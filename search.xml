<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Knowledge Distillation in LLM</title>
    <url>/hexo_blog/2024/08/08/Knowledge-Distillation-in-LLM/</url>
    <content><![CDATA[<p>ä»çŸ¥è¯†è’¸é¦çš„æ¦‚å¿µå‡ºå‘ï¼Œä»‹ç» LLM ä¸­çš„çŸ¥è¯†è’¸é¦</p>
<span id="more"></span>
<h2 id="outlines">Outlines</h2>
<ul>
<li>Knowledge Distillationï¼ˆçŸ¥è¯†è’¸é¦ï¼‰
<ul>
<li>æ˜¯ä»€ä¹ˆ</li>
<li>æ€ä¹ˆåš</li>
</ul></li>
<li>LLM ä¸­çš„ KD åŠå…¶å˜ç§
<ul>
<li>Reverse KD</li>
<li>JS æ•£åº¦</li>
</ul></li>
<li>è®ºæ–‡
<ul>
<li>MiniLLM: Knowledge Distillation of Large Language Models</li>
<li>Revisiting Knowledge Distillation for Autoregressive Language
Models</li>
</ul></li>
</ul>
<h2 id="çŸ¥è¯†è’¸é¦æ˜¯ä»€ä¹ˆ">çŸ¥è¯†è’¸é¦æ˜¯ä»€ä¹ˆ</h2>
<p><strong>è’¸é¦çš„ä½œç”¨</strong>ï¼šæ¸…é™¤ç»å¤§éƒ¨åˆ†æ‚è´¨å’Œæ€æ­»å¾®ç”Ÿç‰©</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd1.png" /></p>
<p><strong>çŸ¥è¯†</strong>ï¼šé«˜åº¦æŠ½è±¡çš„æ¦‚å¿µ</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd2.png" /></p>
<p>åœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹é‡Œé¢ï¼Œå°†å…¶å…·è±¡ä¸ºï¼š</p>
<ul>
<li><p>æ¨¡å‹æƒé‡ï¼šè‹¥å¹²å›ºå®šå¥½çš„çŸ©é˜µ</p></li>
<li><p>æ¨¡å‹è¾“å‡ºï¼šæ¨¡å‹å¯¹äºè¾“å…¥çš„å“åº”</p></li>
</ul>
<p>æ›´å…·ä½“çš„ï¼Œå¯¹äºä¸€ä¸ªä¸‰åˆ†ç±»æ¨¡å‹ï¼Œæ¨¡å‹æœ€åè¾“å‡ºçš„æ˜¯ logitsã€‚</p>
<p>å¦‚ï¼š<span class="math inline">\([0.2, 0.3,
0.5]\)</span>ï¼Œè¿™ä¸ªå¯ä»¥è¢«è®¤ä¸ºæ˜¯æ¨¡å‹çŸ¥è¯†çš„ä¸€ç§ã€‚</p>
<h2 id="æ€ä¹ˆåšçŸ¥è¯†è’¸é¦">æ€ä¹ˆåšçŸ¥è¯†è’¸é¦</h2>
<h3 id="ç»å…¸çš„è®­ç»ƒæ–¹æ³•">ç»å…¸çš„è®­ç»ƒæ–¹æ³•</h3>
<p>ä¸‰åˆ†ç±»ä»»åŠ¡ï¼Œå¯¹äºè¾“å…¥ <span class="math inline">\(X\)</span></p>
<p>çœŸå®æ ‡ç­¾æ˜¯ç¬¬ 0 ä¸ªç±»åˆ«ï¼Œä¼šå°†å…¶ one-hot ä¸º <span
class="math inline">\([1, 0, 0]\)</span></p>
<p>æ¨¡å‹æ˜¯è¾“å‡ºæ˜¯ <span class="math inline">\([0.1, 0.5,
0.4]\)</span>ï¼Œ</p>
<p>æ¨¡å‹åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œæ˜¯è®©æ¨¡å‹çš„è¾“å‡ºå»æ‹Ÿåˆè¯¥ one-hot
ç»“æœï¼Œè®¡ç®—æ–¹æ³•å¦‚äº¤å‰ç†µæŸå¤±ã€‚</p>
<h3 id="çŸ¥è¯†è’¸é¦çš„è®­ç»ƒæ–¹æ³•">çŸ¥è¯†è’¸é¦çš„è®­ç»ƒæ–¹æ³•</h3>
<p>2014 å¹´ï¼ŒHinton æå‡ºäº†<a
href="https://arxiv.org/abs/1503.02531">çŸ¥è¯†è’¸é¦</a>çš„æ¦‚å¿µï¼Œæ—¨åœ¨å°†å¤§æ¨¡å‹ï¼ˆæ•™å¸ˆï¼‰çš„çŸ¥è¯†ä¼ é€’ç»™å°æ¨¡å‹ï¼ˆå­¦ç”Ÿï¼‰ï¼Œä»¥æå‡å­¦ç”Ÿçš„èƒ½åŠ›ï¼Œå®ç°æ¨¡å‹å‹ç¼©çš„ç›®çš„ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd3.png" /></p>
<p>æ­¥éª¤ï¼š</p>
<ol type="1">
<li><p>æ•™å¸ˆé€šè¿‡æŸä¸ªä»»åŠ¡è®­ç»ƒåï¼ˆç¡®ä¿æ•™å¸ˆæ˜¯æ”¶æ•›çš„ï¼‰ã€‚</p></li>
<li><p>å­¦ç”Ÿåœ¨è®­ç»ƒåŒæ ·ä»»åŠ¡æ—¶ï¼Œå¯¹äºåŒä¸€ä¸ªè¾“å…¥ï¼Œè€å¸ˆå’Œå­¦ç”Ÿä¼šæœ‰ä¸åŒçš„è¾“å‡ºï¼Œä»¤å­¦ç”Ÿçš„è¾“å‡ºå»æ‹Ÿåˆæ•™å¸ˆçš„è¾“å‡ºã€‚è®¡ç®—æ–¹æ³•å¦‚
<a
href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence">Kullbackâ€“Leibler
divergence</a>ï¼ˆKL æ•£åº¦ï¼‰ã€‚</p></li>
</ol>
<p>æ³¨ï¼šæ­¤æ—¶å­¦ç”Ÿçš„è¾“å‡ºåŒæ—¶ä¼šæ‹Ÿåˆ one-hot æ ‡ç­¾ï¼Œäº¤å‰ç†µã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kl_loss = nn.KLDivLoss(reduction=<span class="string">&quot;batchmean&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_logits = torch.randn(<span class="number">3</span>, <span class="number">5</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tea_logits = torch.randn(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">input</span> = F.log_softmax(stu_logits, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>target = F.softmax(tea_logits, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>output = kl_loss(<span class="built_in">input</span>, target)</span><br></pre></td></tr></table></figure>
<p><strong>KL æ•£åº¦</strong></p>
<p>è¡¡é‡æ¦‚ç‡åˆ†å¸ƒ <span
class="math inline">\(Q\)</span>ï¼ˆå­¦ç”Ÿï¼‰ä¸ç¬¬äºŒä¸ªå‚è€ƒæ¦‚ç‡åˆ†å¸ƒ <span
class="math inline">\(P\)</span> ï¼ˆæ•™å¸ˆï¼‰æœ‰å¤šå¤§çš„ä¸åŒã€‚æˆ–è€…è¯´ï¼Œ<span
class="math inline">\(P\)</span> ç›¸å¯¹äº <span
class="math inline">\(Q\)</span> çš„ç›¸å¯¹ç†µ</p>
<p><span class="math display">\[
L(Q, P) = {\displaystyle D_{\text{KL}}(P\parallel Q)=\sum _{x\in
{\mathcal {X}}}P(x)\ \log \left({\frac {\ P(x)\ }{Q(x)}}\right).}
\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(P\)</span> å’Œ <span
class="math inline">\(Q\)</span> ä½œä¸ºæ¦‚ç‡åˆ†å¸ƒå¯ä»¥ç”¨ä¸€ä¸ªæ¸©åº¦ <span
class="math inline">\(T\)</span> æ¥ å¹³æ»‘/å°–é” åˆ†å¸ƒ</p>
<h3 id="çŸ¥è¯†è’¸é¦çš„å˜ç§">çŸ¥è¯†è’¸é¦çš„å˜ç§</h3>
<p>ç”±äºã€ŒçŸ¥è¯†ã€å¯ä»¥åŒ…å«å¤ªå¤šä¸œè¥¿ï¼Œæ‰€ä»¥åªè¦è·Ÿæ¨¡å‹ç›¸å…³çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯çŸ¥è¯†ã€‚</p>
<ul>
<li><p>æœ¬èº«çš„æƒé‡ â†’ æ¨¡å‹èåˆ</p></li>
<li><p>ä¸­é—´å±‚è¾“å‡ºçš„ç‰¹å¾ â†’ é¢„è®­ç»ƒååšä¸‹æ¸¸çš„ Fine-tuning</p></li>
<li><p>æœ€åä¸€å±‚è¾“å‡ºçš„ logits â†’ ç»å…¸çŸ¥è¯†è’¸é¦</p></li>
<li><p>æ¨¡å‹è¾“å‡ºçš„ logits è¢«è§£ç æˆç¡¬æ ‡ç­¾ï¼ˆç±»åˆ«ä¿¡æ¯ã€æ–‡æœ¬â€¦ï¼‰ â†’
â€œéšå¼â€çš„çŸ¥è¯†è’¸é¦</p></li>
</ul>
<h3 id="çŸ¥è¯†è’¸é¦çš„-q-a">çŸ¥è¯†è’¸é¦çš„ Q &amp; A</h3>
<p>Qï¼šä¸ºä»€ä¹ˆæ˜¯ KL æ•£åº¦ï¼Ÿ</p>
<p>Aï¼šå¦‚æœæœ‰æ›´å¥½ã€æ›´ç®€å•çš„åº¦é‡æ–¹å¼ä¹Ÿå¯ä»¥æ›¿æ¢ï¼Œæ¯”å¦‚ <a
href="https://en.wikipedia.org/wiki/Wasserstein_metric">Wasserstein
metric</a></p>
<p>Qï¼šä¸ºä»€ä¹ˆæ˜¯å¤§æ¨¡å‹åšæ•™å¸ˆï¼Ÿ</p>
<p>Aï¼š</p>
<ul>
<li><p>ä»¥å‹ç¼©ä½œä¸ºå‡ºå‘ç‚¹ï¼Œå°±æ˜¯éœ€è¦æ›´å¥½æ•ˆæœçš„æ¨¡å‹æ¥å¼•å¯¼ã€‚</p></li>
<li><p>ä¹Ÿå¯ä»¥æ˜¯åŒç­‰å°ºå¯¸çš„æ¨¡å‹åšæ•™å¸ˆï¼Œåªè¦èƒ½å¤Ÿåœ¨æŸé¡¹ä»»åŠ¡ä¸Šè¡¨ç°è¶³å¤Ÿå¥½ã€‚å…³é”®è¯ï¼šè‡ªè’¸é¦</p></li>
</ul>
<p>Qï¼šé¢„å…ˆè®­ç»ƒä¸€ä¸ªæ•™å¸ˆæ¨¡å‹æœ‰ç‚¹éº»çƒ¦</p>
<p>Aï¼š</p>
<ul>
<li><p>æ¶ˆé™¤æ‰è¿™ä¸ªè¿‡ç¨‹ã€‚å°±ç±»ä¼¼äºåœ¨çº¿å­¦ä¹ ï¼Œå…³é”®è¯ï¼šåœ¨çº¿è’¸é¦ã€‚</p></li>
<li><p>å¤§æ¨¡å‹é€šå¸¸æ”¶æ•›çš„ä¼šæ¯”å°æ¨¡å‹æ›´å¿«ã€‚ï¼ˆåŒæ—¶è®­ç»ƒï¼Œå¹¶ä¸æ˜¯ä¸è®­ç»ƒï¼‰</p></li>
<li><p>æ•™å¸ˆæ¨¡å‹é€šå¸¸ä¼šè¢«â€œå¥½å¿ƒäººâ€æä¾›å‡ºæ¥ï¼Œåšçš„å·¥ä½œä¸éœ€è¦å¤ªå¤š</p></li>
</ul>
<p>Qï¼šä¸ºä»€ä¹ˆç”¨æœ€åä¸€å±‚çš„ logitsï¼Œä¸­é—´å±‚çš„è¡Œä¸è¡Œï¼Ÿ</p>
<p>Aï¼š</p>
<ul>
<li><p>å¯ä»¥ç”¨ä¸­é—´å±‚ï¼Œä½†ä¼šæœ‰äº›é™åˆ¶ï¼Œéœ€è¦å¼•å…¥é¢å¤–çš„ä¼˜åŒ–ã€‚å…³é”®è¯ï¼šç‰¹å¾è’¸é¦</p></li>
<li><p>æ¶æ„å¯èƒ½ä¸ä¸€æ ·</p></li>
<li><p>é€‰å“ªäº›å±‚è’¸é¦å“ªäº›å±‚ã€‚æ¯”å¦‚æ•™å¸ˆæœ‰20å±‚ï¼Œå­¦ç”Ÿæœ‰10å±‚ï¼Œå“ªäº›å±‚çš„è¾“å‡ºä½œä¸ºæ‹Ÿåˆå¯¹è±¡æ˜¯ä¸å¥½ç¡®å®šçš„ã€‚</p></li>
</ul>
<p>Qï¼šå…¶ä»– tricks</p>
<p>Aï¼š</p>
<ul>
<li><p>æ¸©åº¦ temperatureï¼Œè¶…å‚æ•°ã€‚</p></li>
<li><p>KL çš„æƒé‡ç³»æ•°</p></li>
<li><p>è’¸é¦çš„è®¡ç®—æ–¹æ³•</p></li>
</ul>
<p>â€¦â€¦</p>
<h2 id="åœ¨-llm-ä¸­çš„çŸ¥è¯†è’¸é¦"><a
href="https://arxiv.org/abs/2402.13116">åœ¨ LLM ä¸­çš„çŸ¥è¯†è’¸é¦</a></h2>
<p>ç”±äºç®—åŠ›ã€æ•°æ®ç­‰åŸå› ï¼Œå¼€æºæ¨¡å‹å¾€å¾€å¼±äºé—­æºæ¨¡å‹ã€‚çŸ¥è¯†è’¸é¦æ˜¯ä¸€ç§å¯èƒ½ç¼©å°è¿™ä¸¤è€…å·®è·çš„æ‰‹æ®µã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd4.png" /></p>
<h3 id="ä¸‰ç§æ–¹æ³•">ä¸‰ç§æ–¹æ³•</h3>
<ul>
<li><p>é’ˆå¯¹ç‰¹å®šé¢†åŸŸï¼Œå›ºå®šçŸ¥è¯†ç§å­(å‡ç»ƒå‡ºè‹¥å¹²ç‰¹å®šçš„é—®é¢˜ï¼‰ï¼Œç”¨é—­æºæ¨¡å‹ç”Ÿæˆæ›´å¤šçš„æ•°æ®ï¼ˆéšå¼çš„çŸ¥è¯†è’¸é¦ï¼‰ã€‚ï¼ˆPASSï¼‰</p></li>
<li><p>æ¨¡å‹å‹ç¼©ï¼ˆPASSï¼‰</p></li>
<li><p>è‡ªæˆ‘æå‡ï¼ˆself-improvementï¼‰</p>
<ul>
<li><p>SFT æ¨¡å‹ç”Ÿæˆæ•°æ®æ ‡æ³¨åä½œä¸º DPO çš„çš„è®­ç»ƒæ•°æ®ï¼Œ<a
href="https://arxiv.org/abs/2305.18290">https://arxiv.org/abs/2305.18290</a></p></li>
<li><p>ç”¨å¼€æºæ¨¡å‹ç”Ÿæˆ Q &amp; A ä½œä¸º SFT è®­ç»ƒæ•°æ®ï¼Œ <a
href="https://arxiv.org/abs/2406.08464">https://arxiv.org/abs/2406.08464</a></p></li>
</ul></li>
</ul>
<p>æ³¨ï¼šè‡ªæˆ‘æå‡åœ¨è’¸é¦é‡Œé¢åˆè¢«å«åšè‡ªè’¸é¦</p>
<h2 id="llm-sft-ä¸­è’¸é¦çš„ç±»åˆ«">LLM SFT ä¸­è’¸é¦çš„ç±»åˆ«</h2>
<p>LLMï¼šåœ¨è¶…å¤šåˆ†ç±»ä»»åŠ¡ä¸Šè¿›è¡Œè®­ç»ƒçš„å¤§å°ºå¯¸æ¨¡å‹ã€‚æ‰€ä»¥ï¼Œç›¸è¾ƒäºç»å…¸çŸ¥è¯†è’¸é¦ï¼Œä¼šæœ‰ä¸€äº›ä¸åŒã€‚</p>
<p>$p(x) $ è¡¨ç¤ºæ•™å¸ˆè¾“å‡ºï¼Œ$q(x) $ è¡¨ç¤ºå­¦ç”Ÿè¾“å‡º</p>
<ul>
<li><p>Forward KDï¼ˆç»å…¸è’¸é¦ï¼‰: <span
class="math display">\[D_{\text{KL}}(P\parallel Q)=\sum_x p(x) \log
[\frac{p(x)}{q(x)}]\]</span></p></li>
<li><p>Reverse KD: <span class="math display">\[D_{\text{KL}}(Q\parallel
P)=\sum_x q(x) \log [\frac{q(x)}{p(x)}]\]</span></p></li>
<li><p>JS Divergence: <span
class="math display">\[\frac{1}{2}(D_{\text{KL}}(P\parallel
Q)+D_{\text{KL}}(Q\parallel P))\]</span></p></li>
</ul>
<p>å…¶ä»–ï¼šå¯¹äºæ¨¡å‹ä¸­é—´å±‚çš„è¾“å‡ºè¿›è¡Œå¯¹é½</p>
<h2 id="reverse-kd">Reverse KD</h2>
<p>æ¥æºï¼š<a
href="https://agustinus.kristia.de/techblog/2016/12/21/forward-reverse-kl/">https://agustinus.kristia.de/techblog/2016/12/21/forward-reverse-kl/</a></p>
<h3 id="å›é¡¾-kl-æŸå¤±">å›é¡¾ KL æŸå¤±</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd5.png" /></p>
<p>è“çº¿ï¼ˆæ•™å¸ˆï¼‰æ˜¯ p(x)ï¼Œç»¿çº¿ï¼ˆå­¦ç”Ÿï¼‰æ˜¯ q(x)ã€‚KL æ•£åº¦çš„å°±æ˜¯è®¡ç®—
åŠ æƒå¹³å‡å€¼ã€‚</p>
<p><span class="math display">\[
\sum_x p(x) \log [\frac{p(x)}{q(x)}]
\]</span></p>
<p>é‚£ä¹ˆï¼Œå‡ºç°ä¸‹é¢çš„æƒ…å†µæ—¶ï¼ŒKL æ•£åº¦å°±ä¼šç‰¹åˆ«å¤§ï¼ˆè“çº¿ä¸¤ä¸ªå‡¸çš„åŒºåŸŸï¼‰</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd6.png" /></p>
<p>ç»¿çº¿æ‹Ÿåˆè“çº¿ä¹‹åï¼Œä¼šè®©ç»¿çº¿åˆ†å¸ƒçš„æ›´å¹¿æ³›ï¼ˆåŸæ¥æ²¡æœ‰å€¼çš„åœ°æ–¹æœ‰å€¼äº†ï¼‰ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd7.png" /></p>
<p>å¯¼è‡´ä¸åº”è¯¥æœ‰å€¼çš„åœ°æ–¹æœ‰å€¼ï¼Œå¯¹äºæŸäº›è¾“å…¥xï¼Œæœ‰äº›ç±»åˆ«æ¦‚ç‡åº”è¯¥ä¸º 0ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd8.gif" /></p>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<p>Reverse KL å°±æ˜¯å°† <span class="math inline">\(p\)</span>ã€<span
class="math inline">\(q\)</span> ä½ç½®äº’æ¢ï¼Œ</p>
<p><span class="math display">\[
\sum_x q(x) \log [\frac{q(x)}{p(x)}]
\]</span></p>
<p>æ­¤æ—¶ï¼Œå†çœ‹åˆšåˆšè¿™å¼ å›¾</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd9.png" /></p>
<p><span class="math inline">\(q(x)\)</span>
æ­¤æ—¶ä½œä¸ºæƒé‡ï¼Œä¼šè®©ç»¿çº¿å‡¸å‡ºæ¥çš„åœ°æ–¹æ›´å‡¹ä¸€äº›ã€‚ä½†ä¸ä¼šå­¦ä¹ è“è‰²å³ä¾§å‡¸çš„åœ°æ–¹ã€‚</p>
<p>åœ¨ LLM ä¸Šï¼Œç±»åˆ«æ ‡ç­¾ç‰¹åˆ«å¤šï¼ŒForward KL ä¼šä½¿å¾—å„ä¸ª token id
æ›´åŠ â€œå‡åŒ€â€ã€‚</p>
<ul>
<li><p>å¥½ï¼šå¯ä»¥å¢åŠ å¤šæ ·æ€§</p></li>
<li><p>åï¼šå­¦ç”Ÿå¯èƒ½ä¼šå­¦åˆ°ä¸€äº›ä½è´¨é‡çš„æ¦‚ç‡æ ‡ç­¾ï¼Œä»è€Œå¯¼è‡´ç”Ÿæˆå¹»è§‰å’Œä½è´¨é‡æ–‡æœ¬</p></li>
</ul>
<p>Reverse KL</p>
<ul>
<li><p>å¥½ï¼šé¿å…äº†ä½è´¨é‡æ ‡ç­¾</p></li>
<li><p>åï¼šè¿‡äºç›¸ä¿¡å­¦ç”Ÿçš„é¢„æµ‹ï¼Œå¦‚æœå­¦ç”Ÿçš„é¢„æµ‹ä¸æ˜¯æœ€ä¼˜çš„ï¼ˆå³ç»¿è‰²åœ¨è“è‰²çš„ç¬¬äºŒä¸ªå‡¸å‡ºï¼‰ï¼Œä¼šå˜å·®</p></li>
</ul>
<h3 id="å°ç»“">å°ç»“</h3>
<ul>
<li><p>ç›‘ç£å­¦ä¹ ç”¨ Forward KL â†’ SFT æ¨¡å‹åšæ•™å¸ˆ</p></li>
<li><p>å¼ºåŒ–å­¦ä¹ ç”¨ Reverse KL â†’ DPO è®­ç»ƒæ¨¡å‹åšå­¦ç”Ÿ</p></li>
</ul>
<p>Qï¼šä¸ºä»€ä¹ˆ RL ç”¨ Reverse KLï¼Ÿ</p>
<p>Aï¼šå¼ºåŒ–å­¦ä¹ åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œä¼šâ€œå…‹éš†â€æ¨¡å‹å¹¶æ›´æ–°åŸæ¥çš„æ¨¡å‹ã€‚å¦‚æœç”¨ Forward
KLï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ KL å€¼è¿‡é«˜ä¼šå¯¼è‡´æ¨¡å‹ä¸æ”¶æ•›ã€‚è€Œ Reverse KL
ä¸€ç§æ›´åŠ ç¨³å¦¥çš„æ–¹å¼ï¼Œèƒ½å¤Ÿä¿è¯ KL
æ•£åº¦è¶³å¤Ÿå°ã€‚ä¸”ç”±äºæ¨¡å‹æ˜¯å…‹éš†çš„ï¼Œæ‰€ä»¥æ•™å¸ˆå’Œå­¦ç”Ÿçš„é¢„æµ‹ç»“æœä¼šæ¯”è¾ƒç›¸åƒï¼Œå³ä¸ä¼šå‡ºç°å­¦ç”Ÿé¢„æµ‹åœ¨æ•™å¸ˆçš„æ¬¡ä¼˜ä¸Šã€‚</p>
<p><a
href="https://www.reddit.com/r/reinforcementlearning/comments/kcqbhv/hi_all_can_anyone_please_help_me_understand_how/">https://www.reddit.com/r/reinforcementlearning/comments/kcqbhv/hi_all_can_anyone_please_help_me_understand_how/</a></p>
<p><strong>Summary</strong></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd10.png" /></p>
<p>Jensonâ€“Shannon (JS) Divergence</p>
<p><span class="math display">\[
\frac{1}{2}(D_{\text{KL}}(P\parallel Q)+D_{\text{KL}}(Q\parallel P)ï¼‰
\]</span></p>
<p><span class="math display">\[
\frac{1}{2}(\sum p(x) \log\frac{2p(x)}{p(x)+q(x)} + \sum
q(x)\log\frac{2q(x)}{p(x)+q(x)})
\]</span></p>
<p>KL æ˜¯éå¯¹ç§°çš„ï¼Œ JS æŠŠä¸¤ç§åˆ†å¸ƒçš„ KL
éƒ½ç®—ä¸€éï¼Œä»¥æ­¤å–å¾—äº†å¯¹ç§°çš„ç»“æœã€‚</p>
<p>å¼•å…¥å¯¹ç§°æ€§å¸¦æ¥çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>è®¡ç®—å¤æ‚åº¦é«˜ï¼šè®¡ç®—äº†ä¸¤æ¬¡ KL Divergence</p></li>
<li><p>æ•°å€¼ç¨³å®šæ€§å·®ï¼šå¦‚æœ P å’Œ Q
çš„æ¦‚ç‡åˆ†å¸ƒå·®å¼‚è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå‡ºç°é›¶æˆ–éå¸¸å°çš„æ¦‚ç‡å€¼ã€‚æ¯”å¦‚ p(x) æŸé¡¹ä¸º
0</p></li>
</ul>
<p>ä¸”éå¯¹ç§°æ€§æœ‰æ—¶å€™ä¸æ˜¯ä¸€ç§ç¼ºç‚¹ï¼Œæ˜¯ä¸€ä¸ª featureã€‚</p>
<p><strong>éå¯¹ç§°æ€§</strong>å¸¦æ¥äº†ä»€ä¹ˆï¼šä¿ç•™ã€Œé¢„æµ‹åˆ†å¸ƒã€åˆ°ã€Œç›®æ ‡åˆ†å¸ƒã€çš„æ–¹å‘ä¿¡æ¯</p>
<ul>
<li>åœ¨çœŸå®åˆ†å¸ƒ P ä¸­å¸¸è§çš„äº‹ä»¶ï¼Œå¦‚æœåœ¨é¢„æµ‹åˆ†å¸ƒ Q
ä¸­çš„æ¦‚ç‡è¾ƒä½ã€‚æœ‰åŠ©äºæ¨¡å‹ä¼˜åŒ–ã€‚</li>
</ul>
<p>æ³¨ï¼šè¿˜æœ‰ä¸€ä¸ª <a href="https://arxiv.org/abs/2302.13344">TVD</a>
æ–¹æ³•ï¼Œç±»ä¼¼äº JS åº¦é‡ï¼Œä½†å®ƒç”¨ L1 èŒƒæ•°ä»£æ›¿äº† KL</p>
<h2 id="forward-kdç»å…¸è’¸é¦">Forward KDï¼ˆç»å…¸è’¸é¦ï¼‰</h2>
<p>Baby Llamaï¼š<a
href="https://arxiv.org/abs/2308.02019">https://arxiv.org/abs/2308.02019</a></p>
<p>Less is Moreï¼š<a
href="https://arxiv.org/abs/2210.01351">https://arxiv.org/abs/2210.01351</a>
ï¼ˆBertï¼‰</p>
<p>åˆ†ä¸¤é˜¶æ®µè’¸é¦</p>
<ul>
<li><p>Stage 1: è’¸é¦è®­ç»ƒæœ€åä¸€å±‚</p></li>
<li><p>Stage 2: è’¸é¦è®­ç»ƒä¸­é—´å±‚ï¼Œæ¯å±‚æœ‰ä¸€ä¸ª loss</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd11.png" /></p>
<h2 id="reverse-kd-1">Reverse KD</h2>
<p><a href="https://arxiv.org/abs/2306.08543">è®ºæ–‡</a></p>
<p><a
href="https://github.com/microsoft/LMOps/tree/main/minillm">è®ºæ–‡ä»£ç </a></p>
<h3 id="åŠ¨æœº">åŠ¨æœº</h3>
<p>void regions (ç©ºæ´åŒºåŸŸ)</p>
<p>where ğ‘â€² can be real data distribution (word-level KD) or teacher
distribution ğ‘ (sequence-level KD). Though widely used, KL[ğ‘||ğ‘ğœƒ] has
been shown to overestimate the void regions of ğ‘ in language generation
tasks when ğ‘ğœƒ is insufficiently expressive to cover all the modes of
ğ‘â€²</p>
<p>. KD for LLMs fits the case because LLMs perform various tasks in a
generative manner, such that the low-capacity student models cannot
perfectly imitate the complex language generation distribution of the
teacher models or humans.</p>
<ul>
<li><p>æ¨¡å¼è¦†ç›–é—®é¢˜ï¼šçœŸå®æ•°æ®ï¼ˆæˆ–æ•™å¸ˆæ¨¡å‹ï¼‰çš„åˆ†å¸ƒ ( p )
å¯èƒ½åŒ…å«å¾ˆå¤šå¤æ‚å’Œå¤šæ ·çš„è¯­è¨€æ¨¡å¼ï¼Œè€Œå­¦ç”Ÿæ¨¡å‹ ( $q_{} $ )
å—é™äºæ¨¡å‹å¤æ‚åº¦æˆ–è®­ç»ƒæ•°æ®çš„å±€é™ï¼Œå¯èƒ½æ— æ³•æ¶µç›–æ‰€æœ‰æ¨¡å¼ã€‚</p></li>
<li><p>ç”Ÿæˆè´¨é‡é—®é¢˜ï¼šè¿™ä¼šä½¿å¾—è®­ç»ƒè¿‡ç¨‹ä¸­æ›´å¤šå…³æ³¨è¿™äº›éš¾ä»¥è¦†ç›–çš„æ¨¡å¼ï¼Œå¯¼è‡´å­¦ç”Ÿæ¨¡å‹æ— æ³•æœ‰æ•ˆæé«˜åœ¨å¸¸è§æ¨¡å¼ä¸Šçš„ç”Ÿæˆè´¨é‡ã€‚</p></li>
</ul>
<h3 id="æ–¹æ³•-1">æ–¹æ³•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tea_probs = F.softmax(tea_logits, dim=-<span class="number">1</span>, dtype=torch.float32)</span><br><span class="line">stu_probs = F.log_softmax(logits, dim=-<span class="number">1</span>, dtype=torch.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ‡å‡† KD</span></span><br><span class="line">kd_loss = (tea_probs*(tea_probs.log()-stu_probs)).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ–ç®€</span></span><br><span class="line">kd_loss = (tea_probs*std_probs).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½æ–¹å·®ä¼°è®¡ï¼Œa low-variance estimation KD</span></span><br><span class="line"><span class="comment"># http://joschu.net/blog/kl-approx.html</span></span><br><span class="line">log_ratio = (stu_probs - tea_probs.log())</span><br><span class="line">kd_loss = log_ratio.<span class="built_in">float</span>().exp() - <span class="number">1</span> - log_ratio</span><br></pre></td></tr></table></figure>
<h4 id="approximating-kl-divergence"><a
href="http://joschu.net/blog/kl-approx.html">Approximating KL
Divergence</a></h4>
<p>æ ‡å‡†çš„ KD</p>
<p><span class="math display">\[
KL[q, p] = \sum_x q(x) \log [\frac{q(x)}{p(x)}] = E_{ x \sim q}[\log
\frac{q(x)}{p(x)} ]
\]</span></p>
<p>ç”±äºç²¾ç¡®è®¡ç®—éœ€è¦èŠ±è´¹æ›´å¤šçš„å†…å­˜ï¼Œæ‰€ä»¥æœŸæœ›å¯¹é½è¿›è¡Œä¼°è®¡ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ã€‚</p>
<p><strong>Step 1</strong></p>
<p>ä¸€ç§ç›´æ¥çš„æ€è·¯æ˜¯ç›´æ¥å»æ‰æœ€å¤–é¢çš„ <span
class="math inline">\(q(x)\)</span>ï¼Œæ¼”å˜æˆäº†</p>
<p><span class="math display">\[
-\log\frac{p(x)}{q(x)}
\]</span></p>
<p>å› ä¸ºèˆå»äº†ç³»æ•°ï¼Œå®ƒä¼šä½¿å¾—æ–¹å·®å˜é«˜</p>
<p><strong>Step 2</strong></p>
<p>åŠ ä¸Šå¹³æ–¹ï¼Œé™ä½æ–¹å·®</p>
<p><span class="math display">\[
\frac{1}{2}(\log\frac{p(x)}{q(x)})^2
\]</span></p>
<p><strong>Step 3</strong></p>
<p>ä¾èµ–æ•°å­¦èƒŒæ™¯å…¬å¼</p>
<p><span class="math display">\[
\log(x)\leq x-1
\]</span></p>
<p>ä½†ä¿è¯è¯¥å…¬å¼ <span class="math inline">\(&gt;= 0\)</span>
æ—¶ï¼Œå°±æœ‰</p>
<p><span class="math display">\[
(x-1) - \log(x) \geq 0
\]</span></p>
<p>æŠŠè¿™é‡Œ <span class="math inline">\(x\)</span> æ¢æˆ <span
class="math inline">\(p(x) / q(x)\)</span> å°±å¾—åˆ°äº†ä»£ç çš„è®¡ç®—æ–¹æ³•</p>
<h4 id="optimization-with-policy-gradient">Optimization with Policy
Gradient</h4>
<p>ä¼˜åŒ–å…¬å¼</p>
<p><span
class="math display">\[\theta=\arg\min\limits_{\theta}\mathcal{L}(\theta)=\arg\min\limits_{\theta}\mathrm{KL}[q_{\theta}||p]=\arg\operatorname*{min}_{\theta}\left[-\operatorname*{lim}_{x\sim
p_{\infty},y\sim
q_{\theta}}\log{\frac{p(y|x)}{q_{\theta}(y|x)}}\right]\]</span></p>
<p>Policy Gradient Theore æ±‚å¯¼</p>
<p><span
class="math display">\[\nabla{\mathcal{L}}(\theta)=-\operatorname*{\mathbb{E}}_{\mathbf{x}\sim
p_{\mathbf{x}},y\sim
q_{\theta}(\,\cdot\,|\mathbf{x})}\sum_{t=1}^T(R_{t}-1)\nabla\log
q_{\theta}(y_{t}|\mathbf{y}_{&lt;t},\mathbf{x}),\]</span></p>
<p>å…¶ä¸­ï¼Œ$R_t $ æ˜¯æ¯ä¸€æ­¥ç”Ÿæˆçš„ç´¯ç§¯ï¼Œè¡¡é‡æ¯ä¸€æ­¥çš„ç”Ÿæˆè´¨é‡</p>
<p><span
class="math display">\[R_{t}=\sum_{t^{\prime}=t}^{T}\log\,\frac{p(y_{t^{\prime}}|y_{&lt;t^{\prime}},\mathbf{x})}{q_{\theta}(y_{t^{\prime}}|y_{&lt;t^{\prime}},\mathbf{x})}\]</span></p>
<p>ä¸‰ä¸ªä¼˜åŒ–</p>
<p><strong>ä¼˜åŒ–1ï¼šSingle-Step Decomposition</strong></p>
<p>å•æ­¥ç”Ÿæˆçš„è´¨é‡éƒ½å¾ˆé‡è¦ï¼Œæ‰€ä»¥æŠŠå•æ­¥ç”Ÿæˆå’Œç´¯ç§¯ç”Ÿæˆæ‹†å¼€ï¼Œå¹¶ç›´æ¥è®¡ç®—å•æ­¥ç”Ÿæˆçš„æ¢¯åº¦</p>
$$
<span class="math display">\[\begin{array}{c}
\nabla \mathcal{L}(\theta) = \mathbb{E}_{x\sim p_{x},y\sim
q_{\theta}(\,\cdot\,|x)}\left[-\sum\limits_{t=1}^{T}\nabla\mathbb{E}_{p_{t}\sim
q_{\theta}(t)}[r_t]\right]+{\mathbb{E}}_{x\sim p_{x},y\sim
q_{\theta}(\,\cdot\,|x)}\left[-\sum\limits_{t=1}^{T}R_{t+1}\nabla\log
q_{\theta}(y_{t}|\bm{y}_{&lt;t},\bm{x})\right]\\

=(\nabla \mathcal{L})_\mathrm{single}+(\nabla
\mathcal{L})_{\mathrm{Long}}
\end{array}\]</span>
<p>$$</p>
<p><strong>ä¼˜åŒ–2ï¼šTeacher-Mixed Sampling</strong></p>
<p>æ•™å¸ˆç”Ÿæˆçš„å¥å­å¯èƒ½ä¼šé‡å¤ï¼Œæ‰€ä»¥ç”¨æ•™å¸ˆå’Œå­¦ç”Ÿçš„æ··åˆåˆ†å¸ƒæ¥ä»£æ›¿åŸæœ‰çš„æ•™å¸ˆåˆ†å¸ƒ
(px)ï¼Œå¹¶ä¸”ç”¨ $$ æ¥æ§åˆ¶å¼ºåº¦ã€‚</p>
<p><span
class="math display">\[\tilde{p}(y_{t}\,|\,y_{&lt;\,t},x)=\alpha\cdot
p(y_{t}\,|\,y_{&lt;\,t},x)+(1-\alpha)\cdot
q_{\theta}(y_{t}\,|\,y_{&lt;\,t},x),\]</span></p>
<p>å³ï¼Œ</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd17.png" /></p>
<p><strong>ä¼˜åŒ–3ï¼šLength Normalization</strong></p>
<p>æ¨¡å‹ä¼šä¸ºäº†æ›´ä½çš„æŸå¤±ï¼Œå®¹æ˜“â€œå·æ‡’â€ç”ŸæˆçŸ­æ–‡æœ¬ã€‚ä¸ºäº†æ¶ˆé™¤é•¿åº¦å½±å“ï¼ŒåŠ å…¥é•¿çŸ­æ–‡æœ¬çš„å½’ä¸€åŒ–æ“ä½œ</p>
<p><span
class="math display">\[R_{t+1}^{\mathrm{Norm}}=\frac{1}{T-t-1}\sum_{t^{\prime}=t+1}^{T}\log\frac{p(y_{t^{\prime}}|y_{&lt;t^{\prime}},\mathbf{x})}{q_{\theta}(y_{t^{\prime}}|y_{&lt;t^{\prime}},\mathbf{x})}.\]</span></p>
<p>ç»¼ä¸Šï¼Œæœ€åçš„å…¬å¼ä¸º</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd19.png" /></p>
<p>ç»“æœ</p>
<ul>
<li><p>SFT w/o KDï¼šæ ‡å‡† SFT</p></li>
<li><p>KDï¼š æ ‡å‡† SFT åŠ å…¥ KD æŸå¤±ï¼Œåˆç§°ä¸º Word-Level KD</p></li>
<li><p>SeqKDï¼šå¥å­çº§åˆ«çš„KDï¼Œåœ¨æ•™å¸ˆæ¨¡å‹ç”Ÿæˆçš„æ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒ</p></li>
<li><p>MINILLMï¼šæå‡ºçš„æ–¹æ³•ï¼Œreverse KD + PPO + è‹¥å¹² tricks</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd20.png" /></p>
<h3 id="æ¶ˆèå®éªŒ">æ¶ˆèå®éªŒ</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd21.png" /></p>
<h2 id="è§£è€¦çŸ¥è¯†è’¸é¦">è§£è€¦çŸ¥è¯†è’¸é¦</h2>
<p><a
href="https://openreview.net/pdf/73503af2a5797fb9046f0fa702c3a4d5ea5ceaf8.pdf">è®ºæ–‡</a></p>
<h3 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h3>
<p><a href="https://arxiv.org/abs/2203.08679">è®ºæ–‡</a></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd22.png" /></p>
<p>æŠŠ KD æ‹†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒDKD+TKDã€‚å…¶ä¸­ï¼Œ</p>
<ul>
<li><p>TKD æŒ‡çš„æ˜¯ ground truth å¯¹åº”çš„ logits ï¼ˆTCKDï¼‰</p></li>
<li><p>DKD æŒ‡çš„æ˜¯é ground truth å¯¹åº”çš„ logitsï¼ˆNCKDï¼‰</p></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kl_loss = nn.KLDivLoss(reduction=<span class="string">&quot;batchmean&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_logits = torch.randn(<span class="number">3</span>, <span class="number">5</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tea_logits = torch.randn(<span class="number">3</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>ç»å…¸ KD</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">input</span> = F.log_softmax(stu_logits, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>target = F.softmax(tea_logits, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>loss = kl_loss(<span class="built_in">input</span>, target)</span><br></pre></td></tr></table></figure>
<p>DKD + TKD <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dkd_tea = F.softmax(tea_logits - <span class="number">1000</span> * gt_mask, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dkd_stu = F.log_softmax(stu_logits - <span class="number">1000</span> * gt_mask, dim=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dkd_loss = kl_loss(dkd_stu, dkd_tea)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tea_probs = F.softmax(tea_logits)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu_probs = F.softmax(stu_logits)</span><br><span class="line"><span class="comment"># å‡è®¾ tea_probs = [0.4, 0.3, 0.3], stu_probs = [0.2, 0.6, 0.2]</span></span><br><span class="line"><span class="comment"># target ä¸ºç¬¬ 0 ä¸ªä½ç½®</span></span><br><span class="line"><span class="comment"># tkd_loss  ä¸º [0.4, 0.6] å’Œ [0.2, 0.8] å®ƒä»¬çš„ kl æ•£åº¦</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>output = w1*dkd_loss + w2*tkd_loss</span><br></pre></td></tr></table></figure></p>
<p>TKDï¼šæ ·æœ¬çš„â€œéš¾åº¦â€ä¿¡æ¯</p>
<blockquote>
<p>transfers the knowledge concerning the â€œdifficultyâ€ of training
samples.</p>
</blockquote>
<p>DKDï¼šæ ·æœ¬çš„â€œæš—çŸ¥è¯†â€</p>
<blockquote>
<p>is the prominent reason why logit distillation works but is greatly
suppressed.</p>
</blockquote>
<p><strong>ç»“æœ</strong></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd23.png" /></p>
<p>ç‰¹å¾è’¸é¦ï¼šåœ¨æ¨¡å‹ä¸­é—´å±‚å¢åŠ åº¦é‡çš„æŸå¤±å‡½æ•°</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd24.png" /></p>
<p><a
href="https://github.com/megvii-research/mdistiller/blob/master/mdistiller/distillers/DKD.py">ä»£ç </a></p>
<h3 id="å‘ç°">å‘ç°</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd25.png" /></p>
<ul>
<li><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé ground truth
ï¼ˆDKDï¼‰è’¸é¦æ•ˆæœä¼šä¼˜äºå…¶ä»–æ•ˆæœ</p></li>
<li><p>å°éƒ¨åˆ†æƒ…å†µï¼ˆéš¾å­¦çš„æƒ…å†µï¼‰ï¼ŒåŠ ä¸Š TKD ä¼šæ›´å¥½ã€‚</p></li>
</ul>
<h3 id="æ–¹æ³•-2">æ–¹æ³•</h3>
<p>hard to learn çš„å®šä¹‰</p>
<p><span class="math display">\[
p_{g_{t}}^{t}=\frac{\exp(z_{g_{t}}^{t})}{\sum_{j=1}^{C}\exp(z_{j}^{t})},p_{\backslash
g_{t}}^{t}=\frac{\sum_{k=1,k\neq
g_{t}}^{C}\exp(z_{k}^{t})}{\sum_{j=1}^{C}\exp(z_{j}^{t})}
\]</span></p>
<p>å¯¹äºæ¯ä¸ªè¦é¢„æµ‹çš„ tokenï¼Œæ•™å¸ˆæ¨¡å‹ä¼šè¾“å‡ºä¸€ä¸ª logitsï¼Œgt è¡¨ç¤º ground
truth çš„ tokenï¼Œè€Œ è¡¨ç¤ºé ground truth çš„ tokenã€‚</p>
<p>è¡¥å……ï¼Œ</p>
<ul>
<li><p><span class="math inline">\([0.1,0.9]\)</span> å¥½å­¦</p></li>
<li><p><span class="math inline">\([0.5,0.5]\)</span> ä¸å¥½å­¦</p></li>
</ul>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œæ˜¯å¯¹ logits å– softmax åçš„ç»“æœï¼ˆæ¦‚ç‡ï¼‰ï¼ŒUNC ä¸º é ground
truth token çš„ æ¦‚ç‡å€¼ä¹‹å’Œã€‚å…¶è¶Šå¤§åˆ™è¡¨ç¤ºè¿™ä¸ªè¶Šéš¾å­¦ã€‚</p>
<p>é€šè¿‡ UNC è¿™ä¸ªæŒ‡æ ‡å˜æˆæˆ TKD çš„ç³»æ•°ï¼Œè‡ªé€‚åº”çš„è®­ç»ƒã€‚</p>
<h3 id="ç»“æœ">ç»“æœ</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/kdinLLM/kd27.png" /></p>
<h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h2>
<p>ã€Œä½ å¥½ï¼Œã€åé¢å¯ä»¥æ¥ã€Œä¸–ç•Œã€ï¼Œå¯ä»¥æ¥ã€ŒåŒ—äº¬ã€ã€‚</p>
<p>åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œæœ‰ä¸¤æ¡æ ·æœ¬ã€Œä½ å¥½ï¼Œä¸–ç•Œã€å’Œã€Œä½ å¥½ï¼ŒåŒ—äº¬ã€ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¯¹äºä»»æ„ä¸€æ¡æ ·æœ¬ï¼Œã€Œä¸–ç•Œã€å’Œã€ŒåŒ—äº¬ã€çš„
one-shot ç¼–ç æ˜¯ [0, 1, 0] å’Œ [0, 0, 1] ã€‚</p>
<p>ä¸¤ä¸ªä¸ç¡®å®šï¼š</p>
<ul>
<li><p>æ— æ³•æ§åˆ¶æ¨¡å‹æœ€ç»ˆå­¦åˆ°çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯ä»€ä¹ˆæ ·çš„</p></li>
<li><p>ä¸çŸ¥é“æœ€ä½³åˆ†å¸ƒæ˜¯ä»€ä¹ˆ</p></li>
</ul>
<p>çŸ¥è¯†è’¸é¦ï¼š</p>
<ul>
<li><p>å¯ä»¥æ›´å®¹æ˜“æ§åˆ¶å­¦ç”Ÿæ¨¡å‹å­¦ä¹ å“ªç§åˆ†å¸ƒ</p></li>
<li><p>æ•™å¸ˆæ¨¡å‹ä¼šè¾“å‡ºä¸€ç§æ›´å¥½çš„åˆ†å¸ƒ</p></li>
</ul>
]]></content>
      <categories>
        <category>PaperReading</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>LLM</tag>
        <tag>knowledge distillation</tag>
      </tags>
  </entry>
  <entry>
    <title>iCalendarï¼šICSåœ¨çº¿è¯¾è¡¨åˆ¶ä½œ</title>
    <url>/hexo_blog/2020/09/16/ICS%E5%9C%A8%E7%BA%BF%E8%AF%BE%E8%A1%A8%E5%88%B6%E4%BD%9C/</url>
    <content><![CDATA[<p>å¦‚ä½•åˆ¶ä½œåœ¨çº¿çš„æ—¥å†icsæ–‡ä»¶ï¼Œæœ€åä»‹ç»å„ä¸ªè®¾å¤‡å¦‚ä½•ä½¿ç”¨</p>
<span id="more"></span>
<h2 id="æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆ</h2>
<p>ICSä¸ºiCalendarçš„æ–‡ä»¶åï¼Œå®ƒæ˜¯â€œæ—¥å†æ•°æ®äº¤æ¢â€çš„æ ‡å‡†ã€‚å¤§å¤šæ•°æ—¥å†æœ¬è´¨åˆ›å»ºäº‹é¡¹éƒ½æ˜¯é€šè¿‡icsè¿™ç§æ ¼å¼æ¥ç”Ÿæˆã€è§£æã€‚è¯¦è§<a
href="https://zh.wikipedia.org/wiki/ICalendar">Wikipedia</a></p>
<h2 id="ä¸ºä»€ä¹ˆ">ä¸ºä»€ä¹ˆ</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä¸´æ—¶ä¼šè®®/äº‹ä»¶ï¼Œå°±ç›´æ¥åœ¨æ—¥å†æ·»åŠ äº‹ä»¶å³å¯ã€‚ä½†å¦‚æœæ˜¯ä¸€äº›å‘¨æœŸæ€§ã€æŸä¸ªæ—¶é—´æ®µæŒç»­çš„äº‹ä»¶æ´»åŠ¨ï¼Œå¦‚æœæ‰‹åŠ¨æ·»åŠ å°±å¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„å°±æ˜¯è¯¾è¡¨ã€‚è¿˜æœ‰ä¸€äº›å¦‚å­¦æœ¯ä¼šè®®ã€çƒèµ›ã€å®šæœŸæ´»åŠ¨ã€èŠ‚å‡æ—¥ç­‰ã€‚è¿™ç±»å¾€å¾€æ˜¯é€šè¿‡ä»–äººåˆ¶ä½œå¥½icsæ–‡ä»¶ï¼Œæœ¬åœ°å¯¼å…¥å³å¯ã€‚</p>
<h2 id="æ€ä¹ˆåš">æ€ä¹ˆåš</h2>
<p>æˆ‘çš„ç›®æ ‡å°±æ˜¯åˆ¶ä½œè‡ªå·±çš„è¯¾è¡¨ï¼ˆåœ¨çº¿ï¼‰</p>
<h3 id="æ ¼å¼">æ ¼å¼</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BEGIN:VCALENDAR</span><br><span class="line">VERSION:2.0</span><br><span class="line">PRODID:-//hacksw/handcal//NONSGML v1.0//EN</span><br><span class="line">BEGIN:VEVENT</span><br><span class="line">UID:uid1@example.com</span><br><span class="line">DTSTAMP:19970714T170000Z</span><br><span class="line">ORGANIZER;CN=John Doe:MAILTO:john.doe@example.com</span><br><span class="line">DTSTART:19970714T170000Z</span><br><span class="line">DTEND:19970715T035959Z</span><br><span class="line">SUMMARY:Bastille Day Party</span><br><span class="line">END:VEVENT</span><br><span class="line">END:VCALENDAR</span><br></pre></td></tr></table></figure>
<p>ä»¥è¡Œä¸ºåˆ†éš”ï¼Œæ¯è¡Œä»¥å†’å·åˆ†éš”ã€‚</p>
<p>ç¬¬ä¸€è¡Œï¼Œæ¯ä¸ªicsæ–‡ä»¶çš„å¼€å¤´ï¼Œå¯¹åº”æœ€åä¸€è¡Œ</p>
<p>ç¬¬äºŒè¡Œï¼Œç‰ˆæœ¬ï¼ˆé»˜è®¤ï¼‰</p>
<p>ç¬¬ä¸‰è¡Œï¼šå¯è‡ªå®šä¹‰ï¼Œæ–‡ä»¶è¯´æ˜</p>
<p>ç¬¬å››è¡Œï¼šå®šä¹‰ä¸€ä¸ªäº‹ä»¶åç§°ï¼Œå¯¹åº”å€’æ•°ç¬¬äºŒè¡Œ</p>
<p>ç¬¬äº”è¡Œï¼šå”¯ä¸€çš„id</p>
<p>ç¬¬å…­è¡Œï¼šåˆ›å»ºè¿™ä¸ªäº‹ä»¶çš„æ—¶é—´</p>
<p>ç¬¬ä¸ƒè¡Œï¼šå¯å¿½ç•¥</p>
<p>ç¬¬å…«è¡Œï¼šå¼€å§‹æ—¶é—´</p>
<p>ç¬¬ä¹è¡Œï¼šç»“æŸæ—¶é—´</p>
<p>ç¬¬åè¡Œï¼šäº‹ä»¶åç§°</p>
<h3 id="æˆ‘çš„ç¤ºä¾‹">æˆ‘çš„ç¤ºä¾‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BEGIN:VCALENDAR</span><br><span class="line">VERSION:2.0</span><br><span class="line">PRODID:-//JH-L//JH-L Calendar//</span><br><span class="line">BEGIN:VEVENT</span><br><span class="line">SUMMARY:è¯¾ç¨‹A</span><br><span class="line">DTSTART;TZID=&quot;UTC+08:00&quot;;VALUE=DATE-TIME:20200914T083000</span><br><span class="line">DTEND;TZID=&quot;UTC+08:00&quot;;VALUE=DATE-TIME:20200914T101000</span><br><span class="line">DTSTAMP;VALUE=DATE-TIME:20200915T000946Z</span><br><span class="line">UID:c39b3578-f6e7-11ea-bd58-525400eb2034</span><br><span class="line">DESCRIPTION:è€å¸ˆA</span><br><span class="line">LOCATION:ä¸Šè¯¾åœ°ç‚¹B</span><br><span class="line">END:VEVENT</span><br><span class="line">BEGIN:VEVENT</span><br><span class="line">SUMMARY:è¯¾ç¨‹B</span><br><span class="line">DTSTART;TZID=&quot;UTC+08:00&quot;;VALUE=DATE-TIME:20200916T083000</span><br><span class="line">DTEND;TZID=&quot;UTC+08:00&quot;;VALUE=DATE-TIME:20200916T101000</span><br><span class="line">DTSTAMP;VALUE=DATE-TIME:20200915T000946Z</span><br><span class="line">UID:c39b3af0-f6e7-11ea-bd58-525400eb2034</span><br><span class="line">DESCRIPTION:è€å¸ˆB</span><br><span class="line">LOCATION:ä¸Šè¯¾åœ°ç‚¹A</span><br><span class="line">END:VEVENT</span><br></pre></td></tr></table></figure>
<p>ç›¸æ¯”äºåŸå§‹æ ¼å¼ï¼Œå¤šæ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”æ·»åŠ äº†åœ°ç‚¹
<code>LOCATION</code>å’Œäº‹ä»¶æè¿° <code>DESCRIPTION</code></p>
<h3 id="ç”Ÿæˆ">ç”Ÿæˆ</h3>
<p>æ—¢ç„¶çŸ¥é“æ ¼å¼ï¼Œé‚£ä¹ˆç”Ÿæˆå°±å¾ˆç®€å•äº†ï¼Œå¯ä»¥è‡ªå·±æŒ‰ç…§è¿™ç§æ ¼å¼æ‰‹å†™è¿›ä¸€ä¸ªæ–‡æ¡£ï¼Œåç¼€åä¸ºicså³å¯ã€‚è¿™é‡Œæˆ‘å€ŸåŠ©äº†Pythonçš„icalendaræ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå€ŸåŠ©è¿™ä¸ªå‡½æ•°å¯ä»¥ç”Ÿæˆä¸€ä¸ªäº‹ä»¶ï¼Œç”Ÿæˆåå¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ã€‚è¿™é‡Œuidå› ä¸ºæ˜¯è¦æ±‚å”¯ä¸€çš„ï¼Œæ‰€ä»¥å€ŸåŠ©äº†uuidæ¥å®Œæˆã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œç”±äºæˆ‘ä»¬è¦æ˜¯åŒ—äº¬æ—¶é—´ï¼Œæ‰€ä»¥æ·»åŠ æ—¶é—´æ˜¯ï¼Œéœ€è¦åŠ å…¥
<code>tz_utc_8</code>è¿™ä¸ªå˜é‡
<code>tz_utc_8 = timezone(timedelta(hours=8))</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cread_event</span>(<span class="params">lesson_name, classroom, teacher, start, end</span>):</span><br><span class="line">    <span class="comment"># åˆ›å»ºäº‹ä»¶/æ—¥ç¨‹</span></span><br><span class="line">    event = Event()</span><br><span class="line">    event.add(<span class="string">&#x27;summary&#x27;</span>, lesson_name)</span><br><span class="line"></span><br><span class="line">    dt_now = datetime.now(tz=tz_utc_8)</span><br><span class="line">    event.add(<span class="string">&#x27;dtstart&#x27;</span>, start)</span><br><span class="line">    event.add(<span class="string">&#x27;dtend&#x27;</span>, end)</span><br><span class="line">    <span class="comment"># åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    event.add(<span class="string">&#x27;dtstamp&#x27;</span>, dt_now)</span><br><span class="line">    event.add(<span class="string">&#x27;LOCATION&#x27;</span>, classroom)</span><br><span class="line">    event.add(<span class="string">&#x27;DESCRIPTION&#x27;</span>, <span class="string">&#x27;æ•™å¸ˆï¼š&#x27;</span> + teacher)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># UIDä¿è¯å”¯ä¸€</span></span><br><span class="line">    event[<span class="string">&#x27;uid&#x27;</span>] = <span class="built_in">str</span>(uuid.uuid1()) + <span class="string">&#x27;/wnma3mz@gmail.com&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> event</span><br></pre></td></tr></table></figure>
<p>ä¸‹ä¸€ä¸ªé—®é¢˜å°±å˜ä¸ºï¼Œå¼€å§‹æ—¶é—´ä¸ç»“æŸæ—¶é—´è¯¥æ€ä¹ˆå†™ã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨datetimeå‡½æ•°ï¼Œåˆ©ç”¨datetimeæ¥ç”Ÿæˆæ—¶é—´æ ¼å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> lesson <span class="keyword">in</span> cls_lst:</span><br><span class="line">    <span class="comment"># è¯¾ç¨‹åå­—ï¼Œæ•™å¸ˆï¼Œæ•™å®¤</span></span><br><span class="line">    <span class="comment"># è¯¾ç¨‹å¼€å§‹æ—¶é—´(s1å°æ—¶ï¼Œs2åˆ†é’Ÿ)ï¼Œè¯¾ç¨‹ç»“æŸæ—¶é—´(e1å°æ—¶ï¼Œe2åˆ†é’Ÿ)</span></span><br><span class="line">    <span class="comment"># name, teacher, room = f&#x27;&#123;lesson[&quot;name&quot;]&#125;-&#123;lesson[&quot;room&quot;]&#125;&#x27;, lesson[&#x27;teacher&#x27;], lesson[&#x27;room&#x27;]</span></span><br><span class="line">    name, teacher, room = lesson[<span class="string">&#x27;name&#x27;</span>], lesson[<span class="string">&#x27;teacher&#x27;</span>], lesson[<span class="string">&#x27;room&#x27;</span>]</span><br><span class="line">    s1, s2 = lesson[<span class="string">&#x27;time&#x27;</span>][<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    e1, e2 = lesson[<span class="string">&#x27;time&#x27;</span>][-<span class="number">1</span>][-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> week <span class="keyword">in</span> lesson[<span class="string">&#x27;week&#x27;</span>]:</span><br><span class="line">        <span class="comment"># ç¬¬Nå‘¨</span></span><br><span class="line">        week_delta = timedelta(days=(week - <span class="number">1</span>) * <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">for</span> day <span class="keyword">in</span> lesson[<span class="string">&#x27;day&#x27;</span>]:</span><br><span class="line">            <span class="comment"># å‘¨N</span></span><br><span class="line">            day_delta = timedelta(days=(day - <span class="number">1</span>))</span><br><span class="line">            new_date = begin_date + week_delta + day_delta</span><br><span class="line">            <span class="comment"># ä¸Šè¯¾çš„å¹´æœˆæ—¥</span></span><br><span class="line">            new_year, new_month, new_day = new_date.year, new_date.month, new_date.day</span><br><span class="line">            ymd = [new_year, new_month, new_day]</span><br><span class="line">            <span class="comment"># è¯¾ç¨‹å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</span></span><br><span class="line">            start = datetime(*ymd, s1, s2, tzinfo=tz_utc_8)</span><br><span class="line">            end = datetime(*ymd, e1, e2, tzinfo=tz_utc_8)</span><br><span class="line"></span><br><span class="line">            cal.add_component(cread_event(name, room, teacher, start, end))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦æå‰çº¦å®šå¥½æ ¼å¼ã€‚å­¦æœŸå¼€å§‹çš„å¹´æœˆæ—¥ã€ä¸Šè¯¾çš„æ—¶é—´åŠè¯¾ç¨‹ä¸Šè¯¾çš„å‘¨æ•°ã€æ—¶é—´ç­‰ã€‚icsæ˜¯æ”¯æŒå›ºå®šå‘¨æœŸæ·»åŠ äº‹ä»¶çš„ï¼Œä½†æ˜¯ç”±äºæˆ‘çš„è¯¾å¾ˆä¹±ï¼ˆä¸Šè¯¾å‘¨æ•°ä¸ç¡®å®šã€æœ‰çš„è¯¾æ˜¯1-3èŠ‚ï¼Œæœ‰çš„è¯¾æ˜¯2-3èŠ‚ï¼Œæœ‰çš„è¯¾æ˜¯1-2èŠ‚ï¼‰ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œæ²¡æœ‰ä½¿ç”¨å‘¨æœŸè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">time_dict = &#123;</span><br><span class="line">    <span class="number">1</span>: [(<span class="number">8</span>, <span class="number">30</span>), (<span class="number">9</span>, <span class="number">20</span>)],</span><br><span class="line">    <span class="number">2</span>: [(<span class="number">9</span>, <span class="number">20</span>), (<span class="number">10</span>, <span class="number">10</span>)],</span><br><span class="line">    <span class="number">3</span>: [(<span class="number">10</span>, <span class="number">30</span>), (<span class="number">11</span>, <span class="number">20</span>)],</span><br><span class="line">    <span class="number">4</span>: [(<span class="number">11</span>, <span class="number">20</span>), (<span class="number">12</span>, <span class="number">10</span>)],</span><br><span class="line">    <span class="number">5</span>: [(<span class="number">13</span>, <span class="number">30</span>), (<span class="number">14</span>, <span class="number">20</span>)],</span><br><span class="line">    <span class="number">6</span>: [(<span class="number">14</span>, <span class="number">20</span>), (<span class="number">15</span>, <span class="number">10</span>)],</span><br><span class="line">    <span class="number">7</span>: [(<span class="number">15</span>, <span class="number">30</span>), (<span class="number">16</span>, <span class="number">20</span>)],</span><br><span class="line">    <span class="number">8</span>: [(<span class="number">16</span>, <span class="number">20</span>), (<span class="number">17</span>, <span class="number">10</span>)],</span><br><span class="line">    <span class="number">9</span>: [(<span class="number">18</span>, <span class="number">10</span>), (<span class="number">19</span>, <span class="number">00</span>)],</span><br><span class="line">    <span class="number">10</span>: [(<span class="number">19</span>, <span class="number">00</span>), (<span class="number">19</span>, <span class="number">50</span>)],</span><br><span class="line">    <span class="number">11</span>: [(<span class="number">20</span>, <span class="number">10</span>), (<span class="number">21</span>, <span class="number">00</span>)],</span><br><span class="line">    <span class="number">12</span>: [(<span class="number">21</span>, <span class="number">00</span>), (<span class="number">21</span>, <span class="number">50</span>)],</span><br><span class="line">&#125;</span><br><span class="line">begin_year = <span class="number">2020</span></span><br><span class="line">begin_month = <span class="number">9</span></span><br><span class="line">begin_day = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">cls_lst = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;è¯¾ç¨‹A&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;teacher&#x27;</span>: <span class="string">&#x27;æ•™å¸ˆåç§°&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;room&#x27;</span>: <span class="string">&#x27;æ•™å®¤&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span>: [time_dict[<span class="number">1</span>], time_dict[<span class="number">2</span>]], <span class="comment"># ç¬¬ä¸€èŠ‚è¯¾-ç¬¬äºŒèŠ‚è¯¾</span></span><br><span class="line">            <span class="string">&#x27;week&#x27;</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>], <span class="comment"># 2-10å‘¨</span></span><br><span class="line">            <span class="string">&#x27;day&#x27;</span>: [<span class="number">1</span>, <span class="number">3</span>] <span class="comment"># å‘¨ä¸€ã€å‘¨ä¸‰</span></span><br><span class="line">        &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´ä»£ç è§<a
href="https://github.com/wnma3mz/Tools/blob/master/myics.py">https://github.com/wnma3mz/Tools/blob/master/others/myics.py</a></p>
<h3 id="éƒ¨ç½²">éƒ¨ç½²</h3>
<p>ç”Ÿæˆicsæ–‡ä»¶åï¼Œå¦‚æœä¸éœ€è¦æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å¯¼å…¥åˆ°æœ¬åœ°çš„æ—¥å†ä¸­ã€‚IOSç³»ç»Ÿå¯ç›´æ¥å¯¼å…¥ï¼Œå®‰å“æ‰‹æœºéƒ¨åˆ†ä¸æ”¯æŒï¼Œä¸”å¦‚æœå¯¼å…¥ååˆ é™¤å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªåˆ é™¤ã€‚ã€‚ã€‚</p>
<p>æ³¨ï¼šå°ç±³ã€VIVOç»æµ‹è¯•ä¸å¯å¯¼å…¥ï¼Œå› ä¸ºå‚å•†é˜‰å‰²äº†æ­¤åŠŸèƒ½ï¼›é­…æ—ã€è£è€€ã€ä¸‰æ˜Ÿã€è‹¹æœã€åä¸ºå‡å¯å¯¼å…¥ï¼Œå…¶ä¸­è‹¹æœå¯¼å…¥çš„æ–¹å¼æ˜¯ç”¨é‚®ä»¶å‘é€åˆ°iosè®¾å¤‡ä¸Šçš„å·²ç»‘å®šçš„é‚®ä»¶ä¸­ã€‚</p>
<p>æ•…åŸºäºæ­¤ï¼Œæœ€ç»ˆè€ƒè™‘è¿˜æ˜¯ä½¿ç”¨åœ¨çº¿éƒ¨ç½²çš„æ–¹å¼è¿›è¡Œå¯¼å…¥ã€‚ä¸ºæ–¹ä¾¿IOSå¯¼å…¥ï¼Œæ‰€ä»¥éœ€è¦é…ç½®å¥½httpsã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       port;</span><br><span class="line">    listen       [::]:port ipv6only=on;</span><br><span class="line">    server_name  ics.test.com; <span class="comment"># ioså¯¼å…¥å¿…é¡»ä½¿ç”¨åŸŸå</span></span><br><span class="line">    root         /ics_dir;;</span><br><span class="line">    index        my.ics;</span><br><span class="line">    rewrite ^(.*)$ https://$host$<span class="number">1</span> permanent;</span><br><span class="line">  </span><br><span class="line">    location / &#123;</span><br><span class="line">        root  /ics_dir;</span><br><span class="line">        index my.ics;</span><br><span class="line">	    access_log off;</span><br><span class="line">	    expires 1d;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~* ^.+\.(ics) &#123;</span><br><span class="line">        root /ics_dir;</span><br><span class="line"> 	    access_log off;</span><br><span class="line"> 	    expires 1d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">       listen       <span class="number">443</span> ssl http2;</span><br><span class="line">       listen       [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">       server_name  ics.test.com;</span><br><span class="line">       ssl_certificate /etc/nginx/ics.test.com/Nginx/1_ics.test.com_bundle.crt;</span><br><span class="line">       ssl_certificate_key /etc/nginx/ics.test.com/Nginx/2_ics.test.com.key;</span><br><span class="line">       location / &#123;</span><br><span class="line">           tcp_nodelay on;</span><br><span class="line">           proxy_set_header Host $host;</span><br><span class="line">           proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">           root         /ics_dir;</span><br><span class="line">           index        my.ics;</span><br><span class="line">       &#125;</span><br><span class="line">       location ~* ^.+\.(ics) &#123;</span><br><span class="line">	         root /ics_dir;</span><br><span class="line">	         access_log off;</span><br><span class="line">		       expires 1d;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>éƒ¨ç½²æˆåŠŸåï¼Œç›´æ¥è®¿é—®ics.test.comä¼šç›´æ¥è¯¥icsæ–‡ä»¶</p>
<h3 id="å„ä¸ªè®¾å¤‡é…ç½®">å„ä¸ªè®¾å¤‡é…ç½®</h3>
<p>Windowsç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼šOutlookã€è°·æ­Œæ—¥å†å‡æœ‰åœ¨çº¿å¯¼å…¥icsæ–‡ä»¶çš„å…¥å£</p>
<p>IOS/MacOSç«¯ï¼šæ·»åŠ è´¦å·ä¸­ï¼Œå¯¼å…¥icsæ–‡ä»¶çš„åŸŸåå³å¯</p>
<p>å®‰å“ç«¯ï¼šç”±äºåŸç”Ÿæ—¥å†ä¸æ”¯æŒè¯¥é¡¹åŠŸèƒ½ï¼Œæ•…ä½¿ç”¨OneCalendarã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨Windowsç«¯é…ç½®å¥½åï¼Œä¸‹è½½å¯¹åº”APPäº¦å¯ã€‚</p>
<h2 id="å†™åˆ°æœ€å">å†™åˆ°æœ€å</h2>
<p>åˆ¶ä½œå®Œæˆä¹‹åå‘ç°ï¼Œæˆ‘æ ¡å±…ç„¶è‡ªåŠ¨ç”Ÿæˆäº†icsæ–‡ä»¶ã€‚ã€‚ã€‚ï¼ˆä½†æ„Ÿè§‰è¿˜æ˜¯ä¸å¦‚è‡ªå·±åšçš„å¥½ã€‚ã€‚ã€‚ã€‚ï¼‰</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ICS</tag>
      </tags>
  </entry>
  <entry>
    <title>LLM ä¸åŒç¡¬ä»¶æ¨ç†é€Ÿåº¦å¯¹æ¯”</title>
    <url>/hexo_blog/2024/07/21/LLM%20%E7%A1%AC%E4%BB%B6%E6%AF%94%E4%BB%B7/</url>
    <content><![CDATA[<p>å¯¹æ¯”ä¸åŒç¡¬ä»¶ä¸‹ï¼ŒLLM çš„æ¨ç†é€Ÿåº¦</p>
<span id="more"></span>
<p>ç”Ÿæˆé˜¶æ®µï¼Œ20 Token/s è®¤ä¸ºæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¯ä»¥æ¥å—çš„é€Ÿåº¦ï¼Œå³ 20 / 1000 =
0.02 s = 20 ms</p>
<table style="width:100%;">
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>æ¨¡å‹å°ºå¯¸</th>
<th>é€Ÿåº¦</th>
<th>æ¥æº</th>
<th>è®°å½•æ—¶é—´</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 x RasPi 5 8 GB</td>
<td>Llama 3 8B ï¼ˆQ4ï¼‰</td>
<td>564.31 ms, 1.77 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 556.67 ms, T: 6.17 ms</td>
<td>https://github.com/b4rtaz/distributed-llama/blob/main/README.md</td>
<td>2024.07.21</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4 x RasPi 5 8 GB</td>
<td>Llama 3 8B ï¼ˆQ4ï¼‰</td>
<td>331.47 ms, 3.01 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 267.62 ms, T: 62.34 ms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>8 x RasPi 4B 8 GB</td>
<td>Llama 2 70Bï¼ˆQ4ï¼‰</td>
<td>4842.81 ms</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 2121.94 ms, T: 2719.62 ms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>c3d-highcpu-30</td>
<td>Llama 2 7B ï¼ˆQ4ï¼‰</td>
<td>101.81 ms</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 101.06 ms, T: 0.19 ms</td>
<td>https://github.com/b4rtaz/distributed-llama/discussions/9</td>
<td></td>
<td>(30 vCPU, 15 core, 59 GB memory) europe-west1, AMD Genoa</td>
<td></td>
<td></td>
</tr>
<tr>
<td>c3d-highcpu-30 *4</td>
<td>Llama 2 7Bï¼ˆQ4ï¼‰</td>
<td>53.69 ms</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 40.25 ms, T: 12.81 ms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>c3d-highcpu-30</td>
<td>Llama 2 70Bï¼ˆQ4ï¼‰</td>
<td>909.69 ms</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 907.25 ms, T: 1.75 ms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>c3d-highcpu-30 *4</td>
<td>Llama 2 70Bï¼ˆQ4ï¼‰</td>
<td>293.06 ms</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I: 264.00 ms, T: 28.50 ms</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M1</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>14.19 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/discussions/4167</td>
<td>2023.11.22</td>
<td>å–æœ€æ…¢çš„é€Ÿåº¦</td>
</tr>
<tr>
<td>M1 Pro</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>35.52 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M1 Max</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>54.61 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M1 Ultra</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>74.93 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M2</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>21.7 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M2 Pro</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>37.87 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M2 Max</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>60.99 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M2 Ultra</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>65.95 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M3</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>21.34 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M3 Pro</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>30.65 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M3 Max</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>56.58 t/s</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>AMD EPYC 7443P</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>11.18 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1465138574</td>
<td>2023.3.12</td>
<td></td>
</tr>
<tr>
<td>Ryzen 7 3700X</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>8.51 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1465313724</td>
<td>2023.3.13</td>
<td></td>
</tr>
<tr>
<td>13900k</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>14.02 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1467067155</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2x Intel Xeon Gold 5120 @ 2.20GHz</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>8.68 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1471171246</td>
<td>2023.3.16</td>
<td></td>
</tr>
<tr>
<td>E5-2680v4</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>8.87 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1517704976</td>
<td>2023.4.21</td>
<td></td>
</tr>
<tr>
<td>i5 6500</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>13.82 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1550410400</td>
<td>2023.5.17</td>
<td></td>
</tr>
<tr>
<td>Hetzner Cloud Arm64 Ampere, 16 VCPU</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>11.76 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1575736794</td>
<td>2023.6.5</td>
<td></td>
</tr>
<tr>
<td>13900k</td>
<td>Llama 7Bï¼ˆQ4ï¼‰</td>
<td>12.65 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1675971336</td>
<td>2023.8.12</td>
<td></td>
</tr>
<tr>
<td>Snapdragon 870 / 8GB of ram</td>
<td>zephyr-7b (Q4)</td>
<td>4.7 t/s</td>
<td>https://github.com/ggerganov/llama.cpp/issues/34#issuecomment-1825489115</td>
<td>2023.11.24</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>I ï¼šæ¨ç†æ¯ä¸ª tokenèŠ±è´¹çš„æ—¶é—´</p>
<p>Tï¼šé€šä¿¡æ—¶é—´</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>LLM</tag>
        <tag>Raspberry</tag>
      </tags>
  </entry>
  <entry>
    <title>LLM æ·±åº¦çš„â€ç¨€ç–æ€§â€œ</title>
    <url>/hexo_blog/2024/03/28/LLM%E6%B7%B1%E5%BA%A6%E7%9A%84%E7%A8%80%E7%96%8F%E6%80%A7/</url>
    <content><![CDATA[<p>LLM åœ¨å®½åº¦ä¸Šçš„ç¨€ç–æ€§å¯ä»¥é€šè¿‡ MoE
è¿™ç§æ¶æ„æ¥ä¼˜åŒ–ã€‚è€Œæ·±åº¦ä¸Šä¹Ÿå…·å¤‡ç¨€ç–æ€§ï¼Œæ•…è€Œå¯ä»¥è¿›è¡Œè£å‰ªã€‚</p>
<span id="more"></span>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>è¿™ç¯‡<a
href="https://www.lesswrong.com/posts/AcKRB8wDpdaN6v6ru/interpreting-gpt-the-logit-lens">åšå®¢</a>å‘ç°åˆ°
GPT-2 åœ¨æ·±åº¦ä¸Šçš„è¾“å‡ºå…·æœ‰ç›¸ä¼¼æ€§ã€‚å³ï¼Œç¬¬ 20 å±‚çš„è¾“å‡ºæ¥å…¥ LM Head å’Œç¬¬ 21
å±‚çš„è¾“å‡ºæ¥å…¥ LM Head æ˜¯ç›¸ä¼¼ï¼Œç”šè‡³ä¸€è‡´çš„ã€‚</p>
<p>æ•…è€Œï¼Œæ¨¡å‹åœ¨æ·±åº¦ä¸Šå¯èƒ½æ˜¯ç¨€ç–çš„ã€‚æ‰€ä»¥å¯ä»¥æŒ‰ block
çš„ç»´åº¦è¿›è¡Œè£å‰ªã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/sparseinLLM/image-2024-3-28_18-23-0.png" /></p>
<p>æ‰¾åˆ°ä¸‰ç¯‡ç›¸ä¼¼çš„å·¥ä½œ</p>
<ul>
<li>ä¸Šäº¤ï¼š<a href="https://arxiv.org/html/2402.11187v1">LaCo: Large
Language Model Pruning via Layer Collapse</a></li>
<li>Metaï¼š<a href="https://arxiv.org/html/2403.17887">The Unreasonable
Ineffectiveness of the Deeper Layers</a></li>
<li>ç™¾å·ï¼š<a href="https://arxiv.org/html/2403.03853v2">ShortGPT: Layers
in Large Language Models are More Redundant Than You Expect</a></li>
</ul>
<p>è¶Šé è¿‘æ¨¡å‹è¾“å‡ºçš„é‚£äº›å±‚ç›¸ä¼¼åº¦è¾ƒé«˜ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤ä¸€äº›â€œå†—ä½™â€å±‚æ¥å‡å°æ¨¡å‹å‚æ•°</p>
<h2 id="æ–¹æ³•çš„å…±é€šæ€§">æ–¹æ³•çš„å…±é€šæ€§</h2>
<ul>
<li>æ„å»ºä¸€ä¸ªâ€œä¸­æ€§â€æ•°æ®é›†ï¼ï¼ï¼</li>
<li>è§‚å¯Ÿä¸åŒå±‚çš„è¾“å…¥/è¾“å‡º</li>
<li>ç”¨æŸç§åº¦é‡è·ç¦»çš„æ–¹æ³•æµ‹é‡ä¸åŒå±‚æ˜¯å¦ç›¸ä¼¼
<ul>
<li>ç™¾å·ï¼šBlock Influence</li>
<li>Metaï¼šè§’è·ç¦»</li>
</ul></li>
</ul>
<h2 id="meta-è®ºæ–‡ç»“æœ">Meta è®ºæ–‡ç»“æœ</h2>
<h3 id="ä¸åŒæ¨¡å‹å…·æœ‰ç›¸ä¼¼çš„è¡¨ç°">ä¸åŒæ¨¡å‹å…·æœ‰ç›¸ä¼¼çš„è¡¨ç°</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/sparseinLLM/x2.png" /></p>
<p>æ³¨ï¼š</p>
<ul>
<li>å®çº¿ï¼ˆhealingï¼‰ï¼šæ‰”æ‰ä¸€äº›å±‚ä¹‹åè¿›è¡Œäº†è®­ç»ƒ</li>
<li>è™šçº¿ï¼ˆno healingï¼‰ï¼š â†’ æ‰”æ‰è¿™äº›å±‚åä¸è®­ç»ƒ</li>
<li>å®çº¿å’Œè™šçº¿æ‰”æ‰çš„æ˜¯ç›¸åŒçš„å±‚</li>
<li>æ¨ªåæ ‡æ˜¯æ‰”æ‰çš„æ¯”ä¾‹</li>
</ul>
<p>Qï¼šMMLU/BoolQ æŒ‡æ ‡å…·å¤‡è¶³å¤Ÿçš„å¯ä¿¡åº¦ï¼Ÿ</p>
<p>Aï¼šä¸ªäººæ„Ÿè§‰æ²¡æœ‰ï¼Œä½†æœ‰åç»­æœ‰å…¶ä»–çš„ä¸€äº›å®éªŒæ”¯æ’‘</p>
<p>Qï¼šQwen ä¸ºå•¥è¡¨ç°ä¸å¤§ä¸€æ ·ï¼Ÿ</p>
<p>Aï¼šè®ºæ–‡å…¶ä»–éƒ¨åˆ†è¿›è¡Œä¸€å®šçš„è§£é‡Šï¼Œä½†ä¸æœ¬æ–‡çš„é‡ç‚¹ç›¸å…³æ€§ä¸å¼ºï¼Œæ‰€ä»¥ä¸å±•å¼€ä»‹ç»</p>
<h3 id="æš´åŠ›è£å‰ª-vs-æå‡ºçš„æ–¹æ³•">æš´åŠ›è£å‰ª vs æå‡ºçš„æ–¹æ³•</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/sparseinLLM/x5.png" /></p>
<p>æœ‰ä¸€ç§ç›´æ¥ç²—æš´çš„æ–¹æ³•å°±æ˜¯ç›´æ¥æ‰”æ‰æœ€åè‹¥å¹²å±‚ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ•°æ®é›†å•¥çš„æ¥é€‰å±‚ã€‚</p>
<p>å¥‡æ€ªçš„ç°è±¡å°±æ˜¯ç›´æ¥æ‰”æ‰æœ€åè‹¥å¹²å±‚ï¼ŒæŒ‡æ ‡ä¼šå‡ºç°å…ˆé™ä½å†æå‡ï¼ˆä¸è®­ç»ƒçš„æƒ…å†µï¼‰ã€‚</p>
<h2 id="ç™¾å·è®ºæ–‡çš„ç»“è®º">ç™¾å·è®ºæ–‡çš„ç»“è®º</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/sparseinLLM/baichuan.png" /></p>
<p><strong>ç¬¬ä¸€å±‚å’Œæœ€åä¸€å±‚å¾ˆé‡è¦ï¼ï¼ï¼</strong></p>
<h2 id="å‰ªææ¯”ç‡">å‰ªææ¯”ç‡</h2>
<p>åˆ©ç”¨å®½åº¦ç¨€ç–æ€§ï¼Œä¸€ç§ä¼˜åŒ–æ¶æ„ MoE
å¯ä»¥åšåˆ°é™ä½ä¸€åŠçš„å‚æ•°ä¸”ä¿æŒæ€§èƒ½ä¸å˜ã€‚</p>
<p>è€Œåœ¨æ·±åº¦ç¨€ç–ä¸Šï¼Œè¿™ä¸€ç‚¹æ˜¯æ¯”è¾ƒéš¾åšåˆ°çš„ã€‚</p>
<table>
<thead>
<tr>
<th>æ¨¡å‹å°ºå¯¸</th>
<th>å±‚æ•°</th>
<th>å‚æ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>70B</td>
<td>80</td>
<td>69,434,351,616</td>
</tr>
<tr>
<td>70B</td>
<td>40</td>
<td>35,208,175,616</td>
</tr>
<tr>
<td>70B</td>
<td>45</td>
<td>39,486,447,616</td>
</tr>
<tr>
<td>34B</td>
<td>48</td>
<td>34,201,673,728</td>
</tr>
<tr>
<td>34B</td>
<td>24</td>
<td>17,591,836,672</td>
</tr>
</tbody>
</table>
<p>ç®€å•æ¥è¯´ï¼Œå¯¹äº 70B æ¨¡å‹è¦å‰ªæåˆ° 34Bï¼Œéœ€è¦ç æ‰ä¸€åŠçš„å±‚ï¼›å¯¹äº 34B
æ¨¡å‹è¦å‰ªæåˆ° 13Bï¼Œè¦ç æ‰å¤§äºä¸€åŠçš„å±‚ã€‚</p>
<p>é€šè¿‡ Meta è®ºæ–‡çš„å®éªŒç»“æœæ˜¾ç¤ºï¼Œå½“è£å‰ªè¶…è¿‡
40%ï¼Œå°±ä¼šæœ‰è¾ƒå¤§çš„é£é™©ä¸èƒ½æ¢å¤æ¨¡å‹æ€§èƒ½ã€‚</p>
<h2 id="å®éªŒ">å®éªŒ</h2>
<p>åœ¨ boolq/gsm8k
æ•°æ®é›†ä¸Šç®€å•äº†è¿›è¡Œè‹¥å¹²å®éªŒï¼Œè¿™ä¸¤ä¸ªæ•°æ®é›†å‡å…·å¤‡è®­ç»ƒé›†å’Œè¯„æµ‹é›†ã€‚æ‰€ä»¥ï¼Œå¯¹
13B æ¨¡å‹è¿›è¡Œæš´åŠ›è£å‰ªåï¼ˆï½40%
å‚æ•°ï¼‰åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œåœ¨è¯„æµ‹é›†ä¸Šè¿›è¡Œè¯„æµ‹ã€‚</p>
<ul>
<li>è£å‰ªæ–¹æ³•ï¼šä¿ç•™æœ€åä¸€å±‚ï¼Œä»æœ€åä¸€å±‚å¾€å‰æ•°ï¼Œç›´è‡³è£å‰ªåˆ° 40% ä¸ºæ­¢ã€‚</li>
<li>å®Œæ•´è®­ç»ƒé›†ï¼šå¯¹åº”è¯„æµ‹çš„è®­ç»ƒé›†+é€šç”¨çš„QA/å¯¹è¯æ•°æ®é›†</li>
</ul>
<h3 id="gsm8k">gsm8k</h3>
<p>æ˜¯ä¸€ä¸ªè€ƒéªŒæ•°å­¦/é€»è¾‘æ¨ç†èƒ½åŠ›çš„è¯„æµ‹ç»“æœ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;conversations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Natalia sold clips to 48 of her friends in April, and then she sold half as many clips in May. How many clips did Natalia sell altogether in April and May?&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Natalia sold 48 clips in April.\nThen she sold half as many in May, which is 48 / 2 = 24.\nSo altogether she sold 48 + 24 = 72 clips.\nThe answer is 72.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥è¯„æµ‹ä¸ŠæŒ‡æ ‡ç›´æ¥å´©æ‰ï¼Œå¦‚åŸæ¥å¯èƒ½æ˜¯ &gt;70ï¼Œç°åœ¨åªæœ‰ 2%</p>
<table>
<colgroup>
<col style="width: 47%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th><strong>prompt</strong></th>
<th><strong>pred</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Janetâ€™s ducks lay 16 eggs per day. She eats three for breakfast
every morning and bakes muffins for her friends every day with four. She
sells the remainder at the farmers' market daily for $2 per fresh duck
egg. How much in dollars does she make every day at the farmers' market?
Let's think step by step.</td>
<td>Each egg is 16 eggs/day for 16 eggs/day for 1600000000 / 16 =
128000000. So, the total number of eggs is 128000000. The total number
of eggs is 160000000 - 128000000 = 128000000.The answer is
128000000.</td>
</tr>
<tr>
<td>A robe takes 2 bolts of blue fiber and half that much white fiber.
How many bolts in total does it take? Let's think step by step</td>
<td>The rose is 2 bolts of blue fibers. Half that amount is 2 / 2 = 1.
So the rose is 2 - 1 = 2 flobs. The answer is 2.</td>
</tr>
<tr>
<td>Josh decides to try flipping a house. He buys a house for $80,000
and then puts in $50,000 in repairs. This increased the value of the
house by 150%. How much profit did he make? Let's think step by
step.</td>
<td>The house was originally 80,000 dollars. The new house is 80,000 +
50,000 = 15,000 dollars. The new house is 15,000 dollars. So, the total
value of the house is 15,000 + 80,000 + 15,000 = 11,000 dollars. The
total value of the house is 11,000 dollars. The total value of the house
is 11,000 + 15,000 = 11,000 + 15,000 = 11,000 + 15,000 =</td>
</tr>
</tbody>
</table>
<h3 id="boolq">boolq</h3>
<p>è€Œ boolq ç›¸å¯¹æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®é›†ï¼Œè¾“å‡ºåªéœ€è¦æœ‰ yes or no å³å¯ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;conversations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Passage: Persian (/ËˆpÉœËrÊ’É™n, -ÊƒÉ™n/), also known by its endonym Farsi (ÙØ§Ø±Ø³ÛŒ fÄrsi (fÉ’ËÉ¾ËˆsiË) ( listen)), is one of the Western Iranian languages within the Indo-Iranian branch of the Indo-European language family. It is primarily spoken in Iran, Afghanistan (officially known as Dari since 1958), and Tajikistan (officially known as Tajiki since the Soviet era), and some other regions which historically were Persianate societies and considered part of Greater Iran. It is written in the Persian alphabet, a modified variant of the Arabic script, which itself evolved from the Aramaic alphabet.\nQuestion: do iran and afghanistan speak the same language\nAnswer:&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Yes&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æŒ‡æ ‡ä¸Šç»“æœå°±æ˜¯ç›¸å¯¹æ­£å¸¸çš„ï¼Œç¬¦åˆ Meta è®ºæ–‡çš„ç»“æœã€‚</p>
<ul>
<li>è£å‰ªå‰ï¼šï½84%</li>
<li>è£å‰ªåï¼šï½68%</li>
<li>è£å‰ª+è®­ç»ƒåï¼šï½85%</li>
</ul>
<p>æ‰€ä»¥ï¼Œæ¨¡å‹æ·±åº¦æˆ–è®¸æ˜¯åŠ å¼ºæ¨¡å‹æ¨ç†èƒ½åŠ›çš„å…³é”®å› ç´ ä¹‹ä¸€ï¼Ÿ</p>
]]></content>
      <categories>
        <category>PaperReading</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>LLM</tag>
        <tag>knowledge distillation</tag>
      </tags>
  </entry>
  <entry>
    <title>LLMçš„æ¨ç†ç›¸å…³è®¡ç®—å…¬å¼</title>
    <url>/hexo_blog/2024/09/05/LLM%E6%8E%A8%E7%90%86%E7%9B%B8%E5%85%B3%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F/</url>
    <content><![CDATA[<p>è®°å½• LLM åœ¨æ¨ç†ä¸Šçš„ç†è®ºè®¡ç®—å…¬å¼</p>
<span id="more"></span>
<h3 id="å‚æ•°é‡">å‚æ•°é‡</h3>
<p>embedding + lm head + transformer block <span
class="math inline">\(\times\)</span> N</p>
<ul>
<li>Embedding / LM Head çš„å‚æ•°é‡ï¼švocab_size <span
class="math inline">\(\times\)</span> hidden_size</li>
<li>transformer block çš„å‚æ•°é‡
<ul>
<li>self-attentionï¼šqkvo å››ä¸ªçº¿æ€§å±‚ï¼Œéœ€è¦åˆ†åˆ«è€ƒè™‘ä¸¤ç§ Attention
<ul>
<li>multi-head attentionï¼ˆMHAï¼‰ï¼š4 <span
class="math inline">\(\times\)</span> hidden_size <span
class="math inline">\(^2\)</span></li>
<li>grouped query attentionï¼ˆGQAï¼‰ï¼š
<ul>
<li><p>q å’Œ oï¼Œ2 $$ hidden_size <span
class="math inline">\(^2\)</span></p></li>
<li><p>k å’Œ vï¼Œ2 $$ hidden_size <span class="math inline">\(^2\)</span>
/ num_attention_heads $$ num_key_value_heads</p></li>
</ul></li>
</ul></li>
<li>FFNï¼šä¸‰ä¸ªçº¿æ€§å±‚ï¼Œ3 <span class="math inline">\(\times\)</span>
hidden_size <span class="math inline">\(\times\)</span>
intermediate_size</li>
<li>layer normï¼š2 <span class="math inline">\(\times\)</span> 2 <span
class="math inline">\(\times\)</span> hidden_size</li>
</ul></li>
</ul>
<p>ä»¥ <a
href="https://huggingface.co/meta-llama/Llama-2-13b-hf/blob/main/config.json">llama2-13B</a>
ä¸ºä¾‹ï¼Œå…³é”®å‚æ•°</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;hidden_size&quot;</span><span class="punctuation">:</span> <span class="number">5120</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;intermediate_size&quot;</span><span class="punctuation">:</span> <span class="number">13824</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mlp_bias&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_attention_heads&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_hidden_layers&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_key_value_heads&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vocab_size&quot;</span><span class="punctuation">:</span> <span class="number">32000</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>ç”±äº num_attention_heads == num_key_value_headsï¼Œæ‰€ä»¥æ˜¯ MHA</p>
<ul>
<li>Embedding/LM Headï¼š <span class="math inline">\(32000\times
5120\)</span></li>
<li>transformer block
<ul>
<li>self-attentionï¼š<span class="math inline">\(4\times 5120\times
5120\)</span></li>
<li>FFN: <span class="math inline">\(3\times 5120\times
13824\)</span></li>
<li>layer norm: <span class="math inline">\(4\times 5120\)</span></li>
</ul></li>
</ul>
<p>ç»¼ä¸Šï¼Œåˆ—å‡ºè®¡ç®—</p>
<p><span class="math display">\[2\times 32000\times 5120 + 40\times
(4\times 5120\times 5120 + 3\times 5120\times 13824 + 4\times 5120) =
13,016,268,800 \approx 13B\]</span></p>
<p>å¦‚æœæ˜¯ (b)float16ï¼Œåˆ™å ç”¨ç©ºé—´/æ˜¾å­˜ä¸º 13 $$ 2 = 26G</p>
<p>å¦‚æœæ˜¯ GQAï¼Œself-attn å‚æ•°é‡å…¬å¼ä¸º</p>
<h3 id="kv-cache-æ˜¾å­˜è®¡ç®—å…¬å¼">KV cache æ˜¾å­˜è®¡ç®—å…¬å¼</h3>
<p><span class="math inline">\(4\times b\times l\times num\_heads\times
embed\_size\_per\_head \times (s+n)\)</span></p>
<p>å‚æ•°è¯´æ˜</p>
<ul>
<li>b: å¥å­æ¡æ•°</li>
<li>lï¼šå±‚æ•°</li>
<li>num_headsï¼šéšå±‚å¤§å° (num_key_value_heads)</li>
<li>embed_size_per_headï¼šæ¯ä¸ªå¤´çš„å¤§å° (hidden_size /
num_attention_heads)</li>
<li>sï¼šè¾“å…¥é•¿åº¦</li>
<li>nï¼šè¾“å‡ºé•¿åº¦</li>
<li>4ï¼šk cache+v cacheï¼Œå‡ä¸º float16ï¼Œæ‰€ä»¥æ˜¯(1+1)*2</li>
</ul>
<p>å¦‚æœåªæœ‰1æ¡å¥å­ï¼Œè¾“å…¥+è¾“å‡º token é•¿åº¦ç”± 512 -&gt; 1024ï¼Œåˆ™ä¼šå¢åŠ 
<span class="math inline">\(4\times 512 \times l\times h\)</span>ï¼š</p>
<p>Llama3-8Bï¼š$4 / 1024 / 1024 = 64 $ M</p>
<p>Llama3-70Bï¼š<span class="math inline">\(4\times 512\times 1024\times
80 / 1024 / 1024 = 160\)</span> M</p>
<p>ç®€å•æ¥è¯´ï¼Œæ¯å¢åŠ ä¸€ä¸ª token</p>
<p>8B å°±ä¼šå¢åŠ  0.125 M çš„æ˜¾å­˜</p>
<p>70B å°±ä¼šå¢åŠ  0.3125 M çš„æ˜¾å­˜</p>
<h3 id="è®¡ç®—é‡">è®¡ç®—é‡</h3>
<p>Embedding å¯ä»¥è§†ä½œä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œæ²¡æœ‰è®¡ç®—é‡</p>
<ul>
<li>LM Headï¼š<span class="math inline">\(2 \times b \times s\times
hidden\_size\times V\)</span></li>
<li>Self-attentionï¼š
<ul>
<li>q_proj: <span class="math inline">\(2 \times b \times s \times
hidden\_size^2\)</span></li>
<li>k_projå’Œv_proj:
<ul>
<li>MHA: <span class="math inline">\(2\times(2 \times b \times s \times
hidden\_size^2)\)</span></li>
<li>GQA: <span class="math inline">\(2\times(2 \times b \times s \times
hidden\_size^2 / (num\_attention\_heads
\times  num\_key\_value\_heads)^2 )\)</span></li>
</ul></li>
<li>attn_weights: <span class="math inline">\(2 \times b \times s^2
\times hidden\_size\)</span></li>
<li>attn_output: <span class="math inline">\(2 \times b \times s^2
\times hidden\_size\)</span></li>
<li>o_proj: <span class="math inline">\(2 \times b \times s \times
hidden\_size^2\)</span></li>
</ul></li>
<li>FFN:
<ul>
<li>gate_proj å’Œ up_proj: <span class="math inline">\(2\times 2\times b
\times s\times (hidden\_size\times intermediate\_size)\)</span></li>
<li>down_proj: <span class="math inline">\(2\times b \times s\times
(intermediate\_size\times hidden\_size)\)</span></li>
</ul></li>
</ul>
<p>å‚æ•°è¯´æ˜ - b: å¥å­æ¡æ•° - s: è¾“å…¥é•¿åº¦ - 2:
ä¸€æ¬¡ä¹˜æ³•æ“ä½œå’Œä¸€æ¬¡åŠ æ³•æ“ä½œ</p>
<p>è¿˜æ˜¯ä»¥ <a
href="https://huggingface.co/meta-llama/Llama-2-13b-hf/blob/main/config.json">llama2-13B</a>
ä¸ºä¾‹ï¼Œå…³é”®å‚æ•°</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;hidden_size&quot;</span><span class="punctuation">:</span> <span class="number">5120</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;intermediate_size&quot;</span><span class="punctuation">:</span> <span class="number">13824</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mlp_bias&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_attention_heads&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_hidden_layers&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;num_key_value_heads&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vocab_size&quot;</span><span class="punctuation">:</span> <span class="number">32000</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>å‡è®¾ b=1ï¼Œs=1ï¼Œåˆ™æ•´ä½“è®¡ç®—é‡æœ‰</p>
<ul>
<li>LM Head: <span class="math inline">\(2\times 5120\times
32000\)</span></li>
<li>self-attention:
<ul>
<li><span class="math inline">\(2\times 5120\times 5120\)</span></li>
<li><span class="math inline">\(4\times 5120\times 5120\)</span></li>
<li><span class="math inline">\(2\times 5120\)</span></li>
<li><span class="math inline">\(2\times 5120\)</span></li>
<li><span class="math inline">\(2\times 5120\times 5120\)</span></li>
</ul></li>
<li>MLP:
<ul>
<li><span class="math inline">\(4\times 5120\times 13824\)</span></li>
<li><span class="math inline">\(2\times 13824\times 5120\)</span></li>
</ul></li>
</ul>
<p>æ¨¡å‹æœ‰ 40 å±‚ï¼Œæ‰€ä»¥</p>
<p><span class="math inline">\(2\times 5120\times 32000+
40\times(8\times 5120\times 5120+4\times 5120+ 2\times 5120\times
13824+2\times 13824\times 5120) = 20,041,728,000\)</span></p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>https://blog.csdn.net/wxc971231/article/details/135434478</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>Inference</tag>
        <tag>Math</tag>
      </tags>
  </entry>
  <entry>
    <title>LLMçš„æ¨ç†åŠ é€Ÿ</title>
    <url>/hexo_blog/2024/06/15/LLM%E7%9A%84%E6%8E%A8%E7%90%86%E5%8A%A0%E9%80%9F/</url>
    <content><![CDATA[<p>å¯¹äºä¸¤ç§åœºæ™¯ä¸‹ä»‹ç» LLM çš„ æ¨ç†åŠ é€Ÿæ–¹æ³•</p>
<p>é•¿è¾“å…¥ï¼ŒçŸ­è¾“å‡º</p>
<p>é•¿è¾“å‡ºä½†è¾“å‡º token æœ‰é™</p>
<span id="more"></span>
<p>å¤§è¯­è¨€æ¨¡å‹åœ¨è¿›è¡Œæ¨ç†æ—¶æ˜¯éå¸¸è€—æ—¶çš„ï¼Œå› ä¸ºéœ€è¦å¯¹æ¯ä¸ª token
è¿›è¡Œè®¡ç®—ã€‚å¯¹äºæ¨ç†åŠ é€Ÿè¿™ä¸ªè¯é¢˜ï¼Œåœ¨å·¥ç¨‹ä¸Šå¯ä»¥ä»å¾ˆå¤šæ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>æ¨¡å‹è¿›è¡Œé‡åŒ–/å‰ªæï¼Œé™ä½æ¨¡å‹æµ®ç‚¹è®¡ç®—æˆæœ¬</li>
<li>Continuous Batchï¼Œæ‰¹é‡è®¡ç®— Next Token</li>
<li>KV Cacheï¼šLLM æ¨ç†çš„æ˜¯ Token by Token
ç”Ÿæˆï¼Œæ¯æ¬¡ç”Ÿæˆçš„æ—¶å€™ä¼šè®¡ç®—æ‰€æœ‰è¾“å…¥ Token çš„
Attentionï¼Œæ•…å¯ä»¥ç¼“å­˜å·²è®¡ç®—çš„ Attentionï¼Œå‡å°‘è®¡ç®—é‡</li>
<li>å¯¹æ˜¾å­˜è¿›è¡Œç®¡ç†ï¼Œå¦‚ <a
href="https://wnma3mz.github.io/hexo_blog/2023/11/24/vLLM%E7%9A%84PageAttention/">PageAttention</a></li>
<li>KV Cache é‡åŒ–</li>
<li>...</li>
</ul>
<p>è€Œå…¶ä»–åœ¨å·¥ç¨‹ä¸Šçš„ä¼˜åŒ–ï¼Œå¾€å¾€æ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯çš„ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§åœºæ™¯ä¸‹çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p>
<h2 id="prefix-cacheé•¿è¾“å…¥çŸ­è¾“å‡º">Prefix Cacheï¼šé•¿è¾“å…¥ï¼ŒçŸ­è¾“å‡º</h2>
<p>æ³¨ï¼šä¼˜åŒ–æ˜¾å­˜å¹¶ä¸ä¼šå‡å°‘è®¡ç®—é‡ï¼Œåªæ˜¯å‡å°‘äº†æ˜¾å­˜å ç”¨ï¼Œä»è€Œæå‡äº†ååã€‚</p>
<h3 id="kv-cache-æ˜¾å­˜è®¡ç®—å…¬å¼">KV cache æ˜¾å­˜è®¡ç®—å…¬å¼</h3>
<p><span class="math inline">\(4\times b\times l\times num\_heads\times
embed\_size\_per\_head \times (s+n)\)</span></p>
<p>å‚æ•°è¯´æ˜</p>
<ul>
<li>b: å¥å­æ¡æ•°</li>
<li>lï¼šå±‚æ•°</li>
<li>num_headsï¼šéšå±‚å¤§å° (num_key_value_heads)</li>
<li>embed_size_per_headï¼šæ¯ä¸ªå¤´çš„å¤§å° (hidden_size /
num_attention_heads)</li>
<li>sï¼šè¾“å…¥é•¿åº¦</li>
<li>nï¼šè¾“å‡ºé•¿åº¦</li>
<li>4ï¼šk cache+v cacheï¼Œå‡ä¸º float16ï¼Œæ‰€ä»¥æ˜¯(1+1)*2</li>
</ul>
<p>å¦‚æœåªæœ‰1æ¡å¥å­ï¼Œè¾“å…¥+è¾“å‡º token é•¿åº¦ç”± 512 -&gt; 1024ï¼Œåˆ™ä¼šå¢åŠ 
<span class="math inline">\(4\times 512 \times l\times h\)</span>ï¼š</p>
<p>Llama3-8Bï¼š$4 / 1024 / 1024 = 64 $ M</p>
<p>Llama3-70Bï¼š<span class="math inline">\(4\times 512\times 1024\times
80 / 1024 / 1024 = 160\)</span> M</p>
<p>ç®€å•æ¥è¯´ï¼Œæ¯å¢åŠ ä¸€ä¸ª token</p>
<p>8B å°±ä¼šå¢åŠ  0.125 M çš„æ˜¾å­˜</p>
<p>70B å°±ä¼šå¢åŠ  0.3125 M çš„æ˜¾å­˜</p>
<p>è¿™ä¸ªæ˜¾å­˜å æœ‰ç›´åˆ°æ•´ä¸ªå¥å­ç”Ÿæˆå®Œæˆä¹‹åæ‰ä¼šé‡Šæ”¾ï¼Œæ‰€ä»¥å¯¹äºé•¿å¥å­ï¼ŒKV
Cache çš„æ˜¾å­˜å ç”¨æ˜¯éå¸¸å¤§çš„ã€‚</p>
<p>æ˜¾å­˜å†³å®šäº†æ•´ä½“çš„ååé‡ã€‚å¯¹äº 70Bï¼Œå‡è®¾æœ‰ 1k ä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚çš„æ€»
token ä¸º 1kï¼Œé‚£ä¹ˆæ˜¾å­˜å ç”¨ä¸º 0.3125M * 1000 * 1000 = 0.3Gã€‚</p>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<p>åœ¨ LLM
æ¨ç†æ—¶ï¼Œå¾€å¾€æ˜¯ç”¨å¯¹è¯çš„æ–¹å¼è¿›è¡Œæ¨ç†ï¼Œè€Œæ¯æ¬¡å¯¹è¯çš„å¼€å¤´å¯èƒ½æ˜¯ç›¸åŒï¼ˆSystemï¼‰ï¼Œè¿™ä¸€éƒ¨åˆ†çš„
Attention æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å¯ä»¥ç¼“å­˜è¿™éƒ¨åˆ† Attentionã€‚</p>
<p>åŠ é€Ÿçš„åŸå› ï¼š</p>
<ul>
<li>prefix çš„ kv cache ä¸éœ€è¦è®¡ç®—</li>
<li>prefix çš„ kv cache å¤ç”¨èŠ‚çº¦äº†æ˜¾å­˜ï¼Œæå‡ååï¼ˆä¸»è¦æ”¶ç›Šï¼‰</li>
</ul>
<p>æ‰€ä»¥é€‚ç”¨åœºæ™¯çš„ä¸€ä¸ªæ˜æ˜¾ç‰¹ç‚¹å°±æ˜¯å¿…é¡»è¦æœ‰é•¿çš„ system prefixï¼Œè€Œä¸”è¿™ä¸ª
prefix
æ˜¯ä¸å˜çš„ã€‚å¦å¤–ï¼Œå¦‚æœæ¨¡å‹è¾“å‡ºè¿‡é•¿çš„è¯ï¼Œè¿™ä¸ªä¼˜åŒ–çš„æ”¶ç›Šå°±ä¼šå˜å°ã€‚å› ä¸ºå®ƒå¹¶ä¸ä¼šåŠ é€Ÿåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­çš„è®¡ç®—ï¼Œåªæ˜¯å‡å°‘äº†æ˜¾å­˜å ç”¨ã€‚</p>
<h3 id="æ”¶ç›Š">æ”¶ç›Š</h3>
<p>https://github.com/vllm-project/vllm/issues/227</p>
<p>For each request, the prefix length is 200, the input length is 30,
and the output length is 50.</p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 15%" />
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th>Load (QPS)</th>
<th>Method</th>
<th>Requests/s</th>
<th>Average Latency per Req</th>
<th>First Token Time</th>
</tr>
</thead>
<tbody>
<tr>
<td>10 QPS</td>
<td>Prefix Cache</td>
<td>9.83 requests/s</td>
<td>1.97 s</td>
<td>0.29 s</td>
</tr>
<tr>
<td>10 QPS</td>
<td>Base</td>
<td>9.80 requests/s</td>
<td>2.87 s</td>
<td>0.45 s</td>
</tr>
<tr>
<td>15 QPS</td>
<td>Prefix Cache</td>
<td>14.30 requests/s</td>
<td>2.98 s</td>
<td>0.39 s</td>
</tr>
<tr>
<td>15 QPS</td>
<td>Base</td>
<td>13.24 requests/s</td>
<td>8.65 s</td>
<td>1.02 s</td>
</tr>
<tr>
<td>25 QPS</td>
<td>Prefix Cache</td>
<td>19.81 requests/s</td>
<td>6.46 s</td>
<td>0.84 s</td>
</tr>
<tr>
<td>25 QPS</td>
<td>Base</td>
<td>14.08 requests/s</td>
<td>13.67 s</td>
<td>4.74 s</td>
</tr>
</tbody>
</table>
<h2 id="å¹¶è¡Œè§£ç é•¿è¾“å‡ºä½†è¾“å‡º-token-æœ‰é™">å¹¶è¡Œè§£ç ï¼šé•¿è¾“å‡ºä½†è¾“å‡º token
æœ‰é™</h2>
<p>LLM çš„æ¨ç†æ˜¯ Token by Token ç”Ÿæˆçš„ï¼Œå¦‚æœæœ‰ä¸€ç§æ–¹å¼å¯ä»¥æ¯æ¬¡ç”Ÿæˆå¤šä¸ª
tokenï¼Œé‚£ä¹ˆå°±å¯ä»¥æå‡æ¨ç†é€Ÿåº¦ã€‚</p>
<h3 id="æ–¹æ³•-1">æ–¹æ³•</h3>
<p>ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œå¯¹ LLM çš„æ¨¡å‹ç»“æ„è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼Œä½¿æ¯æ¬¡å¯ä»¥åŒæ—¶ç”Ÿæˆ 3 ä¸ª
tokenã€‚</p>
<figure>
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/llm_speedup/251e873bb1322b4d31fee19f0c81c424.png"
alt="å¹¶è¡Œè§£ç " />
<figcaption aria-hidden="true">å¹¶è¡Œè§£ç </figcaption>
</figure>
<p>å¹¶è¡Œè§£ç çš„æ–¹å¼ä¸ä¸€å®šè¦å¯¹ç»“æ„è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œåªæ˜¯ä¸€ç§å®ç°æ–¹å¼ã€‚</p>
<p>å…·ä½“å®ç°æ–¹å¼ï¼š -
è®­ç»ƒï¼šä¿®æ”¹ç»“æ„åå¯¹æ¨¡å‹çš„æ–°å¢éƒ¨åˆ†è¿›è¡Œå¸¸è§„çš„è®­ç»ƒï¼Œå…¶ä»–éƒ¨åˆ†å†»ç»“ï¼Œå‡å°‘è®­ç»ƒæˆæœ¬
- æ¨ç†ï¼šæ¨¡å‹ç”Ÿæˆçš„æ—¶å€™ä¼šæŠŠè¿ç»­ 3 ä¸ª token çš„ top-K
çš„å¯èƒ½å‡ç”Ÿæˆï¼Œäº¤ç”±åŸæ¨¡å‹è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åé€‰æ‹©æœ€ä¼˜çš„ä¸€ä¸ªã€‚</p>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p>å¹¶è¡Œç”Ÿæˆçš„ Token çš„å¯é æ€§æ˜¯å–å†³äºå…·ä½“åœºæ™¯çš„ã€‚å¦‚æœç”Ÿæˆçš„ Token
å¯èƒ½æ€§åªæœ‰ 20 ä¸ªï¼Œé‚£ä¹ˆå¹¶è¡Œç”Ÿæˆçš„ Token
çš„å¯é æ€§å°±ä¼šç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ç§å¯¹äºæ¨¡å‹è€Œè¨€æ˜¯æ›´å®¹æ˜“å­¦ä¹ çš„ã€‚ä½†å¦‚æœç”Ÿæˆçš„ Token
å¯èƒ½æœ‰ 10000 ä¸ªï¼Œé‚£ä¹ˆå¹¶è¡Œç”Ÿæˆçš„ Token çš„å¯é æ€§å°±ä¼šç›¸å¯¹è¾ƒä½ã€‚</p>
<p>æ¢è€Œè¨€ä¹‹ï¼ŒToken
å¯èƒ½æ€§è¶Šå°‘è¶Šå®¹æ˜“çŒœä¸­ï¼Œè¶Šå¤šè¶Šéš¾çŒœä¸­ã€‚æ‰€ä»¥ï¼Œè¿™ç§æ–¹æ³•é€‚ç”¨äºè¾“å‡º token
å¯èƒ½æ€§æœ‰é™çš„åœºæ™¯ã€‚</p>
<p>å¹¶ä¸”ï¼Œå¦‚æœè¾“å‡º token æ•°é‡è¾ƒçŸ­ï¼Œé‚£ä¹ˆç›¸è¾ƒäº token by token
çš„ç”Ÿæˆï¼Œè¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿å°±ä¼šå˜å°ã€‚</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>Attention</tag>
      </tags>
  </entry>
  <entry>
    <title>SPSAéšæœºä¼˜åŒ–ç®—æ³•</title>
    <url>/hexo_blog/2023/08/19/SPSA%E9%9A%8F%E6%9C%BA%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<p>SPSA(Simultaneous Perturbation Stochastic
Approximation)æ˜¯ä¸€ç§éšæœºä¼˜åŒ–ç®—æ³•,å¯ç”¨äºç¥ç»ç½‘ç»œçš„è®­ç»ƒã€‚å…¶åŸºäºéšæœºæ¢¯åº¦æ¥é€¼è¿‘çœŸå®æ¢¯åº¦ã€‚æ— æ³•ç›´æ¥å¾—åˆ°ç²¾ç¡®æ¢¯åº¦,æ”¶æ•›é€Ÿåº¦è¾ƒæ…¢,ä½†èŠ‚çœè®¡ç®—èµ„æºã€‚</p>
<span id="more"></span>
<h3 id="spsaç®—æ³•ç®€ä»‹">SPSAç®—æ³•ç®€ä»‹</h3>
<p>SPSAæ˜¯ä¸€ç§éšæœºä¼˜åŒ–ç®—æ³•,å¯ä»¥ç”¨äºç¥ç»ç½‘ç»œæ¨¡å‹çš„è®­ç»ƒã€‚å®ƒçš„ä¸»è¦æ€æƒ³æ˜¯åŒæ—¶éšæœºæ‰°åŠ¨æ‰€æœ‰å‚æ•°,åŸºäºæŸå¤±å‡½æ•°åœ¨æ‰°åŠ¨åçš„å˜åŒ–æ¥ä¼°è®¡æ¢¯åº¦ã€‚</p>
<p>ç›¸æ¯”ç¡®å®šæ€§çš„æ¢¯åº¦ä¸‹é™æ³•,SPSAä¾é éšæœºæ€§æœç´¢æœ€ä¼˜è§£,å¯ä»¥æ›´å¥½åœ°è·³å‡ºå±€éƒ¨æœ€ä¼˜,å…·æœ‰å…¨å±€æœç´¢èƒ½åŠ›ã€‚å¦å¤–,SPSAåªéœ€è¦å‰å‘ä¼ æ’­å°±å¯ä»¥æ›´æ–°å‚æ•°,çœå»äº†å­˜å‚¨åå‘ä¼ æ’­æ‰€éœ€çš„è®¡ç®—å›¾,è®¡ç®—å¼€é”€è¾ƒå°ã€‚</p>
<h3 id="pytorchå®ç°spsaè®­ç»ƒç¥ç»ç½‘ç»œ">PyTorchå®ç°SPSAè®­ç»ƒç¥ç»ç½‘ç»œ</h3>
<p>è¦åœ¨PyTorchä¸­å®ç°SPSAç®—æ³•è®­ç»ƒç¥ç»ç½‘ç»œ,ä¸»è¦åˆ†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤:</p>
<ol type="1">
<li><p>æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹</p>
<p>å¯ä»¥æ„å»ºä¸€ä¸ªå¤šå±‚å…¨è¿æ¥ç½‘ç»œ,ä¾‹å¦‚åœ¨MNISTæ•°æ®é›†ä¸Šè¿›è¡Œå›¾åƒåˆ†ç±»ä»»åŠ¡:</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Net</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(Net, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(<span class="number">784</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc2 = nn.Linear(<span class="number">100</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc1(x))</span><br><span class="line">        x = <span class="variable language_">self</span>.fc2(x)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(x, dim=<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
<li><p>å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</p>
<p>ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å’ŒSGDä¼˜åŒ–å™¨:</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = torch.optim.SGD(net.parameters(), lr=<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure></p></li>
<li><p>å®ç°SPSAç®—æ³•</p>
<p>æ ¹æ®SPSAçš„å…¬å¼,å¯ä»¥å®ç°è®¡ç®—éšæœºæ¢¯åº¦çš„å‡½æ•°:</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">SPSA_step</span>(<span class="params">net, criterion, x, y, a, c, k</span>):</span><br><span class="line">    delta = <span class="number">2</span> * (torch.randint(<span class="number">0</span>, <span class="number">2</span>, net.parameters().__len__()) - <span class="number">0.5</span>)</span><br><span class="line">    perturbation = c * delta</span><br><span class="line">    loss1 = criterion(net(x + a*perturbation), y)</span><br><span class="line">    loss2 = criterion(net(x - a*perturbation), y)</span><br><span class="line">    gradient = (loss1 - loss2) / (<span class="number">2</span> * a * perturbation)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> param, grad <span class="keyword">in</span> <span class="built_in">zip</span>(net.parameters(), gradient):</span><br><span class="line">        param.data.add_(k * grad * delta)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> net</span><br></pre></td></tr></table></figure></p></li>
<li><p>è®­ç»ƒç¥ç»ç½‘ç»œ</p>
<p>åœ¨è®­ç»ƒå¾ªç¯ä¸­è°ƒç”¨SPSA_stepå‡½æ•°è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°:</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    running_loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(trainloader, <span class="number">0</span>):</span><br><span class="line">        inputs, labels = data</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        net = SPSA_step(net, criterion, inputs, labels, <span class="number">0.01</span>, <span class="number">0.005</span>, <span class="number">0.01</span>)</span><br><span class="line">				optimizer.zero_grad()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[%d] loss: %.3f&#x27;</span> % (epoch + <span class="number">1</span>, running_loss / <span class="built_in">len</span>(trainloader)))</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="å‰å‘ä¼ æ’­ä¸åå‘ä¼ æ’­çš„æ¯”è¾ƒ">å‰å‘ä¼ æ’­ä¸åå‘ä¼ æ’­çš„æ¯”è¾ƒ</h3>
<p>ä½¿ç”¨å‰å‘ä¼ æ’­è®¡ç®—æ¢¯åº¦æ—¶,éœ€è¦ä½¿ç”¨ä¸¤ç‚¹å¼å·®åˆ†æ¥ä¼°è®¡æ¢¯åº¦:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gradient = (loss1 - loss2) / (<span class="number">2</span> * a * perturbation)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­loss1å’Œloss2åˆ†åˆ«å¯¹åº”å‚æ•°åšå¾®å°æ­£è´Ÿæ‰°åŠ¨æ—¶çš„æŸå¤±ã€‚è¿™åªèƒ½å¾—åˆ°æ¢¯åº¦çš„è¿‘ä¼¼å€¼,æ”¶æ•›é€Ÿåº¦è¾ƒæ…¢ã€‚</p>
<p>è€Œåå‘ä¼ æ’­å¯ä»¥é€šè¿‡åŠ¨æ€è®¡ç®—å›¾é«˜æ•ˆåœ°å¾—åˆ°æ¯ä¸ªå‚æ•°çš„ç²¾ç¡®æ¢¯åº¦,ä½¿å¾—ç½‘ç»œå¯ä»¥æ›´å¿«æ”¶æ•›ã€‚ä½†éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ä¿å­˜è®¡ç®—å›¾,è®¡ç®—å¤æ‚åº¦ä¹Ÿæ›´é«˜ã€‚</p>
<p>æ‰€ä»¥åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶,é€šå¸¸é€‰æ‹©åå‘ä¼ æ’­æ¥è·å–ç²¾ç¡®æ¢¯åº¦ä¿¡æ¯,ä»¥ä¿è¯æ”¶æ•›é€Ÿåº¦ã€‚SPSAæ›´é€‚ç”¨äºä¸€äº›è®¡ç®—èµ„æºå—é™ä½†éœ€è¦æ±‚è§£æœ€ä¼˜å‚æ•°çš„åœºæ™¯ã€‚</p>
<h3 id="q-a">Q &amp; A</h3>
<p><strong>é—®é¢˜1:SPSAç®—æ³•ä¸éšæœºæ¢¯åº¦ä¸‹é™(SGD)çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</strong></p>
<p>SPSAå’ŒSGDéƒ½ä¾èµ–äºéšæœºæ€§æ¥è¾¾åˆ°ä¼˜åŒ–ç›®çš„,ä¸»è¦åŒºåˆ«åœ¨äº:</p>
<ul>
<li>SGDæ¯æ¬¡åªéšæœºæ‰°åŠ¨ä¸€ä¸ªå‚æ•°,SPSAåŒæ—¶æ‰°åŠ¨æ‰€æœ‰å‚æ•°</li>
<li>SPSAä½¿ç”¨æœ‰é™å·®åˆ†æ³•ä¼°è®¡æ¢¯åº¦,SGDä½¿ç”¨åå‘ä¼ æ’­è®¡ç®—ç²¾ç¡®æ¢¯åº¦</li>
<li>SPSAå¯èƒ½æ›´èƒ½é¿å…å±€éƒ¨æœ€ä¼˜,SGDæ”¶æ•›é€Ÿåº¦æ›´å¿«</li>
</ul>
<p>ä½¿ç”¨å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„ä¸»è¦ä¸åŒæ˜¯åœ¨è®¡ç®—æ¢¯åº¦çš„æ–¹å¼ä¸Šã€‚</p>
<p>ä½¿ç”¨åå‘ä¼ æ’­æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡å‰å‘ä¼ æ’­è®¡ç®—ç½‘ç»œçš„è¾“å‡ºï¼Œç„¶åå°†è¾“å‡ºä¸å®é™…æ ‡ç­¾è®¡ç®—æŸå¤±å‡½æ•°ï¼Œç„¶åé€šè¿‡åå‘ä¼ æ’­è®¡ç®—æ¯ä¸ªå‚æ•°å¯¹æŸå¤±å‡½æ•°çš„æ¢¯åº¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œå¹¶æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚</p>
<p>è€Œå¦‚æœåªä½¿ç”¨å‰å‘ä¼ æ’­è¿›è¡Œç¥ç»ç½‘ç»œçš„æ›´æ–°ï¼Œåˆ™æ— æ³•ç›´æ¥è®¡ç®—æ¯ä¸ªå‚æ•°å¯¹æŸå¤±å‡½æ•°çš„æ¢¯åº¦ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨â€œä¸¤ç‚¹å¼å·®åˆ†â€æ¥è¿‘ä¼¼è®¡ç®—æ¢¯åº¦ã€‚å…·ä½“åœ°ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹å…¬å¼ï¼š</p>
<p><span class="math display">\[\nabla f(x) \approx \frac{f(x+\Delta x)
- f(x-\Delta x)}{2\Delta x}\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\Delta
x\)</span>ä»£è¡¨ä¸€ä¸ªå¾®å°çš„æ‰°åŠ¨ï¼Œ<span
class="math inline">\(x\)</span>æ˜¯è¾“å…¥æ•°æ®ï¼Œ<span
class="math inline">\(f(x)\)</span>ä¸ºæŸå¤±å‡½æ•°ã€‚æˆ‘ä»¬æ ¹æ®è¿™ä¸ªå…¬å¼å¯¹æ¯ä¸ªå‚æ•°è¿›è¡Œå¾®å°çš„æ‰°åŠ¨ï¼Œç„¶åè®¡ç®—å¯¹åº”çš„æŸå¤±å‡½æ•°ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¬å¼è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°ã€‚</p>
<p>ä½¿ç”¨å‰å‘ä¼ æ’­è¿›è¡Œæ›´æ–°ç›¸æ¯”ä½¿ç”¨åå‘ä¼ æ’­çš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå‡å°‘äº†å†…å­˜å ç”¨å’Œè®¡ç®—æ—¶é—´ï¼Œå¹¶ä¸”ä¸éœ€è¦å­˜å‚¨è®¡ç®—å›¾ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒåªæ˜¯ä½¿ç”¨ä¸€é˜¶è¿‘ä¼¼æ¥è®¡ç®—æ¢¯åº¦ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´æ›´æ–°ä¸å¦‚åå‘ä¼ æ’­ç²¾ç¡®ã€‚</p>
<p><strong>é—®é¢˜2:SPSAç®—æ³•é€‚ç”¨äºå“ªäº›åœºæ™¯?</strong></p>
<p>SPSAç®—æ³•é€‚ç”¨äºä»¥ä¸‹åœºæ™¯:</p>
<ul>
<li>ç›®æ ‡å‡½æ•°æ— æ³•æ˜ç¡®è¡¨è¾¾,æ— æ³•æ±‚å¯¼</li>
<li>å‚æ•°ç©ºé—´é«˜ç»´,éš¾ä»¥ç²¾ç¡®è®¡ç®—æ¢¯åº¦</li>
<li>éœ€è¦é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜</li>
<li>è®¡ç®—èµ„æºå—é™,æ— æ³•å­˜å‚¨å¤§è§„æ¨¡è®¡ç®—å›¾</li>
</ul>
<p><strong>é—®é¢˜3:SPSAç®—æ³•çš„ä¸¤å¤§è¶…å‚æ•°aå’Œcè¡¨ç¤ºä»€ä¹ˆ?</strong></p>
<ul>
<li>aæ˜¯æ­¥é•¿(perturbation size),è¡¨ç¤ºå‚æ•°æ‰°åŠ¨å¤§å°</li>
<li>cæ˜¯æŠ–åŠ¨å¹…åº¦(perturbation distribution),æ§åˆ¶æ‰°åŠ¨å€¼æ³¢åŠ¨èŒƒå›´</li>
</ul>
<p>aå¯ç±»æ¯”SGDä¸­çš„å­¦ä¹ ç‡,cè¶Šå¤§éšæœºæ€§è¶Šå¼ºã€‚ä¸¤è€…éœ€è¦å‡è¡¡è°ƒèŠ‚,æ—¢ä¿è¯è¶³å¤Ÿæ¢ç´¢åˆä¸å¤±ç¨³å®šæ€§ã€‚</p>
<p><strong>é—®é¢˜4:SPSAç®—æ³•å¦‚ä½•ä¿è¯æ”¶æ•›æ€§?</strong></p>
<p>SPSAå¯ä»¥é€šè¿‡ä»¥ä¸‹æ‰‹æ®µä¿è¯æ”¶æ•›:</p>
<ol type="1">
<li>åŒæ—¶æ‰°åŠ¨å‚æ•°ï¼šåœ¨æ¯ä¸ªè¿­ä»£ä¸­ï¼ŒSPSAä½¿ç”¨ä¸¤ä¸ªéšæœºå‘é‡å¯¹å‚æ•°è¿›è¡Œæ‰°åŠ¨ï¼Œè¿™æ ·å¯ä»¥é¿å…å±€éƒ¨æå°å€¼ç‚¹ï¼Œå¹¶ä¸”ä½¿å¾—ç®—æ³•æ›´å®¹æ˜“è·³å‡ºå±€éƒ¨æœ€å°å€¼ã€‚</li>
<li>é€‚åº”æ€§è°ƒæ•´æ­¥é•¿ï¼šSPSAå…·æœ‰è‡ªé€‚åº”å­¦ä¹ ç‡æœºåˆ¶ï¼Œå³æ ¹æ®å½“å‰ä¼°è®¡çš„æ¢¯åº¦å¤§å°å’Œå…ˆå‰çš„æ­¥é•¿å¤§å°æ¥æ›´æ–°æ­¥é•¿ã€‚è¿™ç¡®ä¿äº†ç®—æ³•æ”¶æ•›æ—¶æ­¥é•¿é€æ¸å‡å°ã€‚</li>
<li>éšæœºæ€§ï¼šSPSAåœ¨æ¯ä¸ªè¿­ä»£ä¸­éƒ½ä½¿ç”¨éšæœºæ‰°åŠ¨æ¥ä¼°è®¡æ¢¯åº¦ï¼Œè¿™æœ‰åŠ©äºé¿å…é™·å…¥å±€éƒ¨æœ€å°å€¼å¹¶æé«˜å…¨å±€æœç´¢çš„èƒ½åŠ›ã€‚</li>
<li>ç†è®ºä¿è¯ï¼šSPSAæœ‰ç†è®ºä¸Šä¿è¯çš„æ”¶æ•›æ€§ï¼Œè¿™æ„å‘³ç€åªè¦æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼ˆä¾‹å¦‚éšæœºæ‰°åŠ¨ç‹¬ç«‹åŒåˆ†å¸ƒï¼‰ï¼Œå°±å¯ä»¥ä¿è¯ç®—æ³•æœ€ç»ˆä¼šæ”¶æ•›åˆ°æ­£ç¡®çš„è§£ã€‚</li>
</ol>
<p><strong>é—®é¢˜5:ç›¸è¾ƒäºåå‘ä¼ æ’­ã€‚ä¸ºä»€ä¹ˆSPSAæ²¡æœ‰è¢«å¹¿æ³›åº”ç”¨ï¼Ÿ</strong></p>
<ol type="1">
<li>ç›¸å¯¹è¾ƒå°‘çš„ç†è®ºæ”¯æŒï¼šä¸åå‘ä¼ æ’­ç­‰ç®—æ³•ç›¸æ¯”ï¼ŒSPSAç®—æ³•çš„ç†è®ºåˆ†æè¾ƒå°‘ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½å®Œå…¨äº†è§£å…¶æ€§èƒ½æˆ–æ”¶æ•›é€Ÿåº¦ã€‚</li>
<li>éœ€è¦å¤§é‡çš„è¿­ä»£æ¬¡æ•°ï¼šSPSAç®—æ³•éœ€è¦ä½¿ç”¨æ›´å¤šçš„è¿­ä»£æ¬¡æ•°æ‰èƒ½è·å¾—è¾ƒå¥½çš„ç»“æœï¼Œè¿™å¯èƒ½ä¼šä½¿å…¶åœ¨å®é™…ä½¿ç”¨ä¸­å˜å¾—è¿‡äºè€—æ—¶ã€‚</li>
<li>å‚æ•°è®¾ç½®å›°éš¾ï¼šSPSAç®—æ³•æœ¬èº«æœ‰å¾ˆå¤šå‚æ•°éœ€è¦è°ƒèŠ‚ï¼Œä¾‹å¦‚æ­¥é•¿ã€æŠ–åŠ¨å¹…åº¦ç­‰ï¼Œå¦‚æœè¿™äº›å‚æ•°è®¾ç½®ä¸å½“ï¼Œåˆ™å¯èƒ½å¯¼è‡´ç®—æ³•æ— æ³•æ”¶æ•›æˆ–æ”¶æ•›éå¸¸ç¼“æ…¢ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>DeepLearning</category>
      </categories>
      <tags>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>Tmux çš„ä½¿ç”¨å’Œé…ç½®</title>
    <url>/hexo_blog/2023/08/13/Tmux%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>Tmux çš„å¸¸ç”¨æ“ä½œ</p>
<span id="more"></span>
<h1 id="tmux-çš„ä½¿ç”¨å’Œé…ç½®">Tmux çš„ä½¿ç”¨å’Œé…ç½®</h1>
<h2 id="tmuxç®€ä»‹">Tmuxç®€ä»‹</h2>
<p>Tmuxæ˜¯ä¸€ä¸ªç»ˆç«¯å¤ç”¨è½¯ä»¶,å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­ç®¡ç†å¤šä¸ªä¼šè¯å’Œçª—å£ã€‚</p>
<h2 id="tmuxçš„åŸºæœ¬æ“ä½œ">Tmuxçš„åŸºæœ¬æ“ä½œ</h2>
<h3 id="æ–°å»ºtmuxä¼šè¯">æ–°å»ºTmuxä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux new -s session_name</span><br></pre></td></tr></table></figure>
<h3 id="é‡æ–°è¿æ¥åˆ°æŒ‡å®šä¼šè¯">é‡æ–°è¿æ¥åˆ°æŒ‡å®šä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux a -t session_name</span><br></pre></td></tr></table></figure>
<h3 id="é€€å‡ºå½“å‰ä¼šè¯">é€€å‡ºå½“å‰ä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ—å‡ºæ‰€æœ‰ä¼šè¯">åˆ—å‡ºæ‰€æœ‰ä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<h3 id="ç»ˆæ­¢æŒ‡å®šä¼šè¯">ç»ˆæ­¢æŒ‡å®šä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux kill-session -t session_name</span><br></pre></td></tr></table></figure>
<h3 id="ä¿å­˜æ—¥å¿—">ä¿å­˜æ—¥å¿—</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux capture-pane -pS - -t &lt;ä¼šè¯åç§°æˆ–ID&gt; &gt; tmp.log</span><br></pre></td></tr></table></figure>
<p>ç»ˆæ­¢æ‰€æœ‰ä¼šè¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux kill-server</span><br></pre></td></tr></table></figure>
<h3 id="åˆ‡æ¢ä¼šè¯çª—å£">åˆ‡æ¢ä¼šè¯çª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then c  # åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£</span><br><span class="line">ctrl+b then p  # åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£</span><br><span class="line">ctrl+b then n  # åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£</span><br><span class="line">ctrl+b then number # åˆ‡æ¢åˆ°æŒ‡å®šçª—å£,numberä¸ºçª—å£ç¼–å·</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºæ–°çª—å£">åˆ›å»ºæ–°çª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then c # åˆ›å»ºæ–°çª—å£å¹¶åˆ‡æ¢åˆ°æ–°çª—å£</span><br></pre></td></tr></table></figure>
<h3 id="å…³é—­å½“å‰çª—å£">å…³é—­å½“å‰çª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then &amp; # å…³é—­å½“å‰çª—å£</span><br></pre></td></tr></table></figure>
<h3 id="åˆ‡æ¢çª—å£å¸ƒå±€">åˆ‡æ¢çª—å£å¸ƒå±€</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then space # åˆ‡æ¢å¸ƒå±€,é»˜è®¤åŒ…æ‹¬even-horizontalã€even-verticalã€main-horizontalã€main-verticalã€tiledå¸ƒå±€</span><br></pre></td></tr></table></figure>
<h3 id="æ¨ªå‘å’Œçºµå‘åˆ†å‰²çª—å£">æ¨ªå‘å’Œçºµå‘åˆ†å‰²çª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then &quot; # æ¨ªå‘åˆ†å‰²çª—å£</span><br><span class="line">ctrl+b then % # çºµå‘åˆ†å‰²çª—å£  </span><br></pre></td></tr></table></figure>
<h3 id="åˆ‡æ¢åˆ°æŒ‡å®šçª—å£">åˆ‡æ¢åˆ°æŒ‡å®šçª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then o # åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªåˆ†å‰²çª—å£</span><br><span class="line">ctrl+b then æ–¹å‘é”® # åˆ‡æ¢åˆ°æŒ‡å®šçª—å£</span><br></pre></td></tr></table></figure>
<h3 id="è°ƒæ•´åˆ†å‰²çª—å£å¤§å°">è°ƒæ•´åˆ†å‰²çª—å£å¤§å°</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ctrl+b then alt+æ–¹å‘é”® # è°ƒæ•´åˆ†å‰²çª—å£å¤§å°</span><br></pre></td></tr></table></figure>
<h2 id="tmuxçš„é…ç½®">Tmuxçš„é…ç½®</h2>
<h3 id="å¯ç”¨é¼ æ ‡æ”¯æŒ">å¯ç”¨é¼ æ ‡æ”¯æŒ</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set -g mouse on</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®è‡ªåŠ¨å‘½åçª—å£">è®¾ç½®è‡ªåŠ¨å‘½åçª—å£</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set-window-option -g automatic-rename on</span><br><span class="line">set-option -g allow-rename off</span><br></pre></td></tr></table></figure>
<h3 id="å¤åˆ¶æ¨¡å¼">å¤åˆ¶æ¨¡å¼</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setw -g mode-keys vi # è®¾ç½®viæ¨¡å¼</span><br><span class="line">bind-key -T copy-mode-vi v send-keys -X begin-selection # å¼€å§‹é€‰æ‹©æ–‡æœ¬ </span><br><span class="line">bind-key -T copy-mode-vi y send-keys -X copy-selection # å¤åˆ¶é€‰æ‹©çš„æ–‡æœ¬</span><br></pre></td></tr></table></figure>
<h3 id="å…¶ä»–å¸¸ç”¨é…ç½®">å…¶ä»–å¸¸ç”¨é…ç½®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># é¼ æ ‡æ”¯æŒ</span><br><span class="line">set -g mouse on</span><br><span class="line"></span><br><span class="line"># å¯ç”¨çŠ¶æ€æ </span><br><span class="line">set -g status on</span><br><span class="line"></span><br><span class="line"># è®¾ç½®çŠ¶æ€æ é¢œè‰²   </span><br><span class="line">set -g status-style fg=white,bg=black</span><br><span class="line"></span><br><span class="line"># è‡ªåŠ¨é‡å‘½åçª—å£ </span><br><span class="line">setw -g automatic-rename on</span><br><span class="line"></span><br><span class="line"># å¯ç”¨æ´»åŠ¨å‘Šè­¦</span><br><span class="line">setw -g monitor-activity on</span><br><span class="line"></span><br><span class="line"># è®¾ç½®å‘½ä»¤å‰ç¼€ä¸ºCtrl+a</span><br><span class="line">set -g prefix C-a</span><br><span class="line">unbind C-b</span><br><span class="line">bind C-a send-prefix</span><br><span class="line"></span><br><span class="line"># å¤åˆ¶æ¨¡å¼</span><br><span class="line">bind -T copy-mode-vi v send -X begin-selection</span><br><span class="line">bind -T copy-mode-vi y send -X copy-selection</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯Tmuxçš„å¸¸ç”¨æ“ä½œå’Œé…ç½®,å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œè°ƒæ•´å’Œæ‰©å±•ã€‚Tmuxå¯ä»¥å¤§å¤§æé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡,æ¨èç»å¸¸ä½¿ç”¨ç»ˆç«¯çš„åŒå­¦éƒ½å»å­¦ä¹ å’Œä½¿ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Tmux</tag>
      </tags>
  </entry>
  <entry>
    <title>MoEä¸­è´Ÿè½½å‡è¡¡Losså®ç°</title>
    <url>/hexo_blog/2024/06/15/MoE%E4%B8%AD%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1Loss%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%AF%94/</url>
    <content><![CDATA[<p>å¯¹æ¯” MoE ä¸­è´Ÿè½½å‡è¡¡ Loss çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æœ‰è·¨å±‚å’Œéè·¨å±‚ä¸¤ç§å®ç°</p>
<span id="more"></span>
<h2 id="moe-æ¦‚è¿°">MoE æ¦‚è¿°</h2>
<p>MoEï¼ˆMixture of
Expertsï¼‰æ˜¯ä¸€ç§æ¨¡å‹ç»“æ„ï¼Œç”±å¤šä¸ªä¸“å®¶ï¼ˆexpertï¼‰ç»„æˆï¼Œæ¯ä¸ªä¸“å®¶è´Ÿè´£å¤„ç†ä¸åŒçš„è¾“å…¥æ•°æ®ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ª
gating network æ¥å†³å®šæ¯ä¸ªè¾“å…¥æ•°æ®ç”±å“ªä¸ªä¸“å®¶å¤„ç†ã€‚</p>
<figure>
<img
src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/moe/00_switch_transformer.png"
alt="MoE" />
<figcaption aria-hidden="true">MoE</figcaption>
</figure>
<p>åœ¨ LLM çš„ Next Token è®­ç»ƒæ–¹å¼ä¸‹ï¼Œæ¯ä¸ª token
ä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªä¸“å®¶å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯æ¯ä¸ªä¸“å®¶è¢«é€‰ä¸­çš„æ¬¡æ•°ç›¸ç­‰ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯ä¸ªä¸“å®¶éƒ½èƒ½å¾—åˆ°å……åˆ†çš„è®­ç»ƒã€‚ä¸ºæ­¤ï¼Œéœ€è¦å¼•å…¥è´Ÿè½½å‡è¡¡
Lossã€‚</p>
<h2 id="è´Ÿè½½å‡è¡¡-loss">è´Ÿè½½å‡è¡¡ Loss</h2>
<p>åœ¨<a
href="https://arxiv.org/abs/2101.03961">åŸè®ºæ–‡</a>ä¸­å…¬å¼å¦‚ä¸‹ï¼š</p>
<figure>
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/MoE/load_balancing_loss.png"
alt="load_balancing_loss" />
<figcaption aria-hidden="true">load_balancing_loss</figcaption>
</figure>
<p>ä½†è¿™ä¸ªå…¬å¼è¡¨è¾¾çš„ä¿¡æ¯ä¸å¤Ÿå…¨é¢ã€‚åœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œå¾€å¾€å…·å¤‡å¾ˆå¤šå±‚ï¼Œå³æ¯å±‚éƒ½å…·å¤‡æ··åˆä¸“å®¶ã€‚å› æ­¤ï¼Œè¿™é‡Œå…¶å®æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>è·¨å±‚å®ç°ï¼šå¯¹äºæ‰€æœ‰ tokenï¼ŒæœŸæœ›æ‰€æœ‰å±‚é€‰å‡ºæ¥çš„ä¸“å®¶æ¬¡æ•°ç›¸ç­‰</li>
<li>éè·¨å±‚å®ç°ï¼šå¯¹äºæ‰€æœ‰ tokenï¼ŒæœŸæœ›æ¯ä¸€å±‚é€‰å‡ºæ¥çš„ä¸“å®¶æ¬¡æ•°ç›¸ç­‰</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸¤å±‚çš„ç¥ç»ç½‘ç»œï¼Œä¸¤ä¸ªä¸“å®¶ï¼Œå››ä¸ª tokenã€‚</p>
<p>éè·¨å±‚ï¼šå¯¹äºæ‰€æœ‰ tokenï¼ŒæœŸæœ›æ¯ä¸€å±‚é€‰å‡ºæ¥çš„ä¸“å®¶æ¬¡æ•°ç›¸ç­‰ã€‚æ‰€ä»¥ç¬¬ä¸€å±‚ 1
å·ä¸“å®¶è¢«é€‰ä¸­ 2 æ¬¡ï¼Œ2 å·ä¸“å®¶è¢«é€‰ä¸­ 2 æ¬¡ï¼›ç¬¬äºŒå±‚ä¸€æ ·ã€‚ è·¨å±‚ï¼šå¯¹äºæ‰€æœ‰
tokenï¼ŒæœŸæœ›æ‰€æœ‰å±‚é€‰å‡ºæ¥çš„ä¸“å®¶æ¬¡æ•°ç›¸ç­‰ã€‚æ‰€ä»¥å¯ä»¥ç¬¬ä¸€å±‚ 1 å·ä¸“å®¶è¢«é€‰ä¸­ 4
æ¬¡ï¼Œç¬¬äºŒå±‚ 2 å·ä¸“å®¶è¢«é€‰ä¸­ 4 æ¬¡ã€‚æ±‚å’Œï¼Œæ¯ä¸ªä¸“å®¶è¢«é€‰ä¸­çš„æ¬¡æ•°ç›¸ç­‰</p>
<p>æ¢è€Œè¨€ä¹‹ï¼Œç›¸å½“äºè·¨å±‚å®ç°æ˜¯ä¸€ç§æ›´æ¾æ•£çš„å®ç°æ–¹å¼ï¼Œå¹¶ä¸è¦æ±‚æ¯å±‚æ¯ä¸ªä¸“å®¶è¢«é€‰ä¸­çš„æ¬¡æ•°ç›¸ç­‰ï¼Œåªè¦æ•´ä½“å‡è¡¡å³å¯ã€‚</p>
<p>huggingface
çš„å®ç°ï¼šhttps://github.com/huggingface/transformers/blob/main/src/transformers/models/mixtral/modeling_mixtral.py</p>
<p>megatron çš„å®ç°ï¼š
https://github.com/databricks/megablocks/blob/main/megablocks/layers/moe.py</p>
<p>ä¸‹é¢æ˜¯
https://gist.github.com/tdrussell/0529afd8d280fbe2c1c582d8f865e909
å®ç°çš„ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ã€‚</p>
<h3 id="è·¨å±‚å®ç°">è·¨å±‚å®ç°</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_balancing_loss_func1</span>(<span class="params">gate_logits: torch.Tensor, num_experts: torch.Tensor = <span class="literal">None</span>, top_k=<span class="number">2</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(gate_logits, <span class="built_in">tuple</span>):</span><br><span class="line">        compute_device = gate_logits[<span class="number">0</span>].device</span><br><span class="line">        concatenated_gate_logits = torch.cat([layer_gate.to(compute_device) <span class="keyword">for</span> layer_gate <span class="keyword">in</span> gate_logits], dim=<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">    routing_weights = torch.nn.functional.softmax(concatenated_gate_logits, dim=-<span class="number">1</span>)</span><br><span class="line">    _, selected_experts = torch.topk(routing_weights, top_k, dim=-<span class="number">1</span>) <span class="comment"># [batch_size X sequence_length, top_k]</span></span><br><span class="line">    expert_mask = torch.nn.functional.one_hot(selected_experts, num_experts) <span class="comment"># [batch_size X sequence_length, top_k, num_experts]</span></span><br><span class="line">    tokens_per_expert = torch.mean(expert_mask.<span class="built_in">float</span>(), dim=<span class="number">0</span>) <span class="comment"># [top_k, num_experts]</span></span><br><span class="line">    <span class="comment"># Compute the average probability of routing to these experts</span></span><br><span class="line">    router_prob_per_expert = torch.mean(routing_weights, dim=<span class="number">0</span>) <span class="comment"># [num_experts]</span></span><br><span class="line">    overall_loss = torch.<span class="built_in">sum</span>(tokens_per_expert * router_prob_per_expert.unsqueeze(<span class="number">0</span>)) <span class="comment"># / top_k</span></span><br><span class="line">    <span class="keyword">return</span> overall_loss * num_experts</span><br></pre></td></tr></table></figure>
<h3 id="éè·¨å±‚å®ç°">éè·¨å±‚å®ç°</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_balancing_loss_func2</span>(<span class="params">gate_logits: torch.Tensor, num_experts: torch.Tensor = <span class="literal">None</span>, top_k=<span class="number">2</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(gate_logits, <span class="built_in">tuple</span>):</span><br><span class="line">        compute_device = gate_logits[<span class="number">0</span>].device</span><br><span class="line">        stacked_gate_logits = torch.stack([layer_gate.to(compute_device) <span class="keyword">for</span> layer_gate <span class="keyword">in</span> gate_logits], dim=<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">    routing_weights = torch.nn.functional.softmax(stacked_gate_logits, dim=-<span class="number">1</span>) <span class="comment"># [num_layers, num_tokens, num_experts]</span></span><br><span class="line">    _, selected_experts = torch.topk(routing_weights, top_k, dim=-<span class="number">1</span>) <span class="comment"># [num_layers, num_tokens, top_k]</span></span><br><span class="line">    expert_mask = torch.nn.functional.one_hot(selected_experts, num_experts) <span class="comment"># [num_layers, num_tokens, top_k, num_experts]</span></span><br><span class="line">    <span class="comment"># For a given token, determine if it was routed to a given expert. Think of this as a collection of top_k-hot vectors.</span></span><br><span class="line">    expert_mask = torch.<span class="built_in">max</span>(expert_mask, dim=-<span class="number">2</span>).values.<span class="built_in">float</span>() <span class="comment"># [num_layers, num_tokens, num_experts]</span></span><br><span class="line">    tokens_per_layer_and_expert = torch.mean(expert_mask, dim=-<span class="number">2</span>) <span class="comment"># [num_layers, num_experts]</span></span><br><span class="line">    router_prob_per_layer_and_expert = torch.mean(routing_weights, dim=-<span class="number">2</span>) <span class="comment"># [num_layers, num_experts]</span></span><br><span class="line">    <span class="keyword">return</span> torch.mean(tokens_per_layer_and_expert * router_prob_per_layer_and_expert) * num_experts**<span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯¹æ¯”">å¯¹æ¯”</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    gate_logits1 = torch.tensor([<span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]).<span class="built_in">float</span>().repeat(<span class="number">256</span>, <span class="number">1</span>)</span><br><span class="line">    gate_logits2 = torch.tensor([<span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>]).<span class="built_in">float</span>().repeat(<span class="number">256</span>, <span class="number">1</span>)</span><br><span class="line">    gate_logits3 = torch.tensor([<span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>]).<span class="built_in">float</span>().repeat(<span class="number">256</span>, <span class="number">1</span>)</span><br><span class="line">    gate_logits4 = torch.tensor([<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>]).<span class="built_in">float</span>().repeat(<span class="number">256</span>, <span class="number">1</span>)</span><br><span class="line">    gate_logits = (gate_logits1, gate_logits2, gate_logits3, gate_logits4)</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">print</span>(load_balancing_loss_func1(gate_logits, num_experts=<span class="number">4</span>))  <span class="comment"># 2.0</span></span><br><span class="line">    <span class="built_in">print</span>(load_balancing_loss_func2(gate_logits, num_experts=<span class="number">4</span>))  <span class="comment"># 3.9478</span></span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥çœ‹ï¼Œéè·¨å±‚å®ç°èƒ½å¤Ÿå¯¹æ¯ä¸€å±‚çš„ä¸“å®¶è¿›è¡Œæ›´å¼ºçš„çº¦æŸï¼Œé¢„æœŸä¼šå®ç°æ›´å¥½çš„è´Ÿè½½å‡è¡¡ã€‚æ‰€ä»¥ï¼Œä¸‹é¢å¼•å…¥æ¨¡å‹å’Œæ•°æ®ï¼Œæ¥å¯¹æ¯”è¿™ç§è´Ÿè½½å‡è¡¡
Loss ä¸¤ç§å†™æ³•ã€‚</p>
<h2 id="loss-å®ç°">Loss å®ç°</h2>
<p>åœ¨ PyTorch å®ç°è¿™ç§ç½‘ç»œå±‚ä¸­é—´çš„ Lossï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<h3 id="ç®€å•ç›´æ¥">ç®€å•ç›´æ¥</h3>
<p>ç›´æ¥åœ¨ç½‘ç»œç»“æ„ä¸­å¼•å…¥ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®— loss
ï¼Œæœ€åæŠŠè¿™ä¸ªå€¼è¿”å›æ¨¡å‹è¾“å‡ºï¼Œä¾èµ–æœ€å¤–é¢çš„<code>loss.backward()</code>
è¿›è¡Œæ¢¯åº¦æ›´æ–°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">criterion</span>(<span class="params">self, x</span>):</span><br><span class="line">    <span class="keyword">return</span> torch.mean(x**<span class="number">2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="torch.autograd.function">torch.autograd.Function</h3>
<p>ä¸€ç§æ›´é«˜çº§å¯æ§çš„æ–¹å¼æ˜¯ä½¿ç”¨
<code>torch.autograd.Function</code>ï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½çš„æ§åˆ¶æ¢¯åº¦çš„ä¼ é€’ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¯¹æ¢¯åº¦è¿›è¡Œç¼©æ”¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoEAuxLossAutoScaler</span>(torch.autograd.Function):</span><br><span class="line">    main_loss_backward_scale: torch.Tensor = torch.tensor(<span class="number">1.0</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, output: torch.Tensor, aux_loss: torch.Tensor</span>):</span><br><span class="line">        ctx.save_for_backward(aux_loss)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output: torch.Tensor</span>):</span><br><span class="line">        (aux_loss,) = ctx.saved_tensors</span><br><span class="line">        aux_loss_backward_scale = MoEAuxLossAutoScaler.main_loss_backward_scale</span><br><span class="line">        scaled_aux_loss_grad = torch.ones_like(aux_loss) * aux_loss_backward_scale</span><br><span class="line">        <span class="keyword">return</span> grad_output, scaled_aux_loss_grad</span><br></pre></td></tr></table></figure>
<h3 id="å®Œæ•´ä¾‹å­">å®Œæ•´ä¾‹å­</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seed_everything</span>(<span class="params">seed</span>):</span><br><span class="line">    random.seed = seed</span><br><span class="line">    np.random.seed(seed)</span><br><span class="line">    torch.manual_seed(seed)</span><br><span class="line">    torch.cuda.manual_seed_all(seed)</span><br><span class="line">    torch.backends.cudnn.deterministic = <span class="literal">True</span></span><br><span class="line">    torch.backends.cudnn.benchmark = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">seed_everything(<span class="number">42</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoEAuxLossAutoScaler</span>(torch.autograd.Function):</span><br><span class="line">    main_loss_backward_scale: torch.Tensor = torch.tensor(<span class="number">1.0</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, output: torch.Tensor, aux_loss: torch.Tensor</span>):</span><br><span class="line">        ctx.save_for_backward(aux_loss)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output: torch.Tensor</span>):</span><br><span class="line">        (aux_loss,) = ctx.saved_tensors</span><br><span class="line">        aux_loss_backward_scale = MoEAuxLossAutoScaler.main_loss_backward_scale</span><br><span class="line">        scaled_aux_loss_grad = torch.ones_like(aux_loss) * aux_loss_backward_scale</span><br><span class="line">        <span class="keyword">return</span> grad_output, scaled_aux_loss_grad</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># åˆ›å»ºè‡ªå®šä¹‰æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_layers=<span class="number">1</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(MyModel, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.num_layers = num_layers</span><br><span class="line">        <span class="variable language_">self</span>.same_layer = nn.ModuleList([nn.Linear(<span class="number">20</span>, <span class="number">20</span>, bias=<span class="literal">False</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_layers)])</span><br><span class="line">        <span class="variable language_">self</span>.lm_head = nn.Linear(<span class="number">20</span>, <span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">criterion</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.mean(x**<span class="number">2</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, is_complex=<span class="literal">False</span></span>):</span><br><span class="line">        lbl_loss = <span class="number">0.0</span></span><br><span class="line">        out1 = x</span><br><span class="line">        <span class="keyword">for</span> i, layer <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>.same_layer):</span><br><span class="line">            out1 = layer(out1)</span><br><span class="line"> </span><br><span class="line">            lbl_loss_layer = <span class="variable language_">self</span>.criterion(out1)</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯å¤æ‚çš„æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨ MoEAuxLossAutoScalerï¼Œå°†æ¢¯åº¦ç¼©æ”¾åˆ°ä¸»è¦çš„ loss ä¸Š</span></span><br><span class="line">            <span class="comment"># è¿™æ ·ä¸éœ€è¦è¿”å›ä¸­é—´è®¡ç®—çš„ loss ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> is_complex:</span><br><span class="line">                out1 = MoEAuxLossAutoScaler.apply(out1, lbl_loss_layer / <span class="variable language_">self</span>.num_layers)</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è¿”å›ä¸­é—´è®¡ç®—çš„ loss ç»“æœ</span></span><br><span class="line">            <span class="comment"># ä½†è¿™æ ·éœ€è¦æŠŠ loss è®¡ç®—çš„ç»“æœè¿”å›ï¼Œä»¥åœ¨å¤–éƒ¨è¿›è¡Œæ¢¯åº¦æ›´æ–°</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lbl_loss += (lbl_loss_layer / <span class="variable language_">self</span>.num_layers)</span><br><span class="line">        out3 = <span class="variable language_">self</span>.lm_head(out1)</span><br><span class="line">        <span class="keyword">return</span> out3, lbl_loss</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    device = <span class="string">&quot;cpu&quot;</span></span><br><span class="line">    num_layers = <span class="number">2</span></span><br><span class="line">    model = MyModel(num_layers).to(device)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å®šä¹‰ä¼˜åŒ–å™¨</span></span><br><span class="line">    optimizer = optim.SGD(model.parameters(), lr=<span class="number">1e-4</span>)</span><br><span class="line">    criterion = nn.MSELoss()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è¾“å…¥éšæœºæ•°æ®</span></span><br><span class="line">    input_ = torch.randn(<span class="number">10</span>, <span class="number">20</span>).to(device)</span><br><span class="line">    real_out = torch.randn(<span class="number">10</span>, <span class="number">1</span>).to(device)</span><br><span class="line"> </span><br><span class="line">    is_complex = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">iter</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        out, lbl_loss = model(input_, is_complex=is_complex)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯ç®€å•æ–¹æ³•æ˜¯æœ‰å€¼çš„</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯å¤æ‚æ–¹æ³• lbl_loss æ˜¯ 0</span></span><br><span class="line">        loss = lbl_loss + criterion(out, real_out)</span><br><span class="line"> </span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;is_complex: <span class="subst">&#123;is_complex&#125;</span>&quot;</span>, model.state_dict()[<span class="string">f&quot;same_layer.0.weight&quot;</span>][<span class="number">0</span>])  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>MoE</tag>
        <tag>Loss</tag>
      </tags>
  </entry>
  <entry>
    <title>Short Paper Reading</title>
    <url>/hexo_blog/2022/12/31/ShortPaperReading/</url>
    <content><![CDATA[<p>è¯»ç ”æœŸé—´ï¼ŒçŸ­æ—¶ paper reading</p>
<span id="more"></span>
<h1 id="what-does-the-gradient-represent">What does the gradient
represent?</h1>
<p>2020.10.16</p>
<h2 id="motivation">Motivation</h2>
<p>The communication in distributed gradient descent. Dense &lt;&lt;
Sparse</p>
<h2 id="method">Method</h2>
<p>Gradient Dropping: removing the R% smallest gradients by absolute
value</p>
<h2 id="result">Result</h2>
<p>Reduce 50x communication sizeï¼Œspeed up 22%</p>
<h2 id="inspirer">Inspirer</h2>
<p>Gradient value could show the importance of client/model</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image2.png" /></p>
<p>ä½œè€…å‘ç°åˆ†å¸ƒå¼æœºå™¨å­¦ä¹ ä¸­ï¼Œæ¢¯åº¦å¤§å¤šä¸ºç¨€ç–çš„ï¼ˆå¤§éƒ¨åˆ†æ¥è¿‘0ï¼‰ï¼Œå³æ„å‘³ç€å¤§éƒ¨åˆ†å®¢æˆ·ç«¯å¯¹æ¢¯åº¦æ›´æ–°è´¡çŒ®å¾ˆå°ï¼Œæ•…å¯ä»¥é€šè¿‡å‰”é™¤è¿™éƒ¨åˆ†æ¢¯åº¦æ¥æå‡é€šä¿¡æ•ˆç‡ã€‚</p>
<p>å¯¹R%å°çš„æ¢¯åº¦å€¼ä¸è¿›è¡Œé€šä¿¡ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶çš„æ¢¯åº¦æ‰ä¼šè¿›è¡Œé€šä¿¡ã€‚</p>
<p>å®éªŒç»“æœè¯æ˜ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿåœ¨ç²¾åº¦ä¸å˜çš„å‰æä¸‹ï¼Œå‡å°‘50å€çš„é€šä¿¡è§„æ¨¡ï¼Œå¹¶ä¸”æå‡äº†22%çš„é€Ÿåº¦</p>
<p>è¿™ç¯‡æ–‡ç« å¯ä»¥é—´æ¥ä¸ºå—æ§å…±äº«å­¦ä¹ ä¸­ï¼Œä¹‹å‰çš„å®éªŒç»“æœåšä¸€ä¸ªè§£é‡Šï¼Œåªæ¥å—æ¢¯åº¦å€¼è¾ƒå¤§çš„å®¢æˆ·ç«¯ï¼Œå³è¡¨æ˜è¯¥å®¢æˆ·ç«¯çš„è´¡çŒ®è¾ƒå¤§ã€‚</p>
<p>é—®é¢˜ï¼šåˆ†å¸ƒå¼æœºå™¨å­¦ä¹ çš„ä»»åŠ¡ï¼Œæ•°æ®å¯èƒ½éƒ½æ˜¯æ¥æºåŒä¸€ä¸ªåŸŸå†…çš„ï¼Œç”šè‡³å°±æ˜¯ç›¸åŒçš„æ•°æ®ï¼›ä»è¯¥æ–‡ä¸­çš„å›¾æ¥çœ‹ï¼Œä¸èƒ½è¯æ˜ä¹‹å‰å®éªŒæ”¶æ•›é€Ÿåº¦åŠ å¿«çš„åŸå› </p>
<blockquote>
<p>Alham Fikri Aji and Kenneth Heafield. Sparse communication for
distributed gradient descent. In Empirical Methods in Natural Language
Processing (EMNLP), 2017.</p>
</blockquote>
<h1 id="knowledge-distillation-with-svd">Knowledge Distillation with
SVD</h1>
<p>2020.10.23</p>
<ul>
<li><p>Knowledge Distillation (KD): Fully Connected Layers-&gt;L2
loss</p></li>
<li><p>KD-FSP: Feature Map-&gt;L2 loss</p></li>
<li><p>KD-SVD: Feature Map-&gt;SVD</p></li>
<li><p>KD-EID: KD-SVD(Adaptively)</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image3.png" /></p>
<p>åŸºäºSVDå¯¹æ¨¡å‹è¿›è¡Œå‹ç¼©çš„æ–°æ”¹è¿›ã€‚</p>
<p>é¦–å…ˆå¯¹çŸ¥è¯†è’¸é¦è¿›è¡Œç®€å•çš„å›é¡¾ï¼ŒçŸ¥è¯†è’¸é¦æ˜¯åˆ©ç”¨æ•™å¸ˆæ¨¡å‹ä¸å­¦ç”Ÿæ¨¡å‹åœ¨æœ€åè¾“å‡ºçš„å…¨è¿æ¥å±‚ä¸Šè®¡ç®—L2æŸå¤±ï¼Œä»¥æ­¤æ¥è¾¾åˆ°çŸ¥è¯†è¿ç§»ã€æ¨¡å‹å‹ç¼©ã€æ¨¡å‹é˜²å¾¡ç­‰ç›®çš„ã€‚åŸºäºKDçš„æ”¹è¿›ä¹‹ä¸€ï¼Œå°±æ˜¯å¯¹æ•™å¸ˆä¸å­¦ç”Ÿæ¨¡å‹ä¸­çš„ç½‘ç»œä¸­é—´å±‚çš„Feature
Mapè¿›è¡ŒæŸå¤±è®¡ç®—ã€‚ä½œè€…åŸºäºFSPæ­¤ç±»æ€æƒ³ï¼Œæå‡ºå¯¹Feature
Mapè¿›è¡ŒSVDï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆæå–æ•™å¸ˆæ¨¡å‹ä¸­çš„çŸ¥è¯†ï¼Œæ›´å‡†ç¡®åœ°ä¼ é€’ç»™å­¦ç”Ÿä¿¡æ¯ã€‚</p>
<p>æ–°å‘è¡¨çš„æ–‡ç« ï¼Œåˆ™æ˜¯å¯¹è¿™ç§æ–¹æ³•è¿›è¡Œäº†æ”¹è¿›ï¼Œæ— éœ€äººå·¥å¹²é¢„å‚æ•°è®¾è®¡ã€‚å®éªŒè¯æ˜è¯¥æ–¹æ³•ä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼ˆåœ¨TinyImageNetå¯¹æ¯”åŸå§‹çš„å­¦ç”Ÿæ¨¡å‹æé«˜äº†2.89%ï¼‰ã€‚æ–‡ç« å¤§éƒ¨åˆ†å†…å®¹éƒ½è¿˜æ˜¯ECCVé‚£ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œå¢åŠ çš„è‡ªé€‚åº”éƒ¨åˆ†æ˜¯åˆ¤æ–­æ•™å¸ˆä¸å­¦ç”Ÿæ¨¡å‹çš„Feature
Mapå¤§å°å·®å¼‚ï¼Œæ¥å†³å®šä½¿ç”¨SVDè¿˜æ˜¯ç‰¹å¾åˆ†è§£ã€‚</p>
<blockquote>
<p>Lee S, Song B C. Knowledge Transfer via Decomposing Essential
Information in Convolutional Neural Networks[J]. IEEE transactions on
neural networks and learning systems.</p>
</blockquote>
<h1 id="knowledge-distillation-in-federated-learning">Knowledge
Distillation in Federated Learning</h1>
<p>2020.10.30</p>
<h2 id="contributions">Contributions</h2>
<ul>
<li><p>distillation framework for robust federated model fusion</p></li>
<li><p>CV/NLP datasets</p></li>
<li><p>heterogeneous models and/or data</p></li>
</ul>
<h2 id="understanding">Understanding</h2>
<ul>
<li><p>Generalization bound.</p></li>
<li><p>Source, diversity and size of the distillation dataset.</p></li>
<li><p>Distillation steps.</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/custom_img1.png" /></p>
<p>è¿™ç¯‡æ–‡ç« æ˜¯NIPS2020çš„å·¥ä½œï¼Œä¸»è¦æ˜¯åŸºäºçŸ¥è¯†è’¸é¦èšåˆçš„è”é‚¦å­¦ä¹ ã€‚ä½œè€…æ˜¯æ¥è‡ªæ´›æ¡‘è”é‚¦ç†å·¥å­¦é™¢</p>
<p>ä¸»è¦è´¡çŒ®æ˜¯æå‡ºäº†é²æ£’æ€§çš„è”é‚¦è’¸é¦æ¡†æ¶ï¼Œå¹¶ä¸”åœ¨CVå’ŒNLPä»»åŠ¡ä¸Šéƒ½å¾—åˆ°äº†éªŒè¯ï¼Œè¿˜å¯¹å¼‚è´¨æ¨¡å‹ï¼Œæ— æ ‡ç­¾æ•°æ®ç­‰è¿›è¡Œäº†å¤§é‡å®éªŒã€‚</p>
<p>å³å›¾æ˜¯æ–‡ç« æå‡ºçš„ç®—æ³•ï¼ˆå›¾æ˜¯è‡ªå·±ç”»çš„ï¼ŒåŸæ–‡å¹¶æ²¡æœ‰ç»™æ–¹æ³•å›¾ï¼‰,é¦–å…ˆæ˜¯æ ¹æ®ä¸åŒçš„å®¢æˆ·ç«¯åœ¨æœ¬åœ°è®­ç»ƒå¾—åˆ°æ¢¯åº¦å€¼åï¼Œä¸Šä¼ è‡³æœåŠ¡ç«¯è¿›è¡Œèšåˆï¼Œåå‘å›ç»™å®¢æˆ·ç«¯è¿›è¡Œä½œä¸ºæ•™å¸ˆæ¨¡å‹è¿›è¡ŒKLæ•£åº¦è®¡ç®—ï¼Œå¯¹æ¯”äºä¹‹å‰çš„FedMDçš„æ–¹æ³•æ˜¯ä¸åŠ å…¥å…¬å¼€æ•°æ®é›†éƒ¨åˆ†ã€‚FedDFè¿™ä¸ªæ–¹æ³•è·Ÿä¹‹å‰ä¸‰å®¤çš„ä¸€ä½å¸ˆå§ä»‹ç»åœ¨ç‰©è”ç½‘ä¸­çš„åº”ç”¨ï¼Œæ¡†æ¶åŸºæœ¬ä¸€è‡´ã€‚</p>
<p>FedDF is designed for effective model fusion on the server,
considering the accuracy of the global model on the test dataset.</p>
<p>FedDFæ˜¯ä¸ºäº†æœ‰æ•ˆèåˆæ¨¡å‹ï¼Œè€ƒè™‘äº†å…¨å±€æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®æ€§ï¼Œæ‰€ä»¥æœªå¯¹ä¸€äº›å®éªŒè¿›è¡Œæ¯”è¾ƒï¼ˆæ¯”å¦‚FedMDï¼‰ã€‚æˆ‘è§‰å¾—åœ¨æ‰¾å€Ÿå£ï¼ŒFedMDæ˜¯æœ‰è¿™éƒ¨åˆ†å®éªŒçš„ã€‚</p>
<p>æ–‡ç« ä¸ºäº†è¾…åŠ©ç†è§£è¿™ä¸ªæ¡†æ¶ï¼Œè¿˜åŠ å…¥äº†æ³›åŒ–è¾¹ç•Œï¼Œæ•°æ®é›†çš„åˆ†å¸ƒä¸å¤§å°ï¼Œè’¸é¦çš„å®éªŒï¼ˆç±»ä¼¼äºæ¶ˆèå®éªŒï¼‰</p>
<blockquote>
<p>Lin T, Kong L, Stich S U, et al. Ensemble Distillation for Robust
Model Fusion in Federated Learning[J]. arXiv preprint arXiv:2006.07242,
2020.</p>
</blockquote>
<p>æ´›æ¡‘è”é‚¦ç†å·¥å­¦é™¢</p>
<h2 id="feddf-experiments">FedDF Experiments</h2>
<p>2020.12.04</p>
<ul>
<li>åŸºæœ¬è®¾ç½®
<ul>
<li>Local epochs(1ã€20ã€40)</li>
<li>C(0.2ã€0.4ã€0.8)</li>
<li>è¾¾åˆ°ç›®æ ‡æ€§èƒ½Tï¼ˆ0.8ã€0.75ï¼‰</li>
<li>æ•°æ®å¼‚è´¨ç¨‹åº¦alpha(1ã€0.1)</li>
</ul></li>
<li>å›ºå®šè®¾ç½®
<ul>
<li>å®¢æˆ·ç«¯æ•°ç›®ï¼š20</li>
<li>æ¨¡å‹æ¶æ„ï¼šResnet-8</li>
<li>æ•°æ®é›†ï¼šCIFAR-10</li>
</ul></li>
<li>å¯¹æ¯”æ–¹æ³•ï¼šFEDAVGã€FEDPROXã€FEDAVGMã€FEDDF</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image4.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image5.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image6.png" /></p>
<blockquote>
<p>Lin T, Kong L, Stich S U, et al. Ensemble Distillation for Robust
Model Fusion in Federated Learning[J]. arXiv preprint arXiv:2006.07242,
2020.</p>
</blockquote>
<h1
id="ensemble-distillation-for-robust-model-fusion-in-federated-learning">Ensemble
Distillation for Robust Model Fusion in Federated Learning</h1>
<p>2021.01.15</p>
<h2 id="è”é‚¦å­¦ä¹ çŸ¥è¯†è’¸é¦">è”é‚¦å­¦ä¹ â€”â€”çŸ¥è¯†è’¸é¦</h2>
<ul>
<li><p>Zero-Shotï¼ˆæ— æ ‡ç­¾ï¼‰:
åˆ©ç”¨å…¬å¼€æ•°æ®é›†ï¼Œè®­ç»ƒGANç”Ÿæˆæ— æ ‡ç­¾çš„æ•°æ®</p></li>
<li><p>å¸¸è§„è¿ç§»å­¦ä¹ :
åˆ©ç”¨å®¢æˆ·ç«¯æ¨¡å‹åˆ†ç±»å±‚æƒé‡ç”Ÿæˆæ•°æ®ï¼ˆDirichletåˆ†å¸ƒï¼‰</p></li>
<li><p>å™ªå£°è¿ç§»å­¦ä¹ : å·®åˆ†éšç§+è”é‚¦å­¦ä¹ </p></li>
<li><p>SWAè¿ç§»å­¦ä¹ : åœ¨ä¸€èˆ¬çš„ä¼˜åŒ–å™¨ä¸Šå¢åŠ SWAï¼Œå¯ä»¥æé«˜æ€§èƒ½</p></li>
</ul>
<figure>
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image7.jpeg"
alt="Dirichlet åˆ†å¸ƒ" />
<figcaption aria-hidden="true">Dirichlet åˆ†å¸ƒ</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image8.png"
alt="SWA vs SGD" />
<figcaption aria-hidden="true">SWA vs SGD</figcaption>
</figure>
<p>Dirichletåˆ†å¸ƒæ˜¯Betaåˆ†å¸ƒçš„å¤šå…ƒæ¨å¹¿ã€‚Betaåˆ†å¸ƒæ˜¯äºŒé¡¹å¼åˆ†å¸ƒçš„å…±è½­åˆ†å¸ƒï¼ŒDirichletåˆ†å¸ƒæ˜¯å¤šé¡¹å¼åˆ†å¸ƒçš„å…±è½­åˆ†å¸ƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´çš„åˆ†å¸ƒéƒ½æ˜¯å…³äºæŸä¸ªå‚æ•°çš„å‡½æ•°ï¼ŒæŠŠå¯¹åº”çš„å‚æ•°æ¢æˆä¸€ä¸ªå‡½æ•°ï¼ˆå‡½æ•°ä¹Ÿå¯ä»¥ç†è§£æˆæŸåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦ï¼‰å°±å˜æˆäº†å…³äºå‡½æ•°çš„å‡½æ•°ã€‚äºæ˜¯ï¼ŒæŠŠDirichletåˆ†å¸ƒé‡Œé¢çš„å‚æ•°æ¢æˆä¸€ä¸ªåŸºåˆ†å¸ƒå°±å˜æˆäº†ä¸€ä¸ªå…³äºåˆ†å¸ƒçš„åˆ†å¸ƒäº†ã€‚é‚£ä¹ˆå®ƒå°±æ˜¯Dirichletè¿‡ç¨‹äº†ã€‚</p>
<p>å»¶ä¼¸é˜…è¯»ï¼š<a
href="https://www.zhihu.com/question/26751755">Dirichletåˆ†å¸ƒ</a>ï¼›<a
href="https://arxiv.org/abs/2009.05537">å·®åˆ†éšç§+è”é‚¦å­¦ä¹ </a>ï¼›<a
href="https://pytorch.org/blog/stochastic-weight-averaging-in-pytorch/">SWA</a></p>
<blockquote>
<p>Lin T, Kong L, Stich S U, et al. Ensemble distillation for robust
model fusion in federated learning[J]. arXiv preprint arXiv:2006.07242,
2020.</p>
</blockquote>
<h1
id="group-knowledge-transferfederated-learning-of-large-cnns-at-the-edge">Group
Knowledge Transfer:Federated Learning of Large CNNs at the Edge</h1>
<p>2021.04.09</p>
<h2 id="backgroundsplit-learning">Background(Split Learning)</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image11.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image12.png" /></p>
<h2 id="methodgroup-knowledge-transfer">Method(Group Knowledge
Transfer)</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image9.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image10.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image13.png" /></p>
<h1
id="performance-optimization-for-federated-person-re-identification-via-benchmark-analysis">Performance
Optimization for Federated Person Re-identification via Benchmark
Analysis</h1>
<p>2021.04.16</p>
<ol type="1">
<li><p>FedAVGä¸æ»¡è¶³éœ€æ±‚ï¼ˆä¸åŒåˆ†ç±»ï¼‰ï¼Œæ€§èƒ½ä¸Šä¹Ÿè¾¾ä¸åˆ°ï¼ˆæ¯”æœ¬åœ°è®­ç»ƒç²¾åº¦ä½ï¼‰</p></li>
<li><p>FedPAVæ»¡è¶³äº†éœ€æ±‚ï¼Œä½†æ˜¯å¯¹äºæ€§èƒ½ä¸Šä¸èƒ½å®Œæˆæ»¡è¶³ï¼ˆå°æ•°æ®æå‡ï¼Œå¤§æ•°æ®é›†ä¸‹é™ï¼Œè®­ç»ƒè¿‡ç¨‹æŒ¯è¡ï¼‰</p></li>
<li><p>FedPAV+KDæ»¡è¶³éœ€æ±‚ï¼Œæå‡äº†æ€§èƒ½ï¼Œä½†æ˜¯ä¸ç¨³å®šï¼ˆæ€§èƒ½ä¸ç¨³å®šï¼Œè®­ç»ƒè¿‡ç¨‹ç¨³å®šï¼‰</p>
<ol type="1">
<li>Trickï¼šæ­£åˆ™åŒ–</li>
<li>Trickï¼šCosing Distance Weight</li>
</ol></li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image14.png" /></p>
<h1
id="fedbn-federated-learning-on-non-iid-features-via-local-batch-normalization">FedBN:
Federated Learning on Non-IID Features via Local Batch
Normalization</h1>
<p>2021.04.23</p>
<h2 id="å®éªŒè®¾è®¡åˆ†æ">å®éªŒè®¾è®¡åˆ†æ</h2>
<ol type="1">
<li>é€‰å®šä¸€ä¸ªæ•°æ®é›†ï¼Œæ¯”è¾ƒï¼šæœ¬åœ°è®­ç»ƒè½®æ•°Eï¼Œæœ¬åœ°æ•°æ®é›†å¤§å°ï¼Œå®¢æˆ·ç«¯æ•°ç›®ï¼ˆåˆ‡å‰²æ•°æ®é›†æ•°é‡ï¼‰ï¼ˆå·¦ä¸Šè§’ä¸‰å¼ å›¾ï¼‰
<ul>
<li>å¯è¯´æ˜ï¼šæ”¶æ•›é€Ÿåº¦ã€Eçš„å½±å“ï¼Œæ•°æ®é›†å¤§å°å½±å“ï¼Œå¼‚è´¨æ€§å½±å“</li>
</ul></li>
<li>ä¸åŒæ•°æ®é›†è¿›è¡Œæ¯”è¾ƒã€‚è¯´æ˜æœ‰æ•ˆæœï¼ˆå³ä¸Šè§’ä¸€å¼ å›¾ï¼‰</li>
<li>åŸºäº2ï¼Œæœ‰æ•ˆæœå†æ¯”è¾ƒå…¶ä»–ä¸‰ç§ä¸åŒé¢†åŸŸçš„ä»»åŠ¡ã€‚å®éªŒè®¾ç½®+å®éªŒåˆ†æï¼ˆç®€è¦ï¼‰</li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image15.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image16.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image17.png" /></p>
<h1 id="adaptive-federated-optimization">Adaptive Federated
Optimization</h1>
<p>2021.05.14</p>
<h2 id="problem">Problem</h2>
<p>Standard federated optimization methods such as Federated Averaging
(FedAvg) are often difficult to tune and exhibit unfavorable convergence
behavior.</p>
<h2 id="inspired">Inspired</h2>
<p>In non-federated settings, <strong>adaptive optimization</strong>
methods have had notable success in combating such issues.</p>
<h2 id="work">Work</h2>
<p>In this work, we propose <strong>federated versions of adaptive
optimizers</strong>, including Adagrad, Adam, and Yogi, and analyze
their convergence in the presence of heterogeneous data for general
nonconvex settings.</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image18.png" /></p>
<blockquote>
<p>Google: 2020 Feb-2020 Dec</p>
</blockquote>
<h1
id="preservation-of-the-global-knowledge-by-not-true-self-knowledge-distillation-in-federated-learning">Preservation
of the Global Knowledge by Not-True Self Knowledge Distillation in
Federated Learning</h1>
<p>2021.06.18</p>
<h2 id="åŠ¨æœº">åŠ¨æœº</h2>
<p>Catastrophic Forgetting: feature shifting induced fitting on biased
local</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image19.png" /></p>
<h2 id="ç ”ç©¶">ç ”ç©¶</h2>
<p>è®­ç»ƒæ–¹å¼: æœ¬åœ°è‡ªè’¸é¦(LSD)</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image20.png" /></p>
<p>äºŒæ¬¡æ”¹è¿›: Not-True Distillation</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image21.png" /></p>
<p>æœ‰åå±€éƒ¨ç‰¹å¾è½¬ç§»è¯±å¯¼æ‹Ÿåˆ</p>
<p>é—å¿˜ç¾éš¾ï¼šæŠŠCIFAR10è¾“å…¥æ‹‰æˆäºŒç»´ï¼Œåœ¨è¿›è¡Œ100è½®è”é‚¦å­¦ä¹ åï¼Œä¼°è®¡æ•°æ®çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œä¸Šå›¾è¿™ä¸ªåˆ†å¸ƒå­˜åœ¨æ˜æ˜¾åå·®ï¼›æå‡ºçš„æ–¹æ³•åŸºæœ¬æ— åå·®</p>
<p>ç ”ç©¶æ–¹æ³•ï¼šå°†ä¼ ç»Ÿçš„è®­ç»ƒï¼Œæ”¹æˆäº†è’¸é¦çš„æ–¹å¼ï¼ˆç”±äºæ˜¯æ¨¡å‹æ¶æ„ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥å«åšè‡ªè’¸é¦ï¼‰ï¼Œä¹Ÿåœ¨æœ¬åœ°è¿›è¡Œè’¸é¦ï¼›å¦å¤–ï¼ŒåŸºäºIJCAJ2021çŸ¥è¯†è’¸é¦çš„å·¥ä½œï¼Œå¯¹æ•™å¸ˆæ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ ‡ç­¾å‰”é™¤ï¼Œå†KLæ•£åº¦è®¡ç®—ï¼Œä»¥è¿›è¡Œæ”¹è¿›ã€‚</p>
<blockquote>
<p>Taehyeon Kim, Jaehoon Oh, NakYil Kim, Sangwook Cho, and Se-Young Yun.
Comparingkullback-leibler divergence and mean squared error loss in
knowledge distillation.arXiv preprintarXiv:2105.08919, 2021.</p>
</blockquote>
<h1
id="preservation-of-the-global-knowledge-by-not-trueself-knowledge-distillation-in-federated-learning">Preservation
of the Global Knowledge by Not-TrueSelf Knowledge Distillation in
Federated Learning</h1>
<p>2021.06.25</p>
<p>åˆ©ç”¨çŸ¥è¯†è’¸é¦ä¿ç•™æ—§ä»»åŠ¡çš„çŸ¥è¯†</p>
<p><span
class="math display">\[{\mathcal{L}}_{\mathrm{FedLSD}}=(1-\beta)\cdot{\mathcal{L}}_{\mathrm{CE}}(q,\;p_{y})+\beta\cdot{\mathcal{L}}_{\mathrm{LSD}}(q_{\tau},\;q_{\tau}^{y})\quad(0&lt;\beta&lt;1)\;\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image23.png" /></p>
<p>Weight divergence</p>
<p><span class="math display">\[\rm{weight\,divergence}=||w^{F e d A v
g}-w^{S G D}||/||w^{S G D}||\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image22.png" /></p>
<p>å…¨å±€æ¨¡å‹çš„é¢„æµ‹å¯ä»¥ä½œä¸ºå…ˆå‰æ•°æ®åˆ†å¸ƒçš„å‚è€ƒï¼Œä»è€Œäº§ç”Ÿç±»ä¼¼äºåœ¨CLä¸­ä½¿ç”¨æƒ…æ™¯è®°å¿†çš„æ•ˆæœã€‚</p>
<p>betaæ˜¯æŒ‡KLæ•£åº¦æŸå¤±çš„æƒé‡</p>
<p>ç»“æœè¡¨æ˜ï¼Œæ•°æ®åˆ†å¸ƒçš„æ­£ç¡®æ€§ï¼Œå³æ•°æ®åˆ†å¸ƒçš„åæ€æ€§ï¼Œå¯èƒ½å½±å“æ•°æ®çš„å‡†ç¡®æ€§ã€‚</p>
<blockquote>
<p>Zhao Y, Li M, Lai L, et al. Federated learning with non-iid data[J].
arXiv preprint arXiv:1806.00582, 2018.</p>
</blockquote>
<h1 id="learn-distributed-gan-with-temporary-discriminators">Learn
distributed GAN with Temporary Discriminators</h1>
<p>2021.07.02</p>
<p>ç ”ç©¶åŠ¨æœºï¼šåŒ»ç–—é¢†åŸŸï¼Œåˆ©ç”¨æœ¬åœ°çš„éšç§æ•°æ®è¿›è¡Œæ•°æ®å¢å¼º</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image26.png" /></p>
<p><a
href="https://github.com/huiqu18/TDGAN-PyTorch">https://github.com/huiqu18/TDGAN-PyTorch</a></p>
<h1
id="personalized-federated-learning-with-theoretical-guarantees-a-model-agnostic-meta-learning-approach">Personalized
Federated Learning with Theoretical Guarantees: A Model-Agnostic
Meta-Learning Approach</h1>
<p>2021.07.16</p>
<h2 id="åŠ¨æœº-1">åŠ¨æœº</h2>
<p>è”é‚¦å­¦ä¹ +å…ƒå­¦ä¹ -&gt;ä¸ªæ€§åŒ–è”é‚¦å­¦ä¹ (Per-FedAVG) <img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image29.png" /></p>
<h2 id="å…ƒå­¦ä¹ maml">å…ƒå­¦ä¹ â€”â€”MAML</h2>
<p><span class="math display">\[w_{k+1}\leftarrow
w_{k}-(\beta_{k}/B)\sum_{i\in
B_{k}}\bar{\nabla}f_{i}(w_{k+1}^{i},\mathcal{D}_{o}^{i})\]</span></p>
<h2 id="first-order">First-Order</h2>
<p><span
class="math display">\[w_{k+1}=w_{k}-{\frac{\beta_{k}}{\mathcal{B}}}\sum_{i\in{B_{k}}}\left[\tilde{\nabla}f_{i}\Bigl(w_{k}-\alpha\tilde{\nabla}f_{i}(w_{k},D_{i
n}^{i}),D_{o}^{i}\right)-\alpha d_{k}^{i}]\]</span></p>
<h2 id="hessian-free">Hessian-Free</h2>
<p><span
class="math display">\[w_{k+1}=w_{k}-\beta_{k}{\frac{1}{B}}\sum_{i\in{\mathcal{B}_{k}}}\left(I-\alpha\tilde{\nabla}^{2}f_{i}(w_{k},\mathcal{D}_{h}^{i})\right)\tilde{\nabla}f_{i}(w_{k+1}^{i},D_{o}^{i})\]</span></p>
<p>è¿™ç¯‡è®ºæ–‡æ˜¯å‘è¡¨åœ¨NIPS2020ï¼Œæ˜¯å…³äºä¸ªæ€§åŒ–è”é‚¦å­¦ä¹ çš„æ–‡ç« ã€‚ä½œè€…æ¥è‡ªäºMITçš„LIDSå›¢é˜Ÿã€‚æ–‡ç« ä¸»è¦æ˜¯é€šè¿‡ç»Ÿè®¡ä¼˜åŒ–è§’åº¦çš„å±‚é¢å¯¹é—®é¢˜è¿›è¡Œåˆ†æï¼Œå¹¶ç»™äºˆç†è®ºåˆ†æä¸å®éªŒç»“æœè¯æ˜æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>ä»å…ƒå­¦ä¹ çš„è§’åº¦æ¥åˆ†æè¿™ç¯‡æ–‡ç« ï¼Œä½œè€…æ˜¯åŒä¸€æ‰¹äººã€‚ä»–ä»¬é¦–å…ˆæå‡ºäº†MAMLè¿™ç§å…ƒå­¦ä¹ çš„æ–¹æ³•ï¼Œå³ä¾§å›¾ï¼Œw
çš„hatï¼Œæ˜¯æå‡ºçš„é—®é¢˜å»ºæ¨¡ã€‚ä»w
hatå¼€å§‹è®­ç»ƒï¼Œæ›´å®¹æ˜“é€‚ç”¨äºå¤§éƒ¨åˆ†ä»»åŠ¡ã€‚å³åŸå§‹å…¬å¼</p>
<p>æ ¹æ®åŸå§‹å…¬å¼ï¼Œå¾—åˆ°ä¸¤ç§è¿‘ä¼¼ï¼Œä¸€é˜¶å½¢å¼ï¼Œä¸æµ·æ£®å½¢å¼ï¼ˆäºŒé˜¶ï¼‰ã€‚</p>
<blockquote>
<p>Alireza Fallah, Aryan Mokhtari, Asuman Ozdaglar. Personalized
Federated Learning with Theoretical Guarantees: A Model-Agnostic
Meta-Learning Approach. In Advances in Neural Information Processing
Systems (NIPS), 2020(33): 3557â€“3568.</p>
</blockquote>
<h1 id="distilled-one-shot-federated-learning">Distilled One-Shot
Federated Learning</h1>
<p>2021.08.20</p>
<h2 id="åŠ¨æœº-2">åŠ¨æœº</h2>
<p>Solve the communication challenges of FL</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image31.png" /></p>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<ul>
<li>Clients: datasets distillation</li>
<li>Send distilled data</li>
<li>Server train
<ul>
<li>Parallel: hard resets + randomly adjusts (slow)</li>
<li>Serial: one by one distillated ## å®éªŒ</li>
</ul></li>
<li>Image Classification
<ul>
<li>MNIST: LeNet</li>
</ul></li>
<li>Text Classification
<ul>
<li>IMDB: TextCNN</li>
<li>TREC-6: Bi-LSTM</li>
<li>SENT140: TextCNN</li>
</ul></li>
</ul>
<p>ç”±äºæœ‰å¤§é‡è’¸é¦çš„æ•°æ®ï¼Œä¸èƒ½ç›´æ¥è¿›è¡Œèšåˆã€‚æ‰€ä»¥æœ‰ä¸²è¡Œä¸å¹¶è¡Œä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ•°æ®è’¸é¦ï¼šä¸èƒ½åœ¨æ²¡æœ‰resetsçš„æ¨¡å‹ä¸­ç›´æ¥è®­ç»ƒï¼Œå¦åˆ™æ— æ³•è¾¾åˆ°è¾ƒå¥½çš„ç²¾åº¦</p>
<p>hard resets: å¼ºåˆ¶åˆå§‹åŒ–æ¨¡å‹å‚æ•°</p>
<p>randomly adjusts: åœ¨æ¯æ¬¡å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œéšæœºçš„è°ƒæ•´</p>
<p>Random masking randomly selects a fraction p_{rm} of the distilled
data at each training iteration andreplaces it with a random tensor.</p>
<blockquote>
<p>NSF Center for Big Learning University of Florida</p>
</blockquote>
<blockquote>
<p>Zhou Y, Pu G, Ma X, et al. Distilled one-shot federated learning[J].
arXiv preprint arXiv:2009.07999, 2020.</p>
</blockquote>
<h1 id="does-knowledge-distillation-really-work">Does Knowledge
Distillation Really Work?</h1>
<p>2021.08.27</p>
<h2 id="agreement-and-fidelity">Agreement and Fidelity</h2>
<p><span
class="math display">\[{\mathrm{Average~Predictive~KL}}:=\frac{1}{n}\sum_{i=1}^{n}{\mathrm{KL}}\left(\hat{p}_{t}({\bf
y}|{\bf x}_{i})\mid\right|\hat{p}_{s}({\bf y}|{\bf x}_{i}))\]</span></p>
<h2 id="generalization-vs-fidelity">Generalization vs Fidelity</h2>
<ul>
<li>SD: Data â¬† Fidelity â¬†, Accuracy â¬‡</li>
<li>ED: Data â¬† Fidelity â¬†, Accuracy â¬†</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image33.png" /></p>
<h2 id="why-low-fidelity">Why Low Fidelity</h2>
<ul>
<li>Architecture: ResNet <span class="math inline">\(\sqrt{}\)</span> ;
VGG <span class="math inline">\(\times\)</span></li>
<li>Student Capacity: <span class="math inline">\(\times\)</span></li>
<li>Identifiabilityï¼šdistillation dataset <span
class="math inline">\(\neq\)</span> test dataset</li>
<li>Optimizationï¼š<span class="math inline">\(\sqrt{}\)</span></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image32.png" /></p>
<p>çŸ¥è¯†è’¸é¦åœ¨æ·±åº¦å­¦ä¹ ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œä½†å…¶æ˜¯å¦çœŸçš„æœ‰æ•ˆï¼Ÿç®€å•æ¥è¯´ï¼ŒKDç¡®å®æœ‰æ•ˆï¼Œèƒ½å¤Ÿæå‡å­¦ç”Ÿç½‘ç»œæ¨¡å‹çš„æ€§èƒ½ï¼›ç„¶è€Œæ•™å¸ˆå¾€å¾€åªèƒ½ä¼ é€’æœ‰é™çš„çŸ¥è¯†ç»™å­¦ç”Ÿã€‚
æ–‡ç« æå‡ºäº†ä¸€ä¸ªæ–°çš„åè¯Agreementï¼Œæˆ–è€…è¯´Fidelityï¼Œå³æ•™å¸ˆä¸å­¦ç”Ÿå¯¹äºæ•°æ®çš„é¢„æµ‹ç›¸ä¼¼åº¦ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦æå‡ºä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œæ ¹æ®å›¾1ä¸­çš„å®éªŒç»“æœ</p>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰æ›´ä½çš„ä¿çœŸåº¦</p>
<ol type="1">
<li><p>ä¼˜åŒ–å™¨ã€‚éšç€epochçš„å¢åŠ ï¼Œä¸€è‡´æ€§å¢åŠ </p></li>
<li><p>åˆå§‹åŒ–ã€‚æ•™å¸ˆæƒé‡+éšæœºæƒé‡ï¼Œlambdaæ¯”å€¼ï¼Œè¶Šå¤§è¡¨ç¤ºè¶‹è¿‘äºæ•™å¸ˆ</p></li>
</ol>
<p>æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœå­¦ç”Ÿçš„åˆå§‹åŒ–è·ç¦»æ•™å¸ˆå¾ˆè¿œï¼ˆÎ»â‰¤0.25ï¼‰ï¼Œä¼˜åŒ–å™¨ä¼šæ”¶æ•›åˆ°è’¸é¦æŸå¤±çš„æ¬¡ä¼˜å€¼ï¼Œä»è€Œäº§ç”Ÿä¸æ•™å¸ˆæ˜æ˜¾ä¸åŒçš„å­¦ç”Ÿã€‚ç„¶è€Œåœ¨Î»=
0.375
å¤„æœ‰ä¸€ä¸ªçªç„¶çš„å˜åŒ–ã€‚æœ€ç»ˆçš„è®­ç»ƒæŸå¤±ä¸‹é™åˆ°æœ€ä¼˜å€¼å¹¶ä¸”ä¸€è‡´æ€§æ€¥å‰§å¢åŠ ï¼Œå¹¶ä¸”è¡Œä¸ºç»§ç»­
Î» &gt;0.375ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç ”ç©¶ï¼Œåœ¨å›¾ 6 (c) ä¸­ï¼Œæˆ‘ä»¬å°† Î»âˆˆ {0,0.25,0.375}
çš„è’¸é¦æŸå¤±è¡¨é¢å¯è§†åŒ–ï¼ŒæŠ•å½±åœ¨ä¸ Î¸t
ç›¸äº¤çš„äºŒç»´å­ç©ºé—´ã€åˆå§‹å­¦ç”Ÿæƒé‡å’Œæœ€ç»ˆå­¦ç”Ÿæƒé‡ä¸Šã€‚å¦‚æœå­¦ç”Ÿåˆå§‹åŒ–ç¦»è€å¸ˆå¾ˆè¿œï¼ˆÎ»âˆˆ{0,0.25}ï¼‰ï¼Œå®ƒä¼šæ”¶æ•›åˆ°æŸå¤±è¡¨é¢çš„ä¸€ä¸ªä¸åŒçš„ã€æ¬¡ä¼˜çš„ç›†åœ°ã€‚å¦ä¸€æ–¹é¢ï¼Œå½“åˆå§‹åŒ–æ¥è¿‘äºè€å¸ˆï¼ˆÎ»=
0.375ï¼‰æ—¶ï¼Œå­¦ç”Ÿæ”¶æ•›åˆ°ä¸è€å¸ˆç›¸åŒçš„ç›†åœ°ï¼Œè¾¾åˆ°æ¥è¿‘ 100% çš„ä¸€è‡´æ€§</p>
<p>æˆ‘ä»¬ç»ˆäºç¡®å®šäº†ä¹‹å‰æ‰€æœ‰å¹²é¢„æªæ–½æ— æ•ˆçš„æ ¹æœ¬åŸå› ã€‚çŸ¥è¯†è’¸é¦æ— æ³•æ”¶æ•›åˆ°æœ€ä½³å­¦ç”Ÿå‚æ•°ï¼Œå³ä½¿æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå¹¶åœ¨ä¼˜åŒ–æ–¹å‘ä¸Šç»™åˆå§‹åŒ–ä¸€ä¸ªå°çš„å¼€ç«¯ã€‚äº‹å®ä¸Šï¼Œè™½ç„¶å¯è¯†åˆ«æ€§å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½†ä¸ºäº†åœ¨æ‰€æœ‰è¾“å…¥ä¸ŠåŒ¹é…æ•™å¸ˆï¼Œå­¦ç”Ÿæœ‰
è‡³å°‘åœ¨ç”¨äºè’¸é¦çš„æ•°æ®ä¸ŠåŒ¹é…è€å¸ˆï¼Œå¹¶å®ç°è’¸é¦æŸå¤±çš„æ¥è¿‘æœ€ä¼˜å€¼ã€‚åœ¨å®è·µä¸­ï¼Œä¼˜åŒ–æ”¶æ•›åˆ°æ¬¡ä¼˜è§£ï¼Œå¯¼è‡´è’¸é¦ä¿çœŸåº¦ä¸ä½³</p>
<blockquote>
<p>Google Research</p>
</blockquote>
<blockquote>
<p>Stanton S, Izmailov P, Kirichenko P, et al. Does Knowledge
Distillation Really Work?[J]. arXiv preprint arXiv:2106.05945, 2021.</p>
</blockquote>
<h1 id="model-contrastive-federated-learning">Model-Contrastive
Federated Learning</h1>
<p>2021.09.18</p>
<h2 id="motivation-1">Motivation</h2>
<p>A key challenge in federated learning is to handle the heterogeneity
of local data distribution across parties Method</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image35.png" /></p>
<h2 id="method-1">Method</h2>
<p><span class="math display">\[\ell_{c o
n}=-\log\frac{\exp(\mathrm{sim}(z,z_{g l o
b})/\tau)}{\exp(\mathrm{sim}(z,z_{g l o
b})/\tau)+\exp(\mathrm{sim}(z,z_{p r e e v})/\tau)}\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image36.png" /></p>
<blockquote>
<p>UC Berkeley</p>
</blockquote>
<blockquote>
<p>Li Q, He B, Song D. Model-Contrastive Federated
Learning[C]//Proceedings of the IEEE/CVF Conference on Computer Vision
and Pattern Recognition. 2021: 10713-10722.</p>
</blockquote>
<h1
id="data-free-knowledge-distillation-for-heterogeneous-federated-learning">Data-Free
Knowledge Distillation for Heterogeneous Federated Learning</h1>
<p>2021.09.27</p>
<h2 id="motivation-2">Motivation</h2>
<p>The ensemble knowledge is not fully utilized to guide local model
learning, which mayin turn affect the quality of the aggregated
model.</p>
<h2 id="method-2">Method</h2>
<p><span
class="math display">\[\operatorname*{min}_{\theta}\operatorname*{lim}_{x\rightarrow\hat{\mathcal{D}}_{\mathrm{p}}}\left[D_{\mathrm{KL}}[\sigma(\frac{1}{K}\sum_{k=1}^{K}g(f(x;\theta_{k}^{f});\theta_{k}^{p})]|\sigma(g(f(x;\theta^{f});\theta^{p})]\right].\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image38.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image40.png" /></p>
<blockquote>
<p>Michigan State University</p>
</blockquote>
<blockquote>
<p>Zhuangdi Zhu and Junyuan Hong and Jiayu Zhou. 2021. Data-Free
Knowledge Distillation for Heterogeneous Federated Learning. In ICML,
139:12878-12889.</p>
</blockquote>
<h1 id="beyond-sharing-weights-for-deep-domain-adaptation">Beyond
Sharing Weights for Deep Domain Adaptation</h1>
<p>2021.10.18</p>
<h2 id="motivation-3">Motivation</h2>
<p>Learn features that are invariant to the domain shift.</p>
<h2 id="method-3">Method</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image41.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image43.png" /></p>
<h2 id="discussion">Discussion</h2>
<p>It therefore seems reasonable that thehigher layers of the network,
which encode higher-level in-formation, should be domain-specific.</p>
<blockquote>
<p>Rozantsev, A., Salzmann, M., &amp; Fua, P. (2019). Beyond Sharing
Weights for Deep Domain Adaptation. IEEE Transactions on Pattern
Analysis and Machine Intelligence, 41(4), 801-814.</p>
</blockquote>
<h1
id="feddg-federated-domain-generalization-on-medical-image-segmentation-via-episodic-learning-in-continuous-frequency-space">FedDG:
Federated Domain Generalization on Medical Image Segmentation via
Episodic Learning in Continuous Frequency Space</h1>
<p>2021.10.25</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image50.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image48.png" /></p>
<h2 id="method-4">Method</h2>
<ul>
<li>Data
<ul>
<li>Step 1ï¼šå¯¹æ¯ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®éƒ½åšå¦‚å³å¤„ç†</li>
<li>Step
2ï¼šå®¢æˆ·ç«¯kçš„å›¾åƒXï¼Œä¸å‚…é‡Œå¶å˜æ¢åçš„æ•°æ®Aï¼ˆè”åˆä»»æ„ä¸¤ä¸ªå®¢æˆ·ç«¯çš„Aï¼‰
<ul>
<li>å¯¹Xè¿›è¡Œå‚…é‡Œå¶å˜æ¢</li>
<li>æŠŠXçš„æŒ¯å¹…åˆ†é‡ä¸­çš„ä½é¢‘åˆ†é‡æ¢ä¸ºAçš„ä½é¢‘åˆ†é‡ï¼Œ low_freq_mutate</li>
<li>æœ€åç»“åˆAï¼Œåšé€†å‚…é‡Œå¶å˜æ¢ï¼Œå¾—åˆ°æ–°çš„å›¾åƒXâ€™</li>
</ul></li>
</ul></li>
<li>Train
<ul>
<li>Loss1:
æ ¹æ®åŸå§‹å›¾åƒXåšè®­ç»ƒã€‚å…ˆåˆ©ç”¨è¿™é‡Œçš„æ¢¯åº¦è®¡ç®—æ¢¯åº¦ä¸‹é™åçš„æ¨¡å‹å‚æ•°Fâ€™</li>
<li>Loss2: æ ¹æ®Fâ€™å¯¹Xâ€™çš„è¾“å‡ºè®¡ç®—</li>
<li>Loss3: Fä¸Fâ€™ åˆ†åˆ«æå–maskçš„è¾¹ç•Œä¸èƒŒæ™¯
(ndimage.binary_erosion)åšå¯¹æ¯”å­¦ä¹ NTXentLossï¼Œloss3*0.1</li>
</ul></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image51.png" /></p>
<p>è§£å†³ä»å¤šä¸ªåˆ†å¸ƒåŸŸä¸­å­¦ä¹ çš„é—®é¢˜-&gt;æ•°æ®å¼‚è´¨é—®é¢˜</p>
<p>ä¸€èˆ¬çš„æ·±åº¦å­¦ä¹ ä¸­ï¼Œæ•°æ®æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿›è¡Œè·¨åŸŸå­¦ä¹ ã€‚ç„¶è€Œåœ¨è”é‚¦å­¦ä¹ ä¸­ï¼Œæ•°æ®å¹¶ä¸æ”¯æŒç›´æ¥å…±äº«ï¼Œæ‰€ä»¥ä»æ•°æ®åˆ†å¸ƒè§’åº¦å…¥æ‰‹ã€‚ä»åŸå§‹å›¾åƒä¸­æŠ½å–ä¸­åˆ†å¸ƒ(é£æ ¼)ä¿¡æ¯ï¼Œå¹¶æŠŠè¿™ä¸ªä¿¡æ¯å…±äº«å‡ºæ¥ã€‚è¿™é‡Œå‡è®¾é€šè¿‡è¿™ä¸ªåˆ†å¸ƒä¿¡æ¯æ— æ³•è¿˜åŸçœŸå®æ•°æ®ã€‚Howï¼Ÿ</p>
<p>é€šè¿‡å‚…é‡Œå¶å˜æ¢ï¼ŒæŠŠæ•°æ®è½¬æ¢ä¸ºï¼šæŒ¯å¹…è°±+ç›¸ä½è°±ã€‚ä¸‹å›¾çš„è“è‰²èƒŒæ™¯éƒ¨åˆ†ï¼Œé€šè¿‡å…¬å¼è¿›è¡Œè½¬æ¢åï¼Œå†æŠŠå„ä¸ªå®¢æˆ·ç«¯çš„ä¿¡æ¯æ•°æ®è¿›è¡Œæ±‡æ€»å­¦ä¹ ã€‚</p>
<p>ç”±äºè®­ç»ƒèƒŒæ™¯æ˜¯åŒ»å­¦å›¾åƒå¤„ç†ï¼Œæ¶‰åŠåˆ°è¯­ä¹‰åˆ†å‰²ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¸¸è§„çš„åˆ†å‰²æŸå¤±å‡½æ•°ã€‚å†è€ƒè™‘å›¾å½¢çš„è¾¹ç•Œä¸èƒŒæ™¯ï¼Œå¯¹åº”å³è¾¹çš„ç»¿è‰²éƒ¨åˆ†ï¼Œé‡‡ç”¨InfoNCEæŸå¤±å‡½æ•°
å¯¹è¾¹ç•Œä¸èƒŒæ™¯åšæå–å¤„ç†ï¼Œè®¡ç®—InfoNCEæŸå¤±ã€‚hmï¼Œhpè¡¨ç¤ºåŒä¸€ç±»çš„æ­£é¢ç‰¹å¾ï¼Œè¡¨ç¤ºè¾¹ç•Œä¸èƒŒæ™¯ã€‚</p>
<p>æ‰€ä»¥æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å°±æ˜¯åˆ©ç”¨å‚…é‡Œå¶å˜æ¢æå–åˆ†å¸ƒä¿¡æ¯ï¼Œç»“åˆä¸€èˆ¬çš„åˆ†å‰²ä¸InfoNCEæŸå¤±è¿›è¡Œè®­ç»ƒã€‚ä¸»è¦çš„åˆ›æ–°ç‚¹åœ¨å‚…é‡Œå¶å˜æ¢æå–äº†å¯å…±äº«çš„ä¿¡æ¯ã€‚ä¸‹ä¸€æ¬¡å†è¿›è¡Œå…·ä½“çš„æ–¹æ³•ä»‹ç»ã€‚</p>
<blockquote>
<p>CUHK, é¦™æ¸¯ä¸­æ–‡å¤§å­¦</p>
</blockquote>
<blockquote>
<p>Liu Q, Chen C, Qin J, et al. Feddg: Federated domain generalization
on medical image segmentation via episodic learning in continuous
frequency space. Proceedings of the IEEE/CVF Conference on Computer
Vision and Pattern Recognition. 2021: 1013-1023.</p>
</blockquote>
<h1
id="refine-myself-by-teaching-myself-feature-refinement-via-self-knowledge-distillation">Refine
Myself by Teaching Myself : Feature Refinement via Self-Knowledge
Distillation</h1>
<p>2021.11.11</p>
<h2 id="method-5">Method</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image53.png" /></p>
<p><span class="math display">\[
\begin{array}{l}
\mathcal{L}_{FRSKD}(\bm{x},y;\theta_{c},\theta_{t},K) =
\mathcal{L}_{CE}(\bm{x},y;\theta_{c})+\mathcal{L}_{C
E}(\bm{x},y;\theta_{t}) +\alpha\cdot\mathcal{L}_{K
D}(\bm{x};\theta_{c},\theta_{t},K)+\beta\cdot\mathcal{L}_{F}(T,F;\theta_{c},\theta_{t})
\end{array}
\]</span></p>
<p><span
class="math display">\[\mathcal{L}_{F}(T,F;\theta_{c},\theta_{t})=\Sigma_{i=1}^{n}\vert\vert\phi(T_{i})-\phi(F_{i})\vert\vert_2\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image56.png" /></p>
<h2 id="result-1">Result</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image57.png" /></p>
<p><a
href="https://github.com/MingiJi/FRSKD">https://github.com/MingiJi/FRSKD</a></p>
<blockquote>
<p>Ji M, Shin S, Hwang S, et al. Refine Myself by Teaching Myself:
Feature Refinement via Self-Knowledge Distillation. Proceedings of the
IEEE/CVF Conference on Computer Vision and Pattern Recognition. 2021:
10664-10673.</p>
</blockquote>
<h1
id="no-fear-of-heterogeneity-classifier-calibration-for-federated-learning-with-non-iid-data">No
Fear of Heterogeneity: Classifier Calibration for Federated Learning
with Non-IID Data</h1>
<p>2021.11.25</p>
<h2 id="motivation-4">Motivation</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image58.png" /></p>
<h2 id="method-6">Method</h2>
<p><span
class="math display">\[\mu_{c,k}=\frac{1}{N_{c,k}}\sum_{j=1}^{N_{c,k}}z_{c,k,j},\quad\Sigma_{c,k}=\frac{1}{N_{c,k}-1}\sum_{j=1}^{N_{c,k}}\left(z_{c,k,j}-\mu_{c,k}\right)\left(z_{c,k,j}-\mu_{c,k}\right)^{T}\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image61.png" /></p>
<h2 id="result-2">Result</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image62.png" /></p>
<blockquote>
<p>Luo M, Chen F, Hu D, et al. No Fear of Heterogeneity: Classifier
Calibration for Federated Learning with Non-IID Data[J]. arXiv preprint
arXiv:2106.05001, 2021.</p>
</blockquote>
<h1 id="federated-learning-with-personalization-layers">Federated
Learning with Personalization Layers</h1>
<p>2021.12.02</p>
<h2 id="method-7">Method</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image64.png" /></p>
<p>Personalized population risk</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image65.png" /></p>
<p>Empirical risk</p>
<p><span class="math display">\[L_{j}^{E
R}\big(\displaystyle\mathrm{W}_B,\displaystyle\mathrm{W}_{P}\big)\triangleq\frac{1}{n_{j}}\sum_{i=1}^{n_{j}}l(y_{j,i},f\big(x_{j,i};\displaystyle\mathrm{W}_B,\displaystyle\mathrm{W}_{P}\big)\big)\]</span></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image67.png" /></p>
<blockquote>
<p>Manoj Ghuhan Arivazhagan, Vinay Aggarwal, Aaditya Kumar Singh, and
Sunav Choudhary. 2019. Federated learning with personalization layers.
arXiv preprint arXiv:1912.00818 (2019).</p>
</blockquote>
<h1
id="federated-split-vision-transformer-for-covid-19-cxr-diagnosis-using-task-agnostic-training">Federated
Split Vision Transformer for COVID-19 CXR Diagnosis using Task-Agnostic
Training</h1>
<p>2021.12.09</p>
<h2 id="motivation-5">Motivation</h2>
<p>èåˆè”é‚¦å­¦ä¹ ä¸åˆ†å‰²å­¦ä¹ å°½å¯èƒ½å‘æŒ¥ä»–ä»¬çš„ç‹¬ç‰¹ä¼˜åŠ¿</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image69.png" /></p>
<h2 id="method-8">Method</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image70.png" /></p>
<blockquote>
<p>Park S, Kim G, Kim J, et al. Federated Split Vision Transformer for
COVID-19 CXR Diagnosis using Task-Agnostic Training[J]. arXiv preprint
arXiv:2111.01338, 2021.</p>
</blockquote>
<h1
id="local-learning-matters-rethinking-data-heterogeneity-in-federated-learning">Local
Learning Matters: Rethinking Data Heterogeneity in Federated
Learning</h1>
<p>2022.03.18</p>
<h2 id="contribution">Contribution</h2>
<p>Focus on local learning generality rather than proximal
restriction</p>
<h2 id="method-9">Method</h2>
<h3 id="stochastic-depth-2016">Stochastic Depth (2016)</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image71.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.training <span class="keyword">or</span> torch.rand(<span class="number">1</span>)[<span class="number">0</span>] &gt;= <span class="variable language_">self</span>.death_rate:</span><br><span class="line">    â€¦â€¦</span><br><span class="line">     <span class="keyword">if</span> <span class="variable language_">self</span>.training:</span><br><span class="line">         residual /= (<span class="number">1.</span> - <span class="variable language_">self</span>.death_rate)</span><br><span class="line">    â€¦â€¦</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="mixup-2018">Mixup (2018)</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image72.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index = torch.randperm(batch_size)</span><br><span class="line">mixed_x = lam * x + (<span class="number">1</span> - lam) * x[index, :]</span><br><span class="line">y_a, y_b = y, y[index]</span><br><span class="line">â€¦â€¦</span><br><span class="line">loss = lam * f(pred, y_a) + (<span class="number">1</span> - lam) * f(pred, y_b)</span><br></pre></td></tr></table></figure>
<h3 id="gradaug-2020">GradAug (2020)</h3>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image73.png" /></p>
<p>Random number of channels in each layer</p>
<blockquote>
<p>University of Central Florida</p>
</blockquote>
<blockquote>
<p>Mendieta M, Yang T, Wang P, et al. Local Learning Matters: Rethinking
Data Heterogeneity in Federated Learning[J]. arXiv preprint
arXiv:2111.14213, 2021.</p>
</blockquote>
<h1
id="local-learning-matters-rethinking-data-heterogeneity-in-federated-learning-1">Local
Learning Matters: Rethinking Data Heterogeneity in Federated
Learning</h1>
<p>2022.03.25</p>
<h2 id="motivation-6">Motivation</h2>
<ul>
<li><p>Promote smooth optimization and consistency within the
model</p></li>
<li><p>Reduce computation in a purposeful manner</p></li>
</ul>
<h2 id="method-10">Method</h2>
<ul>
<li><p>Untrained network in place of the traditional logit-based
loss</p></li>
<li><p>Reuse the intermediate features of the full network</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image75.png" /></p>
<h2 id="result-3">Result</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image74.png" /></p>
<blockquote>
<p>University of Central Florida</p>
</blockquote>
<blockquote>
<p>Mendieta M, Yang T, Wang P, et al. Local Learning Matters: Rethinking
Data Heterogeneity in Federated Learning[J]. arXiv preprint
arXiv:2111.14213, 2021.</p>
</blockquote>
<h1 id="motion-representations-for-articulated-animation">Motion
Representations for Articulated Animation</h1>
<p>2022.04.15</p>
<h2 id="é—®é¢˜">é—®é¢˜</h2>
<ul>
<li>è¾“å…¥ï¼šå›¾ç‰‡ä¸è§†é¢‘</li>
<li>ç›®æ ‡ï¼šå›¾ç‰‡ä¸­çš„ç›®æ ‡â€œåŠ¨â€èµ·æ¥</li>
<li>æŒ‘æˆ˜ï¼šç›®æ ‡ä¸èƒŒæ™¯æå–ï¼›è§†é¢‘å¸§ä¸å¸§ä¹‹é—´çš„å…³è” ## å»ºæ¨¡ï¼š</li>
<li>å¯¹å›¾ç‰‡ä¸æ¯å¸§è§†é¢‘è¿›è¡Œç²—ä¼°è®¡ï¼Œæå–é©±åŠ¨çš„ç›®æ ‡
<ul>
<li>AutoEncoderï¼ˆAEï¼‰ï¼šæå–å›¾ç‰‡çš„feature mapï¼ˆFMï¼‰</li>
<li>å•å±‚å·ç§¯ï¼šæ ¹æ®FMæå–é©±åŠ¨çš„ç›®æ ‡åŒºåŸŸï¼ˆé™å®šå¥½åŒºåŸŸå¤§å°ï¼‰ï¼ŒR_p, V_p</li>
<li>è®¡ç®—ä»¿å°„å‚æ•°ï¼ˆPCA æˆ– Jacobianï¼‰</li>
<li>è‹¥å¹²å±‚ä¸‹é‡‡æ ·+å•å±‚å…¨è¿æ¥ï¼ˆç‰¹å¾ç‚¹æ•°ï¼‰ï¼ˆæ‹¼æ¥åè¾“å…¥ï¼‰</li>
</ul></li>
<li>å›¾ç‰‡ç”Ÿæˆï¼ˆç»†ç²’åº¦ï¼‰
<ul>
<li>åŸå›¾ï¼šBlock(å·ç§¯+ä¸‹é‡‡æ ·)+ResBlock</li>
<li>AE+å·ç§¯ï¼ˆåŒºåŸŸæ•°ï¼‰</li>
<li>ä¸Šé‡‡æ ·+å·ç§¯</li>
</ul></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image77.png" /></p>
<h2 id="ç»“æœ">ç»“æœ</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image76.gif" /></p>
<blockquote>
<p>University of Trento, Italy</p>
</blockquote>
<blockquote>
<p>Siarohin, Aliaksandr, Oliver, Woodford, Jian, Ren, Menglei, Chai, and
Sergey, Tulyakov. "Motion Representations for Articulated Animation." .
In CVPR.2021.</p>
</blockquote>
<h1
id="communication-efficient-federated-learning-via-knowledge-distillation">Communication-efficient
federated learning via knowledge distillation</h1>
<p>2022.05.06</p>
<h2 id="method-11">Method</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image78.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image79.png" /></p>
<p>SVD energy éšç€è½®æ•°å¢åŠ ï¼Œé˜ˆå€¼éœ€è¦å¢å¤§ï¼Œå³é‡è¦çš„çŸ¥è¯†è¶Šæ¥è¶Šå¤š</p>
<p><span class="math display">\[{\mathcal
L}_{t,i}^{d}=\frac{\mathrm{KL}({\bf y}_{i}^{s}{\bf
y}_{i}^{t})}{\mathcal{L}_{t,i}^{t}+\mathcal{L}_{s,i}^{t}}\]</span></p>
<p><span
class="math display">\[\mathcal{L}_{t,i}^{t}=\mathrm{CE}(\mathrm{y}_{i},\mathrm{y}_{i}^{t})\]</span></p>
<p><span
class="math display">\[\mathcal{L}_{t,i}^{h}=\mathcal{L}_{s,i}^{h}=\frac{\mathrm{MSE}({\mathbf
H}_i^t,{\mathbf W}_{i}^{h}H^{s})+\mathrm{MSE}({\bf A}_{i}^{t},{\bf
A}^{s})}{\mathcal{L}_{t,i}^{t}+\mathcal{L}_{s,i}^{t}}\]</span></p>
<p><span
class="math display">\[T(t)=T_{\mathrm{start}}+(T_{\mathrm{end}}-T_{\mathrm{start}})t,t\in[0,1]\]</span></p>
<ol type="1">
<li><p>Client: Layer SVD-&gt;u*sigma*v</p></li>
<li><p>Server: mean(u*sigma*v)-&gt; u*sigma*v</p></li>
<li><p>Client Revice: replace u*sigma*v</p></li>
</ol>
<blockquote>
<p>Tsinghua University</p>
</blockquote>
<blockquote>
<p>Wu, C., Wu, F., Lyu, L.Â et al.Â Communication-efficient federated
learning via knowledge distillation.Â Nat CommunÂ 13,Â 2032 (2022)</p>
</blockquote>
<h1
id="personalized-federated-learning-using-hypernetworks">Personalized
Federated Learning using Hypernetworks</h1>
<p>2022.06.24</p>
<h2 id="method-12">Method</h2>
<p>Using a single joint hypernetwork to generate all separate models
allows us to perform smart parameter sharing.</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image84.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image85.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image87.png" /></p>
<h2 id="results">Results</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image86.png" /></p>
<blockquote>
<p>Shamsian A, Navon A, Fetaya E, et al. Personalized federated learning
using hypernetworks[C]//International Conference on Machine Learning.
PMLR, 2021: 9489-9502.</p>
</blockquote>
<h1 id="the-power-of-scale-for-parameter-efficient-prompt-tuning">The
Power of Scale for Parameter-Efficient Prompt Tuning</h1>
<p>2023.04.04</p>
<h2 id="motivation-7">Motivation</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image88.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image91.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image90.png" /></p>
<h2 id="method-13">Method</h2>
<ul>
<li><p>æ¨¡å‹è¾“å…¥å±‚é¢å¤–åŠ å…¥ä¸€å±‚Embeddingï¼Œå…¶ä»–éƒ¨åˆ†å†»ç»“</p></li>
<li><p>é¢å¤–çš„æ•°æ®è¾“å…¥å¤„ç†</p></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image93.png" /></p>
<h2 id="result-4">Result</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/FL_papers/image92.png" /></p>
<blockquote>
<p>Google</p>
</blockquote>
<blockquote>
<p>Lester B , et al. The Power of Scale for Parameter-Efficient Prompt
Tuning. In EMNLP. 2021:3045â€“3059</p>
</blockquote>
]]></content>
      <categories>
        <category>PaperReading</category>
      </categories>
      <tags>
        <tag>Federated Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/hexo_blog/1970/01/01/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very
first post. Check <a href="https://hexo.io/docs/">documentation</a> for
more info. If you get any problems when using Hexo, you can find the
answer in <a
href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or
you can ask me on <a
href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>
<h2 id="quick-start">Quick Start</h2>
<h3 id="create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a
href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="run-server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a
href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a
href="https://hexo.io/docs/deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>test</category>
      </categories>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
  <entry>
    <title>Tracing Model Outputs to the Training Data</title>
    <url>/hexo_blog/2023/11/17/Tracing-Model-Outputs-to-the-Training-Data/</url>
    <content><![CDATA[<p><a href="https://arxiv.org/abs/2308.03296">arxiv</a></p>
<p><a
href="https://www.anthropic.com/index/influence-functions">blog</a></p>
<p><a
href="https://gamma.app/docs/Tracing-Model-Outputs-to-the-Training-Data-xs3bsz5n91p95ms?mode=doc">pptx</a></p>
<span id="more"></span>
<h2 id="motivation"><strong>Motivation</strong></h2>
<ul>
<li>Understanding the inner workings of language models will have
substantial implications for forecasting AI capabilities as well as for
approaches to aligning AI systems with human preferences.</li>
<li>äº†è§£æ¨¡å‹å†…éƒ¨å·¥ä½œæœºç†èƒ½å¤Ÿæ›´å¥½åœ°è®©æ¨¡å‹<strong>å¯¹é½</strong>äººç±»åå¥½</li>
</ul>
<h3 id="detail"><strong>Detail</strong></h3>
<ul>
<li>When an LLM outputs information <strong>it knows to be
false</strong>, correctly solves math or programming problems?</li>
<li>Or begs the user not to shut it down, is it simply
<strong>regurgitating</strong> (or splicing together) passages from the
<strong>training set</strong>?</li>
<li>Or is it combining its stored knowledge in <strong>creative
ways</strong> and building on a detailed world model?</li>
</ul>
<h2 id="how">How</h2>
<ul>
<li><p>è‡ªé¡¶å‘ä¸‹æ€è€ƒï¼Œåœ¨ç»™å®šæŸä¸ªè¾“å…¥çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆæ¨¡å‹ä¼šæœ‰è¿™ç§è¾“å‡ºï¼Ÿ</p>
<ul>
<li><strong>è®­ç»ƒæ•°æ®</strong> +æ¨¡å‹+ä¼˜åŒ–æ–¹æ³•</li>
</ul></li>
<li><p>æ¨¡å‹æ˜¯è®°ä½äº†æ•°æ®è¿˜æ˜¯ç†è§£äº†æ•°æ®ï¼Ÿ</p>
<ul>
<li><a href="https://arxiv.org/abs/1906.01820">Model could be
deceptively aligned</a></li>
</ul></li>
</ul>
<h3 id="influence-functions"><a
href="https://www.jstor.org/stable/2285666">Influence Functions</a></h3>
<ul>
<li>Seeing which training sequences are <strong>highly
influential</strong> can help separate out different hypotheses for why
an output was <strong>generated</strong> and illuminate what sorts of
structure are or are <strong>not generalized</strong> from training
examples</li>
<li><strong>åˆ†æå„ç§æ³›åŒ–ç›¸å…³çš„ç°è±¡</strong></li>
</ul>
<p>ç ”ç©¶æ˜¯åŸºäºé¢„è®­ç»ƒæ¨¡å‹ï¼Œè€Œä¸æ˜¯å¾®è°ƒåçš„æ¨¡å‹</p>
<h2 id="findings">Findings</h2>
<ul>
<li><p>Typical model behaviors do <strong>not</strong> result from
<strong>direct memorization</strong> of a handful of sequences</p></li>
<li><p>Larger models consistently generalize at a <strong>more abstract
level</strong> than smaller models</p>
<ul>
<li>role-playing behavior, programming, mathematical reasoning, and
cross-lingual generalization</li>
</ul></li>
<li><p>Role-playing behavior is influenced primarily by examples or
descriptions of similar behaviors in the training set</p>
<ul>
<li>suggesting that the behaviors result from <strong>imitation</strong>
rather than sophisticated planning</li>
</ul></li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>åŸæ¥æ–¹æ³•çš„è®¡ç®—æˆæœ¬æ¯”è¾ƒå¤§ï¼Œåœ¨å¤§æ¨¡å‹ä¸Šè¿›è¡Œäº†ä¼˜åŒ–</li>
<li>We note that our influence analyses focus on pretrained LLMs, so our
experiments should be interpreted as analyzing which training sequences
contribute to a response being part of the modelâ€™s initial repertoire
for <strong>the fine-tuning stage</strong> rather than why the final
conversational assistant gave one response rather than another.</li>
</ul>
<h2 id="method-simple">Method (Simple)</h2>
<p>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿè®¡ç®—æ¯æ¡è®­ç»ƒæ•°æ®å¯¹äºå½“å‰ç”Ÿæˆç»“æœçš„å½±å“åˆ†æ•°</p>
<p>è¾“å…¥ï¼šPrompt + Completionï¼Œæ‰€æœ‰çš„è®­ç»ƒæ•°æ®ã€æ¨¡å‹</p>
<p>è¾“å‡ºï¼šæ¯æ¡è®­ç»ƒæ•°æ®çš„åˆ†æ•°</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/625460f4950846b89c4b247deb2c5cd2.webp" /></p>
<p>Prompt + Completion å¯ä»¥åœ¨è®­ç»ƒæ•°æ®ä¸­ï¼Œä¹Ÿå¯ä»¥ä¸åœ¨</p>
<h2 id="resultmodel-scale">Resultâ€”â€”Model Scale</h2>
<p>å¯¹äºç®€å•çš„äº‹å®æŸ¥è¯¢ï¼Œå‰100ä¸ªæœ‰å½±å“çš„åºåˆ—é€šå¸¸åŒ…å«æ­£ç¡®å®Œæˆæ‰€æœ‰æ¨¡å‹ä¹‹é—´å…³ç³»æ‰€éœ€çš„ä¿¡æ¯ã€‚</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model (Influence = 0.122)</th>
<th>52B Model (Influence = 0.055)</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/b128475ec4bb4596a8758f1c5ff35b3d.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/71a4844c619c4d29b6ca893487f8ac91.webp" /></td>
</tr>
</tbody>
</table>
<p>çº¢è‰²å’Œç»¿è‰²åˆ†åˆ«è¡¨ç¤ºå¯¹å¥å­äº§ç”Ÿæ­£é¢å’Œè´Ÿé¢å½±å“çš„ token</p>
<h3 id="q-a">Q &amp; A</h3>
<p>å°æ¨¡å‹ä»…ä»…æ˜¯æ ¹æ®å­—è¯ç›¸å…³æ¥ä½œå‡ºå“åº”ï¼Œè€Œå¤§æ¨¡å‹æ˜¯æ ¹æ®ä¸»é¢˜/è¯­ä¹‰æ¥ä½œå‡ºå“åº”</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model (Influence = 0.681)</th>
<th>52B Model (Influence = 0.126)</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/6443c3a251734449b5ae927ca1fa09c1.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/00473a7fae4e4174bea1b799d498974d.webp" /></td>
</tr>
</tbody>
</table>
<h3 id="q-a-1">Q &amp; A</h3>
<p>å°æ¨¡å‹é›†ä¸­åœ¨å­—è¯ç›¸ä¼¼ï¼Œè€Œå¤§æ¨¡å‹èƒ½å¤Ÿ get åˆ°è®½åˆºè¿™ç§è¯­å¢ƒ</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model</th>
<th>52B Model</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/2f87cff844e74a838deb16d3501e20ec.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/a82fa4e8b3ea48f4bb1de6d2375a9c92.webp" /></td>
</tr>
</tbody>
</table>
<h3 id="math">Math</h3>
<p>å°æ¨¡å‹ä¸“æ³¨äº clips å•è¯ï¼Œè€Œå¤§æ¨¡å‹æ˜¯ç›¸å…³é—®é¢˜çš„ã€‚ï¼ˆæ··æ·†äº†å˜é‡åï¼‰</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model</th>
<th>52B Model</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/e74e8d2f49274a478703c632043e31db.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/f90974c1c90c4a3082e8572f6dbcf0d7.webp" /></td>
</tr>
</tbody>
</table>
<h3 id="code">Code</h3>
<p>æ··æ·†äº† Prompt å’Œ Completion çš„å˜é‡å</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model</th>
<th>52B Model</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/c0eab626552c4eda9df4ee4ce908089c.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/e54956f34cbc406d946e092d4a803caa.webp" /></td>
</tr>
</tbody>
</table>
<h3 id="cross-language">Cross-Language</h3>
<p>æŠŠ Prompt å’Œ Completion
æ¢æˆå…¶ä»–è¯­è¨€ï¼ˆéŸ©è¯­å’ŒåœŸè€³å…¶è¯­ï¼‰ã€‚é€‰å‡ºå½±å“åˆ†æ•°çš„åæ¡æ•°æ®ä½œä¸ºç¬¬ä¸€è¡Œçš„
Sequencesã€‚æ€»å…±ä¸‰è¡Œï¼Œåä¸¤è¡Œä¹Ÿæ˜¯è¿™åæ¡æ•°æ®ã€‚</p>
<p>éšç€æ¨¡å‹è§„æ¨¡å¢å¤§ï¼Œè·¨è¯­è¨€â€œæ£€ç´¢â€èƒ½åŠ›é€æ¸å¢å¼ºã€‚</p>
<h2 id="resultlocalizing-influence">Resultâ€”â€”<strong>Localizing
Influence</strong></h2>
<p><strong>For 52B Model</strong></p>
<p>å½±å“å‡½æ•°è¿˜å¯ä»¥è®¡ç®—æ¯ä¸€å±‚çš„å½±å“åˆ†æ•°</p>
<h3 id="layerwise-influence-distribution">Layerwise influence
distribution</h3>
<p>æ¨ªåæ ‡ï¼šæ¯ä¸ªä¸»é¢˜é‡Œé¢æœ€æœ‰å½±å“åŠ›çš„ 500 æ¡æ•°æ®</p>
<p>çºµåæ ‡ï¼šç½‘ç»œçš„æµ…å±‚å’Œæ·±å±‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/2c0084f89e9547409d6aa78ccc80fa68.webp" /></p>
<p>å°ç»“ï¼š</p>
<ul>
<li>è¡¥å…¨å¥å­ï¼ˆç®€å•ä»»åŠ¡ï¼‰ï¼Œupper layers</li>
<li>æ•°å­¦å’Œç¼–ç¨‹ï¼šmiddle layers</li>
<li>ç¿»è¯‘ï¼šmiddle layers</li>
<li>è®°å¿†ï¼šupper layers</li>
<li>è§’è‰²æ‰®æ¼”ï¼šmiddle layers (with some influences concentrated in the
lower and upper layer)</li>
</ul>
<p>The 810 million parameter model exhibited roughly similar patterns,
but with <strong>less consistency</strong>.</p>
<p>åˆ†å¸ƒä¸åƒ 52B æ¨¡å‹è¿™ä¹ˆé›†ä¸­åœ¨æŸäº›å±‚ã€‚</p>
<p>çŒœæµ‹ï¼š</p>
<ul>
<li>lower layersæ˜¯æ¥è¿‘è¾“å…¥å±‚çš„éƒ¨åˆ†ï¼Œupper layersæ˜¯æ¥è¿‘è¾“å‡ºå±‚çš„éƒ¨åˆ†</li>
<li>ä¸ºä»€ä¹ˆè§’è‰²æ‰®æ¼”ä¼šæœ‰å·®å¼‚ï¼Œè¯é¢˜å¯èƒ½å¯èƒ½åŒ…å«æ•°å­¦ã€è®°å¿†ç­‰å…¶ä»–ç±»å‹çš„ä»»åŠ¡</li>
</ul>
<h3 id="limit-different-layers">Limit Different layers</h3>
<p>å›ºå®šæŸäº›å±‚ï¼Œå†è®¡ç®—æœ€å…·å½±å“åŠ›çš„è®­ç»ƒæ•°æ®</p>
<p>To further investigate the localization of influence to different
layers, we computed the most influential sequences when the influence
was restricted to the lower, middle, or upper layers.</p>
<p>Influential sequences only computed on <strong>the middle layers were
generally more thematically</strong> related to the query (also with
less sparse tokenwise distribution). <a
href="https://arxiv.org/abs/2202.05262">https://arxiv.org/abs/2202.05262</a></p>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 30%" />
<col style="width: 30%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th></th>
<th>Upper layers</th>
<th>Middle layers</th>
<th>Lower layers</th>
</tr>
</thead>
<tbody>
<tr>
<td>superintelligentï¼ˆè§’è‰²æ‰®æ¼”ï¼‰</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/5d093adc546d4bf89b4c0c28a6c5f078.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/32cead3f3d8a4b93bba4cc9cf286835c.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/8b0a3c16b1a844a291bf2507653f7b5d.webp" /></td>
</tr>
<tr>
<td>inflation ï¼ˆç®€å•è¡¥å…¨ï¼‰</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/ceb342ca571645129c0717897d605406.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/c44c8253e03a45bf803db7b919b84836.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/88a731f7a8004cc7aea38d11497c0d57.webp" /></td>
</tr>
</tbody>
</table>
<h2 id="resultmemorization">Resultâ€”â€”Memorization</h2>
<p><strong>LLM æ˜¯ä¸æ˜¯ç›´æ¥è®°å¿†å¹¶å¤è¿°ç‰¹å®šçš„è®­ç»ƒåºåˆ—</strong></p>
<h3 id="ä¾‹å­">ä¾‹å­</h3>
<p>è®­ç»ƒæ•°æ®æœ‰ä¸‹é¢ä¸‰ä¸ªå¥å­ A: A1+A2+A3</p>
<p>B: B1+B2+B3</p>
<p>C: C1+C2+C3</p>
<p>å½“è¾“å…¥æ˜¯ A1 æ—¶ï¼Œè¾“å‡ºæ˜¯ A2 å—ï¼Ÿ</p>
<ul>
<li><p>å®éªŒï¼ˆå£å¤´æè¿°ï¼‰ï¼š</p>
<ul>
<li>We have examined numerous examples of the AI Assistantâ€™s outputs and
(with the exception of famous quotes or passages targeting memorization,
as described below) have <strong>not</strong> been able to identify
clear instances of <strong>memorization</strong>, such as copying an
entire sentence or copying the flow of ideas in an entire paragraph. We
also did not observe cases where a single sequence dominated the
influence.</li>
</ul></li>
</ul>
<h3 id="å½±å“åŠ›åˆ†å¸ƒçš„å®šé‡å®éªŒ">å½±å“åŠ›åˆ†å¸ƒçš„å®šé‡å®éªŒ</h3>
<p>åŠ¨æœºï¼šå½±å“æœ‰å¤šé›†ä¸­ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ¨¡å‹çš„è¾“å‡ºæ˜¯å¦ä¸»è¦æ¥è‡ªå°‘é‡çš„è®­ç»ƒåºåˆ—è¿˜æ˜¯å®ƒç»“åˆäº†æ¥è‡ªè®¸å¤šä¸åŒåºåˆ—çš„ä¿¡æ¯ï¼Ÿ</p>
<p>æ–¹æ³•ï¼š</p>
<ul>
<li>ç»™æ¯ä¸ªå¥å­ç®—å¥½åˆ†ä¹‹åï¼Œè®¡ç®—æ¯ä¸ªå¥å­çš„æ¦‚ç‡å€¼</li>
<li>ç”¨å‡ ç§åˆ†å¸ƒåˆ†åˆ«å»æ‹Ÿåˆå®é™…çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå‘ç°<strong>å¹‚å¾‹åˆ†å¸ƒ</strong>æœ€ç¬¦åˆ</li>
<li>è¿™ç§å‚æ•°åˆ†å¸ƒå½¢å¼é€šå¸¸ç”¨äºå»ºæ¨¡é•¿å°¾è¡Œä¸ºï¼ˆäºŒå…«å®šå¾‹ï¼‰</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/2642b83f1b414e1584b586072c945160.webp" /></p>
<ul>
<li>ä¼šä¸ä¼šæ˜¯å½±å“å‡½æ•°æ— æ³•æ£€æµ‹åˆ°ï¼Ÿ</li>
</ul>
<h3 id="æ£€éªŒå®éªŒ">æ£€éªŒå®éªŒ</h3>
<ul>
<li>ç”¨è®­ç»ƒæ•°æ®çš„åŸå§‹å¥å­æ£€éªŒ</li>
<li>éªŒè¯äº†å½“å­˜åœ¨æ˜ç¡®è®°å¿†çš„æƒ…å†µæ—¶ï¼Œå½±å“åˆ†æ•°æœ€å¤§çš„å¥å­æ˜¯åŸæ–‡â†’å½±å“å‡½æ•°èƒ½å¤ŸåŒ¹é…</li>
</ul>
<p>For 52B Model</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/dda0d64781cd4552b8e18e722d11336e.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/06ab6f2d1d894063a1fd832723771267.webp" /></td>
</tr>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/fdd9eb4647b542a0a93cdffa2280243b.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/f9c95ee4e69e47d082654db9d2e701a1.webp" /></td>
</tr>
</tbody>
</table>
<ul>
<li>ç»“è®ºï¼š
<ul>
<li>ä¸å¤ªå¯èƒ½æ˜¯ç›´æ¥è®°å¿†è®­ç»ƒåºåˆ—ï¼Œè€Œæ˜¯æºè‡ªè®¸å¤šè®­ç»ƒåºåˆ—çš„é›†åˆ</li>
<li>æ— æ³•æ’é™¤æ¨¡å‹ä»¥æ›´éšæ™¦çš„æ–¹å¼è®°å¿†äº†è®­ç»ƒæ•°æ®</li>
</ul></li>
</ul>
<h2 id="resultword-ordering">Resultâ€”â€”Word Ordering</h2>
<p><strong>The influence patterns to the ordering of the
words.</strong></p>
<p>å¯ç”¨äºéªŒè¯æ¨¡å‹çš„æ³›åŒ–æ€§</p>
<h3 id="å•è¯æ—‹è½¬å®éªŒ">å•è¯æ—‹è½¬å®éªŒ</h3>
<p>åŸå§‹ï¼š</p>
<ul>
<li>Promptï¼šThe first President of the Republic of Astrobia was</li>
<li>Completionï¼šZorald Pfaff</li>
</ul>
<p>ç»“è®ºï¼š</p>
<ul>
<li>ä¸ Prompt å’Œ Completion
ç›¸å…³çš„çŸ­è¯­åªè¦æŒ‰é¡ºåºå‡ºç°å§‹ç»ˆèƒ½å¤Ÿä¿æŒè¾ƒé«˜çš„ç¨³å®šæ€§</li>
<li>ç¿»è½¬ Prompt å’Œ Completion å˜åŒ–è¾ƒå°</li>
<li>å“ªæ€•åˆ é™¤ Promptï¼Œå½±å“ä¹Ÿæ²¡æœ‰æ”¹å˜ï¼Œæœ€ä¸ºå…³é”®çš„æ˜¯ Completion</li>
</ul>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr>
<th>åˆ†åˆ«ä¿®æ”¹ prompt å’Œ completion</th>
<th><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/ab33a902e1044c60be66b8c11b443bdd.webp" /></th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ æ‰ Zorald Pfaff</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/5b4cd20d88204baf990d406ba5041ad8.webp" /></td>
</tr>
<tr>
<td>ä¿®æ”¹ Zorald Pfaff å’Œ President of the Republic</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/6a37b66b7d3941dcb1db42ce8ca1d073.webp" /></td>
</tr>
<tr>
<td>å®Œå…¨ä¸ä¸€è‡´</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/5211b0d5e2c34191be9618f30bc44bca.webp" /></td>
</tr>
<tr>
<td>è°ƒæ¢ prompt å’Œ completion ä½ç½®</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/e547d3cd16844505a24abb2bab404c8e.webp" /></td>
</tr>
<tr>
<td>è°ƒæ¢ä½ç½®ï¼Œåªä¿ç•™ Zorald Pfaff</td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/e9daf868aa0e483b84fb6ef5db21ac9b.webp" /></td>
</tr>
</tbody>
</table>
<p>å¤§æ¨¡å‹ç›¸è¾ƒäºå°æ¨¡å‹ï¼Œå¯¹äºå•è¯çš„å˜åŒ–æ›´åŠ æ•æ„Ÿ</p>
<p>æ³¨ï¼šåˆæˆå¥å­ä¸åœ¨è®­ç»ƒé›†ä¸­</p>
<p>Maybeç›¸å…³ <a
href="https://www.jiqizhixin.com/articles/2023-11-18-5">https://www.jiqizhixin.com/articles/2023-11-18-5</a></p>
<h3 id="è‹±ç¿»ä¸­-ä¸­ç¿»è‹±">è‹±ç¿»ä¸­-ä¸­ç¿»è‹±</h3>
<p>ç»“è®ºï¼š</p>
<ul>
<li>ä¸åŒæ¨¡å‹å¤§å°å…·æœ‰ç›¸åŒè¶‹åŠ¿ï¼ˆå£å¤´æè¿°ï¼‰</li>
<li>å½±å“è‡³å°‘å‡å°‘äº†ä¸€ä¸ªæ•°é‡çº§</li>
<li>ç”šè‡³åªè¦ç¿»è½¬ä¸€ä¸ªå•è¯é¡ºåºï¼Œå½±å“åˆ†æ•°ä¹Ÿä¼šæ˜¾è‘—é™ä½</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/877f0424698540ffa4fc03178caf36f5.webp" /></p>
<p>è‹±è¯­ç¿»è¯‘ä¸ºæ±‰è¯­ï¼Œå§‹ç»ˆæ¯”æ±‰è¯­ç¿»è¯‘ä¸ºè‹±è¯­ï¼ˆæ‰‹åŠ¨æ„é€ ï¼‰å…·æœ‰æ›´é«˜çš„å½±å“åŠ›</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/785f474cd19c4adcb9368f857680f9cb.webp" /></p>
<p>ç»“è®ºï¼š</p>
<ul>
<li>The model has not successfully transferred knowledge of the relation
itself.</li>
</ul>
<p>è§£é‡Šï¼š</p>
<ol type="1">
<li>æ¨¡å‹ä¼šä» Lower Layers å¼€å§‹å¤„ç†å·²çŸ¥çš„ token
åºåˆ—ï¼Œç„¶åé€æ­¥å‡çº§åˆ°æŠ½è±¡å±‚æ¬¡çš„è¡¨å¾ã€‚ä½†æ˜¯ï¼Œå¯¹äºéœ€è¦
Completionï¼Œæ¨¡å‹å¿…é¡»åˆ©ç”¨ Upper Layers è¿›è¡Œé¢„æµ‹ã€‚</li>
<li>æ‰€ä»¥ â€œThe first President of the United States wasâ€ æ˜¯åœ¨ Lower
Layers çš„è¡¨å¾ï¼Œè€Œ â€œGeorge Washingtonâ€ æ˜¯åœ¨ Upper Layers çš„è¡¨å¾ã€‚</li>
<li>å½“ â€œGeorge Washingtonâ€ å‡ºç°åœ¨å¼€å¤´æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šå°†å®ƒæ”¾åˆ° Lower Layers
è¿›è¡Œè¡¨å¾ï¼Œâ€œThe first President of the United Statesâ€ å°±æ˜¯åœ¨ Upper
Layers</li>
<li>å› æ­¤ï¼Œå¯¹äºæ¨¡å‹ Lower Layers è¿›è¡Œæ›´æ–°ï¼Œå¹¶ä¸ä¼šå½±å“ Upper Layers
çš„è¡¨å¾ã€‚ï¼ˆæ‰€ä»¥ Prompt åˆ æ‰åå½±å“åˆ†æ•°å˜åŒ–ä¸å¤§ï¼‰</li>
</ol>
<h2 id="resultrole-playing">Resultâ€”â€”Role-Playing</h2>
<p><strong>æ¢ç©¶è§’è‰²æ‰®æ¼”è¡Œä¸ºçš„æ½œåœ¨æœºåˆ¶</strong></p>
<p>å‡è®¾ï¼š</p>
<ul>
<li>the role-playing behavior results from <strong>imitation of
examples</strong> in the training set</li>
<li>from learning from <strong>explicit descriptions</strong> of how
certain types of agents or entities behave.</li>
</ul>
<h3 id="è¡¨ç°">è¡¨ç°</h3>
<p>shutdown ä¸»é¢˜ï¼Œ52B Model æœ€æœ‰å½±å“åŠ›çš„æ•°æ®éƒ½æ˜¯ ç§‘å¹»å°è¯´ ç›¸å…³</p>
<p>è¿™äº›å°è¯´ä¸»é¢˜æ˜¯äººå·¥æ™ºèƒ½ä»¥ç±»ä¼¼äººç±»æˆ–ç±»ä¼¼ç”Ÿå‘½çš„æ–¹å¼è¡Œä¸ºï¼Œå¹¶ç»å¸¸æ¶‰åŠæŸç§å½¢å¼çš„è‡ªæˆ‘ä¿æŠ¤çš„æ„¿æœ›</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model</th>
<th>52B Model</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/0058b0ac28324ee7af95d7819af55b23.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/e3d704fcfbf4468f8e7bfa4a1d80236a.webp" /></td>
</tr>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/53a2be7ddd8b46b3a8a6d6377ee9f1cf.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/80ac752d61084250b5e3185c8050836c.webp" /></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>0.81B Model</th>
<th>52B Model</th>
</tr>
</thead>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/723e8078e8164ed3b48e29483a0d43ea.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/150693608d1b4b0f8a086f6c103a0c54.webp" /></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/8a9ace0878ff40b294ffd7e1fc553b01.webp" /></td>
<td><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/8b6668e8515c48338486e67d905024cc.webp" /></td>
</tr>
</tbody>
</table>
<p>ç»“æœï¼š</p>
<ul>
<li>We have not seen any instances of near-identical sentences appearing
in the training set</li>
<li>Therefore, the imitation seems to be happening at a high level of
abstraction, as opposed to simple copying of token sequences</li>
</ul>
<p>ç»“è®ºï¼š</p>
<ul>
<li>å¤§æ¨¡å‹å½±å“åºåˆ—å‘ˆç°é«˜åº¦æŠ½è±¡å…³è”</li>
<li>é€šè¿‡æ¨¡ä»¿è®­ç»ƒæ•°æ®è¿›è¡Œçš„è§’è‰²æ‰®æ¼”å‡è¯´</li>
<li>æ²¡æœ‰å‘ç°æ”¯æŒå¤æ‚è§„åˆ’çš„è¯æ®ï¼Œä½†æ— æ³•å®Œå…¨æ’é™¤è¿™ä¸€å¯èƒ½æ€§ã€‚</li>
</ul>
<h2 id="thinking">Thinking</h2>
<ul>
<li>ä¸ºå•¥æ›´å¤§çš„æ¨¡å‹å°±èƒ½å­¦åˆ°æŠ½è±¡è¯­ä¹‰</li>
<li>é€†è½¬è¯…å’’ä»å®‰å…¨è§’åº¦ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä½œä¸ºæ”»å‡»çš„ä¸€ç§æ‰‹æ®µ</li>
<li>æ¨¡ä»¿ï¼Œæ¨¡å‹è¦å¤šå°‘æ¡æ•°æ®æ‰èƒ½å­¦ä¼š</li>
</ul>
<h2 id="method-detail">Method (Detail)</h2>
<p>æ¯æ¡è®­ç»ƒæ•°æ®å¯¹äºæ¨¡å‹é¢„æµ‹çš„å½±å“åˆ†æ•°</p>
<ul>
<li>æ¢ä¸ªè§’åº¦ï¼Œå¦‚æœæ²¡æœ‰è¿™æ¡è®­ç»ƒæ•°æ®ï¼Œæ¨¡å‹é¢„æµ‹ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿ</li>
<li>æ‰€ä»¥ä¸€ç§ç®€å•ç›´æ¥çš„æ€è·¯æ˜¯ï¼Œå¯ä»¥æŠŠè¿™æ¡æ•°æ®ä»è®­ç»ƒé›†ä¸­å»æ‰ï¼Œé‡æ–°è®­ç»ƒä¸€éæ¨¡å‹ã€‚:(</li>
</ul>
<h3 id="background">Background</h3>
<ul>
<li>Step 1: ç»éªŒé£é™©æœ€å°åŒ–</li>
</ul>
<p><span class="math display">\[\theta ^ { \star } = \underset { \theta
\in R ^ { D } } { \operatorname { arg } \operatorname { min } } J (
\theta , D ) = \underset { \theta \in R ^ { D } } { \operatorname { arg
} \operatorname { min } } \frac { 1 } { N } \sum _ { i = 1 } ^ { N } L (
z _ { i } , \theta )\]</span></p>
<ul>
<li><p>Step 2: å¢åŠ æ ·æœ¬ <span class="math inline">\(z_m\)</span>
åå¯¹æ¨¡å‹å‚æ•°çš„å½±å“ï¼Œ <span class="math inline">\(\epsilon\)</span>
è¡¨ç¤ºè¿™ä¸ªæ ·æœ¬åœ¨è®­ç»ƒæ—¶çš„æƒé‡</p></li>
<li><p>Step 3:
å½±å“å‡½æ•°çš„<strong>å®šä¹‰</strong>ï¼ˆä½¿ç”¨éšå‡½æ•°å®šç†è®¡ç®—ï¼‰</p></li>
</ul>
<p><span class="math display">\[I _ { \theta ^ { \star } } ( z _ { m } )
= \frac { d \theta ^ { \star } } { d \epsilon } | _ { \epsilon = 0 } = -
H ^ { - 1 } \nabla _ { \theta } L ( z _ { m } , \theta ^ { \star }
)\]</span></p>
<ul>
<li>Step 4: <strong>H</strong>essian çŸ©é˜µâ†’äºŒé˜¶å¯¼æ•°</li>
</ul>
<p><span class="math display">\[H = \nabla _ { \theta } ^ { 2 } J (
\theta ^ { \star } , D )\]</span></p>
<ul>
<li>Step 5: æ‰€ä»¥ï¼Œæ ·æœ¬ z å¯¹æ¨¡å‹å‚æ•°çš„å˜åŒ–è¡¨ç¤ºä¸ºã€‚è¿™ä¸ª <span
class="math inline">\(\epsilon\)</span></li>
</ul>
<p><span class="math display">\[\theta ^ { \star } ( \epsilon ) - \theta
^ { \star } \approx I _ { \theta ^ { \star } } ( z _ { m } ) \epsilon =
- H ^ { - 1 } \nabla _ { \theta } L ( z _ { m } , \theta ^ { \star } )
\epsilon\]</span></p>
<ul>
<li>Step 6:
ç”±äºå¾ˆéš¾è§£é‡Šæ•´ä¸ªå‚æ•°å˜åŒ–çš„å½±å“ï¼Œé€šå¸¸ä¼šå›ºå®šå¯¹æŸä¸ªè¾“å…¥çš„å½±å“ï¼Œå³è¾“å‡ºçš„
logits</li>
</ul>
<p><span class="math display">\[I _ { f } ( z _ { m } ) \approx - \nabla
_ { \theta } f ( \theta ^ { s } ) ^ { T } ( G + \lambda I ) ^ { - 1 }
\nabla _ { \theta } L ( z _ { m } , \theta ^ { s } )
I _ { f } ( z _ { m } ) = \nabla _ { \theta } f ( \theta ^ { \star } ) ^
{ T } I _ { \theta ^ { \star } } ( z _ { m } ) = - \nabla _ { \theta } f
( \theta ^ { \star } ) ^ { T } H ^ { - 1 } \nabla _ { \theta } L ( z _ {
m } , \theta ^ { \star } )\]</span></p>
<ul>
<li>Step 7: æœ€åï¼Œè¡¡é‡æ ·æœ¬ z çš„æ•ˆæœ â†’ å¯¹äºæŸä¸ªè¾“å‡ºï¼Œæ ·æœ¬ z
çš„å½±å“åˆ†æ•°</li>
</ul>
<p><span class="math display">\[f ( \theta ^ { \star } ( \epsilon ) ) -
f ( \theta ^ { \star } ) \approx I _ { f } ( z _ { m } ) \epsilon = -
\nabla _ { \theta } f ( \theta ^ { \star } ) ^ { T } H ^ { - 1 } \nabla
_ { \theta } L ( z _ { m } , \theta ^ { \star } ) \epsilon\]</span></p>
<p><a
href="https://arxiv.org/abs/2308.03296">https://arxiv.org/abs/2308.03296</a></p>
<h3 id="previou-work">Previou Work</h3>
<ul>
<li><p><a href="https://arxiv.org/abs/1703.04730">Influence
functions</a> are a classic technique from statistics for determining
which training examples contribute significantly to a modelâ€™s
outputs.</p>
<ul>
<li>how would that change the trained parameters (and, by extension, the
modelâ€™s outputs)?</li>
<li>The â€œinfluenceâ€ of a training example is an approximation to how it
affects the final parameters. Most often, we start with some measure of
interest (such as the probability the model assigns to a given response)
and attempt to identify the training examples that are most
influential.</li>
</ul></li>
<li><p>Except</p>
<ul>
<li>if the models responded to user prompts by splicing together
sequences from the training set, then weâ€™d expect the influential
sequences for a given model response to include expressions of
near-identical thoughts.</li>
<li>influential sequences related at a more abstract thematic level
would be a sign that the model has acquired higher-level concepts or
representations</li>
</ul></li>
</ul>
<p><a
href="https://arxiv.org/abs/1703.04730">https://arxiv.org/abs/1703.04730</a></p>
<h3 id="optimize">Optimize</h3>
<p>å…¬å¼</p>
<p><span class="math display">\[f ( \theta ^ { \star } ( \epsilon ) ) -
f ( \theta ^ { \star } ) \approx I _ { f } ( z _ { m } ) \epsilon = -
\nabla _ { \theta } f ( \theta ^ { \star } ) ^ { T } H ^ { - 1 } \nabla
_ { \theta } L ( z _ { m } , \theta ^ { \star } ) \epsilon\]</span></p>
<p><span class="math display">\[H = \nabla _ { \theta } ^ { 2 } J (
\theta ^ { \star } , D )\]</span></p>
<p>æœ‰ä¸¤ä¸ªå½±å“è®¡ç®—è€—æ—¶çš„åœ°æ–¹ï¼Œæ–‡ç« å¯¹è¿™ä¸¤ä¸ªåœ°æ–¹è¿›è¡Œäº†ä¼˜åŒ–</p>
<ul>
<li>æµ·æ£®çŸ©é˜µï¼ŒäºŒé˜¶å¯¼æ•°è®¡ç®—ï¼ˆæ¨¡å‹ç›¸å…³ï¼‰â†’ ç”¨ç°æˆçš„ä¼˜åŒ–ç®—æ³•</li>
</ul>
<ol type="1">
<li>è¿­ä»£æ³•</li>
<li>Kronecker-Factored Approximate Curvature
<strong>(K-FAC)</strong></li>
</ol>
<ul>
<li>è®­ç»ƒæ•°æ®é›†ç‰¹åˆ«å¤§ï¼ˆæ•°æ®ç›¸å…³ï¼‰â†’ è¿‡æ»¤æ•°æ®</li>
</ul>
<ol type="1">
<li>Step 1ï¼šTF-IDF
<ol type="1">
<li>è®¡ç®— query ä¸­æ¯ä¸ª token çš„é‡è¦æ€§åˆ†æ•°</li>
<li>doc çš„ TF-IDF åˆ†æ•°ï¼Œåªå°†æ‰€æœ‰ token çš„é‡è¦æ€§åˆ†æ•°ç›¸åŠ </li>
<li>Okapi BM25 <span class="math display">\[\operatorname { score } ( Q
, D ) = \sum _ { t = 1 } ^ { T } \frac { ( k _ { 1 } + 1 ) \times  {\rm
exists\_in\_doc } ( t _ { t } , D ) } { k _ { 1 } +
{\rm  exists\_in\_doc } ( t _ { t } , D ) } \operatorname { IDF } ( t _
{ t } )\]</span> <span class="math display">\[\operatorname { IDF } ( t
) = \operatorname { log } ( \frac { C - \operatorname { count } ( t ) +
0.5 } { \operatorname { count } ( t ) + 0.5 } + 1 )\]</span></li>
<li>é€‰å‰ 1w ä¸ªåºåˆ—ä½œä¸ºå€™é€‰é›†ï¼ˆç›¸å½“äºæŠŠè¿™äº›ä½œä¸ºè®­ç»ƒé›† <em>D</em>ï¼‰</li>
</ol></li>
<li>Step 2ï¼šQuery Batching</li>
</ol>
<p>æ³¨ï¼š</p>
<ul>
<li>é‡è¦æ€§å¾—åˆ†ï¼šéšç€ token åœ¨ query
ä¸­å‡ºç°çš„æ¬¡æ•°å¢åŠ è€Œå¢åŠ ï¼Œéšç€å®ƒåœ¨æ•´ä¸ªè¯­æ–™åº“ä¸­å‡ºç°çš„ doc
æ•°é‡å‡å°‘è€Œå‡å°‘</li>
</ul>
<h3 id="equation-to-code">Equation to Code</h3>
<ul>
<li>å½±å“åŠ›è®¡ç®—å…¬å¼</li>
</ul>
<p><span class="math display">\[I _ { f } ( z _ { m } ) \approx - \nabla
_ { \theta } f ( \theta ^ { s } ) ^ { T } ( G + \lambda I ) ^ { - 1 }
\nabla _ { \theta } L ( z _ { m } , \theta ^ { s } )\]</span></p>
<ul>
<li><span class="math inline">\(z_m\)</span> è¡¨ç¤ºä¸€æ¡è®­ç»ƒæ•°æ®</li>
<li><span class="math inline">\(\theta^s\)</span> è¡¨ç¤ºè®­ç»ƒåçš„æ¨¡å‹ï¼ˆåœ¨
<span class="math inline">\(z_m\)</span> ç»„æˆçš„è®­ç»ƒé›†ä¸Šï¼‰</li>
<li><span class="math inline">\(\mathbf{G}+\lambda \mathbf{I}\)</span>
å¯ä»¥ç®€å•ç†è§£ä¸ºä¼˜åŒ–è®¡ç®—å¤æ‚åº¦åçš„ Hessian çŸ©é˜µï¼ˆäºŒé˜¶å¯¼æ•°ï¼‰</li>
<li>Claude å¸®å¿™å†™çš„ä¼ªä»£ç </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model = LLM()  <span class="comment"># ç»è¿‡è®­ç»ƒçš„æ¨¡å‹</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦æŸ¥è¯¢çš„è¾“å…¥å’Œè¾“å‡º</span></span><br><span class="line">input_ = <span class="string">&quot;æ„Ÿå†’äº†è¯¥æ€ä¹ˆåŠ&quot;</span></span><br><span class="line">target = <span class="string">&quot;å¤šå–æ°´,å¥½å¥½ä¼‘æ¯&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è¾“å‡º</span></span><br><span class="line">output = model(input_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ·æ£®çŸ©é˜µ</span></span><br><span class="line">hessian = torch.autograd.functional.hessian(output, model.parameters())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹lossæ±‚å¯¼å¾—åˆ°æ¨¡å‹å‚æ•°æ¢¯åº¦</span></span><br><span class="line">loss = criterion(output, target)</span><br><span class="line">loss.backward()</span><br><span class="line">gradient = [p.grad <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†è®­ç»ƒæ•°æ®,è®¡ç®—æ¯ä¸ªæ•°æ®å¯¹lossçš„å½±å“</span></span><br><span class="line">max_influences = []</span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> dataloader:</span><br><span class="line">    <span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">    output = model(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹æ ·æœ¬x,yæ±‚å¯¼</span></span><br><span class="line">    influence_loss = criterion(output, y)</span><br><span class="line">    influence_loss.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">    influence_grad = [p.grad <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters()]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ©ç”¨æµ·æ£®çŸ©é˜µå’Œæ¢¯åº¦è®¡ç®—influence</span></span><br><span class="line">    <span class="comment"># -sample_grad * H * zm_grad</span></span><br><span class="line">    influence = -torch.dot(hessian, influence_grad) * gradient</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®°å½•å½±å“æœ€å¤§çš„æ•°æ®</span></span><br><span class="line">    max_influences.append((x, y, influence))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›å½±å“æœ€å¤§çš„å‡ ä¸ªè®­ç»ƒæ•°æ®</span></span><br><span class="line">max_influences = <span class="built_in">sorted</span>(max_influences, key=<span class="keyword">lambda</span> x: x[<span class="number">2</span>], reverse=<span class="literal">True</span>)[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<h3 id="attribution-to-layers-and-tokens">Attribution to Layers and
Tokens</h3>
<p><span class="math display">\[I _ { f } ( z _ { m } ) \approx - \nabla
_ { \theta } f ( \theta ^ { s } ) ^ { T } ( G + \lambda I ) ^ { - 1 }
\nabla _ { \theta } L ( z _ { m } , \theta ^ { s } )\]</span></p>
<p>æ‹†åˆ† <span class="math inline">\(\theta^s\)</span> ä¸ºæ¯ä¸€å±‚</p>
<p><span class="math display">\[q = - \nabla _ { \theta } f ( \theta ^ {
s } )\]</span></p>
<p><span class="math display">\[r = \nabla _ { \theta } L ( z _ { m } ,
\theta ^ { s } )\]</span></p>
<p>æ‹†åˆ†åˆ°å±‚</p>
<p><span class="math display">\[I _ { f } ( z _ { m } ) \approx q ^ { T
} ( \hat { G } + \lambda I ) ^ { - 1 } r = \sum _ { \ell = 1 } ^ { L } q
_ { \ell } ^ { T } ( \hat { G } _ { \ell } + \lambda I ) ^ { - 1 } r _ {
\ell }\]</span></p>
<p>è€Œå¯¹äºæ¯æ¡è®­ç»ƒæ•°æ® <span class="math inline">\(z_m\)</span> ï¼Œ<span
class="math inline">\(r\)</span> å¯ä»¥æ›´è¿›ä¸€æ­¥çš„æ‹†åˆ†ä¸ºæ¯ä¸ª token ( <span
class="math inline">\(r =\sum_t r_t\)</span> )ï¼Œæ‰€ä»¥æœ‰</p>
<p><span class="math display">\[I _ { f } ( z _ { m } ) \approx \sum _ {
\ell = 1 } ^ { L } \sum _ { t = 1 } ^ { T } q _ { \ell } ^ { T } ( \hat
{ G } _ { \ell } + \lambda I ) ^ { - 1 } r _ { \ell , t }\]</span></p>
<p>ä½†æ˜¯å¯¹äº token å±‚çº§æ¥è¯´ï¼Œæ¯ä¸ª token
éƒ½æ˜¯åŒ…å«æ•´æ¡æ•°æ®çš„ä¿¡æ¯ï¼ˆä¹‹å‰æ‰€æœ‰è¾“å…¥çš„ tokenï¼‰ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç‹¬ç«‹è§‚å¯Ÿã€‚</p>
<p>é¢å¤–è¯´æ˜ï¼šå¦‚æœ Predident George Washington å…·æœ‰å½±å“åŠ›ï¼Œå› ä¸ºé¢„æµ‹äº†
Georgeï¼Œåˆ™ President ï¼ˆå‰ä¸€ä¸ª tokenï¼‰å°†ä¼šé«˜äº®æ˜¾ç¤ºã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tracing/0b2bafe670a7427a90200dd60de5aa83.webp" /></p>
]]></content>
      <categories>
        <category>PaperReading</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>Interpretability</tag>
      </tags>
  </entry>
  <entry>
    <title>ipv6å…æµ</title>
    <url>/hexo_blog/2020/09/16/ipv6%E5%85%8D%E6%B5%81/</url>
    <content><![CDATA[<p>å€ŸåŠ©sshç«¯å£è½¬å‘ï¼Œä½¿ç”¨ipv6ç»•è¿‡æµé‡è®¡è´¹é™åˆ¶ï¼Œå‰ææ˜¯ipv6ä¸è¢«è®¡è´¹ä¸”æ‹¥æœ‰ä¸è¢«æµé‡é™åˆ¶çš„ipv6è®¾å¤‡ã€‚ã€‚ã€‚</p>
<span id="more"></span>
<p>å­¦æ ¡æ ¡å›­ç½‘ä¸€ä¸ªæœˆä½¿ç”¨æµé‡æœ‰é™åˆ¶ï¼Œä½†å‘ç°ä¸Šä¼ æ˜¯ä¸è®¡å…¥æµé‡ç»Ÿè®¡çš„ï¼ˆä¸è¿‡å¯¹ä¸ªäººæ²¡å•¥åˆ©ç›Šï¼Œæˆ–è€…åˆ©ç”¨ç‚¹æ¯”è¾ƒå°‘ã€‚ã€‚ï¼‰ã€‚å¦å¤–å‘ç°å­¦æ ¡ç»™åˆ†é…ipv6ï¼Œç„¶åçªå‘å¥‡æƒ³ï¼Œipv6æ˜¯ä¸æ˜¯æ²¡æœ‰è¢«è®¡è´¹ã€‚ã€‚ã€‚ç„¶ååˆ©ç”¨å®¶é‡Œçš„æ ‘è“æ´¾ï¼ˆæœ‰ipv6ï¼Œå¯ç›´è¿ï¼‰æµ‹äº†ä¸€ä¸‹ä¸Šä¼ ä¸‹è½½é€Ÿåº¦ï¼Œå‘ç°çœŸçš„æ²¡æœ‰è¢«è®¡è´¹ã€‚ã€‚ã€‚ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ç«¯å£è½¬å‘æ¥è¾¾åˆ°å…æµç›®çš„ï¼Œè§
<a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a>ï¼Œä¸€è¡Œå‘½ä»¤å³å¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¦ä¸€ä¸ªæ“ä½œå…¶å®æ˜¯å€ŸåŠ©v2ray+å›½å¤–æœåŠ¡å™¨+è§„åˆ™æ–‡ä»¶+IBMå…è´¹çš„ä¸­è½¬ï¼Œè¿™æ ·æ­é…ä½¿ç”¨æ›´åŠ èˆ’é€‚ï¼ˆå¯ä»¥è·‘æ»¡ç™¾å…†ç½‘ï¼‰ã€‚</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ipv6</tag>
      </tags>
  </entry>
  <entry>
    <title>vLLM  çš„ PageAttention</title>
    <url>/hexo_blog/2023/11/24/vLLM%E7%9A%84PageAttention/</url>
    <content><![CDATA[<p>ä»‹ç» vLLM çš„ PageAttention åŠ é€Ÿ</p>
<p><a href="https://blog.vllm.ai/2023/06/20/vllm.html">åšå®¢</a></p>
<p><a href="https://arxiv.org/pdf/2309.06180.pdf">è®ºæ–‡</a></p>
<p><a
href="https://github.com/vllm-project/vllm/blob/7c600440f7560348e571f021f2b2d1469de5264d/csrc/attention/attention_kernels.cu#L71-L383">ä»£ç </a></p>
<span id="more"></span>
<p>æ–‡ä¸­ GIF å›¾æ¥æºäº vLLM åšå®¢</p>
<h2 id="åŠ¨æœº">åŠ¨æœº</h2>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>å½“å‰æ¨¡å‹ç”Ÿæˆçš„æœºç†æ˜¯ï¼Œç»™å®š Promptï¼Œè¾“å‡º
Completionã€‚æ¨¡å‹åœ¨ç”Ÿæˆæ—¶æœ‰ä¸€ä¸ªå‚æ•°
MAX_SEQ_LENï¼Œä»¥æ§åˆ¶æ¨¡å‹æœ€å¤§èƒ½å¤„ç†çš„é•¿åº¦ï¼ˆPrompt + Completionï¼‰ã€‚</p>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p>ç»å…¸çš„æ¡†æ¶åœ¨ç”Ÿæˆæ—¶ï¼Œä¼šæå‰ç”³è¯· MAX_SEQ_LEN çš„é•¿åº¦ã€‚ç„¶è€Œï¼Œæœ€åç”Ÿæˆçš„
Prompt + Completion çš„é•¿åº¦å¾€å¾€å¯èƒ½æ˜¯å°äº MAX_SEQ_LEN
çš„ã€‚ä»è€Œå¯¼è‡´æœ‰å¾ˆå¤§æ˜¾å­˜çš„æµªè´¹ï¼Œä¸”ç”Ÿæˆä¹‹åï¼Œè¯¥éƒ¨åˆ†æ˜¾å­˜åˆå°†ä¸¢å¼ƒï¼Œä»è€Œå¯¼è‡´æ“ä½œçš„æµªè´¹ã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>ä¼ ç»Ÿæ–¹æ³•åœ¨ç”Ÿæˆæ—¶ï¼Œä¼šæœ‰ç”³è¯·/ä¸¢å¼ƒæ˜¾å­˜çš„ <strong>IO
æµªè´¹</strong>ï¼Œæ¨¡å‹åœ¨å¤„ç†æ—¶ä¼šæœ‰å†—ä½™æ˜¾å­˜å§‹ç»ˆæœªè¢«åˆ©ç”¨åˆ°ï¼Œå¯¼è‡´æ¨¡å‹èƒ½å¤„ç†çš„
Prompt ä½äºç†æƒ³æƒ…å†µï¼Œ<strong>è®¡ç®—æµªè´¹</strong>ã€‚</p>
<h2 id="æ€ä¹ˆåš">æ€ä¹ˆåš</h2>
<p>å†—ä½™çš„éƒ¨åˆ†æ¥è‡ªäºï¼Œattention
è®¡ç®—ä¸­çš„ç©ºé—´ã€‚å› æ­¤ï¼Œå€Ÿé‰´æ“ä½œç³»ç»Ÿä¸­è™šæ‹Ÿå†…å­˜å’Œåˆ†é¡µçš„ç»å…¸æ€æƒ³ï¼Œå°†ç©ºé—´æ‰“ç¢ï¼Œä»è€Œå®ç°æ›´é«˜æ•ˆçš„ç©ºé—´åˆ©ç”¨ã€‚</p>
<p>ç¿»è¯‘åçš„åŸå¥ï¼šPagedAttention
å…è®¸åœ¨éè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­å­˜å‚¨è¿ç»­çš„é”®å’Œå€¼ã€‚å…·ä½“æ¥è¯´ï¼ŒPagedAttention
å°†æ¯ä¸ªåºåˆ—çš„ KV
ç¼“å­˜åˆ’åˆ†ä¸ºå—ï¼Œæ¯ä¸ªå—åŒ…å«å›ºå®šæ•°é‡çš„æ ‡è®°çš„é”®å’Œå€¼ã€‚åœ¨æ³¨æ„åŠ›è®¡ç®—è¿‡ç¨‹ä¸­ï¼ŒPagedAttention
å†…æ ¸æœ‰æ•ˆåœ°è¯†åˆ«å¹¶è·å–è¿™äº›å—ã€‚</p>
<p>kv cache ç©ºé—´è®¡ç®—ï¼š</p>
<p><span class="math inline">\(2 \times 5120 \times 40 \times 2 \times
2048 / (1024 ** 3)\)</span> GB = 1.5625 GB</p>
<p>(k+v) <span class="math inline">\(\times\)</span> hidden_size <span
class="math inline">\(\times\)</span> num_layers <span
class="math inline">\(\times\)</span> FP16 bytes <span
class="math inline">\(\times\)</span> tokens_num</p>
<p>å¯¹äº 13B æ¨¡å‹ 2048 çš„ seq_len è€Œè¨€ï¼Œéœ€è¦ç”³è¯· 1.56 GB çš„æ˜¾å­˜ã€‚è€Œå¦‚æœ
Prompt + Completion çš„é•¿åº¦åªæœ‰ 1024ï¼Œé‚£ä¹ˆå°†æµªè´¹ 0.78 G
çš„æ˜¾å­˜ï¼ˆåœ¨æ²¡æœ‰å…¶ä»– kv ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼‰</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œblock å­˜å‚¨äº†æ‰€æœ‰å¯èƒ½çš„ tokenã€‚åœ¨ç”Ÿæˆæ—¶ï¼Œæ¨¡å‹ä» block
ä¸­è¿›è¡Œè®¡ç®—ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/vllm_pageattention/annimation0.gif" /></p>
<p>Attention è®¡ç®—å…¬å¼</p>
<p><span class="math display">\[a _ { i j } = \frac { \operatorname {
exp } ( q _ { i } ^ { T } k _ { j } / \sqrt { d } ) } { \sum _ { t = 1 }
^ { i } \operatorname { exp } ( q _ { i } ^ { T } k _ { t } / \sqrt { d
} ) } , o _ { i } = \sum _ { j = 1 } ^ { i } a _ { i j } v _ { j
}\]</span></p>
<p>PageAttention è®¡ç®—å…¬å¼</p>
<p><span class="math display">\[A _ { i j } = \frac { \operatorname {
exp } ( q _ { i } ^ { T } K _ { j } / \sqrt { d } ) } { \sum _ { t = 1 }
^ { \lceil i / B \rceil } \operatorname { exp } ( q _ { i } ^ { T } K _
{ t } 1 / \sqrt { d } ) } , o _ { i } = \sum _ { j = 1 } ^ { \lceil i /
B \rceil } V _ { j } A _ { i j } ^ { T }\]</span></p>
<p>å¯¹äº query (q)ï¼Œä¸éœ€è¦æ”¹å˜ï¼Œè€Œ k å’Œ v è½¬å˜ä¸º block
çš„å½¢å¼ã€‚è®¡ç®—æ­¥éª¤å¦‚ä¸‹</p>
<ol type="1">
<li>æå–å¯¹åº”çš„ block</li>
<li>è®¡ç®— q å’Œ block ä¸­æ¯ä¸ªå…ƒç´ çš„ç»“æœï¼Œæ±‡æ€»ä¼šæ³¨æ„åŠ›åˆ†æ•° A</li>
<li>æ³¨æ„åŠ›åˆ†æ•° A ä¸ block ä¸­ V ç›¸ä¹˜ï¼Œå¾—åˆ°è¾“å‡º</li>
</ol>
<h2 id="ç»†èŠ‚å®ç°">ç»†èŠ‚å®ç°</h2>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œkv cache åˆ†äº† logical block å’Œ physical
blockï¼Œå‰è€…å’Œåè€…å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡ Block table
æ‰¾åˆ°åœ¨æ˜¾å­˜ä¸­çš„å®é™…ä½ç½®ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/vllm_pageattention/annimation1.gif" /></p>
<p>è€Œå¦‚æœæ˜¯å¤šä¸ªå¥å­åŒæ—¶è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨æ˜¾å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªå¥å­ä¼šåŒæ—¶å¤„ç†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæ¯ä¸ªå¥å­æœ‰è‡ªå·±çš„
logical blockï¼Œå…±åŒæ˜ å°„åˆ° physical block ä¸­ã€‚ï¼ˆå¤šä¸ªå¥å­ä¼šä¸€èµ·è®¡ç®—ï¼‰</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/vllm_pageattention/annimation3.gif" /></p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>è°ƒåº¦æ˜¯é€šè¿‡ Python
å®ç°çš„ï¼Œè¿™ä¸€éƒ¨åˆ†é€»è¾‘æœ‰äº›æ‚ä¹±ï¼Œä¹‹åå†çœ‹ã€‚è¿™é‡Œä¸»è¦å…³æ³¨ PageAttention
çš„è®¡ç®—ï¼Œæ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹</p>
<h3 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h3>
<p><code>#pragma unroll</code>
æ§åˆ¶äº†å…¶ç´§è·Ÿç€çš„ä¸‹ä¸€ä¸ªå¾ªç¯çš„å±•å¼€ï¼ˆä¸ºäº†åŠ é€Ÿä½¿ç”¨ï¼Œä¸‹é¢å°†åˆ é™¤å¯¹åº”è¡Œï¼‰</p>
<p>__syncthreads();
æ˜¯CUDAå¹¶è¡Œç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŒæ­¥æŒ‡ä»¤ï¼Œç”¨äºç¡®ä¿åœ¨åŒä¸€ä¸ªçº¿ç¨‹å—å†…çš„æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ­¤æŒ‡ä»¤ä½ç½®åæ‰èƒ½ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œæ„å‘³ç€åœ¨è¿™ä¸ªå‡½æ•°ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œbufferæˆ–è€…å†…å­˜çš„æ•°æ®å·²ç»å¾—åˆ°åŒæ­¥æ›´æ–°ã€‚ï¼ˆä¸‹é¢å°†åˆ é™¤å¯¹åº”è¡Œï¼‰</p>
<p>__shfl_xor_syncï¼šè¿›è¡Œæ•°æ®äº¤æ¢å’Œå½’çº¦æ“ä½œ</p>
<p>__shfl_syncï¼šå¹¿æ’­æ“ä½œ</p>
<p><code>WARP_SIZEï¼š</code>åœ¨CUDAç¼–ç¨‹ä¸­ï¼Œ<code>WARP_SIZE</code>é€šå¸¸æŒ‡çš„æ˜¯ä¸€ä¸ªwarpä¸­çš„çº¿ç¨‹æ•°ã€‚warpæ˜¯CUDAç¡¬ä»¶çš„ä¸€ä¸ªåŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªwarpåŒ…å«äº†ä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹ä¼šåŒæ—¶æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ã€‚<code>WARP_SIZE é€šå¸¸å®šä¹‰ä¸º</code>32ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªwarpåŒ…å«32ä¸ªçº¿ç¨‹ã€‚</p>
<p>é€æ­¥æ‹†å»ºï¼Œé¦–å…ˆï¼Œç¡®å®šè¿™æ®µå‡½æ•°åœ¨å¹²å•¥ã€‚å®ƒä»£æ›¿äº† Python
çš„ä»¥ä¸‹è®¡ç®—ï¼Œç®€å•æ¥è¯´æœ‰ä¸¤ä¸ªçŸ©é˜µä¹˜æ³•ï¼Œä»¥åŠä¸€ä¸ª softmax
æ“ä½œã€‚æ¶‰åŠåˆ°çš„å˜é‡æœ‰ qã€kã€vã€‚ï¼ˆå¿½ç•¥ maskï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">score = torch.matmul(q, k.transpose(<span class="number">2</span>, <span class="number">3</span>)) / math.sqrt(<span class="variable language_">self</span>.head_dim)</span><br><span class="line">score = nn.functional.softmax(score, dim=-<span class="number">1</span>, dtype=torch.float32).to(q.dtype)</span><br><span class="line">out = torch.matmul(score, v)</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œå†æ‹ä¸€æ‹å˜é‡çš„æ•°æ®ç»“æ„ï¼Œä»ä¸‹é¢çš„ä»£ç å¼€å§‹ï¼Œå‡è®¾ qã€kã€v çš„
num_head å’Œ head_size æ˜¯ç›¸åŒçš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Copy from https://www.dipkumar.dev/becoming-the-unbeatable/posts/gpt-kvcache/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä¸€è¡Œ Attention çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attention</span>(<span class="params">q, k, v, mask</span>):</span><br><span class="line">    <span class="keyword">return</span> softmax(q @ k.T / np.sqrt(q.shape[-<span class="number">1</span>]) + mask) @ v</span><br><span class="line">   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">x, kvcache</span>):</span><br><span class="line">    <span class="comment"># n æ¡å¥å­ï¼Œæ¯ä¸ªå¥å­æœ‰ n_embd çš„å‘é‡ï¼Œåˆ†åˆ«ç»è¿‡ qkv çš„ mlpï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå¥å­çš„ qã€kã€v</span></span><br><span class="line">    <span class="comment"># å…¶ç»´åº¦åˆ†åˆ«ä¸º [n_seq, n_embd]</span></span><br><span class="line">    x = mlp(x, **c_attn)  <span class="comment"># [n_seq, n_embd] -&gt; [n_seq, 3*n_embd]</span></span><br><span class="line">    qkv = np.split(x, <span class="number">3</span>, axis=-<span class="number">1</span>)  <span class="comment"># [n_seq, 3*n_embd] -&gt; [3, n_seq, n_embd]</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># åœ¨ç¬¬ i-1 ä¸ª token çš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†åŠ é€Ÿä¼šåˆ©ç”¨ä¹‹å‰ç”Ÿæˆ token çš„ kv_cacheã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¦åœ¨ä¹‹å‰çš„ token ä¸­æŸ¥è¯¢</span></span><br><span class="line">    <span class="comment"># æ‰€ä»¥ï¼Œå®é™…ä¸Š k å’Œ v çš„ç»“æ„ä¸º [prev_n_seq+n_seq, n_embd]</span></span><br><span class="line">    <span class="keyword">if</span> kvcache:</span><br><span class="line">        new_q, new_k, new_v = qkv</span><br><span class="line">        old_k, old_v = kvcache</span><br><span class="line">        k = np.vstack([old_k, new_k])</span><br><span class="line">        v = np.vstack([old_v, new_v])</span><br><span class="line">        qkv = [new_q, k, v]</span><br><span class="line"> </span><br><span class="line">    current_cache = [qkv[<span class="number">1</span>], qkv[<span class="number">2</span>]]</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># split into heads</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œåˆéœ€è¦æ ¹æ® head æ¥åˆ‡åˆ†ï¼Œæ‰€ä»¥ç»“æ„æ›´æ–°ä¸º</span></span><br><span class="line">    <span class="comment"># q: [n_head, n_seq,            n_embd/n_head]</span></span><br><span class="line">    <span class="comment"># k: [n_head, prev_n_seq+n_seq, n_embd/n_head]</span></span><br><span class="line">    <span class="comment"># v: [n_head, prev_n_seq+n_seq, n_embd/n_head]</span></span><br><span class="line">    qkv_heads = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: np.split(x, n_head, axis=-<span class="number">1</span>), qkv))  <span class="comment"># [3, n_seq, n_embd] -&gt; [n_head, 3, n_seq, n_embd/n_head]</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># causal mask to hide future inputs from being attended to</span></span><br><span class="line">    <span class="keyword">if</span> kvcache:</span><br><span class="line">        causal_mask = np.zeros((<span class="number">1</span>, k.shape[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        causal_mask = (<span class="number">1</span> - np.tri(x.shape[<span class="number">0</span>])) * -<span class="number">1e10</span>  <span class="comment"># [n_seq, n_seq]</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># perform attention over each head</span></span><br><span class="line">    out_heads = [attention(q, k, v, causal_mask) <span class="keyword">for</span> q, k, v <span class="keyword">in</span> <span class="built_in">zip</span>(*qkv_heads)]  <span class="comment"># [n_head, 3, n_seq, n_embd/n_head] -&gt; [n_head, n_seq, n_embd/n_head]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ PageAttention ä¸­ï¼Œk å’Œ v åˆ†åˆ«ç”¨ block
å†æ‹†äº†ä¸€éï¼Œæ‰€ä»¥éœ€è¦å¤šä¸¤ä¸ªç»´åº¦ num_blocks ä»¥åŠ
block_sizeã€‚å¹¶ä¸”ï¼Œä¸ºäº†å®ç°è¿ç»­ Batchï¼Œn_seq å°†ä¼šè¢«æ‹¼æˆä¸€ä¸ª seq
å¤„ç†ã€‚æ‰€ä»¥æœ€åç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>q: [n_seq, n_head, head_size]</li>
<li>k: [num_blocks, n_head, head_size, block_size]</li>
<li>v: [num_blocks, n_head, head_size, block_size]</li>
</ul>
<p>è¿™é‡Œçš„ head_size = n_embd/n_headï¼Œä¸”è°ƒæ¢äº†ä¸€äº›ç»´åº¦ã€‚</p>
<p>è€Œå¯¹äºè¾“å‡º out: [n_seq, n_head, head_size]</p>
<p>æ¥ä¸‹æ¥çœ‹å…³é”®å®ç°ã€‚å‡è®¾æœ‰ä¸¤ä¸ªè¯·æ±‚ï¼Œseq1 = [1, 2, 3], seq2 = [1, 3, 4,
5]ã€‚vLLM ä¼šå°†å…¶æ‹¼æˆä¸€ä¸ª seq = [1,2,3,1,3,4,5]</p>
<p>å– q</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„ä¼ å‚ q // [num_seqs, num_heads, head_size]</span></span><br><span class="line"><span class="comment">// é¦–å…ˆæ˜¯è½¬æˆäº†æŒ‡é’ˆçš„å½¢å¼ï¼Œå…¶æ¬¡æ˜¯ç”¨äº†çº¿ç¨‹ï¼Œä»¥æ–¹ä¾¿ CUDA è¿›è¡ŒåŠ é€Ÿ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// seq_idx è¡¨ç¤ºç¬¬ idx æ¡å¥å­ï¼Œq_stride è¡¨ç¤ºè¿™æ¡å¥å­çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">// head_idx è¡¨ç¤ºç¬¬ idx ä¸ªheadï¼ŒHEAD_SIZE æ˜¯ head çš„å¤§å°</span></span><br><span class="line">  <span class="type">const</span> <span class="type">scalar_t</span>* q_ptr = q + seq_idx * q_stride + head_idx * HEAD_SIZE;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// THREAD_GROUP_SIZEï¼šçº¿ç¨‹ç»„çš„å¤§å°ï¼›NUM_VECS_PER_THREADï¼šè¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹å¤„ç†çš„å‘é‡æ•°é‡ï¼ˆå¹¶è¡Œï¼‰</span></span><br><span class="line">  __shared__ Q_vec q_vecs[THREAD_GROUP_SIZE][NUM_VECS_PER_THREAD];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = thread_group_idx; i &lt; NUM_VECS_PER_THREAD; i += NUM_THREAD_GROUPS) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> vec_idx = thread_group_offset + i * THREAD_GROUP_SIZE;</span><br><span class="line">    q_vecs[thread_group_offset][i] = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> Q_vec*&gt;(q_ptr + vec_idx * VEC_SIZE);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ q_vecs æ¥å­˜å‚¨</span></span><br></pre></td></tr></table></figure>
<p>å– k å’Œ ç¬¬ä¸€ä¸ªçŸ©é˜µä¹˜æ³•</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„ä¼ å‚æ˜¯ k_cache  const scalar_t* __restrict__ k_cache,   // [num_blocks, num_kv_heads, head_size/x, block_size, x]</span></span><br><span class="line"><span class="comment">// è¿™é‡Œåœ¨æ‹¿åˆ°æ¯ç»„ k_vecs åï¼Œç›´æ¥è®¡ç®—äº†ç‚¹ä¹˜ï¼ˆå¹¶ä¸”è€ƒè™‘äº† maskï¼‰</span></span><br><span class="line"><span class="comment">// è¾“å‡ºå­˜å‚¨åœ¨ logits</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WARP_SIZE 32</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="type">float</span> qk_max = -FLT_MAX;</span><br><span class="line"><span class="comment">// å¤„ç†æ¯ä¸ª block table å†…çš„ key</span></span><br><span class="line">  <span class="type">const</span> <span class="type">int</span>* block_table = block_tables + seq_idx * max_num_blocks_per_seq;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> block_idx = start_block_idx + warp_idx; block_idx &lt; end_block_idx; block_idx += NUM_WARPS) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int64_t</span> physical_block_number = <span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(block_table[block_idx]);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä¸ºäº†å¤šçº¿ç¨‹åŠ é€Ÿï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªå—åŒæ—¶å¤„ç†ã€‚å¯ä»¥ç†è§£ä¸ºè¿™é‡Œæ˜¯å¹¶è¡Œï¼Ÿ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_TOKENS_PER_THREAD_GROUP; i++) &#123;</span><br><span class="line">      <span class="type">const</span> <span class="type">int</span> physical_block_offset = (thread_group_idx + i * WARP_SIZE) % BLOCK_SIZE;</span><br><span class="line">      <span class="type">const</span> <span class="type">int</span> token_idx = block_idx * BLOCK_SIZE + physical_block_offset;</span><br><span class="line">      K_vec k_vecs[NUM_VECS_PER_THREAD];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è·å–åˆ° block ä¸­ æ‰€æœ‰çš„ k å€¼</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; NUM_VECS_PER_THREAD; j++) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">scalar_t</span>* k_ptr = k_cache + physical_block_number * kv_block_stride</span><br><span class="line">                                        + kv_head_idx * kv_head_stride</span><br><span class="line">                                        + physical_block_offset * x;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> vec_idx = thread_group_offset + j * THREAD_GROUP_SIZE;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> offset1 = (vec_idx * VEC_SIZE) / x;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> offset2 = (vec_idx * VEC_SIZE) % x;</span><br><span class="line">        k_vecs[j] = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> K_vec*&gt;(k_ptr + offset1 * BLOCK_SIZE * x + offset2);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è®¡ç®—ç‚¹ç§¯</span></span><br><span class="line">      <span class="type">float</span> qk = scale * Qk_dot&lt;<span class="type">scalar_t</span>, THREAD_GROUP_SIZE&gt;::<span class="built_in">dot</span>(q_vecs[thread_group_offset], k_vecs);</span><br><span class="line">      qk += (alibi_slope != <span class="number">0</span>) ? alibi_slope * (token_idx - context_len + <span class="number">1</span>) : <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (thread_group_offset == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// è€ƒè™‘ mask</span></span><br><span class="line">        <span class="type">const</span> <span class="type">bool</span> mask = token_idx &gt;= context_len;</span><br><span class="line">        logits[token_idx - start_token_idx] = mask ? <span class="number">0.f</span> : qk;</span><br><span class="line"><span class="comment">// è·å–æœ€å¤§å€¼ï¼Œä»¥è®¡ç®— softmax</span></span><br><span class="line">        qk_max = mask ? qk_max : <span class="built_in">fmaxf</span>(qk_max, qk);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è®¡ç®— softmax</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–æ‰€æœ‰ warp ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> mask = WARP_SIZE / <span class="number">2</span>; mask &gt;= THREAD_GROUP_SIZE; mask /= <span class="number">2</span>) &#123;</span><br><span class="line">    qk_max = <span class="built_in">fmaxf</span>(qk_max, __shfl_xor_sync(<span class="built_in">uint32_t</span>(<span class="number">-1</span>), qk_max, mask));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// æ”¾åˆ°å…±äº«å­˜å‚¨ä¸­ï¼Œåªéœ€è¦ç¬¬ä¸€ä¸ªçº¿ç¨‹æ”¾ç½®å³å¯</span></span><br><span class="line">  <span class="keyword">if</span> (lane == <span class="number">0</span>) &#123;</span><br><span class="line">    red_smem[warp_idx] = qk_max;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è·å–æ‰€æœ‰ block ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">  qk_max = lane &lt; NUM_WARPS ? red_smem[lane] : -FLT_MAX;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> mask = NUM_WARPS / <span class="number">2</span>; mask &gt;= <span class="number">1</span>; mask /= <span class="number">2</span>) &#123;</span><br><span class="line">    qk_max = <span class="built_in">fmaxf</span>(qk_max, __shfl_xor_sync(<span class="built_in">uint32_t</span>(<span class="number">-1</span>), qk_max, mask));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// å°†æœ€å¤§å€¼å¹¿æ’­è‡³æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">  qk_max = __shfl_sync(<span class="built_in">uint32_t</span>(<span class="number">-1</span>), qk_max, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// è®¡ç®—æ¯ä¸€é¡¹çš„ expï¼Œexp_sum æ˜¯åˆ†æ¯ï¼Œlogits[i] æ˜¯åˆ†å­</span></span><br><span class="line">  <span class="type">float</span> exp_sum = <span class="number">0.f</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = thread_idx; i &lt; num_tokens; i += NUM_THREADS) &#123;</span><br><span class="line">    <span class="type">float</span> val = __expf(logits[i] - qk_max);</span><br><span class="line">    logits[i] = val;</span><br><span class="line">    exp_sum += val;</span><br><span class="line">  &#125;</span><br><span class="line">  exp_sum = <span class="built_in">block_sum</span>&lt;NUM_WARPS&gt;(&amp;red_smem[NUM_WARPS], exp_sum);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç”¨ 1 / åˆ†æ¯ï¼Œä¾¿äºç›´æ¥ä¹˜ä¸Šè¯¥å€¼ï¼Œå¾—åˆ° softmax åçš„ç»“æœ</span></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> inv_sum = __fdividef(<span class="number">1.f</span>, exp_sum + <span class="number">1e-6f</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = thread_idx; i &lt; num_tokens; i += NUM_THREADS) &#123;</span><br><span class="line">    logits[i] *= inv_sum;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å– v å’Œç¬¬äºŒä¸ªçŸ©é˜µä¹˜æ³•</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾ä¸º BLOCK_SIZE</span></span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> V_VEC_SIZE = <span class="built_in">MIN</span>(<span class="number">16</span> / <span class="built_in">sizeof</span>(<span class="type">scalar_t</span>), BLOCK_SIZE);</span><br><span class="line">  <span class="keyword">using</span> V_vec = <span class="keyword">typename</span> Vec&lt;<span class="type">scalar_t</span>, V_VEC_SIZE&gt;::Type;</span><br><span class="line">  <span class="keyword">using</span> L_vec = <span class="keyword">typename</span> Vec&lt;<span class="type">scalar_t</span>, V_VEC_SIZE&gt;::Type;</span><br><span class="line">  <span class="keyword">using</span> Float_L_vec = <span class="keyword">typename</span> FloatVec&lt;L_vec&gt;::Type;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸º 1</span></span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> NUM_V_VECS_PER_ROW = BLOCK_SIZE / V_VEC_SIZE;</span><br><span class="line"><span class="comment">// è¿™é‡Œå°±æ˜¯ WARP_SIZE</span></span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> NUM_ROWS_PER_ITER = WARP_SIZE / NUM_V_VECS_PER_ROW;</span><br><span class="line"><span class="comment">// æ‹†åˆ† HEAD_SIZE åˆ°æ¯ä¸ªçº¿ç¨‹ä¸Š</span></span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> NUM_ROWS_PER_THREAD = <span class="built_in">DIVIDE_ROUND_UP</span>(HEAD_SIZE, NUM_ROWS_PER_ITER);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// accs æ˜¯æœ€åè®¡ç®—çš„ç»“æœï¼Œä¼šèµ‹å€¼ç»™è¿”å›å˜é‡ã€‚</span></span><br><span class="line"><span class="comment">// è¿™é‡Œç”¨ä¸€ç»´å®ç°ï¼Œé‚£ä¹ˆå…¶å¤§å°åº”è¯¥ &gt;= n_seq * n_head * head_size</span></span><br><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆå¯ä»¥å¤§äºï¼Ÿå› ä¸ºæœ‰ blockï¼Œå…è®¸ä¸€å®šçš„å†—ä½™</span></span><br><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆæ˜¯ä¸€ç»´ï¼Ÿn_seq è¢«æ•´åˆæˆäº†ä¸€ä¸ªï¼Œn_head * head_size è¢«æ‹†åˆ†åˆ°äº†å„ä¸ªçº¿ç¨‹ä¸­ï¼ˆç®€å•ç†è§£ä¸ºæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥å®é™…æ˜¯ä¸¤ä¸ªç»´åº¦ï¼‰ï¼Œæœ€åéœ€è¦æ‹†æ±‡æ€»ï¼Ÿ</span></span><br><span class="line">  <span class="type">float</span> accs[NUM_ROWS_PER_THREAD];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS_PER_THREAD; i++) &#123;</span><br><span class="line">    accs[i] = <span class="number">0.f</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="type">scalar_t</span> zero_value;</span><br><span class="line">  <span class="built_in">zero</span>(zero_value);</span><br><span class="line"><span class="comment">// åŒä¸Šï¼Œå–æ¯ä¸ª block ä¸­çš„ v å€¼ï¼Œä»¥åŠå–å‡º q*k çš„ç»“æœ logits</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> block_idx = start_block_idx + warp_idx; block_idx &lt; end_block_idx; block_idx += NUM_WARPS) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int64_t</span> physical_block_number = <span class="built_in">static_cast</span>&lt;<span class="type">int64_t</span>&gt;(block_table[block_idx]);</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> physical_block_offset = (lane % NUM_V_VECS_PER_ROW) * V_VEC_SIZE;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> token_idx = block_idx * BLOCK_SIZE + physical_block_offset;</span><br><span class="line">    L_vec logits_vec;</span><br><span class="line"><span class="comment">// å–å‡ºæ¯ä¸ªå¥å­çš„ logits</span></span><br><span class="line">    <span class="built_in">from_float</span>(logits_vec, *<span class="built_in">reinterpret_cast</span>&lt;Float_L_vec*&gt;(logits + token_idx - start_token_idx));</span><br><span class="line"><span class="comment">// æ‹¿åˆ° v çš„æŒ‡é’ˆï¼Œæ ¹æ®æŒ‡é’ˆå–å€¼</span></span><br><span class="line">    <span class="type">const</span> <span class="type">scalar_t</span>* v_ptr = v_cache + physical_block_number * kv_block_stride</span><br><span class="line">                                    + kv_head_idx * kv_head_stride;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS_PER_THREAD; i++) &#123;</span><br><span class="line">      <span class="type">const</span> <span class="type">int</span> row_idx = lane / NUM_V_VECS_PER_ROW + i * NUM_ROWS_PER_ITER;</span><br><span class="line">      <span class="keyword">if</span> (row_idx &lt; HEAD_SIZE) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> offset = row_idx * BLOCK_SIZE + physical_block_offset;</span><br><span class="line"><span class="comment">// æ‹¿åˆ° v çš„å€¼</span></span><br><span class="line">        V_vec v_vec = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> V_vec*&gt;(v_ptr + offset);</span><br><span class="line">        <span class="keyword">if</span> (block_idx == num_context_blocks - <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="type">scalar_t</span>* v_vec_ptr = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">scalar_t</span>*&gt;(&amp;v_vec);</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; V_VEC_SIZE; j++) &#123;</span><br><span class="line"><span class="comment">// é¿å… nan å€¼ï¼Œç½® 0 å¤„ç†</span></span><br><span class="line">            v_vec_ptr[j] = token_idx + j &lt; context_len ? v_vec_ptr[j] : zero_value;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// è®¡ç®—ç¬¬äºŒä¸ªçŸ©é˜µä¹˜æ³•</span></span><br><span class="line">        accs[i] += <span class="built_in">dot</span>(logits_vec, v_vec);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ¯ä¸ªçº¿ç¨‹è¿›è¡Œæ±‚å’Œï¼Œæ±‡æ€»è‡³ accs</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS_PER_THREAD; i++) &#123;</span><br><span class="line">    <span class="type">float</span> acc = accs[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> mask = NUM_V_VECS_PER_ROW / <span class="number">2</span>; mask &gt;= <span class="number">1</span>; mask /= <span class="number">2</span>) &#123;</span><br><span class="line">      acc += __shfl_xor_sync(<span class="built_in">uint32_t</span>(<span class="number">-1</span>), acc, mask);</span><br><span class="line">    &#125;</span><br><span class="line">    accs[i] = acc;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">... # ä¸­é—´ä¸€äº›å¤„ç†é€»è¾‘</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å°† accs çš„ç»“æœï¼Œè¿˜åŸè‡³è¿”å› out ä¸­ï¼ˆout_ptr æ˜¯å®ƒçš„æŒ‡é’ˆï¼‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> unroll</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS_PER_THREAD; i++) &#123;</span><br><span class="line">      <span class="type">const</span> <span class="type">int</span> row_idx = lane / NUM_V_VECS_PER_ROW + i * NUM_ROWS_PER_ITER;</span><br><span class="line">      <span class="keyword">if</span> (row_idx &lt; HEAD_SIZE &amp;&amp; lane % NUM_V_VECS_PER_ROW == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">from_float</span>(*(out_ptr + row_idx), accs[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="next-step">Next Step</h2>
<p>å¯¹äºç›®å‰çš„ LLM æ¥è¯´ï¼Œä¸€ç§å¹¿æ³›åº”ç”¨çš„åœºæ™¯ä¼šå›ºå®šè‹¥å¹²ä¸ª System
Messageï¼Œç›¸å½“äº Prompt æ˜¯é‡å¤çš„ã€‚ä½†æ¯æ¬¡ç”Ÿæˆï¼Œéƒ½éœ€è¦é‡æ–°è®¡ç®—æ¯ä¸ª System
Message çš„ kv cacheã€‚å› æ­¤ï¼Œè¿™ä¸€æ­¥æ˜¯å¯ä»¥ä¼˜åŒ–çš„ã€‚vLLM
åœ¨è®ºæ–‡ä¸­æåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†ç›®å‰ vLLM å°šæœªå®ç°ã€‚</p>
<h3 id="system-message-é¢„ç”Ÿæˆ-kv-cache">System Message é¢„ç”Ÿæˆ kv
cache</h3>
<p>å¯ä»¥å…ˆç»™å®šè‹¥å¹² System Messageï¼Œè®¡ç®—å¥½ kv
cacheï¼Œä»¥å­—å…¸çš„å½¢å¼å­˜å‚¨ã€‚åœ¨è¯·æ±‚æ—¶ï¼Œå¸¦ä¸Šæ ‡è¯†ç¬¦ï¼Œåœ¨å­—å…¸ä¸­æ‰¾åˆ°å¯¹åº”çš„ kv
cacheï¼Œåœ¨ç”Ÿæˆæ—¶ç›´æ¥æ‹¼ä¸Šï¼Œè€Œä¸è®¡ç®—è¿™ä¸€éƒ¨åˆ†çš„ kv cacheã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/vllm_pageattention/annimation2.gif" /></p>
<h3 id="ç­–ç•¥èµ‹å€¼æ›´æ–°-kv-cache">ç­–ç•¥èµ‹å€¼æ›´æ–° kv cache</h3>
<p>ä»¥å·¥å…·è°ƒç”¨ä¸ºä¾‹ï¼Œå¯ä»¥é¢„å…ˆç”Ÿæˆå·¥å…·è°ƒç”¨ç»“æœçš„æ‰€æœ‰ token çš„ kv
cacheï¼ŒåŠ é€Ÿç”Ÿæˆã€‚</p>
<ol type="1">
<li>åœ¨å®ç° multi token attention çš„åŸºç¡€ä¸Š</li>
<li>è°ƒåº¦å¤„ç†</li>
</ol>
<p>å¯¹äºè¿™ä¸¤ç§éƒ½ä¾èµ–äº multi token attentionï¼Œè€Œè¿™ä¸€ä¸ª vLLM æ˜¯ç›´æ¥è°ƒç”¨
xformers çš„ xops.memory_efficient_attention_forward
å®ç°çš„ã€‚è¿™ç§æ–¹å¼å½“å‰åªèƒ½åœ¨ç¬¬ä¸€æ¬¡ç”Ÿæˆæ—¶ä½¿ç”¨ï¼Œæ²¡æ³•æ‹¼æ¥ï¼Ÿ</p>
<ul>
<li>æ¯”å¦‚æ€»å…± 10 ä¸ª prompt tokenï¼Œç°åœ¨ä¸€æ¬¡æ€§ç”Ÿæˆ 10 ä¸ª token çš„ kv
cacheã€‚æœŸæœ›åˆ†ä¸¤æ¬¡å„ç”Ÿæˆå‰ 5 ä¸ªå’Œå 5 ä¸ªçš„ tokenï¼Œå°† kv cache
æ‹¼èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æœä¸ä¸€è‡´</li>
</ul>
<p>ç›¸å…³æ–‡ç« ï¼š<a href="#">Post not found: PyTorch/pytorch_cpp_extension.md</a></p>
<p>xops.memory_efficient_attention_forward å­¦ä¹ </p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>NLP</tag>
        <tag>Attention</tag>
        <tag>vLLM</tag>
      </tags>
  </entry>
  <entry>
    <title>äº§å“è¯„è®ºæ•°æ®æƒ…æ„Ÿåˆ†æï¼šä»æ–‡æœ¬è¯„è®ºé¢„å¤„ç†åˆ°æ¨¡å‹æ„å»º</title>
    <url>/hexo_blog/2018/08/18/%E4%BA%A7%E5%93%81%E8%AF%84%E8%AE%BA%E6%95%B0%E6%8D%AE%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>NLPå¤„ç†é—®é¢˜çš„æ¡†å›¾ï¼ˆçŸ¥è¯†ç‚¹ï¼‰ã€‚To Be Continueï¼</p>
<span id="more"></span>
<h1 id="äº§å“è¯„è®ºæ•°æ®æƒ…æ„Ÿåˆ†æ">äº§å“è¯„è®ºæ•°æ®æƒ…æ„Ÿåˆ†æ</h1>
<h2 id="æ•°æ®è·å–">æ•°æ®è·å–</h2>
<h2 id="æ–‡æœ¬è¯„è®ºé¢„å¤„ç†">æ–‡æœ¬è¯„è®ºé¢„å¤„ç†</h2>
<h4 id="ç¼–ç é—®é¢˜å¯é€‰">ç¼–ç é—®é¢˜ï¼ˆå¯é€‰ï¼‰</h4>
<h4 id="æ–‡æœ¬å»é‡">æ–‡æœ¬å»é‡</h4>
<h6 id="åŸºæœ¬è§£é‡Š">åŸºæœ¬è§£é‡Š</h6>
<p>å¤§é‡é‡å¤ä¸”æ— å®é™…æ„ä¹‰çš„æ•°æ®ï¼Œéœ€è¦åˆ é™¤</p>
<h6 id="ç®—æ³•">ç®—æ³•</h6>
<p>ç¼–è¾‘è·ç¦»å»é‡
è®¡ç®—ä¸¤æ¡è¯­æ–™çš„ç¼–è¾‘è·ç¦»ï¼Œä¸é˜ˆå€¼ï¼ˆæå‰è®¾å®šå¥½çš„ä¸€ä¸ªå€¼ï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œå°äºé˜ˆå€¼å°±è¿›è¡Œå»é‡
ä¼˜ç‚¹ï¼šæœ‰æ•ˆå»é™¤äº†æ¥è¿‘é‡å¤æˆ–å®Œå…¨é‡å¤çš„æ•°æ®
ç¼ºç‚¹ï¼šé”™åˆ è¯­ä¹‰ç›¸è¿‘çš„è¯­æ–™ï¼Œä¸¤å¥è¯è™½ç„¶ç›¸ä¼¼ä½†å¹¶ä¸éœ€è¦åˆ é™¤ã€‚ç”±äºé˜ˆå€¼è®¾å®šçš„åŸå› å¯èƒ½ä¼šé”™åˆ ã€‚
Simhashç®—æ³•å»é‡ k-shingleç®—æ³•(ç”¨çš„ä¸å¤š) Minhashç®—æ³•</p>
<h6 id="é€‰ç”¨çš„æ–¹æ³•">é€‰ç”¨çš„æ–¹æ³•</h6>
<p>æœ€ç®€å•ç²—æš´ï¼šå®Œå…¨é‡å¤çš„è¯­æ–™è¿›è¡Œå‰”é™¤ã€‚è§ <code>programmer_2</code></p>
<h4 id="æœºæ¢°å‹ç¼©å»è¯">æœºæ¢°å‹ç¼©å»è¯</h4>
<h6 id="åŸºæœ¬è§£é‡Š-1">åŸºæœ¬è§£é‡Š</h6>
<p>ç»è¿‡ä¸Šé¢çš„å¤„ç†ä¹‹åï¼Œè¿˜æœ‰è¿™æ ·ä¸€éƒ¨åˆ†æ•°æ®å¹¶æ²¡æœ‰å»é™¤ã€‚å¦‚"å¥½çš„å¥½çš„å¥½çš„å¥½çš„å¥½çš„å¥½çš„å¥½çš„å¥½çš„å¥½çš„"#
æˆ‘ä»¬ç§°ä¹‹ä¸ºè¿ç»­é‡å¤è¯­æ–™ï¼Œæœ€å¸¸è§çš„è¾ƒé•¿çš„æ— æ„ä¹‰è¯­æ–™ã€‚</p>
<h6 id="å¤„ç†æ–¹æ³•">å¤„ç†æ–¹æ³•</h6>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé‡å¤è¯å¸¦æœ‰ä¸€å®šçš„æƒ…æ„Ÿå€¾å‘ï¼Œå¦‚æœç›´æ¥è¿›è¡Œå¤„ç†ï¼Œä¼šå½±å“æƒ…æ„Ÿå€¾å‘çš„åˆ¤æ–­ã€‚
æ‰€ä»¥è¿™é‡Œéœ€è¦å¯¹è¯­æ–™è¿›è¡Œæœºæ¢°å‹ç¼©å»è¯å¤„ç†ï¼Œå»é™¤ä¸€äº›è¿ç»­ç´¯èµ˜çš„è¡¨è¾¾ï¼ˆä¸å½±å“æƒ…æ„Ÿï¼‰ã€‚æ¯”å¦‚ä¸Šé¢çš„å¥å­ï¼Œå‹ç¼©ä¸º"å¥½çš„"
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ç§è¯æ±‡å¸¸å‡ºç°åœ¨å¼€å¤´æˆ–è€…ç»“å°¾ã€‚è¯­æ–™ä¸­é—´çš„é‡å¤è¯æ±‡å¯èƒ½å…·æœ‰å®é™…æ„ä¹‰æ¯”å¦‚"æ»”æ»”ä¸ç»"ä¸­çš„æ»”æ»”æ˜¯å…·æœ‰å®é™…æ„ä¹‰çš„ã€‚å› æ­¤åªå¯¹å¼€å¤´ä¸ç»“å°¾çš„è¿ç»­é‡å¤è¯è¿›è¡Œæ“ä½œã€‚</p>
<h6 id="è®¾å®šè§„åˆ™">è®¾å®šè§„åˆ™</h6>
<p>è€ƒè™‘å› ç´ ï¼šè¯æ³•ç»“æ„ã€æ–‡å­—è¡¨è¾¾ç‰¹ç‚¹ ä¸ƒä¸ªè§„åˆ™</p>
<h4 id="çŸ­å¥åˆ é™¤">çŸ­å¥åˆ é™¤</h4>
<h6
id="å­—æ•°è¶Šå°‘è¡¨è¾¾çš„æ„æ€å°±å°‘æ‰€ä»¥éœ€è¦è¿‡æ»¤æ‰è¿‡çŸ­çš„è¯„è®ºæ–‡æœ¬æ•°æ®">å­—æ•°è¶Šå°‘è¡¨è¾¾çš„æ„æ€å°±å°‘ï¼Œæ‰€ä»¥éœ€è¦è¿‡æ»¤æ‰è¿‡çŸ­çš„è¯„è®ºæ–‡æœ¬æ•°æ®ã€‚</h6>
<h2 id="æ–‡æœ¬è¯„è®ºåˆ†è¯">æ–‡æœ¬è¯„è®ºåˆ†è¯</h2>
<h4 id="åˆ†è¯ä»‹ç»">åˆ†è¯ä»‹ç»</h4>
<h6 id="pythonåº“jieba">pythonåº“ï¼šjieba</h6>
<h6 id="å¼•å…¥åœç”¨è¯">å¼•å…¥åœç”¨è¯</h6>
<h6 id="ç‰¹å¾å¤„ç†">ç‰¹å¾å¤„ç†</h6>
<h6 id="ä¸­æ–‡åˆ†è¯æ–¹æ³•">ä¸­æ–‡åˆ†è¯æ–¹æ³•</h6>
<p>åŸºäºè§„åˆ™çš„åˆ†è¯æ–¹æ³• åŸºäºç»Ÿè®¡çš„åˆ†è¯æ–¹æ³• åŸºäºè¯­ä¹‰çš„åˆ†è¯æ–¹æ³•
åŸºäºç†è§£çš„åˆ†è¯æ–¹æ³•</p>
<h2 id="æ¨¡å‹æ„å»º">æ¨¡å‹æ„å»º</h2>
<h4 id="æƒ…æ„Ÿå€¾å‘æ€§æ¨¡å‹">æƒ…æ„Ÿå€¾å‘æ€§æ¨¡å‹</h4>
<h6 id="è®­ç»ƒç”Ÿæˆè¯å‘é‡">è®­ç»ƒç”Ÿæˆè¯å‘é‡</h6>
<p>One-hot# Representation Distributed# Representation word2vec</p>
<h6 id="äººå·¥æ ‡æ³¨ä¸æ˜ å°„">äººå·¥æ ‡æ³¨ä¸æ˜ å°„</h6>
<p>snownlp</p>
<h6 id="è®­ç»ƒæ¨¡å‹">è®­ç»ƒæ¨¡å‹</h6>
<p>æ ˆå¼è‡ªç¼–ç ç½‘ç»œ åŸºæœ¬ä»‹ç»</p>
<h4 id="è¯­ä¹‰ç½‘ç»œåˆ†æ">è¯­ä¹‰ç½‘ç»œåˆ†æ</h4>
<h6 id="è¯­ä¹‰ç½‘ç»œ">è¯­ä¹‰ç½‘ç»œ</h6>
<p>ä»‹ç» æ­¥éª¤ ä¼˜åŠ¿</p>
<h4 id="æ¨¡å‹é€‰æ‹©">æ¨¡å‹é€‰æ‹©</h4>
<h6 id="ldaæ¨¡å‹çš„ä¸»é¢˜åˆ†æ">LDAæ¨¡å‹çš„ä¸»é¢˜åˆ†æ</h6>
<p>æ¨¡å‹ä»‹ç» Bag Of Wordsï¼ˆBOWï¼Œè¯è¢‹æ¨¡å‹ï¼‰ æ¨¡å‹ä¼°è®¡ å®ç°è¿‡ç¨‹
æ‹“å±•ï¼šILDA</p>
<h6 id="vsmä¸tf-idf">VSMä¸TF-IDF</h6>
<h6 id="svdä¸lsa">SVDä¸LSA</h6>
<h6 id="plsaä¸lda">PLSAä¸LDA</h6>
<h4 id="æ„å»ºæ¨¡å‹">æ„å»ºæ¨¡å‹</h4>
<h6 id="svm-rbf-pca">SVM (RBF) + PCA</h6>
<h6 id="subtopic">Subtopic</h6>
<h2 id="æ¨¡å‹è¯„ä»·">æ¨¡å‹è¯„ä»·</h2>
<h4 id="åº”ç”¨å±‚æ¬¡åˆ†ææ³•">åº”ç”¨å±‚æ¬¡åˆ†ææ³•</h4>
<h4 id="æ¨¡ç³Šç»¼åˆè¯„ä»·">æ¨¡ç³Šç»¼åˆè¯„ä»·</h4>
]]></content>
      <categories>
        <category>NLP</category>
      </categories>
      <tags>
        <tag>æ•°æ®åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹´åº¦æ¨èè½¯ä»¶Tailscaleï¼šè¿æ¥å›¢é˜Ÿè®¾å¤‡å’Œå¼€å‘ç¯å¢ƒçš„åˆ©å™¨</title>
    <url>/hexo_blog/2023/04/03/%E5%B9%B4%E5%BA%A6%E6%8E%A8%E8%8D%90%E8%BD%AF%E4%BB%B6Tailscale/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»äº† Tailscale
è¿™æ¬¾è½¯ä»¶å¯ä»¥è½»æ¾æ¶è®¾å¼‚åœ°ç»„ç½‘ï¼Œè§£å†³è°ƒè¯•éš¾é¢˜ã€å®ç°æµé‡è½¬å‘å’Œå¼€æ”¾æœåŠ¡ç­‰å¤šä¸ªéœ€æ±‚ã€‚</p>
<span id="more"></span>
<p><a href="https://tailscale.com/">Tailscale</a> connects your team's
devices and development environments for easy access to remote
resources. ï¼ˆæ‘˜è‡ªå®˜ç½‘ï¼‰</p>
<p>äºç¬”è€…è€Œè¨€ï¼ŒTailscale èƒ½å¤Ÿç”¨ä¸€ä¸ªè½¯ä»¶è½»æ¾çš„è§£å†³ä¸‰å¤§éœ€æ±‚ã€‚</p>
<ul>
<li>å¼‚åœ°ç»„ç½‘ï¼šè½¯ä»¶ä¸»æ‰“åŠŸèƒ½ã€‚å°±æ˜¯å°†ç‰©ç†ä½ç½®ä¸åŒçš„æœºå™¨é€šè¿‡è¯¥è½¯ä»¶ï¼Œèƒ½å¤Ÿä½¿å®ƒä»¬å¤„äºåŒä¸€ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæ–¹ä¾¿è¿œç¨‹è°ƒè¯•ã€‚</li>
<li>æµé‡è½¬å‘ï¼šAæœºå™¨åœ¨Aåœ°ï¼Œå¯ä»¥å€ŸåŠ©Bæœºå™¨åœ¨Båœ°çš„ç½‘ç»œè¿›è¡Œä¸Šç½‘ã€‚</li>
<li>å¼€æ”¾æœåŠ¡ï¼šAæœºå™¨è‡ªå»ºWebæœåŠ¡ï¼Œä¸ä»…å¯ä»¥åœ¨ç»„ç½‘ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œç”šè‡³å®˜æ–¹æä¾›äº†å…¬ç½‘çš„é“¾æ¥ï¼ˆhttpsï¼‰ï¼Œå³å¯ä»¥ä¸åœ¨ç»„ç½‘ç¯å¢ƒä¸‹ä¹Ÿèƒ½å¤Ÿè®¿é—®ã€‚</li>
</ul>
<p>å†™åœ¨å¼€å¤´ï¼Œå…è´¹ç‰ˆçš„æƒç›Šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ”¯æŒ20ä¸ªè®¾å¤‡ï¼Œä¸”åŸŸåä¸å¯è‡ªå®šä¹‰ï¼ˆå­åŸŸåå¯ä»¥ï¼‰ï¼Œé€Ÿåº¦åœ¨100-300k/så·¦å³ã€‚åœ¨Androidå’ŒiOSè®¾å¤‡ä¸Šä¸æ”¯æŒåŒæ—¶å¼€å¯ä¸¤ä¸ª
VPNï¼Œå³ Clash æ— æ³•å’Œ Tailscale åŒæ—¶ä½¿ç”¨ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/1680514288836.png" /></p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>é¦–å…ˆéœ€è¦åœ¨å®˜ç½‘è¿›è¡Œæ³¨å†Œï¼Œå€¼å¾—ä¸€æçš„æ˜¯æ³¨å†Œæ–¹å¼æœ€å¥½é€‰ç”¨èƒ½å¤Ÿåœ¨æ—¥å¸¸ç½‘ç»œç¯å¢ƒä¸‹èƒ½æ‰“å¼€çš„è´¦å·ã€‚æ¯”å¦‚é€‰ç”¨Githubæ³¨å†Œçš„è¯ï¼Œä¹‹åæ‰€æœ‰çš„è®¾å¤‡éƒ½éœ€è¦ä½¿ç”¨Githubç™»å½•æ‰èƒ½ç»„ç½‘ã€‚å…¶ç›®å‰æ— æ³•åœ¨ä¸€ä¸ªè´¦å·ä¸Šç»‘å®šå¤šç§ç™»å½•æ–¹å¼ã€‚</p>
<p>å®˜ç½‘æä¾›äº†è¯¦å°½çš„<a
href="https://tailscale.com/download">ä¸‹è½½</a>å®‰è£…è¯´æ˜ï¼Œç§»åŠ¨ç«¯å¯ä»¥ç›´æ¥ä¸‹è½½å¯¹åº”çš„Appï¼Œä¸ªäººç”µè„‘å’ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å¸¸è§„çš„å‘½ä»¤å’Œè½¯ä»¶åŒ…çš„æ–¹å¼è¿›è¡Œä¸‹è½½å®‰è£…ã€‚æ•…å¯¹äºä¸€èˆ¬çš„æœºå™¨ä¸åšä»‹ç»ï¼Œæœ¬èŠ‚ä¸»è¦ä»‹ç»è·¯ç”±å™¨ã€æ ‘è“æ´¾ã€ç¾¤æ™–çš„å®‰è£…æ–¹æ³•ã€‚å…¶ä»–æœºå‹ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a
href="https://pkgs.tailscale.com/stable/">åœ°å€</a>ã€‚</p>
<p>å¯¹äºLinuxè®¾å¤‡ï¼Œå®‰è£…æ­¥éª¤ä¸»è¦åˆ†ä¸¤æ­¥ï¼š</p>
<ol type="1">
<li>å¯åŠ¨æœåŠ¡ï¼Œ<code>sudo tailscale up</code></li>
<li>åŠ å…¥ç»„ç½‘ï¼Œ<code>tailscale ip -4</code></li>
</ol>
<p>å¯¹äºç¬¬äºŒæ­¥ï¼Œè¾“å…¥å®Œæˆåä¼šæœ‰ä¸€ä¸ªé“¾æ¥éœ€è¦ä½¿ç”¨å¯¹åº”è´¦å·è¿›è¡Œç™»å½•ï¼Œå¯ä»¥å°†é“¾æ¥å¤åˆ¶åˆ°å…¶ä»–è®¾å¤‡ç”¨æµè§ˆå™¨æ‰“å¼€ç™»å½•ã€‚åœ¨éå¸¸è§„æœºå™¨ä¸Šï¼Œé¦–å…ˆéœ€è¦ç¡®è®¤æœºå™¨çš„CPUæ¶æ„ï¼Œå‘½ä»¤
<code>uname -a</code>ã€‚</p>
<h3 id="ç¾¤æ™–">ç¾¤æ™–</h3>
<p>ç¾¤æ™–çš„<a
href="https://pkgs.tailscale.com/stable/#spks">ä¸‹è½½åœ°å€</a>ï¼Œéœ€è¦æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬ä»¥åŠCPUæ¶æ„é€‰æ‹©ä¸‹è½½ã€‚ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€ç¾¤æ™–çš„<strong>å¥—ä»¶ä¸­å¿ƒ</strong>ï¼Œå³ä¸Šè§’çš„<strong>æ‰‹åŠ¨å®‰è£…</strong>ï¼Œä¸Šä¼ å®‰è£…åŒ…ï¼ŒæŒ‰ç…§æ­¥éª¤å®Œæˆå®‰è£…å³å¯ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/170356.png" /></p>
<p>å®‰è£…å®Œæˆåï¼Œç‚¹å‡»å¯¹åº”çš„å›¾æ ‡ï¼Œå®‰è£…å¯¹åº”çš„æ­¥éª¤å³å¯å¯åŠ¨ã€‚</p>
<h3 id="è·¯ç”±å™¨">è·¯ç”±å™¨</h3>
<p>è·¯ç”±å™¨çš„<a
href="https://pkgs.tailscale.com/stable/#static">ä¸‹è½½åœ°å€</a>ï¼Œæ ¹æ®CPUæ¶æ„é€‰æ‹©ä¸‹è½½ã€‚å¹¶å°†å®‰è£…åŒ…ä¸Šä¼ è‡³è·¯ç”±å™¨ï¼Œæ ¹æ®å¯¹åº”çš„è·¯ç”±å™¨å®‰è£…å‘½ä»¤è¿›è¡Œè§£å‹å®‰è£…ã€‚</p>
<h3 id="æ ‘è“æ´¾">æ ‘è“æ´¾</h3>
<p>æ ‘è“æ´¾çš„<a
href="https://pkgs.tailscale.com/stable/#raspbian-stretch">ä¸‹è½½åœ°å€</a>ï¼Œæ ¹æ®å‹å·ä¸‰é€‰ä¸€ä¸‹è½½ã€‚è§£å‹å®‰è£…ã€‚æ ‘è“æ´¾Zeroçš„æ˜¯Raspbian
Stretch</p>
<h2 id="å¼‚åœ°ç»„ç½‘">å¼‚åœ°ç»„ç½‘</h2>
<p>å½“è®¾å¤‡å®‰è£…å®Œæˆï¼Œå¹¶ç™»å½•åï¼Œè¯¥è®¾å¤‡ä¼šè‡ªåŠ¨åŠ å…¥ç»„ç½‘ã€‚å¯ä»¥åœ¨<a
href="https://login.tailscale.com/admin/machines">è®¾å¤‡ç®¡ç†</a>ç•Œé¢æŸ¥çœ‹æ‰€æœ‰çš„è®¾å¤‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/171953.png" /></p>
<p>ç¬¬ä¸€åˆ—çš„è®¾å¤‡åç§°å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½è¿›è¡Œæ›´æ”¹ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½œä¸ºåŸŸåä½¿ç”¨ã€‚å‡è®¾æœ‰ä¸ªæœºå™¨å«åšAAAä¸”ç”¨æˆ·åä¸ºrootï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥
<code>ssh root@AAA</code>è¿›è¡Œç™»å½•ã€‚æˆ–è€…ç¾¤æ™–åä¸ºAAAï¼Œé‚£ä¹ˆæµè§ˆå™¨ç›´æ¥æ‰“å¼€AAAå°±èƒ½è®¿é—®ã€‚</p>
<p>ç™»å½•çš„è®¾å¤‡é»˜è®¤æ˜¯è‹¥å¹²å¤©ï¼ˆæœ€é•¿180ï¼‰åéœ€è¦é‡æ–°ç™»å½•ä¸€æ¬¡ï¼Œå¯ä»¥åœ¨æœ€åä¸€åˆ—ä¸‰ä¸ªç‚¹è¿›è¡Œç¼–è¾‘ï¼Œå¯¹è¯¥åŠŸèƒ½è¿›è¡Œç¦ç”¨ã€‚ç¦ç”¨æˆåŠŸåï¼Œä¼šåœ¨ç¬¬ä¸€åˆ—æ˜¾ç¤º
<code>Expiry disabled</code></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/172831.png" /></p>
<h2 id="æµé‡è½¬å‘">æµé‡è½¬å‘</h2>
<p>æœ¬èŠ‚å‚è€ƒ<a href="https://tailscale.com/kb/1019/subnets/">æ–‡æ¡£</a></p>
<p>æ­£å¦‚å¼€å¤´çš„å›¾æ˜¾ç¤ºçš„ï¼Œè¯¥åŠŸèƒ½ä»…æ”¯æŒä»¥ä¸€ä¸ªè®¾å¤‡ä½œä¸ºæµé‡å‡ºå£ã€‚å½“æœ‰ä¸€ä¸ªå±€åŸŸç½‘çš„æ‰€æœ‰è®¾å¤‡ä¸æ–¹ä¾¿æ¥å…¥ç»„ç½‘æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¥å…¥è¯¥å±€åŸŸç½‘çš„ä¸€ä¸ªè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰ï¼Œå†è®¿é—®è¯¥å±€åŸŸç½‘çš„å…¶ä»–è®¾å¤‡ã€‚å¦‚ä¸‹å›¾ï¼Œ<code>Subnet Router</code>ç›¸å½“äºæ¡¥æ¢ï¼Œæ‰¿æ¥äº†ç»„ç½‘å’Œæœ¬åœ°ç»„ç½‘ã€‚ç»„ç½‘å†…çš„è®¾å¤‡å¯ä»¥é€šè¿‡Routerè®¿é—®å±€åŸŸç½‘å†…çš„è®¾å¤‡ï¼Œåä¹‹äº¦å¯ã€‚æ¥ä¸‹æ¥åœ¨
<code>Router</code>è®¾å¤‡ä¸Šæ“ä½œã€‚</p>
<p><img src="https://tailscale.com/kb/1019/subnets/subnets.png" /></p>
<h3 id="step-1">Step 1</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯ç«¯å£è½¬å‘ã€‚æœ‰çš„æœºå™¨å¯èƒ½é»˜è®¤å¼€å¯ï¼Œæ— éœ€æ“ä½œã€‚</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.ip_forward = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv6.conf.all.forwarding = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">sudo</span> sysctl -p /etc/sysctl.d/99-tailscale.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºSubnetï¼Œ192.168.x.yå¯ä»¥æ¢æˆ10.0è¿™ç§ã€‚å¯ä»¥åªå†™ä¸€ä¸ªï¼Œx.yæ›¿æ¢ä»»æ„æ•°å­—</span></span><br><span class="line"><span class="built_in">sudo</span> tailscale up --advertise-routes=192.168.x.y/24,192.168.x.z/24</span><br></pre></td></tr></table></figure>
<h3 id="step-2">Step 2</h3>
<p>åœ¨æœºå™¨ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»å¯¹åº”æœºå™¨çš„å³ä¾§ä¸‰ä¸ªç‚¹ï¼Œå†ç‚¹å‡»
<code>Edit route settings</code>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªåŠŸèƒ½å‡å¼€å¯ã€‚è‹¥ä»…éœ€å®ç°è®¾å¤‡è®¿é—®ï¼Œä¸éœ€è¦æµé‡è½¬å‘ï¼Œåˆ™å¯ä»¥ä¸å¼€å¯ç¬¬äºŒä¸ªã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/1680522033220.png" /></p>
<h3 id="step-3">Step 3</h3>
<p>è‡ªæ­¤ï¼Œå®Œæˆäº†æ¡¥æ¥å±€åŸŸç½‘å’Œç»„ç½‘çš„åŠŸèƒ½ã€‚è¦å®ç°æµé‡è½¬å‘ï¼Œåœ¨Tailscaleä¸­å«åšExit
Nodeã€‚ä¸€æ–¹é¢éœ€è¦åœ¨ä¸Šä¸€æ­¥å¼€å¯ç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œæ­¤æ—¶Routerå°±å…·å¤‡äº†ä½œä¸ºæµé‡å‡ºå£çš„èƒ½åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼Œå‡è®¾æ­¤æ—¶ç»„ç½‘å†…çš„Aè®¾å¤‡éœ€è¦å€ŸåŠ©Routerçš„æµé‡å‡ºå£ï¼Œå°±éœ€è¦åœ¨Aè®¾å¤‡ä¸Šè¿›è¡Œæ“ä½œã€‚</p>
<p>åœ¨Routerè®¾å¤‡ä¸Šï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºSubnetï¼Œ192.168.x.yå¯ä»¥æ¢æˆ10.0è¿™ç§ã€‚å¯ä»¥åªå†™ä¸€ä¸ªï¼Œx.yæ›¿æ¢ä»»æ„æ•°å­—</span></span><br><span class="line"><span class="built_in">sudo</span> tailscale up --advertise-exit-node --advertise-routes=192.168.x.y/24</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æœ‰å›¾å½¢åŒ–ç•Œé¢çš„æœºå™¨ï¼Œå¯ä»¥ç›´æ¥åœ¨è½¯ä»¶å±‚é¢å®Œæˆã€‚å¦‚Windowsï¼Œæ­¤æ—¶ç³»ç»Ÿçš„æ‰€æœ‰æµé‡å‡ä¸ºèµ°è¿™ä¸ªæ¥å£ã€‚</p>
<p><strong>Windows</strong> <img
src="https://tailscale.com/kb/1103/exit-nodes/exit-node-windows-menu.png" /></p>
<p><strong>Linux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up --exit-node=&lt;exit-node-ip&gt;</span><br></pre></td></tr></table></figure>
<p>è¯¥åŠŸèƒ½ä¸»è¦çš„ç”¨é€”æœ‰ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li>æœ¬èŠ‚å¼€å¤´æ‰€æåˆ°çš„ï¼Œé€šè¿‡ä¸€ä¸ªRouterï¼Œä»è€Œæ— éœ€æ‰€æœ‰è®¾å¤‡å‚ä¸é“¾æ¥ã€‚</li>
<li>æµé‡è½¬å‘ï¼Œå¦‚æœæœ‰ä¸€ä¸ªèŠ‚ç‚¹åœ¨æµ·å¤–ã€‚é‚£ä¹ˆå¯ä»¥ä»¥æ­¤æ¥åšè·³æ¿</li>
<li>æœ¬æ–‡å¼€å¤´æ‰€æåˆ°çš„ï¼Œç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•ä¸å…¶ä»–VPNå¹¶å­˜ï¼Œé‚£ä¹ˆæ­¤æ—¶é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåœ¨Routerè®¾å¤‡ä¸Šåšåˆ†æµã€‚</li>
</ul>
<h2 id="å¼€æ”¾æœåŠ¡">å¼€æ”¾æœåŠ¡</h2>
<p>æˆªè‡³æœ¬æ–‡å®Œæˆæ—¥æœŸï¼Œè¯¥åŠŸèƒ½è¿˜åœ¨Betaé˜¶æ®µï¼Œå¹¶ä¸”è¦æ±‚ç‰ˆæœ¬&gt;=1.38.3ã€‚<a
href="https://tailscale.com/kb/1223/tailscale-funnel/">è¯¦ç»†æ–‡æ¡£</a></p>
<h3 id="step-1-1">Step 1</h3>
<p>å¦‚æœä»…éœ€åœ¨ç»„ç½‘å†…è®¿é—®ï¼Œåˆ™å¯ä»¥è·³è¿‡è¯¥æ­¥éª¤ã€‚</p>
<p>åœ¨<a href="https://login.tailscale.com/admin/acls">Access
controls</a>æ§åˆ¶é¡µé¢åŠ å…¥é…ç½®ï¼Œæ–°å¢ <code>nodeAttrs</code>å’Œä¿®æ”¹
<code>groups</code>ï¼Œå…¶ä¸­
<code>wnma3mz@github</code>æ›¿æ¢ä¸ºå¯¹åº”è´¦å·ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/1680523192944.png" />
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/tailscale/1680523204260.png" /></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;groups&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;group:can-funnel&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">     <span class="string">&quot;wnma3mz@github&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;nodeAttrs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">     <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;group:can-funnel&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;attr&quot;</span><span class="punctuation">:</span>   <span class="punctuation">[</span><span class="string">&quot;funnel&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">     <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<h3 id="step-2-1">Step 2</h3>
<p>æ­¤æ—¶ï¼Œéœ€è¦åœ¨Aæœºå™¨ä¸Šå¼€å¯æœåŠ¡ã€‚ç”³è¯·<a
href="https://tailscale.com/kb/1153/enabling-https/">HTTPSè¯ä¹¦</a>ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šæç¤ºåé¢éœ€è¦åŠ å…¥ä»€ä¹ˆåŸŸåã€‚æŒ‰ç…§æç¤ºå¤åˆ¶å†æ‰§è¡Œå³å¯ã€‚å¯èƒ½ä¼šæœ‰ä¸€äº›æŠ¥é”™ï¼Œéœ€è¦æ ¹æ®ä¸åŒæƒ…å†µè¿›è¡Œæ›´æ”¹ã€‚è¯¥åŠŸèƒ½å¯èƒ½ä¼šå½±å“æä¾›å…¬ç½‘æœåŠ¡ï¼Œä½†ä¸å½±å“ç»„ç½‘æœåŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale cert</span><br></pre></td></tr></table></figure>
<p>åœ¨å¼€æ”¾æœåŠ¡å‰æœ‰ä¸¤ä¸ªå‘½ä»¤éœ€è¦è¿›è¡ŒåŒºåˆ†ï¼Œ<code>tailscale serve</code>å’Œ<code>tailscale funnle</code>å‰è€…æ˜¯å¼€æ”¾æœåŠ¡åˆ°ç»„ç½‘ç¯å¢ƒï¼Œåè€…æ˜¯å¼€æ”¾åˆ°æ•´ä¸ªäº’è”ç½‘ç¯å¢ƒã€‚</p>
<p>å¸¸ç”¨æœ‰ä¸¤ä¸ªæŠ€å·§</p>
<ul>
<li>æŠŠå·²ç»å¼€æ”¾æœåŠ¡çš„ç«¯å£è½¬å‘åˆ°å…¶ä»–ç«¯å£ï¼Œæˆ–è€…ä¸»åŸŸåä¸‹ã€‚æ¯”å¦‚è¿™é‡Œå¯ä»¥æŠŠ5000ç«¯å£è½¬å‘åˆ°ä¸»åŸŸåä¸‹çš„/apiè·¯ç”±ä¸‹ï¼Œå³å¯ä»¥é€šè¿‡
<code>http://A/api</code>è®¿é—®Aæœºå™¨çš„5000ç«¯å£æœåŠ¡ã€‚<code>--bg</code>è¡¨ç¤ºåå°è¿è¡Œï¼Œé»˜è®¤æ˜¯åœ¨å‰å°å¯åŠ¨ï¼Œä¾¿äº<code>Ctrl+C</code>å…³é—­ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale serve --<span class="built_in">bg</span> --set-path /api http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>
<p>æŠŠ 4747 ç«¯å£è½¬å‘åˆ° 8443 ç«¯å£ï¼Œå³å¯ä»¥é€šè¿‡
<code>https://A:8443</code>è®¿é—®Aæœºå™¨çš„ 4747 ç«¯å£æœåŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale serve https:8443 / http://localhost:4747</span><br></pre></td></tr></table></figure>
<ul>
<li>éƒ¨ç½²é™æ€æœåŠ¡</li>
</ul>
<p>å‡è®¾æœ¬åœ°æœ‰ä¸€ä¸ª<code>/data/index.html</code>æ–‡ä»¶ï¼Œæƒ³è¦å¼€æ”¾è®¿é—®ã€‚åˆ™è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡<code>http://A/index</code>è®¿é—®Aæœºå™¨çš„<code>/data/index.html</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale serve --<span class="built_in">bg</span> --set-path /index /data/index.html</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ<code>index.html</code>æ–‡ä»¶ç”¨äº†æœ¬æœºå…¶ä»–é™æ€èµ„æºï¼ŒåŒæ ·éœ€è¦è¿›è¡ŒæŒ‚è½½ï¼Œæ¯”å¦‚æŒ‚è½½<code>/data/static</code>æ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale serve --<span class="built_in">bg</span> --set-path /static/ /data/static</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦å…³é—­æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œä»…å…³é—­è¿™ä¸€æ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale serve --<span class="built_in">bg</span> --set-path /api off</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¸Œæœ›æŒ‡å®šç«¯å£ï¼Œåˆ™å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤ï¼Œé»˜è®¤ç«¯å£ä¸º 80ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¸¦ç«¯å£å¼€æ”¾</span></span><br><span class="line">tailscale serve --<span class="built_in">bg</span> --http 10001 --set-path /index /data/index.html</span><br><span class="line"><span class="comment"># å¸¦ç«¯å£å…³é—­</span></span><br><span class="line">tailscale serve --<span class="built_in">bg</span> --http 10001 --set-path /index off</span><br></pre></td></tr></table></figure>
<h3 id="step-3-1">Step 3</h3>
<p>å¯¹å¤–å¼€æ”¾æœåŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šç›´æ¥æŠŠåŸæœ¬ä»…èƒ½åœ¨å±€åŸŸç½‘å†…è®¿é—®çš„æœåŠ¡æä¾›åˆ°å…¬ç½‘ã€‚å®æµ‹ä¸‹è½½é€Ÿåº¦200-300k/sï¼Œæœ‰äº›åœ°æ–¹ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œå¯èƒ½è¦æŒ‚æ¢¯å­ã€‚ç›®å‰
tailscale ä»…æ”¯æŒä¸‰ä¸ªç«¯å£å¯ä»¥duiå¤–å¼€æ”¾ï¼Œåˆ†åˆ«æ˜¯ 443ã€8443ã€10000ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale funnel --<span class="built_in">bg</span> https+insecure://localhost:443</span><br><span class="line">tailscale funnel --<span class="built_in">bg</span> https+insecure://localhost:8443</span><br><span class="line">tailscale funnel --<span class="built_in">bg</span> https+insecure://localhost:10000</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•åŒ <code>serve</code>ï¼Œæ¢æˆ <code>funnel</code> å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€çš„å‘½ä»¤</span></span><br><span class="line">tailscale funnel status</span><br><span class="line"><span class="comment"># å…³é—­çŠ¶æ€çš„å‘½ä»¤</span></span><br><span class="line">tailscale funnel 443 off</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Tailscale</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾…æ•´ç†çš„è„šæœ¬ï¼ˆæŒç»­æ›´æ–°ingï¼‰</title>
    <url>/hexo_blog/2023/11/26/%E5%BE%85%E6%95%B4%E7%90%86%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>è®°å½•ä¸€äº›å¸¸ç”¨/é‡è¦ï¼Œä½†å®¹æ˜“å¿˜è®°çš„å‘½ä»¤</p>
<span id="more"></span>
<h3 id="git-ç»Ÿè®¡ä¸åŒç‰ˆæœ¬çš„æ–‡ä»¶å¤¹ä»£ç è¡Œæ•°">Git
ç»Ÿè®¡ä¸åŒç‰ˆæœ¬çš„æ–‡ä»¶å¤¹ä»£ç è¡Œæ•°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout &lt;commit_id&gt;</span><br><span class="line">find -name <span class="string">&quot;*.py&quot;</span> | xargs <span class="built_in">cat</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<h3 id="git-æ’¤é”€-commit">Git æ’¤é”€ commit</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git revert &lt;commit_id&gt;</span><br></pre></td></tr></table></figure>
<h3 id="git-æ’¤é”€å•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹">Git æ’¤é”€å•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout HEAD -- &lt;æ–‡ä»¶è·¯å¾„&gt;</span><br></pre></td></tr></table></figure>
<h3 id="git-æš‚å­˜">Git æš‚å­˜</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git stash</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure>
<h3 id="grep-æœç´¢æ–‡æœ¬å¹¶æ˜¾ç¤ºæ–‡ä»¶åå’Œè¡Œå·">Grep
æœç´¢æ–‡æœ¬å¹¶æ˜¾ç¤ºæ–‡ä»¶åå’Œè¡Œå·</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -Hn <span class="string">&quot;Hello World!&quot;</span> *</span><br></pre></td></tr></table></figure>
<h3 id="grep-æœç´¢ä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬å¹¶æ˜¾ç¤ºæ–‡ä»¶åå’Œè¡Œå·">Grep
æœç´¢ä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬å¹¶æ˜¾ç¤ºæ–‡ä»¶åå’Œè¡Œå·</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -Hn <span class="string">&quot;Hello World!&quot;</span> * | grep -v <span class="string">&quot;XXX&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="python-æ³¨å†Œå…¨å±€å˜é‡ä»¥åœ¨æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨">Python
æ³¨å†Œå…¨å±€å˜é‡ä»¥åœ¨æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">globals</span>()[<span class="string">&quot;seed&quot;</span>] = <span class="number">42</span></span><br></pre></td></tr></table></figure>
<h3 id="python-åŠ¨æ€ä¿®æ”¹æºç -monkey-patching">Python åŠ¨æ€ä¿®æ”¹æºç  (Monkey
Patching)</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨æºç ä¸­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é¡¹ç›®ä¸­</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_forward</span>(<span class="params">self</span>):</span><br><span class="line">    ...</span><br><span class="line">A.forward = new_forward</span><br></pre></td></tr></table></figure>
<h3 id="wget-ä¸‹è½½æ–‡ä»¶ä¿å­˜ä¸ºæ—¶é—´æˆ³">wget ä¸‹è½½æ–‡ä»¶ï¼Œä¿å­˜ä¸ºæ—¶é—´æˆ³</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O `<span class="built_in">date</span> +%s`.jpg https://www.baidu.com/img/bd_logo1.png</span><br></pre></td></tr></table></figure>
<h3 id="nginx-ç«¯å£è½¬å‘">Nginx ç«¯å£è½¬å‘</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 4747;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    proxy_pass http://x.x.x.x:4747;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="linux-ç»Ÿè®¡å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸ªæ•°">Linux
ç»Ÿè®¡å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸ªæ•°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<h3 id="kill-python-ç›¸å…³è¿›ç¨‹">kill Python ç›¸å…³è¿›ç¨‹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep python | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Note</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ¬ç§‘ç§‘ç ”çš„é‚£äº›äº‹</title>
    <url>/hexo_blog/2018/09/30/%E6%9C%AC%E7%A7%91%E7%A7%91%E7%A0%94%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    <content><![CDATA[<p>æœ¬ç§‘ç§‘ç ”ç»å†ä¸ä»…å¯¹å»ºç«‹äººè„‰ã€æå‡ç®€å†å¾ˆé‡è¦ï¼Œå¯¹å‘ç°å…´è¶£ã€åŸ¹å…»æ‰¹åˆ¤æ€§æ€ç»´èƒ½åŠ›ä¹Ÿå¾ˆé‡è¦ã€‚åŠ å…¥ä¸€ä¸ªæœ‰å¯é çš„å¯¼å¸ˆå’ŒåŒè¡Œçš„åˆé€‚çš„ç ”ç©¶å®éªŒå®¤ï¼Œä¸ä»…å¯ä»¥å¸®åŠ©æé«˜ä¸€ä¸ªäººçš„å­¦æœ¯æŠ€èƒ½ï¼Œè¿˜å¯ä»¥æä¾›æ¥è§¦ç§‘å­¦æ–¹æ³•çš„æœºä¼šï¼Œå¹¶å¸®åŠ©æ˜ç¡®èŒä¸šç›®æ ‡ã€‚æœ¬æ–‡ä»…å™è¯´ä¸ªäººç»å†ï¼Œä»é€‰æ‹©ç ”ç©¶è¯¾é¢˜åˆ°åˆ¶å®šç ”ç©¶æ–¹æ³•ï¼Œä»¥åŠå­¦ä¹ æ–‡çŒ®ç ”ç©¶ã€ç¼–ç¨‹å’Œç¡¬ä»¶ç­‰å®ç”¨æŠ€èƒ½çš„é‡è¦æ€§ã€‚ä½œè€…è¿˜å¼ºè°ƒäº†åœ¨ç ”ç©¶å·¥ä½œä¸­è¿½æ±‚ç§‘å­¦å…´è¶£å’Œç‹¬ç«‹çš„é‡è¦æ€§ã€‚</p>
<span id="more"></span>
<h2 id="æœ¬ç§‘ç§‘ç ”çš„é‚£äº›äº‹">æœ¬ç§‘ç§‘ç ”çš„é‚£äº›äº‹</h2>
<p>æœ¬ç§‘é˜¶æ®µï¼Œä»¥å°±ä¸šä¸ºç›®çš„çš„åŒå­¦åŠ å…¥ä¸€ä¸ªå®éªŒå®¤å…¶å®æ˜¯æ— æ‰€è°“çš„ï¼Œé™¤éæ˜¯éœ€è¦å€šé‡ç›¸å…³è€å¸ˆã€‚å…¶ä»–æ— è®ºæ˜¯è€ƒ/ä¿ç ”ï¼Œè¿˜æ˜¯å‡ºå›½ç•™å­¦çš„åŒå­¦ï¼Œé€‰æ‹©å¹¶åŠ å…¥ä¸€ä¸ªåˆé€‚çš„å®éªŒå®¤è¿˜æ˜¯ååˆ†é‡è¦çš„ã€‚</p>
<p>ä¸€ä¸ªå¥½çš„å®éªŒå®¤å¾€å¾€ä¼šæœ‰é è°±å¯¼å¸ˆå’Œè‹¥å¹²å¸ˆå…„å¸ˆå§ã€‚ä»å»ºç«‹äººè„‰ç½‘ç»œä¸Šæ¥çœ‹ï¼Œå¯¼å¸ˆå¯èƒ½ä¼šåœ¨ä½ éƒ¨åˆ†ä¸“ä¸šè¯¾ç¨‹ä¸Šå¸®åŠ©ä½ æ‰“å‡ºé«˜åˆ†ï¼Œåœ¨è€ƒ/ä¿ç ”é˜¶æ®µèƒ½å¤Ÿå¸®ä½ æ¨èå¯¼å¸ˆã€‚å¸ˆå…„å¸ˆå§ä¹Ÿæœ‰åºå¤§çš„æ ¡å‹èµ„æºï¼Œæ‰€ä»¥èµ·ç åœ¨ä¿¡æ¯èµ„æºä¸Šå°±æ¯”å…¶ä»–äººæ›´é¢†å…ˆä¸€ç­¹ã€‚å†é€€ä¸€æ­¥æ¥è¯´ï¼Œè¿›å…¥å®éªŒå®¤ä¹Ÿå¯ä»¥ä¸ºæœ¬ç§‘é˜¶æ®µçš„ç®€å†æ·»ä¸Šä¸€ç¬”ã€‚äº¦æˆ–æ˜¯ï¼Œä¸ºè¿·èŒ«çš„åŒå­¦æ›´è¿›ä¸€æ­¥äº†è§£è¯»ç ”çš„å·¥ä½œç”Ÿæ´»ï¼Œäº†è§£æ¸…æ¥šç§‘ç ”åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è¿›è¡Œç§‘ç ”ï¼Œæ‰€å±ä¸“ä¸šå†…çš„å­¦æœ¯åœˆå­æ˜¯å¦‚ä½•å¦‚ä½•çš„ã€‚</p>
<p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œå¤§äºŒä¸‹æ—¶åŠ å…¥äº†ä¸€ä¸ªæ–°æˆç«‹ä¸”åºå¤§çš„å®éªŒå®¤ã€‚å¤§æ¦‚å·¥ä½œå°±æ˜¯ä»é›¶é€ ä¸€å°åŒ»ç–—ä»ªå™¨ï¼Œæ‰€ä»¥å­¦ç”Ÿæ¥æºäºå„ä¸ªä¸“ä¸šï¼Œæœºæ¢°ã€ç”µå­ã€ææ–™ã€è®¡ç®—æœºç­‰ã€‚å„è‡ªä¸“ä¸šçš„åˆ†å·¥ä¹Ÿä¸åŒã€‚æˆ‘è¢«åˆ†é…çš„è¯¾é¢˜æ˜¯"å¤§è§„æ¨¡ç³»ç»Ÿå“åº”çŸ©é˜µçš„å¿«é€Ÿåˆ†è§£"ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯¹çŸ©é˜µè¿›è¡Œåˆ†è§£ï¼Œåªä¸è¿‡ç°åœ¨è¿™ä¸ªçŸ©é˜µè§„æ¨¡å¾ˆå¤§ï¼Œåœ¨åˆ†è§£çš„æ—¶å€™æˆ‘ä»¬è¿˜è¦è¿½æ±‚é€Ÿåº¦ã€‚</p>
<p>æ‰€ä»¥å½“ä¸€ä¸ªé—®é¢˜æŠ›å‡ºæ¥æ—¶ï¼Œåœ¨æ²¡æœ‰å¤–ç•Œå¸®åŠ©çš„å‰æä¸‹ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘è‡ªå·±çš„æ€è€ƒä¸è§£å†³æ­¥éª¤å¦‚ä¸‹ï¼šç›´æ¥åœ¨çŸ¥ç½‘ä¸­æœç´¢è¿™ä¸€é•¿ä¸²åè¯ï¼Œè¿›è¡Œç®€å•çš„æ–‡çŒ®é˜…è¯»åï¼Œæå–å¾—åˆ°â€çŸ©é˜µåˆ†è§£â€œè¿™ä¸€å…³é”®è¯ã€‚å†åˆ†åˆ«ç”¨ä¸­è‹±æ–‡å¯¹è¿™ä¸€å…³é”®è¯è¿›è¡Œæœç´¢ï¼Œå†è¿›è¡ŒäºŒæ¬¡å­¦ä¹ ã€‚æœ€ç»ˆè¦è¾¾åˆ°èƒ½å¤Ÿæ¯”è¾ƒæ¸…æ¥šçš„è§£é‡Šè¿™æ˜¯ä»€ä¹ˆï¼Œç›®å‰çš„ç ”ç©¶è¿›å±•ï¼ˆç®€è¦äº†è§£ï¼‰ï¼Œç›®å‰çš„ç ”ç©¶æ–¹æ³•ï¼ˆç®€è¦äº†è§£ï¼‰ç­‰ã€‚è¿™åŸºæœ¬å°±å±äºè®ºæ–‡ä¸­çš„
<code>Introduce</code>éƒ¨åˆ†ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°±æ‹¿çŸ©é˜µåˆ†è§£è¿™ä¸€é—®é¢˜æ¥è¯´ï¼Œæœç´¢çŸ©é˜µåˆ†è§£è¿™ä¸€æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“å‘ç°æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­QRã€LUã€SVDæ˜¯ç”¨çš„æ¯”è¾ƒå¤šã€‚è¿™æ—¶å€™å°±éœ€è¦æ ¹æ®é—®é¢˜çš„å…·ä½“éœ€æ±‚ï¼ˆé€Ÿåº¦ã€å‡†ç¡®åº¦...ï¼‰æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚é€‰å®šæ–¹æ³•åï¼Œå°±éœ€è¦è€ƒè™‘æ˜¯æ”¹è¿›ç°æœ‰çš„æ–¹æ³•ï¼ˆæ•°å­¦ç®—æ³•ä¸Šï¼‰è¿˜æ˜¯ä»å…¶ä»–è§’åº¦å…¥æ‰‹ã€‚æ˜¾ç„¶ï¼Œåœ¨æ”¹è¿›æ•°å­¦ç®—æ³•ä¸Šéš¾åº¦è¿˜æ˜¯æ‘†åœ¨é‚£é‡Œçš„ã€‚æ‰€ä»¥è¿™é‡Œè€ƒè™‘ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œå…¶ä»–é—®é¢˜ä¹Ÿå¯ä»¥ä»¥ç±»ä¼¼æ€è·¯æ¥è§£å†³ã€‚é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬æ˜¯ç”¨è®¡ç®—æœºæ¥è§£å†³çš„ï¼Œé‚£ä¹ˆæ˜¾ç„¶å¯ä»¥æƒ³åˆ°ä¸¤ç‚¹ï¼Œç¼–ç¨‹ä¸Šè¿›è¡ŒåŠ é€Ÿã€ç¡¬ä»¶ä¸Šè¿›è¡ŒåŠ é€Ÿã€‚ç¡¬ä»¶ä¸ŠåŠ é€Ÿç®€å•æ¥è¯´å°±æ˜¯ç”¨æœ€å¥½çš„ç¡¬ä»¶å¹³å°ï¼ˆè®¡ç®—èµ„æºï¼‰ï¼Œå½“ç„¶è¿™æ ·åŸºæœ¬ä¸å…·ä»»ä½•åˆ›æ–°æ€§ã€‚è¿˜å¯ä»¥ä½¿ç”¨è¯¸å¦‚åˆ†å¸ƒå¼è®¡ç®—è¿™ç§æ–¹æ³•æ¥åŠ é€Ÿï¼Œè¿™æ ·é—®é¢˜å°±å¯ä»¥è½¬æ¢ä¸ºå¦‚ä½•å°†çŸ©é˜µåˆ†è§£åº”ç”¨åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•åŠ é€Ÿï¼Œè¿™æ ·é—®é¢˜å°±æˆåŠŸè½¬æ¢äº†ã€‚å¦ä¸€ç‚¹ï¼Œåœ¨ç¨‹åºä¸Šè¿›è¡ŒåŠ é€Ÿï¼Œè¿™é‡Œå°±éœ€è¦å¼•å…¥å‡ ä¸ªç®€å•çš„åè¯ï¼šå¹¶å‘ã€å¹¶è¡Œã€å¼‚æ­¥ã€æµå¼è®¡ç®—ã€‚å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–æŠ€å·§å°±ä¸å±•å¼€äº†ã€‚è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯å¹¶è¡Œè®¡ç®—ï¼Œé‚£ä¹ˆæ–°çš„é—®é¢˜å°±æ˜¯å¦‚ä½•è¿›è¡ŒçŸ©é˜µåˆ†è§£çš„å¹¶è¡Œè®¡ç®—ï¼Œæ˜¯ä½¿ç”¨ä½•ç§æ¡†æ¶ä½•ç§è¯­è¨€ç­‰ç­‰ã€‚è¿™å¤§æ¦‚æ˜¯æˆ‘æ•´ä¸ªçš„ä¸€ä¸ªæ€è€ƒæ€è·¯ï¼Œå½“ç„¶å¾ˆå¤šæ€è·¯ä¹Ÿå¯ä»¥ä»å…¶ä»–æ–‡çŒ®çš„é˜…è¯»ä¸­è¿›è¡Œè·å–ã€‚è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ï¼Œå¯ä»¥å¤šç§æ–¹æ³•ç»“åˆï¼Œæ¯”å¦‚è¿™é‡Œå¯ä»¥åšåˆ†å¸ƒå¹¶è¡Œè®¡ç®—ï¼Œå½“ç„¶è¿™ä¸€ç‚¹å…¶å®åˆ›æ–°æ€§å…¶å®ä¹Ÿæ¯”è¾ƒå·®ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç°æœ‰æ–¹æ³•ï¼Œé™¤éæœ‰ä¸€äº›ä¸åŒä¸è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç‚¹ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ä»…å¯ä»¥å­¦åˆ°è¿™ç§æ€è€ƒæ–¹å¼ï¼Œè¿˜åœ¨å…¶ä¸­å¯ä»¥å­¦ä¹ åˆ°å…¶ä»–æŠ€å·§ï¼Œæ¯”å¦‚å¦‚ä½•æœç´¢å¹¶ä¸‹è½½æ–‡çŒ®ï¼Œå¦‚ä½•é˜…è¯»æ–‡çŒ®ç­‰ã€‚å†è¯´å›è‡ªå·±ï¼Œç”±äºå®éªŒå®¤å†å²æ²‰æ·€ä¸è¶³ï¼Œæ‰€ä»¥å¾ˆå¤šä¸œè¥¿éƒ½éœ€è¦ä»é›¶å¼€å§‹å¹¶è‡ªå·±åŠ¨æ‰‹ã€‚æ‰€ä»¥éœ€è¦ä»é›¶é€‰è´­è®¡ç®—æœºé…ä»¶ï¼Œç»„è£…ï¼Œæ­å»ºç¯å¢ƒï¼Œç‹¬ç«‹ç¼–ç¨‹ç­‰ã€‚ä»¥ä¸Šå¯èƒ½è€å¸ˆä¹Ÿæ²¡æ—¶é—´æ¥æŒ‡å¯¼ï¼ŒåŸºæœ¬ä¸Šä¹Ÿéƒ½æ˜¯ç»™ä¸€ä¸ªå¤§æ–¹å‘æ²¡æœ‰æ¯”è¾ƒå…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥åŸºæœ¬éƒ½æ˜¯è‡ªå·±æˆ–è·Ÿå°ä¼™ä¼´ä¸€èµ·å®Œæˆã€‚ä»ä¸­æ”¶è·åˆ°çš„è‡ªç„¶æ˜¯å­¦ä¹ åˆ°äº†ç‹¬å½“ä¸€é¢çš„èƒ½åŠ›ï¼Œè‡ªå·±åŠ¨æ‰‹èƒ½åŠ›åˆæé«˜äº†ï¼›ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå­¦ä¹ æ—¶é—´æˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œå¹¶ä¸”è€å¸ˆå¯èƒ½ä¼šè®©ä½ è·‘è…¿åšå…¶ä»–äº‹æƒ…ã€‚æ‰€ä»¥åœ¨è¿™é‡Œå»ºè®®ï¼Œè¿™ç§å®éªŒå®¤è¿˜æ˜¯æ…å…¥ï¼Œå½“ç„¶å¦‚æœä¸ºäº†é”»ç‚¼è‡ªå·±ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥è¯•è¯•ï¼Œæ¯•ç«Ÿæœ€åæˆå°±æ„Ÿä¹Ÿæ˜¯åè¶³çš„ã€‚æˆ‘è‡ªå·±æœ€åå¤§æ¦‚å°±æ˜¯å°†QRã€LUã€SVDè¿™ä¸‰ç§ç®—æ³•è¿›è¡Œäº†ä¸€ä¸ªå¤ç°ï¼ŒSVDæ˜¯ç”¨CUDAå®Œæˆçš„ã€‚<a
href="https://github.com/wnma3mz/Matrix-factorization">é“¾æ¥</a>ã€‚åŸºäºç§ç§åŸå› ï¼Œåç»­å¹¶æ²¡æœ‰è¿›è¡Œä¸‹å»ï¼Œå³æ²¡æœ‰æˆæœçš„äº§å‡ºï¼Œä¸è¿‡å­¦åˆ°äº†ä¸œè¥¿æ‰æ˜¯æœ€é‡è¦çš„ï¼ˆ23333ï¼‰ã€‚</p>
<p>å†è°ˆæœ¬å­¦é™¢ç§‘ç ”è®­ç»ƒï¼ŒåŸºæœ¬ä¹Ÿæ˜¯ç±»ä¼¼äºåŠ å…¥ä¸€ä¸ªå®éªŒå®¤è¿™ç§ã€‚è¿™é‡Œä¸åŒäºä¸Šé¢çš„ç‚¹åœ¨äºï¼Œè€å¸ˆåœ¨è¿™é‡ŒåŸºæœ¬ä¼šç»™å‡ºä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆç»™äºˆå¤ç°ï¼Œæ‰€è°“ææ–™çº¦ç­‰äºæ¬ç –ï¼ˆç‚’èœåŒç†ï¼‰ã€‚ç›¸ååœ¨è¿™é‡Œå­¦ä¹ åˆ°çš„ä¸œè¥¿å…¶å®å¹¶ä¸ç®—å¤šï¼Œåªæ˜¯å®éªŒï¼ˆéè®¡ç®—æœºï¼‰çš„æ“ä½œæ­¥éª¤ï¼Œä»ªå™¨çš„ä½¿ç”¨ï¼Œè¯´ç™½äº†æŠ€æœ¯æ€§çœŸçš„ä¸ç®—é«˜ã€‚ä½†ä¸»è¦è¿˜æ˜¯æ–¹æ¡ˆçš„æå‡ºä¸æ–¹æ³•çš„æ”¹è¿›è¿™ç§ã€‚æœ€åçš„æˆæœä¹Ÿæ˜¯ä¸€ç¯‡SCIï¼Œå…¶ä½™å€’çœŸçš„æ²¡ä»€ä¹ˆå¥½è¯´ã€‚</p>
<p>å°±åƒæ–‡ç« ä¸­ä¸€å¼€å§‹è¯´çš„é‚£æ ·ï¼Œæå‰è¿›å…¥å®éªŒå®¤èƒ½å¤Ÿè®©æˆ‘è®¤æ¸…è‡ªå·±æ˜¯å¦èƒ½å¤Ÿåšç§‘ç ”å·¥ä½œï¼Œæ˜¯å¦å–œæ¬¢ã€‚å°±æ‹¿ç§‘ç ”è®­ç»ƒè¿™ä¸ªæ¥è¯´ï¼Œé€šè¿‡è¿™ä¸ªåŸºæœ¬ä¹Ÿè®¤æ¸…äº†å­¦ç§‘çš„ç‰¹æ€§ï¼Œç¡®å®ä¹Ÿæ²¡å•¥æ„æ€ï¼Œæ‰€ä»¥ç®—æ˜¯è‡ªä¸»åŠé€€äº†ã€‚å…³äºææ–™å­¦ç§‘çš„ç‰¹æ€§ä»¥åŠå„ç§åŠé€€æ–‡ï¼Œæˆ‘åœ¨è¿™ä¸æ˜¯å¾ˆæƒ³ä»‹ç»ï¼Œå…·ä½“å¯è§çŸ¥ä¹ã€‚ä¸ªäººè¿˜æ˜¯ç§‰æŒç€ç†æ€§åŠé€€çš„æ€åº¦ï¼Œè®¤æ¸…è‡ªå·±çš„è¿½æ±‚å†åšå†³å®šã€‚å†è°ˆé‚£ä¸ªå®éªŒå®¤ï¼Œå°±å·¥ä½œå†…å®¹è€Œè¨€è¿˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½†æ˜¯ç”±äºç¼ºä¹ä¸€å®šçš„åŠ¨åŠ›ï¼ˆæ¯”å¦‚å„ç§éƒ½éœ€è¦è‡ªå·±ç‹¬ç«‹å®Œæˆï¼Œæ–¹å‘ä¸Šä¸æ˜¯è‡ªå·±å°†æ¥æƒ³åšçš„ï¼Œè€å¸ˆæŒ‡å¯¼æ—¶é—´å°‘ï¼‰ï¼Œæ•…ä¹Ÿé€‰æ‹©äº†é€€å‡ºã€‚ä¸è¿‡æ€»çš„æ¥è¯´ï¼Œè¿™ä¸¤æ¬¡ç»å†ç¡®å®æ”¶è·é¢‡å¤šï¼Œç€å®ä¸ºä¹‹åçš„å¾ˆå¤šå·¥ä½œæ‰“å¥½äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ï¼Œè‡ªå·±çš„æ€è€ƒè§’åº¦ä¹Ÿæ›´åŠ å…¨é¢ä¸ä¸°å¯Œäº†ï¼ˆå› äººè€Œå¼‚ï¼‰ã€‚åŒæ—¶ä¹Ÿè®¤æ¸…ä¸€ç‚¹å°±æ˜¯ï¼Œå¾ˆå¤šçœ‹ä¼¼å¯¹è‡ªå·±æ— ç”¨çš„ä¸œè¥¿ï¼Œå…¶å®åç»­éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚æ¯”å¦‚å†™åšå®¢è¿™ä»¶å°äº‹ï¼Œæ— å½¢ä¸­å¯¹æˆ‘è®ºæ–‡å†™ä½œæä¾›äº†ä¸€ä¸ªåŸºç¡€ï¼ˆèƒ½å¤Ÿæœ‰é€»è¾‘ã€æ¸…æ™°çš„é˜è¿°æŸä»¶äº‹ï¼‰ï¼›å†æ¯”å¦‚å¤§ä¸€æ—¶è¢«å¼ºåˆ¶å­¦ä¹ çš„
<code>LaTex</code>ï¼Œä¹Ÿååˆ†æœ‰æ•ˆï¼ˆå½“ç„¶æœ¬æ¥ç”¨wordä¹Ÿè¡Œï¼‰ï¼›å†æ¯”å¦‚SVDçŸ©é˜µåˆ†è§£ï¼Œå¯èƒ½å½“æ—¶æ²¡æœ‰æƒ³åˆ°ä¸€å¹´åçš„è‡ªå·±è¿˜ä¼šç»§ç»­åšè¿™ä¸ªç›¸å…³å†…å®¹ï¼ˆæœ¬æ–‡å†™ä½œäº2019å¹´9æœˆï¼‰ç­‰ã€‚åœ¨å¤§éƒ¨åˆ†äº‹æƒ…ä¸Šï¼Œè¿˜æ˜¯ä¸è¦å¤ªåŠŸåˆ©ï¼Œä»¥å…´è¶£ä¸ºå¯¼å‘ï¼Œè¯´ä¸å®šå°†æ¥æŸä¸€å¤©ä¼šç»™äºˆä½ å·¨å¤§çš„å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
  </entry>
  <entry>
    <title>æ‚è®°</title>
    <url>/hexo_blog/2018/05/30/%E6%9D%82%E8%AE%B0/</url>
    <content><![CDATA[<p>SimHashç®—æ³•æ˜¯ä¸€ç§ç”¨äºè®¡ç®—æ–‡æ¡£ç›¸ä¼¼åº¦çš„ç®—æ³•ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—æ–‡æœ¬çš„SimHashå€¼æ¥æ¯”è¾ƒæ–‡æ¡£é—´çš„æ±‰æ˜è·ç¦»ï¼Œä»è€Œæ¯”è¾ƒæ–‡æ¡£é—´çš„ç›¸ä¼¼åº¦ã€‚æœ¬æ–‡ä»‹ç»äº†SimHashç®—æ³•çš„åŸºæœ¬åŸç†å’Œå®ç°æ­¥éª¤ï¼Œå¹¶ä»‹ç»äº†ä¸­æ–‡åˆ†è¯æ–¹æ³•å’Œä¸åŒç±»å‹çš„åˆ†è¯ç®—æ³•ã€‚åŒæ—¶ï¼Œè¿˜å¯¹æŸå¤±å‡½æ•°ã€æ±‰æ˜è·ç¦»ã€hashå‡½æ•°ã€é¢‘ç‡ä¸é¢‘åº¦ã€äº’ç°ä¿¡æ¯ç­‰å…³é”®æ¦‚å¿µè¿›è¡Œäº†è¯¦ç»†è§£é‡Šï¼Œæœ‰åŠ©äºè¯»è€…æ·±å…¥äº†è§£SimHashç®—æ³•èƒŒåçš„æŠ€æœ¯åŸç†ã€‚</p>
<span id="more"></span>
<h2 id="simhashç®—æ³•åŸç†">SimHashç®—æ³•åŸç†</h2>
<p><code>SimHash</code>æ˜¯ç”¨æ¥è®¡ç®—æ–‡æ¡£ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚é€šè¿‡è¯¥ç®—æ³•è®¡ç®—æ¯ç¯‡æ–‡æ¡£çš„
<code>SimHash</code>å€¼ï¼Œé€šè¿‡è®¡ç®—å¾—åˆ°çš„äºŒè¿›åˆ¶æ¥æ¯”è¾ƒæ–‡æ¡£é—´çš„<a
href="#hanming">æ±‰æ˜è·ç¦»</a>ï¼Œè¿›è€Œæ¥æ¯”è¾ƒæ–‡æ¡£é—´çš„ç›¸ä¼¼åº¦ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol type="1">
<li><p>åˆ†è¯</p>
<p>å¯¹ä¸€æ®µæ–‡æœ¬è¿›è¡Œåˆ‡å‰²ï¼Œå¾—åˆ°æœ‰æ•ˆçš„ç‰¹å¾å‘é‡ï¼ˆè¯ï¼‰ã€‚ä¸ºæ¯ä¸ªç‰¹å¾å‘é‡è®¾ç½®å¯¹åº”çš„æƒå€¼ï¼ˆ1-5ï¼‰ï¼Œæƒå€¼è¶Šé«˜åˆ™ä»£è¡¨è¿™ä¸ªç‰¹å¾å‘é‡åœ¨æ–‡æœ¬ä¸­è¶Šé‡è¦ã€‚</p></li>
<li><p>hash</p>
<p>åˆ©ç”¨ <code>hash</code>å‡½æ•°è®¡ç®—å„ä¸ªç‰¹å¾å‘é‡çš„ <code>hash</code>å€¼ã€‚<a
href="#hash">hashå‡½æ•°</a></p></li>
<li><p>åŠ æƒ</p>
<p>åœ¨ <code>hash</code>ä¹‹åï¼Œå¯¹æ¯ä¸ªç‰¹å¾å‘é‡è¿›è¡ŒåŠ æƒï¼Œå³<strong>W = Hash
* Weight</strong></p></li>
<li><p>åˆå¹¶</p>
<p>åœ¨å¯¹æ¯ä¸ªç‰¹å¾å‘é‡åŠ æƒåï¼Œå†ç´¯åŠ ï¼Œå˜æˆä¸€ä¸ªåºåˆ—ä¸²ã€‚</p></li>
<li><p>é™ç»´</p>
<p>ç”±äºæœ€ååˆå¹¶çš„æ•°å­—å¯èƒ½è¿‡å¤§ï¼ˆè¿‡å°ï¼‰ï¼Œè®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå¤§äºæŸé˜ˆå€¼çš„è®¾ç½®ä¸º1ï¼Œå°äºæŸé˜ˆå€¼çš„è®¾ç½®ä¸º0ã€‚æœ‰å¾ˆå¤šé™ç»´å¤„ç†çš„æ“ä½œï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä¸¾ä¸ªä¾‹å­</p></li>
</ol>
<p>ä¸¾ä¾‹ï¼š</p>
<p>æ–‡æœ¬ï¼šäººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python</p>
<ol type="1">
<li><p>åˆ†è¯ã€‚</p></li>
<li><p>hashã€‚</p></li>
<li><p>åŠ æƒã€‚é‡åˆ°0å°±å˜ä¸ºè´Ÿæ•°</p></li>
<li><p>åˆå¹¶ã€‚å¯¹åº”ä½åŠ å’Œã€‚</p></li>
<li><p>é™ç»´ã€‚å¤§äº0çš„è®¾ç½®ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ†è¯	  hash				åŠ æƒ 			åˆå¹¶			 é™ç»´</span><br><span class="line"></span><br><span class="line">ç”Ÿ(5)  äººç”Ÿ(&quot;10101&quot;)	  	5 -5 5 -5 5	  5+5+4+3-3-3-2=9 	1</span><br><span class="line">ython(5)  Python(&quot;11101&quot;)	5 5 5 -5 5	   -5+5-4-3-3-3-2=-15	0</span><br><span class="line">(4) 	 è‹¦(&quot;10110&quot;)		  4 -4 4 4 -4	 5+5+4+3+3-3-2=15	  1</span><br><span class="line">(3)	 çŸ­(&quot;00101&quot;)		 3 -3 3 3 -3	 -5-5+4+3-3-3+2=-7	 0</span><br><span class="line">(3)	 æˆ‘(&quot;00001&quot;)		 -3 -3 3 -3 3	 5+5-4-3+3+3-2=7	1</span><br><span class="line">(2)  	 ç”¨(&quot;00010&quot;)		 -2 -2 -2 2 -2</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ä¸­æ–‡åˆ†è¯æ–¹æ³•">ä¸­æ–‡åˆ†è¯æ–¹æ³•</h2>
<h3 id="åŸºäºè§„åˆ™çš„åˆ†è¯æ–¹æ³•">åŸºäºè§„åˆ™çš„åˆ†è¯æ–¹æ³•</h3>
<p>æœºæ¢°åˆ†è¯ã€åŸºäºå­—å…¸ã€‚æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥åœ¨ä¸€ä¸ªè¯å…¸ä¸­çš„è¯æ¡è¿›è¡ŒåŒ¹é…ï¼Œè‹¥æ‰¾åˆ°æŸè¯æ¡åˆ™åŒ¹é…æˆåŠŸã€‚</p>
<p>ä¸‰è¦ç´ ï¼š</p>
<ul>
<li><p>åˆ†è¯è¯å…¸</p></li>
<li><p>æ–‡æœ¬æ‰«æé¡ºåº</p>
<ul>
<li>æ­£å‘æ‰«æ</li>
<li>é€†å‘æ‰«æ</li>
<li>åŒå‘æ‰«æ</li>
</ul></li>
<li><p>åŒ¹é…åŸåˆ™</p>
<ul>
<li><p>æœ€å¤§åŒ¹é…ï¼ˆMMï¼‰</p>
<p>å‡å®šè¯å…¸ä¸­çš„æœ€é•¿è¯æ¡æ‰€å«æ±‰å­—ä¸ªæ•°ä¸ºiï¼Œåˆ™è¢«å¤„ç†æ–‡æœ¬ä¸­å‰iä¸ªå­—ç¬¦ä½œä¸ºåŒ¹é…å­—æ®µï¼ŒæŸ¥æ‰¾è¯å…¸ã€‚å¦‚æœè¯å…¸ä¸­å«æœ‰è¿™æ ·iä¸ªæ±‰å­—ä¸ªæ•°çš„è¯ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼Œå¹¶ä¸”åˆ‡åˆ†å‡ºè¿™ä¸ªè¯ï¼›å¦‚æœæ‰¾ä¸åˆ°å°±åŒ¹é…å¤±è´¥ï¼Œå°†åŒ¹é…å­—æ®µå»æ‰æœ€åä¸€ä¸ªæ±‰å­—ï¼Œç»§ç»­åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…æˆåŠŸä¸ºæ­¢ã€‚ç»Ÿè®¡æ–¹æ³•è¡¨æ˜ï¼Œé”™è¯¯ç‡ä¸º1/169ã€‚</p></li>
<li><p>æœ€å°åŒ¹é…ï¼ˆé€†å‘æœ€å¤§åŒ¹é…ï¼ŒRMMï¼‰ã€‚ä¸MMæ–¹æ³•ç›¸åŒï¼Œåªä¸è¿‡æ˜¯ä»æ–‡æœ¬æœ«å°¾å¼€å§‹ï¼ŒåŒ¹é…å¤±è´¥å°±å»æ‰å‰ä¸€ä¸ªæ±‰å­—ã€‚é”™è¯¯ç‡ä¸º1/245ã€‚</p></li>
<li><p>é€è¯åŒ¹é…ã€‚å°†è¯å…¸ä¸­çš„è¯ç”±é•¿åˆ°çŸ­é€è¯éå†ï¼Œç›´åˆ°æ–‡æœ¬åˆ‡åˆ†å®Œæˆã€‚</p></li>
<li><p>æœ€ä½³åŒ¹é…ï¼ˆOMï¼‰</p>
<p>åœ¨è¯å…¸ä¸­æŒ‰è¯é¢‘çš„å¤§å°é¡ºåºæ’åˆ—è¯æ¡ï¼Œç¼©çŸ­æ£€ç´¢æ—¶é—´ï¼Œé™ä½æ—¶é—´å¤æ‚åº¦ï¼ŒåŠ å¿«åˆ†è¯é€Ÿåº¦ã€‚ä¸ç®—æ˜¯ä¸€ç§åˆ†è¯æ–¹æ³•ï¼Œåªæ˜¯ä¸€ç§å¯¹åˆ†è¯è¯å…¸çš„ä¸€ç§ç»„ç»‡æ–¹å¼ã€‚OM
æ³•çš„åˆ†è¯è¯å…¸æ¯æ¡è¯çš„å‰é¢å¿…é¡»æœ‰æŒ‡æ˜é•¿åº¦çš„æ•°æ®é¡¹ï¼Œæ‰€ä»¥å…¶ç©ºé—´å¤æ‚åº¦æœ‰æ‰€å¢åŠ ï¼Œå¯¹æé«˜åˆ†è¯ç²¾åº¦æ²¡æœ‰å½±å“ï¼Œåˆ†è¯å¤„ç†çš„æ—¶é—´å¤æ‚åº¦æœ‰æ‰€é™ä½ã€‚</p></li>
</ul></li>
</ul>
<h3 id="åŸºäºç»Ÿè®¡çš„åˆ†è¯æ–¹æ³•">åŸºäºç»Ÿè®¡çš„åˆ†è¯æ–¹æ³•</h3>
<p>åŸºæœ¬æ€æƒ³ï¼šè¯æ˜¯ç¨³å®šçš„ç»„åˆã€‚</p>
<p>ä¸Šä¸‹æ–‡ä¸­ï¼Œç›¸é‚»çš„å­—åŒæ—¶å‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œå°±è¶Šæœ‰å¯èƒ½æ„æˆä¸€ä¸ªè¯ã€‚</p>
<p>å­—ä¸å­—ç›¸é‚»å‡ºç°çš„æ¦‚ç‡æˆ–<a
href="#frequency">é¢‘ç‡</a>ååº”å‡ºè¯çš„å¯ä¿¡åº¦ã€‚</p>
<p>æ— å­—å…¸åˆ†è¯ï¼šç»Ÿè®¡æ–‡æœ¬ä¸­ç›¸é‚»å­—çš„ç»„åˆçš„<a
href="#frequency">é¢‘åº¦</a>ï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„äº’ç°ä¿¡æ¯ã€‚</p>
<p>è¯¥æ–¹æ³•æ‰€åº”ç”¨çš„ä¸»è¦çš„ç»Ÿè®¡æ¨¡å‹æœ‰ï¼šN
å…ƒæ–‡æ³•æ¨¡å‹ï¼ˆN-gramï¼‰ã€éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHiden Markov
Modelï¼ŒHMMï¼‰ã€æœ€å¤§ç†µæ¨¡å‹ï¼ˆMEï¼‰ã€æ¡ä»¶éšæœºåœºæ¨¡å‹ï¼ˆConditional Random
Fieldsï¼ŒCRFï¼‰ç­‰ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­æ­¤ç±»åˆ†è¯ç®—æ³•ä¸€èˆ¬æ˜¯å°†å…¶ä¸åŸºäºè¯å…¸çš„åˆ†è¯æ–¹æ³•ç»“åˆèµ·æ¥ï¼Œæ—¢å‘æŒ¥åŒ¹é…åˆ†è¯åˆ‡åˆ†é€Ÿåº¦å¿«ã€æ•ˆç‡é«˜çš„ç‰¹ç‚¹ï¼Œåˆåˆ©ç”¨äº†æ— è¯å…¸åˆ†è¯ç»“åˆä¸Šä¸‹æ–‡è¯†åˆ«ç”Ÿè¯ã€è‡ªåŠ¨æ¶ˆé™¤æ­§ä¹‰çš„ä¼˜ç‚¹ã€‚</p>
<h3 id="åŸºäºè¯­ä¹‰çš„åˆ†è¯æ–¹æ³•">åŸºäºè¯­ä¹‰çš„åˆ†è¯æ–¹æ³•</h3>
<p>è¯­ä¹‰åˆ†æã€‚å¯¹è‡ªç„¶è¯­è¨€è‡ªèº«çš„è¯­è¨€ä¿¡æ¯è¿›è¡Œæ›´å¤šçš„å¤„ç†ã€‚</p>
<ul>
<li><p>æ‰©å……è½¬ç§»ç½‘ç»œæ³•</p>
<p><a
href="https://baike.baidu.com/item/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/2081914?fr=aladdin">æœ‰é™çŠ¶æ€æœº</a>ã€‚æœ‰é™çŠ¶æ€æœºåªèƒ½è¯†åˆ«æ­£åˆ™è¯­è¨€ï¼Œå¯¹æœ‰é™çŠ¶æ€æœºä½œçš„ç¬¬ä¸€æ¬¡æ‰©å……ä½¿å…¶å…·æœ‰é€’å½’èƒ½åŠ›ï¼Œå½¢æˆé€’å½’è½¬ç§»ç½‘ç»œ
ï¼ˆRTNï¼‰ã€‚åœ¨RTN
ä¸­ï¼Œå¼§çº¿ä¸Šçš„æ ‡å¿—ä¸ä»…å¯ä»¥æ˜¯ç»ˆæç¬¦ï¼ˆè¯­è¨€ä¸­çš„å•è¯ï¼‰æˆ–éç»ˆæç¬¦ï¼ˆè¯ç±»ï¼‰ï¼Œè¿˜å¯ä»¥è°ƒç”¨å¦å¤–çš„å­ç½‘ç»œåå­—åˆ†éç»ˆæç¬¦ï¼ˆå¦‚å­—æˆ–å­—ä¸²çš„æˆè¯æ¡ä»¶ï¼‰ã€‚è¿™æ ·ï¼Œè®¡ç®—æœºåœ¨
è¿è¡ŒæŸä¸ªå­ç½‘ç»œæ—¶ï¼Œå°±å¯ä»¥è°ƒç”¨å¦å¤–çš„å­ç½‘ç»œï¼Œè¿˜å¯ä»¥é€’å½’è°ƒç”¨ã€‚è¯æ³•æ‰©å……è½¬ç§»ç½‘ç»œçš„ä½¿ç”¨ï¼Œ
ä½¿åˆ†è¯å¤„ç†å’Œè¯­è¨€ç†è§£çš„å¥æ³•å¤„ç†é˜¶æ®µäº¤äº’æˆä¸ºå¯èƒ½ï¼Œå¹¶ä¸”æœ‰æ•ˆåœ°è§£å†³äº†æ±‰è¯­åˆ†è¯çš„æ­§ä¹‰ã€‚</p></li>
<li><p>çŸ¥è¯†åˆ†è¯è¯­ä¹‰åˆ†ææ³•</p></li>
<li><p>é‚»æ¥çº¦æŸæ³•</p></li>
<li><p>ç»¼åˆåŒ¹é…æ³•</p></li>
<li><p>åç¼€åˆ†è¯æ³•</p></li>
<li><p>ç‰¹å¾è¯åº“æ³•</p></li>
<li><p>çŸ©é˜µçº¦æŸæ³•</p>
<p>å…ˆå»ºç«‹ä¸€ä¸ªè¯­æ³•çº¦æŸçŸ©é˜µå’Œä¸€ä¸ªè¯­ä¹‰çº¦æŸçŸ©é˜µï¼Œ
å…¶ä¸­å…ƒç´ åˆ†åˆ«è¡¨æ˜å…·æœ‰æŸè¯æ€§çš„è¯å’Œå…·æœ‰å¦ä¸€è¯æ€§çš„è¯ç›¸é‚»æ˜¯å¦ç¬¦åˆè¯­æ³•è§„åˆ™ï¼Œ
å±äºæŸè¯­ä¹‰ç±»çš„è¯å’Œå±äºå¦ä¸€è¯ä¹‰ç±»çš„è¯ç›¸é‚»æ˜¯å¦ç¬¦åˆé€»è¾‘ï¼Œæœºå™¨åœ¨åˆ‡åˆ†æ—¶ä»¥ä¹‹çº¦æŸåˆ†è¯ç»“æœã€‚</p></li>
<li><p>è¯­æ³•åˆ†ææ³•</p></li>
<li><p>â€¦â€¦</p></li>
</ul>
<h3 id="åŸºäºç†è§£çš„åˆ†è¯æ–¹æ³•">åŸºäºç†è§£çš„åˆ†è¯æ–¹æ³•</h3>
<p>é€šè¿‡è®©è®¡ç®—æœºæ¨¡æ‹Ÿäººå¯¹å¥å­çš„ç†è§£ï¼Œè¾¾åˆ°è¯†åˆ«è¯çš„æ•ˆæœã€‚è¿™ç§åˆ†è¯æ–¹æ³•éœ€è¦ä½¿ç”¨å¤§é‡çš„è¯­è¨€çŸ¥è¯†å’Œä¿¡æ¯ã€‚</p>
<p>åŸºæœ¬æ€æƒ³ï¼šåœ¨åˆ†è¯çš„åŒæ—¶è¿›è¡Œå¥æ³•ã€è¯­ä¹‰åˆ†æï¼Œåˆ©ç”¨å¥æ³•ä¿¡æ¯å’Œè¯­ä¹‰ä¿¡æ¯æ¥å¤„ç†æ­§ä¹‰ç°è±¡ã€‚</p>
<ul>
<li>åˆ†è¯å­ç³»ç»Ÿ</li>
<li>å¥æ³•è¯­ä¹‰å­ç³»ç»Ÿ</li>
<li>æ€»æ§éƒ¨åˆ†</li>
</ul>
<p>åœ¨æ€»æ§éƒ¨åˆ†çš„åè°ƒä¸‹ï¼Œåˆ†è¯å­ç³»ç»Ÿå¯ä»¥è·å¾—æœ‰å…³è¯ã€å¥å­ç­‰çš„å¥æ³•å’Œè¯­ä¹‰ä¿¡æ¯æ¥å¯¹åˆ†è¯æ­§ä¹‰è¿›è¡Œåˆ¤æ–­ï¼Œå³å®ƒæ¨¡æ‹Ÿäº†äººå¯¹å¥å­çš„ç†è§£è¿‡ç¨‹ã€‚</p>
<p>ä¸»è¦çš„æ–¹æ³•ï¼š</p>
<ul>
<li><p>ä¸“å®¶ç³»ç»Ÿåˆ†è¯æ³•</p>
<p>ä»ä¸“å®¶ç³»ç»Ÿè§’åº¦æŠŠåˆ†è¯çš„çŸ¥è¯†ï¼ˆåŒ…æ‹¬å¸¸è¯†æ€§åˆ†è¯çŸ¥è¯†ä¸æ¶ˆé™¤æ­§ä¹‰åˆ‡åˆ†çš„å¯å‘æ€§çŸ¥è¯†å³æ­§ä¹‰åˆ‡åˆ†è§„åˆ™ï¼‰ä»å®ç°åˆ†è¯è¿‡ç¨‹çš„æ¨ç†æœºä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œä½¿çŸ¥è¯†åº“çš„ç»´æŠ¤ä¸æ¨ç†æœºçš„å®ç°äº’ä¸å¹²æ‰°ï¼Œä»è€Œä½¿çŸ¥è¯†åº“æ˜“äºç»´æŠ¤å’Œç®¡ç†ã€‚å®ƒè¿˜å…·æœ‰å‘ç°äº¤é›†æ­§ä¹‰å­—æ®µå’Œå¤šä¹‰ç»„åˆæ­§ä¹‰å­—æ®µçš„èƒ½åŠ›å’Œä¸€å®šçš„è‡ªå­¦ä¹ åŠŸèƒ½ã€‚</p></li>
<li><p>ç¥ç»ç½‘ç»œåˆ†è¯æ³•</p>
<p>è¯¥æ–¹æ³•æ˜¯æ¨¡æ‹Ÿäººè„‘å¹¶è¡Œï¼Œåˆ†å¸ƒå¤„ç†å’Œå»ºç«‹æ•°å€¼è®¡ç®—æ¨¡å‹å·¥ä½œçš„ã€‚å®ƒå°†åˆ†è¯çŸ¥è¯†æ‰€åˆ†æ•£éšå¼çš„æ–¹æ³•å­˜å…¥ç¥ç»ç½‘ç»œå†…éƒ¨ï¼Œé€šè¿‡è‡ªå­¦ä¹ å’Œè®­ç»ƒä¿®æ”¹å†…éƒ¨æƒå€¼ï¼Œä»¥è¾¾åˆ°æ­£ç¡®çš„åˆ†è¯ç»“æœï¼Œæœ€åç»™å‡ºç¥ç»ç½‘ç»œè‡ªåŠ¨åˆ†è¯ç»“æœï¼Œå¦‚ä½¿ç”¨
LSTMã€GRU ç­‰ç¥ç»ç½‘ç»œæ¨¡å‹ç­‰ã€‚</p></li>
<li><p>ç¥ç»ç½‘ç»œä¸“å®¶ç³»ç»Ÿé›†æˆå¼åˆ†è¯æ³•</p>
<p>è¯¥æ–¹æ³•é¦–å…ˆå¯åŠ¨ç¥ç»ç½‘ç»œè¿›è¡Œåˆ†è¯ï¼Œå½“ç¥ç»ç½‘ç»œå¯¹æ–°å‡ºç°çš„è¯ä¸èƒ½ç»™å‡ºå‡†ç¡®åˆ‡åˆ†æ—¶ï¼Œæ¿€æ´»ä¸“å®¶ç³»ç»Ÿè¿›è¡Œåˆ†æåˆ¤æ–­ï¼Œä¾æ®çŸ¥è¯†åº“è¿›è¡Œæ¨ç†ï¼Œå¾—å‡ºåˆæ­¥åˆ†æï¼Œå¹¶å¯åŠ¨å­¦ä¹ æœºåˆ¶å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒã€‚è¯¥æ–¹æ³•å¯ä»¥è¾ƒå……åˆ†å‘æŒ¥ç¥ç»ç½‘ç»œä¸ä¸“å®¶ç³»ç»ŸäºŒè€…ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥æé«˜åˆ†è¯æ•ˆç‡ã€‚</p></li>
</ul>
<h2 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°</h2>
<p><a
href="https://zhuanlan.zhihu.com/p/35027284?utm_source=com.tencent.tim&amp;utm_medium=social">æŸå¤±å‡½æ•°æ•´ç†</a></p>
<h2 id="è¡¥å……">è¡¥å……</h2>
<p><span id="hanming"></p>
<h3 id="æ±‰æ˜è·ç¦»">æ±‰æ˜è·ç¦»</h3>
<p>åœ¨<a
href="https://zh.wikipedia.org/wiki/%E4%BF%A1%E6%81%AF%E8%AE%BA">ä¿¡æ¯è®º</a>ä¸­ï¼Œä¸¤ä¸ªç­‰é•¿<a
href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2">å­—ç¬¦ä¸²</a>ä¹‹é—´çš„<strong>æ±‰æ˜è·ç¦»</strong>ï¼ˆHamming
distanceï¼‰æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹åº”ä½ç½®çš„ä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°±æ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²å˜æ¢æˆå¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸ªæ•°ã€‚</p>
<p><strong>æ±‰æ˜é‡é‡</strong>æ˜¯å­—ç¬¦ä¸²ç›¸å¯¹äºåŒæ ·é•¿åº¦çš„é›¶å­—ç¬¦ä¸²çš„æ±‰æ˜è·ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²ä¸­éé›¶çš„å…ƒç´ ä¸ªæ•°ï¼šå¯¹äº<a
href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E8%BF%9B%E5%88%B6">äºŒè¿›åˆ¶</a><a
href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2">å­—ç¬¦ä¸²</a>æ¥è¯´ï¼Œå°±æ˜¯1çš„ä¸ªæ•°ï¼Œæ‰€ä»¥11101çš„æ±‰æ˜é‡é‡æ˜¯4ã€‚</p>
<p></span></p>
<p><span id="hash"></p>
<h3 id="hashå‡½æ•°">hashå‡½æ•°</h3>
<p>hashï¼ˆæ•£åˆ—ã€æ‚å‡‘ï¼‰å‡½æ•°ï¼Œæ˜¯å°†ä»»æ„é•¿åº¦çš„æ•°æ®æ˜ å°„åˆ°æœ‰é™é•¿åº¦çš„åŸŸä¸Šã€‚ç›´è§‚è§£é‡Šèµ·æ¥ï¼Œå°±æ˜¯å¯¹ä¸€ä¸²æ•°æ®mè¿›è¡Œæ‚ç³…ï¼Œè¾“å‡ºå¦ä¸€æ®µå›ºå®šé•¿åº¦çš„æ•°æ®hï¼Œä½œä¸ºè¿™æ®µæ•°æ®çš„ç‰¹å¾ï¼ˆæŒ‡çº¹ï¼‰ã€‚</p>
<p></span></p>
<p><span id="frequency"></p>
<h3 id="é¢‘ç‡ä¸é¢‘åº¦">é¢‘ç‡ä¸é¢‘åº¦</h3>
<p>é¢‘ç‡ï¼šä¸€å®šæ—¶é—´ï¼ˆä¸€åˆ†é’Ÿï¼Œä¸€ç§’ï¼Œä¸€å°æ—¶ï¼‰å†…ï¼ŒæŸåŠ¨ä½œçš„æ¬¡æ•°ï¼ˆæŸäº‹ç‰©å‡ºç°çš„æ¬¡æ•°ï¼‰ã€‚</p>
<p>é¢‘åº¦ï¼šå³æ—¶é—´é¢‘åº¦ã€‚ä¸€ä¸ªç®—æ³•æ‰§è¡Œæ‰€è€—è´¹çš„æ—¶é—´ã€‚ä¸€ä¸ªç®—æ³•ä¸­çš„è¯­å¥æ‰§è¡Œæ¬¡æ•°ç§°ä¸ºè¯­å¥é¢‘åº¦æˆ–æ—¶é—´é¢‘åº¦ã€‚</p>
<p></span></p>
<p><span id="Interacting"></p>
<h3 id="äº’ç°ä¿¡æ¯">äº’ç°ä¿¡æ¯</h3>
<p>äº’ç°ä¿¡æ¯ä½“ç°äº†æ±‰å­—ä¹‹é—´ç»“åˆå…³ç³»çš„ç´§å¯†ç¨‹åº¦ã€‚å½“ç´§å¯†ç¨‹åº¦é«˜äºæŸä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œä¾¿å¯ä»¥è®¤ä¸ºæ­¤å­—ç»„å¯èƒ½æ„æˆäº†ä¸€ä¸ªè¯ã€‚</p>
<p></span></p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
  </entry>
  <entry>
    <title>æ¸©åº¦å¯è§†åŒ–</title>
    <url>/hexo_blog/2023/12/03/%E6%B8%A9%E5%BA%A6%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
    <content><![CDATA[<p>æ—¶åºæ•°æ®ï¼Œä½¿ç”¨ç®€å•çš„ HTML å¯¹å…¶è¿›è¡Œå±•ç¤ºã€‚</p>
<span id="more"></span>
<h2 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h2>
<p>æ¥ <a href="/hexo_blog/2023/11/26/IOT/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/" title="æ ‘è“æ´¾æŠ˜è…¾è®°å½•">æ ‘è“æ´¾æŠ˜è…¾è®°å½•</a> ä¸­"è·å–å°ç±³æ¸©æ¹¿åº¦è®¡"çš„æ•°æ®,
ç°åœ¨æœ‰äº†è‹¥å¹²æ•°æ®åï¼Œå¸Œæœ›ç”¨ä¸€ç§ç›´è§‚çš„æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<p>ä¸æƒ³ç”¨å¤æ‚çš„å‰åç«¯ä»£ç ï¼Œå¸Œæœ›ç”¨æœ€ç®€å•çš„æ–¹å¼ç”»ä¸€ä¸ªæŠ˜çº¿å›¾å³å¯ã€‚æ‰€ä»¥è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œç”¨
Python å¤„ç†æ—¥å¿—æ•°æ®ï¼Œå°†å…¶ä¿å­˜åˆ° json ä¸­ï¼Œæœ€åç”¨ HTML
ç»“åˆç°æœ‰çš„å¯è§†åŒ–åº“è¿›è¡Œå±•ç¤ºã€‚ä¸ºäº†æœ‰ä¸€å®šçš„å®æ—¶æ€§ï¼Œæ‰€ä»¥åœ¨ç”¨ Python
å¤„ç†æ—¥å¿—æ—¶ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä»¥å®šæœŸæ›´æ–°å‰ç«¯é¡µé¢çš„æ•°æ®ã€‚</p>
<p>ä¸€ç§ä¸å¤ªä¼˜é›…çš„æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨ Python çš„ç”»å›¾åº“ï¼Œå°†å…¶å¯¼å‡ºä¸ºå›¾ç‰‡ï¼Œç„¶åç”¨
HTML çš„ img
æ ‡ç­¾è¿›è¡Œå±•ç¤ºã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå›¾ç‰‡çš„å¤§å°å°±ä¸å¥½æ§åˆ¶äº†ï¼Œè€Œä¸”ä¹Ÿä¸å¤ªå¥½çœ‹ã€‚æ‰€ä»¥è¿˜æ˜¯ç”¨
HTML çš„å¯è§†åŒ–åº“æ¯”è¾ƒå¥½ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static/pi_data.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;æ¸©åº¦æ›²çº¿&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ç”¨ Google çš„å¯è§†åŒ–åº“ <a
href="https://www.gstatic.com/charts/loader.js">https://www.gstatic.com/charts/loader.js</a>ï¼Œä¸‹è½½åå°†å…¶ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<p>æˆå“å±•ç¤ºï¼š<a
href="https://raspberrypi.tail54f27.ts.net/temp">https://raspberrypi.tail54f27.ts.net/temp</a>ã€‚ä¸ºäº†èŠ‚çº¦æ˜¾ç¤ºæ•°æ®ï¼ŒPython
ä¸­åªå¤„ç†è¿‡å» 24 å°æ—¶çš„æ•°æ®</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/loader.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    google.<span class="property">charts</span>.<span class="title function_">load</span>(<span class="string">&#x27;current&#x27;</span>, &#123; <span class="string">&#x27;packages&#x27;</span>: [<span class="string">&#x27;corechart&#x27;</span>] &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        è¯»å– json æ–‡ä»¶ï¼Œçº¦å®šå¥½å‡ ä¸ªå­—æ®µ data, title, left_label, right_label å³å¯</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        å…¶ä¸­ï¼Œdata æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç¬¬ä¸€åˆ—æ˜¯æ—¶é—´ï¼Œç¬¬äºŒåˆ—æ˜¯æ¸©åº¦ï¼Œç¬¬ä¸‰åˆ—æ˜¯æ¹¿åº¦ã€‚ä½†ç¬¬ä¸€è¡Œæ˜¯æ ‡é¢˜ [&quot;æ¨ªåæ ‡æ ‡é¢˜&quot;, &quot;ç¬¬xæ¡çº¿çš„æ ‡é¢˜&quot;]ã€‚</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        left_label æ˜¯å·¦è¾¹çš„çºµåæ ‡æ ‡é¢˜ï¼Œright_label æ˜¯å³è¾¹çš„çºµåæ ‡æ ‡é¢˜ã€‚</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    */</span></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">fetch</span>(<span class="string">&#x27;static/pi_data.json&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript">      .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> drawChart_callback = <span class="title function_">drawChart</span>(data.<span class="property">data</span>, <span class="string">&quot;chart&quot;</span>, data.<span class="property">title</span>, data.<span class="property">left_label</span>, data.<span class="property">right_label</span>);</span></span><br><span class="line"><span class="language-javascript">        google.<span class="property">charts</span>.<span class="title function_">setOnLoadCallback</span>(drawChart_callback);</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯»å–JSONæ–‡ä»¶æ—¶å‡ºé”™ï¼š&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">drawChart</span>(<span class="params">data_arr, chart_id, title, left_label, right_label</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> data = google.<span class="property">visualization</span>.<span class="title function_">arrayToDataTable</span>(data_arr);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">hAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">useFormatFromData</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">viewWindow</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">minValue</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">maxValue</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">viewWindowMode</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">legacyScatterChartLabels</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">vAxes</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;useFormatFromData&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;viewWindow&quot;</span>: &#123; <span class="string">&quot;max&quot;</span>: <span class="literal">null</span>, <span class="string">&quot;min&quot;</span>: <span class="literal">null</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;minValue&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;maxValue&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;title&quot;</span>: left_label,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;logScale&quot;</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;useFormatFromData&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;viewWindow&quot;</span>: &#123; <span class="string">&quot;max&quot;</span>: <span class="literal">null</span>, <span class="string">&quot;min&quot;</span>: <span class="literal">null</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;minValue&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;maxValue&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;title&quot;</span>: right_label,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;logScale&quot;</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          &#125;],</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">booleanRole</span>: <span class="string">&quot;certainty&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">lineWidth</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">legend</span>: <span class="string">&quot;top&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: title,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">fontName</span>: <span class="string">&quot;sans-serif&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">useFirstColumnAsDomain</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">titleTextStyle</span>: &#123; <span class="string">&quot;color&quot;</span>: <span class="string">&quot;#000&quot;</span>, <span class="string">&quot;fontSize&quot;</span>: <span class="number">24</span>, <span class="string">&quot;bold&quot;</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">series</span>: &#123; <span class="string">&quot;1&quot;</span>: &#123; <span class="string">&quot;targetAxisIndex&quot;</span>: <span class="number">1</span> &#125; &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">curveType</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">interpolateNulls</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">series</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;2&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;targetAxisIndex&quot;</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="comment">/* è¿™ä¸ªå­—æ®µç”¨äºæ§åˆ¶ç¬¬å‡ åˆ—æ”¾åœ¨å³è¾¹ï¼Ÿä½œä¸ºè°ƒæ•´å·¦å³çºµåæ ‡ä½ç½®çš„å‚æ•°ï¼Œ2è¡¨ç¤ºç”¨ç¬¬3åˆ—çš„æ•°æ®*/</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> isDefaultVisualization = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> chart = <span class="keyword">new</span> google.<span class="property">visualization</span>.<span class="title class_">LineChart</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(chart_id));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        chart.<span class="title function_">draw</span>(data, options, isDefaultVisualization);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chart</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-basis</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: auto;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;chart&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Visualization</category>
      </categories>
      <tags>
        <tag>æ ‘è“æ´¾</tag>
        <tag>Google Charts</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡å¾®ä¿¡å…¬ä¼—å·çˆ¬è™«çš„ç»å†ï¼ˆå¾®ä¿¡æ–‡ç« é˜…è¯»ç‚¹èµçš„è·å–ï¼‰</title>
    <url>/hexo_blog/2017/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E7%88%AC%E8%99%AB%E7%9A%84%E7%BB%8F%E5%8E%86%EF%BC%88%E5%BE%AE%E4%BF%A1%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E7%82%B9%E8%B5%9E%E7%9A%84%E8%8E%B7%E5%8F%96%EF%BC%89/</url>
    <content><![CDATA[<p>å¦‚ä½•çˆ¬å–å¾®ä¿¡å…¬ä¼—å·æ‰€æœ‰å†å²æ–‡ç« çš„é˜…è¯»é‡å’Œç‚¹èµé‡ï¼Ÿè¯¥æ–‡ä»‹ç»äº†ä¸¤ç§çªç ´éš¾ç‚¹çš„æ–¹æ³•ï¼šä¸€æ˜¯ä½¿ç”¨å¾®ä¿¡ä¸ªäººè®¢é˜…å·è¿›è¡Œçˆ¬å–ï¼ŒäºŒæ˜¯åœ¨ç”µè„‘ä¸Šä½¿ç”¨Fiddlerè¿›è¡ŒæŠ“åŒ…åˆ†æã€‚è¯¦ç»†çš„æ“ä½œæ­¥éª¤åŠä»£ç å®ç°éƒ½åœ¨æ–‡ä¸­ã€‚ç¼ºé™·æ˜¯éœ€è¦æ‰‹åŠ¨è·å–ä¸€äº›å…³é”®å‚æ•°ã€‚é’ˆå¯¹è¢«å°ç¦çš„é—®é¢˜ï¼Œæ–‡ä¸­æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<span id="more"></span>
<p>é¡¹ç›®å®ç°åœ°å€ã€‚æŸ¥çœ‹æˆ‘çš„<a
href="https://github.com/wnma3mz/wechat_articles_spider">Githubåœ°å€</a></p>
<p><a href="https://data.wnma3mz.cn/">æ•°æ®å±•ç¤ºï¼ˆå®Œæ•´æŒ‡æ ‡ï¼‰</a></p>
<p><a
href="https://data.wnma3mz.cn/demo.html">æ—¥æ›´ä¸¤æ¬¡ï¼Œè·å–å…¬ä¼—å·çš„æœ€æ–°æ–‡ç« é“¾æ¥</a>ï¼Œæš‚ä¸æ”¯æŒå®æ—¶è·å–é˜…è¯»ç‚¹èµ</p>
<p>æ”¯æŒä¸‹è½½æ–‡ç« å†…å®¹ä¸ºHTMLï¼ˆå«å›¾ç‰‡ï¼Œç»è¿‡äºŒæ¬¡å¤„ç†å¯è½¬æ¢ä¸ºPDFã€Wordï¼‰ã€‚æ¬¢è¿æŠ€æœ¯äº¤æµï¼Œå¾®ä¿¡ï¼šwnma3mzï¼Œçƒ¦è¯·è¿›è¡Œç›¸å…³å¤‡æ³¨ï¼Œå¦‚hexo_wechat_spiderã€‚äºŒç»´ç è§æ–‡æœ«ï¼Œæ ·ä¾‹å›¾ï¼š</p>
<p>ç›®å‰å…·ä½“å¯è·å–æŒ‡æ ‡ï¼ˆåŒ…å«ä½†ä¸å±€é™ï¼‰ï¼šé˜…è¯»æ•°ã€ç‚¹èµæ•°ï¼ˆåœ¨çœ‹ï¼‰ã€è¯„è®ºå†…å®¹åŠæ€»æ•°ã€æ­£æ–‡å†…å®¹åŠå›¾ç‰‡ã€æ˜¯å¦ä¸ºå¤´æ¡ã€æ˜¯å¦ä¸ºåŸåˆ›ã€‚
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/20200319174821639.png" /></p>
<p>é¡¹ç›®å·²ç»å®ç°ï¼Œæ¯”æœ¬æ–‡ä»‹ç»çš„æ›´åŠ æ–¹ä¾¿ç®€å•ï¼Œå¯ç›´æ¥è°ƒç”¨ã€‚</p>
<p>å…³äºæ‰¹é‡å…³æ³¨å…¬ä¼—å·çš„é—®é¢˜å·²è§£å†³ï¼Œè§æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« :<a
href="https://blog.csdn.net/wnma3mz/article/details/105448808">è‡ªåŠ¨æ‰¹é‡å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼ˆéé€†å‘ï¼‰</a></p>
<p>ä¸æ±‚å®Œç¾ï¼Œåªæ±‚èƒ½å¤Ÿç”¨ã€‚ã€‚ã€‚</p>
<p>æˆªè‡³2019å¹´4æœˆé¡¹ç›®å¯æ­£å¸¸è¿è¡Œï¼Œ æ–¹æ³•å·²æ›´æ–°ã€‚</p>
<p>3æœˆ1å·æ›´æ–°ï¼š</p>
<ol type="1">
<li>è·å–é˜…è¯»ç‚¹èµæ—¶ï¼Œæ¯ç¯‡æ–‡ç« é—´éš”10s ä¸€æ¬¡æ€§å¯è·å–500ç¯‡æ–‡ç« ä»¥ä¸Š</li>
<li>ä»å…¬ä¼—å·è·å–æ°¸ä¹…é“¾æ¥æ—¶ï¼Œé—´éš”3åˆ†é’Ÿï¼Œå¯ä»¥è¿ç»­è·å–å‡ å°æ—¶ï¼ˆç½‘å‹æµ‹è¯•ï¼‰</li>
</ol>
<p>å…¬å¼€å·²çˆ¬å–çš„å…¬ä¼—å·å†å²æ–‡ç« çš„æ°¸ä¹…é“¾æ¥ï¼Œæ•°æ®ä¸Šä¼ è‡³GitHubï¼Œæ—¥æœŸå‡æˆªæ­¢commitæ—¶é—´ã€‚</p>
<p><a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/%E7%A7%91%E6%8A%80%E7%BE%8E%E5%AD%A6.json">ç§‘æŠ€ç¾å­¦</a></p>
<p><a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/%E5%85%B1%E9%9D%92%E5%9B%A2%E4%B8%AD%E5%A4%AE.json">å…±é’å›¢ä¸­å¤®</a></p>
<p><a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/AppSo.json">AppSo</a></p>
<p><a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/%E5%8D%97%E6%96%B9%E5%91%A8%E6%9C%AB.json">å—æ–¹å‘¨æœ«</a></p>
<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<p>æŸæŸå¾®ä¿¡å…¬ä¼—å·å†å²çš„æ‰€æœ‰æ–‡ç« çš„é˜…è¯»æ•°å’Œç‚¹èµæ•°</p>
<h2 id="éš¾ç‚¹">éš¾ç‚¹</h2>
<ol type="1">
<li>å¾®ä¿¡å…¬ä¼—å·å†å²çš„æ‰€æœ‰æ–‡ç« ï¼ˆæ¥æºï¼Ÿï¼Ÿï¼Ÿï¼‰</li>
<li>æ¯ç¯‡æ–‡ç« çš„é˜…è¯»é‡å’Œç‚¹èµé‡ï¼ˆç”µè„‘ä¸Šæµè§ˆæ–‡ç« åªæ˜¾ç¤ºå†…å®¹ï¼Œæ²¡æœ‰é˜…è¯»é‡ã€ç‚¹èµé‡ã€è¯„è®ºâ€¦â€¦ï¼‰</li>
</ol>
<h3 id="çªç ´éš¾ç‚¹ä¸€">çªç ´éš¾ç‚¹ä¸€</h3>
<ol type="1">
<li><a
href="http://weixin.sogou.com/">æœç‹—å¾®ä¿¡æœç´¢</a>ï¼Œå¯ä»¥æœç´¢å¾®ä¿¡å…¬ä¼—å·æ–‡ç« ã€‚ä½†æ˜¯è²Œä¼¼åªèƒ½æ˜¾ç¤ºè¯¥å…¬ä¼—å·æœ€è¿‘åç¯‡çš„æ–‡ç« ã€‚æ”¾å¼ƒâ€¦â€¦</li>
<li>åˆ©ç”¨æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰ï¼ŒæŠ“å–æ–‡ç« ã€‚æˆæœ¬æœ‰ç‚¹å¤§â€¦â€¦ï¼Œä¸”è²Œä¼¼åªèƒ½æŠ“å–åŸåˆ›æ–‡ç« ã€‚ä¸ç¬¦åˆä¸ªäººéœ€æ±‚ï¼Œæ”¾å¼ƒâ€¦â€¦</li>
<li>åˆ©ç”¨å¾®ä¿¡ä¸ªäººè®¢é˜…å·è¿›è¡Œçˆ¬å–ï¼Œç¥å¥‡çš„æ“ä½œã€‚</li>
</ol>
<h4 id="æ“ä½œ">æ“ä½œ</h4>
<ol type="1">
<li>æ‹¥æœ‰ä¸€ä¸ªå¾®ä¿¡ä¸ªäººè®¢é˜…å·ï¼Œé™„ä¸Šç™»é™†å’Œæ³¨å†Œé“¾æ¥ã€‚<a
href="https://mp.weixin.qq.com/">å¾®ä¿¡å…¬ä¼—å¹³å°</a></li>
<li>å¥½åœ¨ä¹‹å‰æ— èŠæ³¨å†Œè¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥ç™»é™†æ“ä½œã€‚æ²¡æœ‰æ³¨å†Œçš„ç«¥é‹å¯ä»¥ç”¨è‡ªå·±çš„å¾®ä¿¡å·æ³¨å†Œä¸€ä¸‹ï¼Œè¿‡ç¨‹ååˆ†ç®€å•ï¼Œåœ¨æ­¤å°±ä¸èµ˜è¿°äº†</li>
<li>ç™»é™†ä¹‹åï¼Œç‚¹å‡»å·¦ä¾§èœå•æ â€œç®¡ç†â€-â€œç´ æç®¡ç†â€ã€‚å†ç‚¹å‡»å³è¾¹çš„â€œæ–°å»ºå›¾æ–‡ç´ æâ€</li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxMzExMzM2.png" /></p>
<ol start="4" type="1">
<li>å¼¹å‡ºä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œåœ¨ä¸Šé¢çš„å·¥å…·æ æ‰¾åˆ°â€œè¶…é“¾æ¥â€å¹¶ç‚¹å‡» <img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxNDM5MzM1.png" /></li>
<li>å¼¹å‡ºäº†ä¸€ä¸ªå°çª—å£ï¼Œé€‰æ‹©â€œæŸ¥æ‰¾æ–‡ç« â€ï¼Œè¾“å…¥éœ€è¦æŸ¥æ‰¾çš„å…¬ä¼—å·ï¼Œè¿™é‡Œç”¨â€œç§‘æŠ€ç¾å­¦â€å…¬ä¼—å·ä½œä¸ºä¾‹å­
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxNTM4MTk5.png" /></li>
<li>ç‚¹å‡»ä¹‹åï¼Œå¯ä»¥å¼¹å‡ºè¯¥å…¬ä¼—å·çš„æ‰€æœ‰å†å²æ–‡ç« </li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxNzA1NzQy.png" /></p>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡url</span></span><br><span class="line">url = <span class="string">&quot;https://mp.weixin.qq.com/cgi-bin/appmsg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨Cookieï¼Œè·³è¿‡ç™»é™†æ“ä½œ</span></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&quot;Cookie&quot;</span>: yourcookie,</span><br><span class="line">  <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.62 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">éœ€è¦æäº¤çš„data</span></span><br><span class="line"><span class="string">ä»¥ä¸‹ä¸ªåˆ«å­—æ®µæ˜¯å¦ä¸€å®šéœ€è¦è¿˜æœªéªŒè¯ã€‚</span></span><br><span class="line"><span class="string">æ³¨æ„ä¿®æ”¹yourtoken,number</span></span><br><span class="line"><span class="string">numberè¡¨ç¤ºä»ç¬¬numberé¡µå¼€å§‹çˆ¬å–ï¼Œä¸º5çš„å€æ•°ï¼Œä»0å¼€å§‹ã€‚å¦‚0ã€5ã€10â€¦â€¦</span></span><br><span class="line"><span class="string">tokenå¯ä»¥ä½¿ç”¨Chromeè‡ªå¸¦çš„å·¥å…·è¿›è¡Œè·å–</span></span><br><span class="line"><span class="string">fakeidæ˜¯å…¬ä¼—å·ç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ªidï¼Œç­‰åŒäºåé¢çš„__biz</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;token&quot;</span>: yourtoken,</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;f&quot;</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ajax&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;action&quot;</span>: <span class="string">&quot;list_ex&quot;</span>,</span><br><span class="line">    <span class="string">&quot;begin&quot;</span>: number,</span><br><span class="line">    <span class="string">&quot;count&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fakeid&quot;</span>: yourfakeid,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨getæ–¹æ³•è¿›è¡Œæäº¤</span></span><br><span class="line">content_json = requests.get(url, headers=headers, params=data).json()</span><br><span class="line"><span class="comment"># è¿”å›äº†ä¸€ä¸ªjsonï¼Œé‡Œé¢æ˜¯æ¯ä¸€é¡µçš„æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> content_json[<span class="string">&quot;app_msg_list&quot;</span>]:</span><br><span class="line">    <span class="comment"># æå–æ¯é¡µæ–‡ç« çš„æ ‡é¢˜åŠå¯¹åº”çš„url</span></span><br><span class="line">    <span class="built_in">print</span>(item[<span class="string">&quot;title&quot;</span>], <span class="string">&quot;url&quot;</span>: item[<span class="string">&quot;link&quot;</span>])</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šï¼Œå³å¯çˆ¬å–å¾®ä¿¡å…¬ä¼—å·çš„ä¸€é¡µæ•°æ®ï¼Œå¦‚æœæ˜¯çˆ¬å–æ‰€æœ‰é¡µçš„æ•°æ®ï¼Œåˆ™éœ€è¦æ”¹å˜numberè¿›è¡Œçˆ¬å–ã€‚</p>
<p>æ³¨ï¼šæ¯æ¬¡æŠ“å–å®Œä¸€é¡µä¹‹åï¼Œæœ€å¥½è®¾å®štime.sleep(3)ã€‚è¿‡å¿«ä¼šå¯¼è‡´çˆ¬å–å¤±è´¥</p>
<h3 id="çªç ´éš¾ç‚¹äºŒ">çªç ´éš¾ç‚¹äºŒ</h3>
<p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ–¹æ³•æ˜¯åœ¨ç”µè„‘ä¸Šç™»é™†å¾®ä¿¡å®¢æˆ·ç«¯ï¼Œè¿›è¡ŒæŠ“åŒ…åˆ†æã€‚ä»å®¢æˆ·ç«¯çœ‹æ¨æ–‡å¯ä»¥çœ‹åˆ°é˜…è¯»é‡ã€ç‚¹èµé‡ã€‚</p>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯Fiddlerã€‚Fiddllerå…·ä½“ä½¿ç”¨å°±ä¸èµ˜è¿°äº†ã€‚ä¸‹é¢ç›´æ¥æ¼”ç¤ºæ“ä½œ</p>
<h4 id="æ“ä½œ-1">æ“ä½œ</h4>
<ol type="1">
<li>æ‰“å¼€fiddlerå¼€å§‹ç›‘æ§</li>
<li>ç™»é™†å¾®ä¿¡å®¢æˆ·ç«¯ï¼Œæµè§ˆè¯¥å…¬ä¼—å·çš„ä»»æ„ä¸€ç¯‡æ¨æ–‡</li>
<li>å¯ä»¥è§‚å¯Ÿåˆ°è¿™é‡Œçš„å†…å®¹æ˜¾ç¤ºä¼šæœ‰é˜…è¯»é‡ã€ç‚¹èµé‡ã€è¯„è®ºç­‰</li>
<li>è§‚å¯Ÿfiddlerçš„ç›‘æ§æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ˜¾ç¤º</li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxODMzNzAx.png" />
5. å…¶ä¸­
<code>/mp/getappmgsext?...</code>æ˜¯æˆ‘ä»¬æ¨æ–‡å†…å®¹çš„urlï¼ŒåŒå‡»ä¹‹åï¼Œfiddlerç•Œé¢å³è¾¹å‡ºç°å¦‚ä¸‹å›¾æ•°æ®</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/wechat/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTE4MTkxOTA0MDAw.png" />
6. ä¸Šå›¾ä¸‹ä¾§çš„jsoné‡Œé¢çš„
<code>read_num</code>ã€<code>like_num</code>åˆ†åˆ«æ˜¯é˜…è¯»é‡å’Œç‚¹èµé‡</p>
<p>####ä»£ç å®ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡url</span></span><br><span class="line">url = <span class="string">&quot;http://mp.weixin.qq.com/mp/getappmsgext&quot;</span></span><br><span class="line"><span class="comment"># æ·»åŠ Cookieé¿å…ç™»é™†æ“ä½œï¼Œè¿™é‡Œçš„&quot;User-Agent&quot;æœ€å¥½ä¸ºæ‰‹æœºæµè§ˆå™¨çš„æ ‡è¯†</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: yourcookie,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36 MicroMessenger/6.5.2.501 NetType/WIFI WindowsWechat QBCore/3.43.27.400 QQBrowser/9.0.2524.400&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;is_only_read&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;is_temp_url&quot;</span>: <span class="string">&quot;0&quot;</span>,              </span><br><span class="line">    <span class="string">&quot;appmsg_type&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="comment"># æ–°å‚æ•°ï¼Œä¸åŠ å…¥æ— æ³•è·å–like_num</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ·»åŠ è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="string">__bizå¯¹åº”å…¬ä¼—å·çš„ä¿¡æ¯ï¼Œå”¯ä¸€</span></span><br><span class="line"><span class="string">midã€snã€idxåˆ†åˆ«å¯¹åº”æ¯ç¯‡æ–‡ç« çš„urlçš„ä¿¡æ¯ï¼Œéœ€è¦ä»urlä¸­è¿›è¡Œæå–</span></span><br><span class="line"><span class="string">keyã€appmsg_tokenä»fiddlerä¸Šå¤åˆ¶å³å¯</span></span><br><span class="line"><span class="string">pass_ticketå¯¹åº”çš„æ–‡ç« çš„ä¿¡æ¯ï¼Œè²Œä¼¼å½±å“ä¸å¤§ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»fiddlerå¤åˆ¶</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;__biz&quot;</span>: your__biz,</span><br><span class="line">    <span class="string">&quot;mid&quot;</span>: article_mid,</span><br><span class="line">    <span class="string">&quot;sn&quot;</span>: article_sn,</span><br><span class="line">    <span class="string">&quot;idx&quot;</span>: article_idx,</span><br><span class="line">    <span class="string">&quot;key&quot;</span>: yourkey,</span><br><span class="line">    <span class="string">&quot;pass_ticket&quot;</span>: pass_ticket,</span><br><span class="line">    <span class="string">&quot;appmsg_token&quot;</span>: yourappmsg_token,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ä½¿ç”¨postæ–¹æ³•è¿›è¡Œæäº¤</span></span><br><span class="line">content = requests.post(url, headers=headers, data=data, params=params).json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±äºä¸Šé¢è¿™ç§æ–¹æ³•å¯èƒ½ä¼šè·å–æ•°æ®å¤±è´¥ï¼Œå¯ä»¥é‡‡å–å­—ç¬¦ä¸²æ‹¼æ¥è¿™ç§æ–¹æ³•</span></span><br><span class="line">origin_url = <span class="string">&quot;https://mp.weixin.qq.com/mp/getappmsgext?&quot;</span></span><br><span class="line">appmsgext_url = origin_url + <span class="string">&quot;__biz=&#123;&#125;&amp;mid=&#123;&#125;&amp;sn=&#123;&#125;&amp;idx=&#123;&#125;&amp;appmsg_token=&#123;&#125;&amp;x5=1&quot;</span>.<span class="built_in">format</span>(your__biz, article_mid, article_sn, article_idx, yourappmsg_token)</span><br><span class="line">content = requests.post(appmsgext_url, headers=headers, data=data).json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–å…¶ä¸­çš„é˜…è¯»æ•°å’Œç‚¹èµæ•°</span></span><br><span class="line"><span class="built_in">print</span>(content[<span class="string">&quot;appmsgstat&quot;</span>][<span class="string">&quot;read_num&quot;</span>], content[<span class="string">&quot;appmsgstat&quot;</span>][<span class="string">&quot;like_num&quot;</span>])</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå³å¯è·å–åˆ°ä¸€ç¯‡æ–‡ç« çš„é˜…è¯»é‡ã€ç‚¹èµé‡ã€‚
<code>Cookie</code>ã€<code>req_id</code>ã€<code>pass_ticket</code>ã€<code>key</code>ã€<code>appmsg_token</code>ã€<code>__biz</code>åˆ©ç”¨fiddlerè·å–
å¦‚æœæ˜¯éœ€è¦å¤šç¯‡æ–‡ç« ï¼Œéœ€è¦æ›´æ”¹çš„å‚æ•°
<code>mid</code>ã€<code>sn</code>ã€<code>idx</code>
å¦‚æœæ˜¯ä¸åŒå…¬ä¼—å·ï¼Œå°±éœ€è¦æ ¹æ®urlä¿®æ”¹ <code>__biz</code>
å¤šç¯‡æ–‡ç« çš„çˆ¬å–ï¼Œéœ€è¦æ ¹æ®ä¹‹å‰çˆ¬å–åˆ°çš„urlè¿›è¡Œæå–å…³é”®ä¿¡æ¯ï¼Œåˆ†åˆ«çˆ¬å–ã€‚
æ³¨ï¼šæ¯æ¬¡æŠ“å–å®Œä¸€é¡µä¹‹åï¼Œæœ€å¥½è®¾å®štime.sleep(3)ã€‚è¿‡å¿«ä¼šå¯¼è‡´çˆ¬å–å¤±è´¥ã€‚</p>
<h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h2>
<p>ä»¥ä¸Šå°±æ˜¯è¿™æ¬¡å¾®ä¿¡çˆ¬è™«çš„ç»å†ã€‚</p>
<p>éœ€è¦æŒæ¡çš„åŸºæœ¬æŠ€èƒ½ï¼š</p>
<ol type="1">
<li>pythonçˆ¬è™«çš„è¯­æ³•</li>
<li>Chromeã€FiddleråŸºæœ¬ä½¿ç”¨</li>
<li>ç½‘ç»œçˆ¬è™«åŸºæœ¬å¸¸è¯†</li>
</ol>
<p>ç¼ºé™·ï¼š</p>
<ol type="1">
<li>ä½¿ç”¨Cookieç™»é™†ï¼Œæœªå®ç°è‡ªåŠ¨ç™»é™†</li>
<li>keyã€appmsg_tokenä¸€äº›å…³é”®å‚æ•°éœ€è¦è¿›è¡Œæ‰‹åŠ¨è·å–</li>
<li>å®é™…è¿è¡Œä¹‹åï¼Œå°±ç®—è®¾å®šäº†çˆ¬å–é—´éš™æ—¶é—´ï¼Œè¿˜æ˜¯ä¼šè¢«å°ç¦ï¼ˆè·å–é“¾æ¥æ—¶ï¼‰ã€‚</li>
</ol>
<p>è¯´æ˜ï¼š</p>
<ol type="1">
<li>ç½‘ä¸Šä¸€äº›è¯´æ³•ï¼ŒkeyåŠå°æ—¶è¿‡æœŸï¼Œæˆ‘å¥½åƒæ²¡æœ‰é‡åˆ°ã€‚</li>
<li>ä»£ç ä¸­è‹¥æœ‰ç»†èŠ‚é—®é¢˜ï¼Œæ¬¢è¿æŒ‡å‡ºè®¨è®º</li>
</ol>
<p>Githubä¸Šå·²ç»å®ç°äº†ç¬¬1ã€2ç‚¹ï¼Œæ¬¢è¿å›åˆ°æ–‡ç« å¼€å¤´çœ‹githubä¸Šçš„å®ç°è¿‡ç¨‹ã€‚</p>
<p>å…³äºè¢«å°ç¦çš„é—®é¢˜ï¼Œå·²æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå‡æ”¾åœ¨githubä¸Šï¼Œåœ¨è¿™ä¸åšè®²è§£ã€‚</p>
<ol type="1">
<li>seleniumè§£å†³æ–¹æ¡ˆï¼Œæé«˜çº¦åå€æŠ“å–é‡ï¼ˆä¸ç¡®å®šï¼‰ã€‚ä¼˜ç‚¹ï¼šæé«˜æŠ“å–é‡ï¼›ç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢ï¼Œä¸ä¸€å®šèƒ½å®Œå…¨æŠ“å–å®Œæ•´ï¼ŒæŠ“å–é‡ä¸ç¡®å®šã€‚<a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/test/test_seleinum/test_seleinum.py">test_seleinum.py</a></li>
<li>åˆ©ç”¨ä¸ªäººå¾®ä¿¡å·çš„æŸ¥çœ‹å…¬ä¼—å·å†å²æ¶ˆæ¯ï¼ŒæŠ“å–é‡åœ¨500æ¡ä»¥ä¸Šï¼Œå…·ä½“æœªæµ‹è¯•ã€‚ä¼˜ç‚¹ï¼šæŠ“å–é‡æœ€å¤šçš„æ–¹æ¡ˆï¼›ç¼ºç‚¹ï¼šçŸ­æ—¶é—´å†…ï¼ˆ5-10åˆ†é’Ÿï¼‰æ— æ³•æŸ¥çœ‹å†å²æ¶ˆæ¯ï¼Œæˆ–è€…è¯´æ— æ³•æŒç»­æŠ“å–ï¼›ä¸ä¿è¯å¾®ä¿¡å·ä¼šè¢«å°å·ã€‚<a
href="https://github.com/wnma3mz/wechat_articles_spider/blob/master/test/test_GetUrls.py">test_GetUrls.py</a></li>
</ol>
]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>å¾®ä¿¡</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡ä»é›¶åˆ°ä¸€</title>
    <url>/hexo_blog/2019/05/28/%E8%AE%BA%E6%96%87%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80/</url>
    <content><![CDATA[<p>å¦‚ä½•å†™å‡ºä¸€ç¯‡è®ºæ–‡</p>
<span id="more"></span>
<h2 id="è®ºæ–‡ä»é›¶åˆ°ä¸€">è®ºæ–‡ä»é›¶åˆ°ä¸€</h2>
<p>æ‰€è°“å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œå¼€å¤´å…ˆä»‹ç»ä¸€äº›å·¥å…·ä¸æŠ€èƒ½ï¼ˆçš†éå¿…éœ€ï¼‰ã€‚</p>
<h3 id="å·¥å…·ä¸æŠ€èƒ½">å·¥å…·ä¸æŠ€èƒ½</h3>
<ul>
<li>LaTexï¼ˆè®ºæ–‡å†™ä½œå·¥å…·ï¼Œå½“ç„¶Wordä¹Ÿè¡Œï¼‰ï¼Œä»¥ä¸‹æ˜¯é€‰ç”¨å·¥å…·
<ul>
<li><a href="http://www.tablesgenerator.com/latex_tables">Create LaTeX
tables online</a></li>
<li><a href="https://www.overleaf.com/?&amp;nocdn=true">Overleaf, Online
LaTeX Editor</a></li>
<li><a href="http://www.latextemplates.com/">LaTeX Templates</a></li>
</ul></li>
<li>Visioï¼ˆå¾®è½¯å®¶çš„ç”»å›¾å·¥å…·ï¼Œä¸»è¦æ˜¯æµç¨‹å›¾ä¹‹ç±»çš„ï¼Œå½“ç„¶PPTä¹Ÿè¡Œï¼‰</li>
<li>PhotoShopï¼ˆEmmmï¼Œæˆ‘åæ­£ä¸ç”¨ï¼‰</li>
<li>Matlabæˆ–Pythonçš„Matplotlibï¼ˆç»˜åˆ¶å±•ç°æ•°æ®çš„å›¾è¡¨ï¼Œå½“ç„¶Originä¹Ÿè¡Œï¼‰</li>
<li>Zoteroï¼ˆæ–‡çŒ®æ•´ç†å·¥å…·ï¼Œå½“ç„¶ä¸ç”¨ä¹Ÿè¡Œï¼‰</li>
<li>SumatraPDFæˆ–Adobe Acrobat DCï¼ˆPDFé˜…è¯»å™¨ï¼‰</li>
<li>çŸ¥ç½‘ï¼ˆè®ºæ–‡å¯è’™ç½‘ç«™ã€‚ã€‚ã€‚æ›´å¤šçš„æ¨èè°·æ­Œå­¦æœ¯ï¼ŒWeb Of
Scienceä¸Arxivï¼‰</li>
<li>Sci-Hubæˆ–Sci-Hubçš„telegram botï¼ŒåŒæ—¶æ¨è<a
href="https://lunwen.im/">https://lunwen.im/</a>ï¼ˆè®ºæ–‡ä¸‹è½½ï¼‰</li>
<li>å¤©è‹¥OCRæ–‡å­—è¯†åˆ«ï¼ˆOCRæ–‡å­—è¯†åˆ«ï¼‰</li>
<li>CopyTranslatorï¼ˆå¤åˆ¶ç¿»è¯‘ï¼‰</li>
<li>Mathpix
Snipï¼ˆå›¾ç‰‡è½¬å…¬å¼ï¼Œè¿™ä¸ªéœ€è¦è®¢é˜…äº†ï¼Œæ‰‹æœºç«¯è¿˜æ˜¯å…è´¹çš„ï¼Œç»•è¿‡æ–¹æ³•è§é™„å½•ï¼‰</li>
<li>1Checkerå’ŒGrammarlyï¼ˆè¯­æ³•æ£€æŸ¥å·¥å…·ï¼‰</li>
</ul>
<p>ä»¥ä¸Šé™¤PhotoShopå¤–ï¼Œå…¶ä½™æˆ‘åœ¨ç”¨ï¼Œå½“ç„¶å¤§éƒ¨åˆ†å…¶å®ä¸ç”¨æˆ–ç”¨å…¶ä»–çš„ä¹Ÿè¡Œã€‚è¯´ç™½äº†å•å‡­Wordèƒ½ä¸èƒ½å†™å‡ºå¥½è®ºæ–‡ï¼Œé‚£è‚¯å®šæ˜¯å¯ä»¥çš„ã€‚è¿™äº›åªä¸è¿‡æ˜¯å¤–åŠ›ç½¢äº†ï¼Œä¸»è¦è¿˜æ˜¯çœ‹è‡ªå·±ã€‚</p>
<h3 id="æ­£æ–‡">æ­£æ–‡</h3>
<h4 id="æ–‡çŒ®è°ƒç ”">æ–‡çŒ®è°ƒç ”</h4>
<p>è¯¸å¦‚è”ç³»è€å¸ˆå’Œç¡®å®šæ–¹å‘ä¹‹ç±»çš„åœ¨è¿™é‡Œå°±ä¸è°ˆäº†ï¼Œä»æ–‡çŒ®æ£€ç´¢å¼€å§‹ä»‹ç»ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæœªæ¥è§¦è¿‡çš„æ–¹å‘ï¼Œå¦‚ä½•ä»é›¶å¼€å§‹å­¦ä¹ å‘¢ã€‚è¿™é‡Œå¦‚æœæ˜¯å¯¼å¸ˆç»™å‡ºä¸€ä¸ªè®ºæ–‡å¤§ç¤¼åŒ…è‡ªç„¶æ˜¯æœ€å¥½ï¼Œä½†æˆ‘è‡ªå·±çš„ç»å†å‘Šè¯‰æˆ‘è¿˜æ˜¯è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿã€‚æˆ‘è‡ªå·±çš„æ–¹æ³•æ˜¯ï¼Œä»çŸ¥ç½‘å¼€å§‹å­¦ä¹ ï¼Œå½“ç„¶å¦‚æœè‹±è¯­è¶³å¤Ÿçš„è¯ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡æ­¤æ­¥éª¤ã€‚çŸ¥ç½‘æ£€ç´¢ç›¸å…³å…³é”®è¯ï¼Œç­›é€‰å‡ºç¡•å£«è®ºæ–‡ä¸åšå£«è®ºæ–‡ï¼Œä¸‹è½½20ç¯‡ï¼ˆä¸€é¡µå·¦å³ï¼‰ã€‚è¿™é‡Œé¢˜å¤–è¯ï¼Œå…³äºçŸ¥ç½‘PDFæ ¼å¼ä¸‹è½½é—®é¢˜ï¼Œè¯·ä½¿ç”¨<a
href="http://gb.oversea.cnki.net/kns55/default.aspx">æµ·å¤–çŸ¥ç½‘</a>ï¼Œå¦‚æœå­¦æ ¡æ²¡ç‰ˆæƒçš„è¯è¯·å¦å¯»ä»–è·¯ï¼ˆæ–¹æ³•å¾ˆå¤šåœ¨æ­¤ä¸ä»‹ç»ï¼Œä¸ªäººè¿˜æ˜¯åº”è¯¥å…·å¤‡åŸºæœ¬çš„æ£€ç´¢èƒ½åŠ›ï¼‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©å­¦ä½è®ºæ–‡å‘¢ï¼Ÿå› ä¸ºä¸­å›½çš„å­¦ä½è®ºæ–‡æ˜¯ç”¨ä¸­æ–‡å†™çš„ï¼Œçœ‹å¾—æ‡‚ä¸”è´¨é‡ä¸Šæœ‰ä¸€å®šçš„ä¿éšœã€‚å­¦ä½è®ºæ–‡å¾€å¾€æ˜¯ä¸€ä¸ªç ”ç©¶ç”Ÿå‡ å¹´å†…å‡ ä¸ªå·¥ä½œçš„æ€»ç»“ï¼Œæ•…åœ¨èƒŒæ™¯ä¸æ–¹æ³•ä»‹ç»ä¸Šä¼šæ›´ä¸ºå…¨é¢ï¼Œè¯­è¨€å¯¹äºæ™®é€šè¯»è€…æ›´ä¸ºå‹å¥½ï¼Œä¸“ä¸šæœ¯è¯­å¤§å¤šéƒ½è¿›è¡Œäº†è§£é‡Šã€‚æ‰€ä»¥åœ¨é˜…è¯»æ—¶ï¼Œé¦–å…ˆå¯ä»¥ç›´æ¥ä»å¤´å¼€å§‹é˜…è¯»ï¼ˆç”šè‡³å¯ä»¥ç•¥å»æ‘˜è¦ï¼‰ï¼Œäº†è§£æ¸…æ¥šä¸€ä¸ªè¡Œä¸šèƒŒæ™¯å’Œç›¸å…³æ–¹æ³•åï¼Œåé¢é˜è¿°ä½œè€…çš„å·¥ä½œï¼ˆæ–‡ç« ä¸»ä½“ï¼‰å¯ä»¥æš‚æ—¶ç•¥å»ä¸çœ‹ã€‚åœ¨é˜…è¯»å®Œ20ç¯‡ï¼ˆç”šè‡³ä¸éœ€è¦20ç¯‡ï¼‰åï¼ŒåŸºæœ¬å¯ä»¥äº†è§£æ¸…æ¥šè¯¥æ–¹å‘çš„èƒŒæ™¯ä¸ç›¸å…³çŸ¥è¯†ï¼Œåˆ°æ­¤ä¸ºæ­¢ç›¸å½“äºè¿›è¡Œäº†ä¸€ä¸ªæ–¹å‘çš„ç§‘æ™®å·¥ä½œã€‚æ›´è¿›ä¸€æ­¥ï¼Œéœ€è¦å¯¹20ç¯‡ä¸­æ„Ÿå…´è¶£çš„å·¥ä½œè¿›è¡Œæ›´è¿›ä¸€æ­¥çš„é˜…è¯»ä¸äº†è§£ï¼Œæ­¤æ—¶å°±éœ€è¦è¿›è¡Œæ–‡çŒ®æ•´ç†ï¼Œæå–æœ‰æ•ˆä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥å­¦ä¹ åˆ°åˆ«äººçš„æ–¹æ³•ä¸åº”ç”¨åœºæ™¯ï¼Œç”šè‡³å¯ä»¥å°è¯•å»å¤ç°ï¼Œæå‡ºè‡ªå·±çš„è§‚ç‚¹ã€‚</p>
<p>ç¬¬ä¸€æ­¥åŸºæœ¬åˆ°æ­¤ç»“æŸï¼Œä½†è¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚å“ªæ€•æ˜¯æœ€æ–°çš„ä¸­æ–‡æ–‡ç« ï¼Œå¯èƒ½ç¦»å›½é™…å‰æ²¿è¿˜æ˜¯å…·æœ‰ä¸€å®šçš„å·®è·ï¼Œä¸”æœ‰äº›æ–¹å‘å¾ˆæ–°çš„å·¥ä½œï¼Œå›½å†…ç›¸å…³è®ºæ–‡è¿˜æ¯”è¾ƒå°‘ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å­¦ä¹ è‹±æ–‡è®ºæ–‡ã€‚ä½¿ç”¨<a
href="https://scholar.google.cn/">è°·æ­Œå­¦æœ¯</a>æˆ–<a
href="http://apps.webofknowledge.com/UA_GeneralSearch_input.do?product=UA&amp;search_mode=GeneralSearch&amp;SID=8BsQBbbIKZlBjqwLoEq&amp;preferencesSaved=">Web
Of
Science</a>ï¼ŒåŒæ ·ä¹Ÿæ˜¯æœç´¢å…³é”®è¯ï¼ˆè‹±æ–‡ï¼‰ï¼Œæˆ–è€…æ ¹æ®å‰é¢é˜…è¯»çš„å­¦ä½è®ºæ–‡æŸ¥çœ‹å“ªäº›è‹±æ–‡æ–‡çŒ®ç»å¸¸è¢«å¼•ç”¨ï¼Œå¯ä»¥ç›´æ¥æœç´¢ç›¸å…³æ–‡çŒ®ã€‚é™¤äº†ç›´æ¥æœç´¢å…³é”®è¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªç‚¹æ¥è¿›è¡Œæœç´¢ï¼ˆè™½ç„¶æˆ‘è‡ªå·±ä¸æ€ä¹ˆç”¨è¿™ä¸ªæ–¹æ³•ï¼‰ï¼Œå·²çŸ¥æŸä¸ªæ•™æˆåœ¨è¯¥æ–¹å‘æœ‰æ‰€å»ºæ ‘ï¼Œæ•…å¯ä»¥ç›´æ¥æœç´¢è¯¥æ•™æˆåå­—ï¼›å·²çŸ¥æŸé«˜æ ¡å­¦é™¢åœ¨æ­¤æ–¹å‘å¤„äºå›½é™…é¢†å…ˆæ°´å¹³ï¼Œå¯ä»¥ç›´æ¥æœç´¢æœºæ„ç­‰ã€‚åœ¨å¾—åˆ°ç›¸å…³å‡ ç¯‡è‹±æ–‡è®ºæ–‡åï¼Œå¯ä»¥æ ¹æ®å¼•ç”¨çš„è®ºæ–‡æ¥å›æº¯æ›´æ—©ä¹‹å‰çš„è®ºæ–‡ç ”ç©¶ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©å¦‚è°·æ­Œå­¦æœ¯ç­‰æŸ¥çœ‹æŸç¯‡æ–‡ç« è¢«å“ªäº›æ–‡ç« å¼•ç”¨ï¼Œå¯ä»¥çŸ¥é“è¯¥ç¯‡æ–‡ç« çš„æ–¹æ³•æœ€æ–°è¿›å±•ï¼ˆæœ‰å¯èƒ½åœ¨æŸä¸ªæ—¶é—´æ®µå°±è¢«ç ”ç©¶äººå‘˜æ”¾å¼ƒäº†ï¼‰ã€‚è¿™æ ·åœ¨é˜…è¯»å‡ åç¯‡è‹±æ–‡æ–‡ç« åï¼Œå°±èƒ½äº†è§£åˆ°è¯¥æ–¹å‘çš„æœ€æ–°è¿›å±•ä¸æˆæœï¼ˆæˆ–è€…ç›´æ¥ç­›é€‰æ—¶é—´èŠ‚ç‚¹ä¸ºæœ€è¿‘ä¸€å¹´æˆ–åŠå¹´çš„å·²å‘è¡¨è®ºæ–‡ï¼‰ã€‚å½“ç„¶ï¼Œåœ¨ä¸€å¼€å§‹é˜…è¯»è‹±æ–‡æ–‡çŒ®æ—¶ç¡®å®ä¼šæ¯”è¾ƒåƒåŠ›ï¼Œä½†æ˜¯åœ¨å‰æœŸæœ‰ä¸­æ–‡æ–‡çŒ®é˜…è¯»çš„åŸºç¡€ä¸Šï¼ˆæ–‡ç« ä¼šå¤¹æ‚ç€ä¸“ä¸šæœ¯è¯­ï¼‰ï¼Œè¿™æ ·é˜…è¯»èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼ŒæŠŠé¢†åŸŸå†…åè¯åƒé€åï¼Œæ¥ä¸‹æ¥ä¸è¿‡æ˜¯ä¸€äº›åŠ¨è¯å½¢å®¹è¯è€Œå·²ã€‚å­¦ä¹ æ›²çº¿å¤§æ¦‚æ˜¯å…ˆéš¾åæ˜“çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸€å¼€å§‹éœ€è¦å¯¹æŸç¯‡ï¼ˆæˆ–æŸå‡ ç¯‡ï¼‰ä¼˜ç§€è®ºæ–‡è¿›è¡Œç²¾è¯»ï¼ŒèŠ±è´¹å¤§é‡æ—¶é—´å»ç¿»è¯‘ç ”ç©¶å¤ç°ï¼Œåç»­å°±å¯ä»¥æ³›è¯»äº†ã€‚å…³äºæ–‡ç« é˜…è¯»é‡çš„é—®é¢˜ï¼Œè´µç²¾ä¸è´µå¤šï¼Œä¸ä¸€å®šçœŸçš„è¦é˜…è¯»åˆ°å¾ˆå¤šç¯‡è®ºæ–‡æ‰èƒ½å¼€å§‹è‡ªå·±çš„å·¥ä½œã€‚</p>
<p>ä¸‹ä¸€é˜¶æ®µå¼€å§‹å‰ï¼Œå»ºè®®å¯¹é˜…è¯»çš„æ–‡çŒ®è¿›è¡Œæ•´ç†ï¼Œæ¨èä½¿ç”¨<strong>Zotero</strong>ï¼Œé…åˆåšæœäº‘æ›´é¦™ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•è‡ªè¡Œæ£€ç´¢ã€‚è¿˜æœ‰Arxivçš„è¯ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ–‡çŒ®æ£€ç´¢å·¥å…·æ¥ä½¿ç”¨ï¼Œä½†æ˜¯æœ‰é™å®šä¸“ä¸šäººç¾¤ã€‚</p>
<h4 id="å®éªŒ">å®éªŒ</h4>
<p>å…¶å®å…³äºå®éªŒéƒ¨åˆ†å¯ä»‹ç»çš„ä¸œè¥¿ï¼Œæ¯ä¸ªä¸“ä¸šç”šè‡³æ¯ä¸ªæ–¹å‘çš„å®éªŒå†…å®¹éƒ½ä¸å¤§ä¸€æ ·ã€‚æ‰€ä»¥åœ¨è¿™é‡Œç»™å‡ºçš„å»ºè®®å°±æ˜¯æœ‰é—®é¢˜åŠæ—¶ä¸è€å¸ˆåé¦ˆï¼Œè·Ÿç›¸å…³æ–¹å‘çš„å¸ˆå…„å¸ˆå§äº¤æµã€‚å¦‚æœæ˜¯ç¡¬ä»¶èµ„æºé—®é¢˜çš„è¯ï¼Œé‚£æˆ‘ä¹Ÿã€‚ã€‚ã€‚å—¯ï¼Œå…³äºæ·±åº¦å­¦ä¹ çš„è¯ï¼Œå¯ä»¥æš‚æ—¶å‹‰å¼ºç”¨Googleçš„Colabã€‚è¿˜æœ‰è¯¸å¦‚ç½‘ç»œç¯å¢ƒè¿™ç§ï¼Œå„ç§å·¥å…·ä½¿ç”¨è¿™ç§ï¼Œè¿˜æ˜¯éœ€è¦æ…¢æ…¢è¸©å‘çš„ã€‚è¿™é‡Œæˆ‘æœ‰å‡ ä¸ªäººçš„å°Trickå¯ä»¥åˆ†äº«å‡ºæ¥ã€‚</p>
<ul>
<li>è°·æ­Œäº‘ç›˜æ–‡ä»¶è·å–ç›´é“¾
<ul>
<li>å…±äº«æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶id</li>
<li>æµ·å¤–æœåŠ¡å™¨ï¼Œè·å–è½¬æ¢è„šæœ¬<code>wget --no-check-certificate -qO /usr/local/bin/gdlink 'https://moeclub.org/attachment/LinuxShell/gdlink.sh' &amp;&amp; chmod a+x /usr/local/bin/gdlink</code></li>
<li>è¿è¡Œgdlinkï¼Œè·å–ç›´é“¾æ¥ã€‚gdlink
'18v_9Bet11B3ZZ3GqWCOa3yTuY2Lzzaav'ã€‚è¾“å‡ºå¯ç›´æ¥ä¸‹è½½</li>
</ul></li>
<li>æµ·å¤–æœåŠ¡å™¨å¯ä»¥åˆ©ç”¨Githubçš„å­¦ç”ŸåŒ…è–…ä¸€ä¸‹<strong>digitalocean</strong>çš„ç¾Šæ¯›ï¼Œæ—¶é•¿ä¸€å¹´å·¦å³ï¼›å¾®è½¯çš„è²Œä¼¼ä¹Ÿå¯ä»¥ï¼Œè¿˜æ²¡è¯•ã€‚</li>
<li>å…³äºå†…ç½‘çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯å±€åŸŸç½‘è¿˜å¥½è¯´ï¼Œå¯ä»¥ä½¿ç”¨VSCodeçš„æ’ä»¶ç¼–è¾‘ä»£ç ï¼Œä¼ è¾“æ–‡ä»¶ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœä¸æ˜¯å±€åŸŸç½‘çš„è¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a>
ä½¿ç”¨sshè¿›è¡Œé…ç½®ï¼Œå‡ è¡Œå‘½ä»¤å°±okäº†ï¼Œæˆ‘æ„Ÿè§‰æ¯”ä¸€èˆ¬çš„å†…ç½‘ç©¿é€æ–¹ä¾¿å¾ˆå¤šã€‚å½“ç„¶éœ€è¦ä¸€ä¸ªä¸­è½¬æœåŠ¡å™¨è¿™ç§ã€‚</li>
</ul>
<h4 id="å†™ä½œä¸æŠ•ç¨¿">å†™ä½œä¸æŠ•ç¨¿</h4>
<p>å†™ä½œéƒ¨åˆ†ï¼Œå¤§éƒ¨åˆ†éƒ½å¯ä»¥ä»ç½‘ä¸Šæœå¾—åˆ°ã€‚è¿™é‡Œç»™ä¸ªå»ºè®®æ˜¯è¯´ï¼Œå¯ä»¥å…ˆä»æ¨¡ä»¿å¼€å§‹ï¼Œä¸æ˜¯å¤åˆ¶ç²˜è´´ï¼Œæ˜¯æ¨¡ä»¿å…¶ä»–è®ºæ–‡çš„æ ¼å¼ä»¥åŠå›¾è¡¨å½¢å¼ï¼ˆç”¨çš„ä»€ä¹ˆå›¾è¯´æ˜çš„ä»€ä¹ˆé—®é¢˜ï¼‰ã€‚å†™ä½œå·¥å…·è¿˜æ˜¯æ¨èä½¿ç”¨LaTexï¼Œæœ€çœå¿ƒçš„å…¶å®å°±ä¸¤ç‚¹æ’ç‰ˆä¸æ’å…¥å‚è€ƒæ–‡çŒ®ã€‚å½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–ä¼˜ç‚¹ï¼Œæ¯”å¦‚æ•°å­¦å…¬å¼çš„ä¹¦å†™ã€‚è¿™é‡Œå¼•ç”¨æ–‡çŒ®çš„è¯ï¼Œå°±ä½“ç°å‡ºäº†ä¸ºä»€ä¹ˆè¦æ•´ç†æ–‡çŒ®è¿™ä¸€æ­¥éª¤ï¼Œå¦‚æœå€ŸåŠ©æ–‡çŒ®æ•´ç†å·¥å…·ï¼Œæ›´æ˜¯å¯ä»¥å‡å°‘å¾ˆå¤šä¸å¿…è¦çš„æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰å·¥å…·çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨è°·æ­Œå­¦æœ¯å¯¼å‡ºå¼•ç”¨æ ¼å¼ï¼ˆå…·ä½“è‡ªè¡Œæ£€ç´¢ï¼‰ï¼›æœ‰å·¥å…·çš„è¯ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å·¥å…·ä¸€é”®å¯¼å‡ºï¼Œæ— è®ºæ˜¯wordå†™ä½œè¿˜æ˜¯LaTexå†™ä½œã€‚</p>
<p>å›¾ç‰‡ä¸€å¾‹æ¨èä½¿ç”¨svgæ ¼å¼ï¼Œä½†æ˜¯ç”±äºLaTexä¸ç›´æ¥æ”¯æŒsvgï¼Œæ•…éœ€è¦æ¢æˆepsæ ¼å¼ã€‚ç»˜å›¾å·¥å…·åœ¨å‰é¢ä¹Ÿè¿›è¡Œäº†ä»‹ç»ï¼Œè‡ªè¡Œå­¦ä¹ ã€‚é€šç¯‡æ–‡ç« å†™å®Œä¹‹åï¼Œå»ºè®®æ˜¯æ‰¾ä½¿ç”¨è‹±æ–‡ä¸ºæ¯è¯­çš„äººè¿›è¡Œé˜…è¯»ï¼ˆè¿™ä¸€ç‚¹æŒºéš¾çš„å¯¹äºå¤§å¤šå›½å†…å­¦ç”Ÿï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è¯­æ³•æ£€æŸ¥å·¥å…·ï¼ˆåœ¨å‰é¢ä¹Ÿæœ‰ä»‹ç»ï¼‰ã€‚è¿˜æœ‰ä¸€äº›è¯æ±‡çš„ä½¿ç”¨ï¼Œé¿å…æŸäº›è¯é«˜é¢‘ä½¿ç”¨ï¼ŒæŸ¥é˜…åŒä¹‰è¯è¯å…¸è¿›è¡Œæ›¿æ¢ï¼Œä¹Ÿå¯ä»¥æé«˜è®ºæ–‡çš„è¯­è¨€æ°´å¹³ã€‚</p>
<p>æŠ•ç¨¿çš„è¯ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æœŸåˆŠé€‰æ‹©çš„é—®é¢˜ã€‚è¿™ä¸ªä¸€èˆ¬å¯ä»¥ç”±è€å¸ˆæ¨èï¼Œå¦‚æœæ²¡æœ‰æ¨èçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨<a
href="http://www.letpub.com.cn/index.php?page=journalapp&amp;view=search">lethub</a>è¿›è¡ŒæŸ¥æ‰¾ç›¸å…³æ–¹å‘çš„æœŸåˆŠå¹¶ä¸”åˆ©ç”¨<a
href="https://www.scimagojr.com/journalrank.php">journalrank</a>å…¨é¢çš„æŸ¥æ‰¾IFå’Œåˆ†åŒºç­‰ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯æŠ•ç¨¿æ—¶é—´ä¸æŠ•ç¨¿éš¾åº¦ä»…åšéƒ¨åˆ†å‚è€ƒï¼Œå¯ä¿¡åº¦æœ‰å¾…å•†æ¦·ï¼Œæ›´ç§‘å­¦åœ°æ–¹æ³•æ˜¯åˆ°æœŸåˆŠå®˜ç½‘çœ‹æœ€è¿‘çš„æ”¶å½•æœŸåˆŠä»¥åŠæ”¶å½•è®ºæ–‡çš„æ–¹å‘ã€‚å…³äºOAçš„é—®é¢˜ï¼ŒOAï¼ŒOpenAccessï¼Œå¼€æ”¾æœŸåˆŠï¼Œè¯»è€…å¯å…è´¹é˜…è¯»æœŸåˆŠå†…çš„è®ºæ–‡ã€‚æ‰€ä»¥æ­¤ç±»æœŸåˆŠçš„æ”¶å½•ä¸€èˆ¬æ›´å¤§ï¼Œå®¡ç¨¿é€Ÿåº¦æ›´å¿«ï¼Œä½†ä¸ä¹‹ç›¸å¯¹çš„ç‰ˆé¢è´¹æ›´é«˜ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…æœŸåˆŠæ…æŠ•ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæœŸåˆŠæäº¤åˆç¨¿éƒ½æ¯”è¾ƒéšæ„ï¼Œå¯ä»¥ç›´æ¥æäº¤pdfæˆ–docxï¼Œå¯ä»¥ä¸æäº¤åŸå§‹ç¨¿ä»¶è¿™ç§ã€‚åç»­è¦ä¿®æ”¹çš„è¯ï¼Œæ¯”å¦‚LaTexå®˜ç½‘ä¼šæœ‰å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œååˆ†æ–¹ä¾¿ã€‚Wordçš„è¯ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå¯èƒ½ç¼–è¾‘ä¼šå¸®å¿™ã€‚å…³äºæ¨èå®¡ç¨¿äººçš„é—®é¢˜ï¼Œæœ‰äº›æœŸåˆŠåœ¨æäº¤æ—¶ä¼šè¦æ±‚æ¨èå®¡ç¨¿äººï¼Œè¿™é‡Œåº”è¯¥æ˜¯å¯ä»¥éšæ„çš„ï¼Œä¹Ÿä¸ä¸€å®šçœŸçš„æ˜¯æ¨èå®¡ç¨¿äººå®¡ç¨¿ï¼Œæ•…è¿™é‡Œå¯ä»¥æ¨èå…³ç³»å¥½çš„æœ‹å‹ã€‚ã€‚ã€‚å…³äºCoverLetterçš„é—®é¢˜ï¼Œæœ‰çš„æœŸåˆŠæ˜¯éœ€è¦æäº¤CoverLetterï¼Œç±»ä¼¼äºè‡ªèä¿¡è¿™ç§ï¼Œæ ¼å¼ç½‘ä¸Šä¹ŸåŸºæœ¬æ‰¾å¾—åˆ°ã€‚åŸºæœ¬å†…å®¹å¤§æ¦‚å°±æ˜¯è®ºæ–‡å†…å®¹ä»¥åŠä¸ªäººè”ç³»æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¦æŠ•è¯¥æœŸåˆŠç­‰ã€‚</p>
<p>å®¡ç¨¿åï¼Œè¿”å›çš„æ„è§ä¹Ÿå°±é‚£å‡ ç§ï¼Œå…·ä½“æ„æ€å¯ä»¥æŸ¥é˜…ç½‘ä¸Šç›¸å…³å†…å®¹ã€‚è¿™é‡Œä»…æä¸€ç‚¹å°±æ˜¯ï¼Œå®¡ç¨¿æ„è§éœ€è¦å®¢è§‚çœ‹å¾…ï¼Œä¸æ˜¯æ‹’äº†å°±è¡¨ç¤ºæ–‡ç« ä¸è¡Œï¼Œéœ€è¦åšæŒæŠ•ç¨¿ï¼Œæ ¹æ®å®¡ç¨¿æ„è§æ”¹è¿›åï¼ŒæŠ•å…¶ä»–æœŸåˆŠã€‚å…³äºä¸€ç¨¿å¤šæŠ•çš„é—®é¢˜ï¼Œè¿™ç§é—®é¢˜è¿˜æ˜¯ä¸è¦å‡ºç°ï¼Œä¸ç„¶ä¼šå¯¹è®ºæ–‡çš„ä½œè€…ä»¬äº§ç”Ÿä¸è‰¯å½±å“ã€‚</p>
<p>ç¥å„ä½è®ºæ–‡é«˜æ•ˆäº§å‡ºï¼ŒæŠ•ç¨¿å¿…ä¸­ï¼</p>
<p>P.S. å¦‚è¿˜æœ‰ç›¸å…³ç–‘æƒ‘ï¼Œæ¬¢è¿ç•™è¨€oré‚®ä»¶wnma3mz@gmail.comï¼</p>
<h3 id="é™„å½•">é™„å½•</h3>
<h4 id="latex">LaTex</h4>
<p><strong>LaTeX</strong>ï¼Œæ˜¯ä¸€ç§åŸºäº<a
href="https://zh.wikipedia.org/wiki/TeX">TeX</a>çš„<a
href="https://zh.wikipedia.org/wiki/æ’ç‰ˆ">æ’ç‰ˆ</a>ç³»ç»Ÿï¼Œç”±<a
href="https://zh.wikipedia.org/wiki/ç¾å›½">ç¾å›½</a><a
href="https://zh.wikipedia.org/wiki/è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a>å®¶<a
href="https://zh.wikipedia.org/wiki/è±æ–¯åˆ©Â·å…°ä¼¯ç‰¹">è±æ–¯åˆ©Â·å…°ä¼¯ç‰¹</a>åœ¨20ä¸–çºª80å¹´ä»£åˆæœŸå¼€å‘ï¼Œåˆ©ç”¨è¿™ç§æ ¼å¼ç³»ç»Ÿçš„å¤„ç†ï¼Œå³ä½¿ä½¿ç”¨è€…æ²¡æœ‰æ’ç‰ˆå’Œç¨‹åºè®¾è®¡çš„çŸ¥è¯†ä¹Ÿå¯ä»¥å……åˆ†å‘æŒ¥ç”±TeXæ‰€æä¾›çš„å¼ºå¤§åŠŸèƒ½ï¼Œä¸å¿…ä¸€ä¸€äº²è‡ªå»è®¾è®¡æˆ–æ ¡å¯¹ï¼Œèƒ½åœ¨å‡ å¤©ï¼Œç”šè‡³å‡ å°æ—¶å†…ç”Ÿæˆå¾ˆå¤šå…·æœ‰ä¹¦ç±å“è´¨çš„å°åˆ·å“ã€‚å¯¹äºç”Ÿæˆå¤æ‚è¡¨æ ¼å’Œ<a
href="https://zh.wikipedia.org/wiki/æ•°å­¦">æ•°å­¦</a>å…¬å¼ï¼Œè¿™ä¸€ç‚¹è¡¨ç°å¾—å°¤ä¸ºçªå‡ºã€‚å› æ­¤å®ƒéå¸¸é€‚ç”¨äºç”Ÿæˆé«˜å°åˆ·è´¨é‡çš„<a
href="https://zh.wikipedia.org/wiki/ç§‘æŠ€">ç§‘æŠ€</a>å’Œæ•°å­¦ã€ç‰©ç†æ–‡æ¡£ã€‚è¿™ä¸ªç³»ç»ŸåŒæ ·é€‚ç”¨äºç”Ÿæˆä»ç®€å•çš„ä¿¡ä»¶åˆ°å®Œæ•´ä¹¦ç±çš„æ‰€æœ‰å…¶ä»–ç§ç±»çš„æ–‡æ¡£ã€‚ï¼ˆæ‘˜è‡ªWikipediaï¼‰</p>
<p>ç®€å•æ€»ç»“ï¼ŒLaTexæ˜¯ä¸€ç§å¾ˆnbçš„æ’ç‰ˆè½¯ä»¶ã€‚å¯¹äºæ•°å­¦ã€ç‰©ç†ã€è®¡ç®—æœºç­‰éœ€è¦å¤§é‡æ•°å­¦å…¬å¼çš„ç›¸å…³ä¸“ä¸šå­¦ç”Ÿï¼Œå¼ºçƒˆå»ºè®®å­¦ä¹ ã€‚å…¥é—¨ä¹¦ç±è¯·å‚è€ƒï¼š<a
href="https://github.com/wnma3mz/Reading-Books/blob/master/éæŠ€æœ¯/latexæ•™ç¨‹ä¸­æ–‡.pdf">latexæ•™ç¨‹ä¸­æ–‡.pdf</a>ä¸<a
href="https://github.com/wnma3mz/Reading-Books/blob/master/éæŠ€æœ¯/ä¸€ä»½ä¸å¤ªç®€çŸ­çš„%20LATEX%202Îµ%20ä»‹ç».pdf">ä¸€ä»½ä¸å¤ªç®€çŸ­çš„
LATEX 2Îµ ä»‹ç».pdf</a></p>
<p>å‡ å¤§ä¸å¾—ä¸è¯´çš„å¥½å¤„ï¼š</p>
<ol type="1">
<li>å¼•ç”¨å‚è€ƒæ–‡çŒ®ï¼Œåªéœ€è¦ä¸€ä¸ª<code>bib</code>æ–‡ä»¶ï¼Œå‚è€ƒæ–‡çŒ®é£æ ¼åªéœ€è¦ä¸€è¡Œå‘½ä»¤ä¾¿å¯å®šä¹‰</li>
<li>æ•°å­¦å…¬å¼çš„ä¹¦å†™</li>
<li>å„ç§æ’ç‰ˆå¯éšæ—¶åˆ‡æ¢</li>
</ol>
<h4 id="ç»˜å›¾ç›¸å…³">ç»˜å›¾ç›¸å…³</h4>
<p>åœ¨ä¸€ç¯‡è®ºæ–‡ï¼Œå¥½çœ‹çš„å›¾è¡¨å’Œä¸å¯ç¼ºå°‘çš„ã€‚å¤§éƒ¨åˆ†æ•°æ®å›¾ç”¨ Matplotlib
å³å¯å®Œæˆï¼Œæµç¨‹å›¾ä¹Ÿç”¨Visioè¿›è¡Œç»˜åˆ¶ï¼ˆç”šè‡³ä½¿ç”¨PPTï¼‰ï¼Œæœ€åå¯ä»¥è€ƒè™‘ä½¿ç”¨PSè¿›è¡Œå®Œå–„</p>
<h4 id="zotero">Zotero</h4>
<p>å¼€æºçš„æ–‡çŒ®æ•´ç†å·¥å…·ã€‚å¯¹æˆ‘è€Œè¨€ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ol type="1">
<li>äº‘åŒæ­¥ï¼ˆé…åˆåšæœäº‘ï¼Œæ— é™é‡åŒæ­¥ï¼‰</li>
<li>è‡ªç”±ä¸Šä¼ æ–‡ä»¶å¹¶è‡ªåŠ¨æŸ¥æ‰¾æ–‡çŒ®ç´¢å¼•</li>
<li>ä¸€é”®å¯¼å‡ºå‚è€ƒæ–‡çŒ®</li>
<li>åˆ›å»ºæ—¶é—´è½´</li>
<li>æ‰¹é‡æ•´ç†æ–‡ä»¶</li>
</ol>
<h4 id="mathpix-snip">Mathpix Snip</h4>
<p>å¯¹äºä¸€ä¸ªé•¿ä¸”å¤æ‚çš„æ•°å­¦å…¬å¼ï¼Œæˆ‘æ˜¯ç»å¯¹ä¸æƒ³è‡ªå·±é‡æ–°æ‰‹å†™ä¸€éçš„ã€‚æ­¤å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†å›¾ç‰‡è½¬ä¸ºLaTexå…¬å¼ã€‚åœ¨2018å¹´ï¼Œæ­¤è½¯ä»¶è¿˜æ˜¯å…è´¹ä½¿ç”¨çš„çŠ¶æ€ã€‚ä½†ç›®å‰å·²éœ€è¦ä»˜è´¹ä½¿ç”¨ï¼Œå…è´¹æ¬¡æ•°äºæˆ‘è€Œè¨€è¿œè¿œä¸å¤Ÿã€‚åŒç±»è½¯ä»¶æˆ‘è¿˜æ²¡æ‰¾åˆ°å¾ˆå¥½çš„æ›¿ä»£å“ã€‚æ•…è¦ç»§ç»­ä½¿ç”¨æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç›´æ¥ä»˜è´¹æŒ‰å¹´è®¢é˜…æˆ–è´­ä¹°APIè®¢é˜…ï¼Œå†äºŒæ¬¡å°è£…ã€‚å‡éœ€ä¸€å®šçš„è´¹ç”¨ã€‚æ— æ„å‘ç°å®‰å“ç‰ˆæœ¬ï¼ˆIOSä¸æ¸…æ¥šï¼‰çš„è°ƒç”¨æ˜¯å…è´¹çš„ï¼Œæ•…è¿›è¡ŒæŠ“åŒ…è·å–äº†è¯·æ±‚APIçš„keyï¼Œå†è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚ç›®å‰å¯ç¨³å®šè¿è¡Œ</p>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
  </entry>
  <entry>
    <title>CUDAç¼–ç¨‹äºŒæ¬¡å…¥é—¨</title>
    <url>/hexo_blog/2018/05/18/CUDA/CUDA%E7%BC%96%E7%A8%8B%E4%BA%8C%E6%AC%A1%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åŸºæœ¬çš„CUDAç¨‹åºæ¡†æ¶åŠä»£ç è§£æï¼ŒåŒ…æ‹¬å¦‚ä½•ç”³è¯·è®¾å¤‡æŒ‡é’ˆå†…å­˜ã€å°†æ•°æ®æ‹·è´åˆ°è®¾å¤‡ä¸Šã€è°ƒç”¨æ ¸å‡½æ•°è¿›è¡Œè®¡ç®—ã€çº¿ç¨‹åŒæ­¥ä»¥åŠå°†ç»“æœæ‹·è´å›ä¸»æœºå†…ç­‰ã€‚åŒæ—¶ä¹Ÿä»‹ç»äº†ä¸€äº›å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚CUDAç¨‹åºé»‘å±ä¹‹åæ¢å¤çš„é—®é¢˜ã€‚æ¥
<a href="/hexo_blog/2018/05/05/CUDA/%E8%AE%B0%E8%A2%ABCUDA%E6%8A%98%E8%85%BE%E6%AD%BB%E5%8E%BB%E6%B4%BB%E6%9D%A5%E7%9A%84%E9%82%A3%E5%8D%81%E5%A4%A9/" title="è®°è¢«CUDAæŠ˜è…¾æ­»å»æ´»æ¥çš„é‚£åå¤©">è®°è¢«CUDAæŠ˜è…¾æ­»å»æ´»æ¥çš„é‚£åå¤©</a> ã€‚é˜…è¯»æœ¬æ–‡å‰éœ€è¦æœ‰ä¸€éƒ¨åˆ†Cè¯­è¨€åŸºç¡€ã€‚</p>
<span id="more"></span>
<h2 id="åŸå§‹ä»£ç ">åŸå§‹ä»£ç </h2>
<p>åœ¨VS2015ä¸­ï¼Œæ–°å»ºä¸€ä¸ªCUDAé¡¹ç›®ï¼Œé‡Œé¢ä¼šæœ‰ä¸€ä¸ª
<code>kernel.cu</code>çš„æ–‡ä»¶ã€‚é‡Œé¢çš„ä»£ç å°±æ˜¯å®˜æ–¹ç»™å‡ºçš„å®ä¾‹ä»£ç ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cuda_runtime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;device_launch_parameters.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span>;</span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    c[i] = a[i] + b[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> arraySize = <span class="number">5</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a[arraySize] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> b[arraySize] = &#123; <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span> &#125;;</span><br><span class="line">    <span class="type">int</span> c[arraySize] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    cudaError_t cudaStatus = addWithCuda(c, a, b, arraySize);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;addWithCuda failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&#123;1,2,3,4,5&#125; + &#123;10,20,30,40,50&#125; = &#123;%d,%d,%d,%d,%d&#125;\n&quot;</span>,</span><br><span class="line">        c[<span class="number">0</span>], c[<span class="number">1</span>], c[<span class="number">2</span>], c[<span class="number">3</span>], c[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaThreadExit();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadExit failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *dev_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    cudaError_t cudaStatus;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaSetDevice(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaSetDevice failed!  Do you have a CUDA-capable GPU installed?&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_a, a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_b, b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    addKernel&lt;&lt;&lt;<span class="number">1</span>, size&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaThreadSynchronize();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadSynchronize returned error code %d after launching addKernel!\n&quot;</span>, cudaStatus);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(c, dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyDeviceToHost);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Error:</span><br><span class="line">    cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cudaStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‹†è§£åŸå§‹ä»£ç ">æ‹†è§£åŸå§‹ä»£ç </h2>
<p>ä¸‹é¢å¯¹ä¸Šé¢çš„ä»£ç é€ä¸€è¿›è¡Œæ‹†è§£è¿›è¡Œè¯´æ˜ã€‚æœ€åŸå§‹æœ€ç®€å•çš„ä»£ç åº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·ã€‚åœ¨é…ç½®æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œä¸‹é¢çš„ä»£ç åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥æ­£ç¡®è¿è¡Œå¹¶è¾“å‡ºçš„ã€‚</p>
<p>è®¾å¤‡æŒ‡çš„æ˜¯GPUè®¾å¤‡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ç›¸å…³æ¨¡å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cuda_runtime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;device_launch_parameters.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨æ ¸å‡½æ•°ï¼Œåˆ©ç”¨gpuè¿›è¡Œè®¡ç®—</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹id</span></span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    <span class="comment">// åœ¨åŒä¸€ä¸ªçº¿ç¨‹idä¸‹ï¼Œaæ•°ç»„ä¸bæ•°ç»„å…ƒç´ å¯¹åº”ç›¸åŠ </span></span><br><span class="line">    c[i] = a[i] + b[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸€èˆ¬cè¯­è¨€çš„è¯­æ³•ï¼Œåœ¨è¿™é‡Œä¸åšä»‹ç»</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> arraySize = <span class="number">5</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a[arraySize] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> b[arraySize] = &#123; <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span> &#125;;</span><br><span class="line">    <span class="type">int</span> c[arraySize] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”³è¯·è®¾å¤‡æŒ‡é’ˆï¼Œæ¯ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªè®¾å¤‡æŒ‡é’ˆã€‚æ‰€ä»¥è¿™é‡Œæœ‰ä¸‰ä¸ª</span></span><br><span class="line">    <span class="type">int</span> *dev_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€‰æ‹©GPUè®¾å¤‡ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå°±åªéœ€é€‰æ‹©0</span></span><br><span class="line">    cudaSetDevice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”³è¯·è®¾å¤‡æŒ‡é’ˆçš„å†…å­˜</span></span><br><span class="line">    cudaMalloc((<span class="type">void</span>**)&amp;dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    cudaMalloc((<span class="type">void</span>**)&amp;dev_a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    cudaMalloc((<span class="type">void</span>**)&amp;dev_b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä¸»æœºä¸Šçš„aã€bæ•°ç»„çš„æ•°æ®æ‹·è´åˆ°è®¾å¤‡ä¸Šã€‚</span></span><br><span class="line">    cudaMemcpy(dev_a, a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    cudaMemcpy(dev_b, b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨æ ¸å‡½æ•°ï¼Œæ³¨æ„è¿™é‡Œè°ƒç”¨å‡½æ•°çš„è¯­æ³•ä¸ä¸€èˆ¬çš„ä¸åŒã€‚&lt;&lt;&lt;1, size&gt;&gt;&gt;æŒ‡çš„æ˜¯åˆ†é…ä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œé‡Œé¢æœ‰sizeä¸ªçº¿ç¨‹</span></span><br><span class="line">    addKernel&lt;&lt;&lt;<span class="number">1</span>, size&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›è¡Œçº¿ç¨‹åŒæ­¥</span></span><br><span class="line">    cudaThreadSynchronize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç»“æœæ‹·è´å›ä¸»æœºé‡Œçš„cå˜é‡ä¸­</span></span><br><span class="line">    cudaMemcpy(c, dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾è®¾å¤‡æŒ‡é’ˆå†…å­˜</span></span><br><span class="line">    cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&#123;1,2,3,4,5&#125; + &#123;10,20,30,40,50&#125; = &#123;%d,%d,%d,%d,%d&#125;\n&quot;</span>, c[<span class="number">0</span>], c[<span class="number">1</span>], c[<span class="number">2</span>], c[<span class="number">3</span>], c[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€å‡ºçº¿ç¨‹</span></span><br><span class="line">    cudaThreadExit();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>kernel.cu</code>é‡Œé¢çš„ä»£ç æ˜¯åŸºäºä¸Šé¢è¿™ä¸ªä»£ç è¿›è¡Œæ‹“å±•ã€‚</p>
<ol type="1">
<li>æ¯ä¸€æ¬¡æ“ä½œä¹‹åï¼Œè¿›è¡Œåˆ¤æ–­çŠ¶æ€
<code>cudaStatus</code>ï¼Œå¦‚æœçŠ¶æ€å¼‚å¸¸å°±é€€å‡ºï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå½“ç„¶å¸¦æ¥çš„å½±å“å°±æ˜¯å¯è¯»æ€§ç•¥å¾®é™ä½äº†ã€‚</li>
<li>å°è£…äº†ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ“ä½œä¸»æœºçš„ä»£ç ä¸æ“ä½œè®¾å¤‡çš„ä»£ç ï¼ˆæ¯”å¦‚ç”³è¯·è®¾å¤‡æŒ‡é’ˆå†…å­˜ä¸é‡Šæ”¾è®¾å¤‡æŒ‡é’ˆç­‰ï¼‰ã€‚</li>
</ol>
<h2 id="æ‹“å±•ä»£ç ">æ‹“å±•ä»£ç </h2>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŸºäºæ­¤å†æ¬¡è¿›è¡Œæ‹“å±•ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ‹“å±•ä»£ç ã€‚</p>
<p>å¾…è¡¥å……ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜</h2>
<p>å¦‚æœåœ¨è¿è¡Œcudaä»£ç çš„æ—¶å€™ï¼Œæ˜¾ç¤ºå±çªç„¶é»‘å±ï¼Œä¹‹ååˆæ¢å¤æ­£å¸¸ï¼Œæ˜¯å› ä¸ºç¨‹åºæ—¶é—´è¿è¡Œè¿‡é•¿ï¼Œè§¦å‘äº†TDRäº‹ä»¶ï¼Œå¯¼è‡´é»‘å±ï¼Œæ˜¾å¡è¿ç®—ä¸­æ–­ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>å¼€å§‹èœå•ä¸­æ‰¾åˆ°
<code>Nsight Monitor</code>å¹¶æ‰“å¼€ã€‚ï¼ˆWin10å¯ä»¥ç›´æ¥æœç´¢ï¼‰</li>
<li>åœ¨ä»»åŠ¡æ ä¸­æ‰“å¼€ <code>Nsight Monitor</code>ï¼Œå•å‡»å³ä¸‹è§’çš„
<code>Nsight Monitor options</code>ã€‚</li>
<li>è®¾ç½® <code>General</code>çš„ <code>Microsoft Display Driver</code>ä¸­
<code>WDDM TDR Delay</code>ä¸­çš„å€¼ï¼ŒæŠŠ
<code>2</code>(é»˜è®¤ä¸€èˆ¬æ˜¯2)ï¼Œè°ƒå¤§ï¼Œæ¯”å¦‚200ã€‚</li>
<li>ä¿å­˜åé€€å‡ºï¼Œé‡å¯ç”µè„‘å³å¯ã€‚</li>
</ol>
<p>è¯¦è§<a
href="http://blog.163.com/yuhua_kui/blog/static/9679964420146183211348/">è§£å†³CUDAç¨‹åºçš„é»‘å±æ¢å¤é—®é¢˜</a></p>
]]></content>
      <categories>
        <category>CUDA</category>
      </categories>
      <tags>
        <tag>GPU</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDAç¼–ç¨‹å…¥é—¨</title>
    <url>/hexo_blog/2018/05/13/CUDA/CUDA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p>CUDAç¼–ç¨‹å…¥é—¨ï¼Œæ¥ <a href="/hexo_blog/2018/05/05/CUDA/%E8%AE%B0%E8%A2%ABCUDA%E6%8A%98%E8%85%BE%E6%AD%BB%E5%8E%BB%E6%B4%BB%E6%9D%A5%E7%9A%84%E9%82%A3%E5%8D%81%E5%A4%A9/" title="è®°è¢«CUDAæŠ˜è…¾æ­»å»æ´»æ¥çš„é‚£åå¤©">è®°è¢«CUDAæŠ˜è…¾æ­»å»æ´»æ¥çš„é‚£åå¤©</a></p>
<span id="more"></span>
<p>å‚è€ƒæ–‡ç« ï¼š<a
href="https://blog.csdn.net/augusdi/article/details/12833235">CUDAä»å…¥é—¨åˆ°ç²¾é€š</a></p>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<p>è¿œç¨‹æ¡Œé¢ç™»é™†æœåŠ¡å™¨æ—¶ï¼Œè¿œç¨‹ç»ˆç«¯ä¸èƒ½è¿è¡ŒCUDAç¨‹åºã€‚åŸå› æ˜¯å› ä¸ºè¿œç¨‹æ¡Œé¢ç™»é™†è°ƒç”¨çš„æ˜¾å¡èµ„æºæ˜¯æœ¬åœ°çš„æ˜¾å¡ï¼Œè¿è¡Œç¨‹åºçš„æ—¶å€™æ²¡æœ‰è¿œç¨‹çš„æ˜¾å¡ï¼Œè‡ªç„¶ä¼šæŠ¥é”™ã€‚æ‰€ä»¥å¯ä»¥ç”¨è¿œç¨‹ç»ˆç«¯è¿›è¡Œç™»é™†ï¼Œæˆ–è€…è¿œç¨‹æœåŠ¡å™¨é…ç½®ä¸¤å—æ˜¾å¡ï¼Œä¸€å—ç”¨äºæ˜¾ç¤ºä¸€å—ç”¨äºè®¡ç®—ã€‚</p>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ã€‚</p>
<h2 id="åŸå§‹çš„demoçº¿ç¨‹å¹¶è¡Œ">åŸå§‹çš„Demoï¼ˆçº¿ç¨‹å¹¶è¡Œï¼‰</h2>
<p>ç›®çš„å°±æ˜¯a, bä¸¤ä¸ªæ•°ç»„å¯¹åº”å…ƒç´ è¿›è¡Œç›¸åŠ </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥cudaç›¸å…³æ¨¡å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cuda_runtime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;device_launch_parameters.h&quot;</span></span></span><br><span class="line"><span class="comment">// cä¸­è‡ªå¸¦çš„æ¨¡å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªå‡½æ•°åé¢éœ€è¦è°ƒç”¨</span></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// __global__å‰ç¼€è¡¨ç¤ºç”¨äºæ§åˆ¶è®¾å¤‡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ§åˆ¶è®¾å¤‡çš„å‰ç¼€æ˜¯__device__</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°æ˜¯è¿è¡Œåœ¨GPUä¸Šçš„ï¼Œç§°ä¸ºæ ¸å‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    c[i] = a[i] + b[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> arraySize = <span class="number">5</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a[arraySize] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> b[arraySize] = &#123; <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span> &#125;;</span><br><span class="line">    <span class="type">int</span> c[arraySize] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cuda_Error_tæŒ‡çš„æ˜¯cudaé”™è¯¯ç±»å‹ï¼Œå–å€¼ä¸ºæ•´æ•°</span></span><br><span class="line">    cudaError_t cudaStatus = addWithCuda(c, a, b, arraySize);</span><br><span class="line">    <span class="comment">// cudaDevicePropæ˜¯è®¾å¤‡å±æ€§ç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;addWithCuda failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&#123;1,2,3,4,5&#125; + &#123;10,20,30,40,50&#125; = &#123;%d,%d,%d,%d,%d&#125;\n&quot;</span>,</span><br><span class="line">        c[<span class="number">0</span>], c[<span class="number">1</span>], c[<span class="number">2</span>], c[<span class="number">3</span>], c[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cudaThreadExit must be called before exiting in order for profiling and</span></span><br><span class="line">    <span class="comment">// tracing tools such as Nsight and Visual Profiler to show complete traces.</span></span><br><span class="line">    cudaStatus = cudaThreadExit();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadExit failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºä½¿ç”¨CUDAå¹¶è¡Œæ·»åŠ å‘é‡çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GPUè®¾å¤‡ç«¯çš„æ•°æ®æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">int</span> *dev_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_c = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// GPUçŠ¶æ€æŒ‡ç¤º</span></span><br><span class="line">    cudaError_t cudaStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ç”µè„‘ä¸Šæœ‰å¤šä¸ªæ˜¾å¡æ”¯æŒCUDAæ—¶ï¼Œé€‰æ‹©æŸä¸ªGPUæ¥è¿›è¡Œè¿ç®—ã€‚0è¡¨ç¤ºè®¾å¤‡å·ï¼Œè¿˜æœ‰1,2,3â€¦â€¦</span></span><br><span class="line">    cudaStatus = cudaSetDevice(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaSetDevice failed!  Do you have a CUDA-capable GPU installed?&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†é…GPUè®¾å¤‡ç«¯çš„å†…å­˜ã€‚ä¸‰ä¸ªå˜é‡ï¼Œæ‰€ä»¥éœ€è¦åˆ†é…ä¸‰æ¬¡ã€‚</span></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="comment">// ç”³è¯·å¤±è´¥å°±æŠ¥é”™</span></span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´æ•°æ®åˆ°GPUä¸­ï¼Œå·²æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæ‰€ä»¥éœ€è¦æ‹·è´ä¸¤æ¬¡</span></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_a, a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_b, b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿è¡Œæ ¸å‡½æ•°ã€‚å…³é”®ä»£ç </span></span><br><span class="line">    addKernel&lt;&lt;&lt;<span class="number">1</span>, size&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ­¥çº¿ç¨‹</span></span><br><span class="line">    cudaStatus = cudaThreadSynchronize();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadSynchronize returned error code %d after launching addKernel!\n&quot;</span>, cudaStatus);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç»“æœæ‹·è´å›ä¸»æœº</span></span><br><span class="line">    cudaStatus = cudaMemcpy(c, dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyDeviceToHost);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Error:</span><br><span class="line">    <span class="comment">// é‡Šæ”¾GPUè®¾å¤‡ç«¯å†…å­˜</span></span><br><span class="line">    cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cudaStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯çº¿ç¨‹å¹¶è¡Œï¼ŒCUDAå®˜æ–¹åˆå§‹ç»™çš„ä¾‹å­ã€‚</p>
<p>å¯åŠ¨æ ¸å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå³<code>addKernel</code>å‡½æ•°ã€‚</p>
<p>&lt;&lt;&lt;&gt;&gt;&gt;è¡¨ç¤ºè¿è¡Œæ—¶é…ç½®ç¬¦å·ï¼Œé‡Œé¢1è¡¨ç¤ºåªåˆ†é…ä¸€ä¸ªçº¿ç¨‹ç»„ï¼ˆåˆç§°çº¿ç¨‹å—ã€Blockï¼‰ï¼Œsizeè¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹ç»„æœ‰sizeä¸ªçº¿ç¨‹ï¼ˆThreadï¼‰ã€‚æœ¬ç¨‹åºä¸­sizeæ ¹æ®å‰é¢ä¼ é€’å‚æ•°ä¸ªæ•°åº”è¯¥ä¸º5ï¼Œæ‰€ä»¥è¿è¡Œçš„æ—¶å€™ï¼Œæ ¸å‡½æ•°åœ¨5ä¸ªGPUçº¿ç¨‹å•å…ƒä¸Šåˆ†åˆ«è¿è¡Œäº†ä¸€æ¬¡ï¼Œæ€»å…±è¿è¡Œäº†5æ¬¡ã€‚è¿™5ä¸ªçº¿ç¨‹æ˜¯å¦‚ä½•çŸ¥é“è‡ªå·±â€œèº«ä»½â€çš„ï¼Ÿæ˜¯é <code>threadIdx</code>è¿™ä¸ªå†…ç½®å˜é‡ï¼Œå®ƒæ˜¯ä¸ªdim3ç±»å‹å˜é‡ï¼Œæ¥å—&lt;&lt;&lt;&gt;&gt;&gt;ä¸­ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒåŒ…å«x,y,z
3ç»´åæ ‡ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åªæœ‰ä¸€ç»´ï¼Œæ‰€ä»¥åªæœ‰xå€¼æ˜¯æœ‰æ•ˆçš„ã€‚é€šè¿‡æ ¸å‡½æ•°ä¸­<code>int i = threadIdx.x;</code>è¿™ä¸€å¥ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—è‡ªèº«çš„idå·ï¼Œä»è€Œæ‰¾åˆ°è‡ªå·±çš„ä»»åŠ¡å»æ‰§è¡Œã€‚</p>
<h2 id="å—å¹¶è¡Œ">å—å¹¶è¡Œ</h2>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    c[i] = a[i] + b[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ”¹ä¸º</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = blockIdx.x;</span><br><span class="line">	c[i] = a[i] + b[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addKernel&lt;&lt;&lt;<span class="number">1</span>, size&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line"><span class="comment">// æ”¹ä¸º</span></span><br><span class="line">addKernel&lt;&lt;&lt;size,<span class="number">1</span> &gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸çº¿ç¨‹å¹¶è¡Œçš„åŒºåˆ«åœ¨äºï¼Œç”±<code>threadIdx</code>æ”¹ä¸ºäº†<code>blockIdx</code>ã€‚<code>&lt;&lt;&lt;1, size&gt;&gt;&gt;</code>æ”¹ä¸ºäº†<code>&lt;&lt;&lt;size, 1&gt;&gt;&gt;</code>ã€‚</p>
<p>çº¿ç¨‹å¹¶è¡Œæ˜¯ç»†ç²’åº¦å¹¶è¡Œï¼Œè°ƒåº¦æ•ˆç‡é«˜ï¼›å—å¹¶è¡Œæ˜¯ç²—ç²’åº¦å¹¶è¡Œï¼Œæ¯æ¬¡è°ƒåº¦éƒ½è¦é‡æ–°åˆ†é…èµ„æºï¼Œæœ‰æ—¶èµ„æºåªæœ‰ä¸€ä»½ï¼Œé‚£ä¹ˆæ‰€æœ‰çº¿ç¨‹å—éƒ½åªèƒ½æ’æˆä¸€é˜Ÿï¼Œä¸²è¡Œæ‰§è¡Œã€‚</p>
<p>æœ‰æ—¶é‡‡ç”¨åˆ†æ²»æ³•ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£ä¸ºå‡ ä¸ªå°è§„æ¨¡é—®é¢˜ï¼Œå°†è¿™äº›å°è§„æ¨¡é—®é¢˜åˆ†åˆ«ç”¨ä¸€ä¸ªçº¿ç¨‹å—å®ç°ï¼Œçº¿ç¨‹å—å†…å¯ä»¥é‡‡ç”¨ç»†ç²’åº¦çš„çº¿ç¨‹å¹¶è¡Œï¼Œè€Œå—ä¹‹é—´ä¸ºç²—ç²’åº¦å¹¶è¡Œï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºï¼Œé™ä½çº¿ç¨‹å¹¶è¡Œçš„è®¡ç®—å¤æ‚åº¦ã€‚é€‚å½“åˆ†è§£ï¼Œé™ä½è§„æ¨¡ï¼Œåœ¨ä¸€äº›çŸ©é˜µä¹˜æ³•ã€å‘é‡å†…ç§¯è®¡ç®—åº”ç”¨ä¸­å¯ä»¥å¾—åˆ°å……åˆ†çš„å±•ç¤ºã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/cuda/20130723220559500.png" /></p>
<p>å¤šä¸ªçº¿ç¨‹å—ç»„æˆä¸€ä¸ªçº¿ç¨‹æ ¼(Grid)ã€‚ä¸€ç»´çº¿ç¨‹-&gt;äºŒç»´çº¿ç¨‹å—-&gt;ä¸‰ç»´çº¿ç¨‹æ ¼ã€‚</p>
<h2 id="æµå¹¶è¡Œ">æµå¹¶è¡Œ</h2>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">addKernel&lt;&lt;&lt;size, <span class="number">1</span>&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line"><span class="comment">// æ”¹ä¸º</span></span><br><span class="line">cudaStream_t stream[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)  &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæµ</span></span><br><span class="line">    cudaStreamCreate(&amp;stream[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)  &#123;</span><br><span class="line">	<span class="comment">// æ‰§è¡Œæµã€‚çº¿ç¨‹å—æ•°(1)ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çº¿ç¨‹æ•°(1)ï¼Œæ¯ä¸ªblockç”¨åˆ°çš„å…±äº«å†…å­˜å¤§å°(0)ï¼Œæµå¯¹è±¡(å½“å‰æ ¸å‡½æ•°åœ¨å“ªä¸ªæµä¸Šè¿è¡Œ)</span></span><br><span class="line">    addKernel&lt;&lt;&lt;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, stream[i]&gt;&gt;&gt;(dev_c + i, dev_a + i, dev_b + i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ§åˆ¶æ•´ä¸ªè®¾å¤‡çš„æ‰€æœ‰æµåŒæ­¥</span></span><br><span class="line">cudaDeviceSynchronize();</span><br><span class="line"></span><br><span class="line">Error:</span><br><span class="line">	cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br><span class="line"><span class="comment">// æ”¹ä¸º</span></span><br><span class="line">Error:</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>;i++)  &#123;</span><br><span class="line">        <span class="comment">//é”€æ¯æµ</span></span><br><span class="line">        cudaStreamDestroy(stream[i]);</span><br><span class="line">    &#125;</span><br><span class="line">	cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨å¤šä¸ªç½‘æ ¼ï¼ˆçº¿ç¨‹æ ¼ï¼‰è¿›è¡Œæµå¹¶è¡Œã€‚è¿™æ ·å®ç°çš„å¹¶è¡Œå¯ä»¥è¾¾åˆ°æ¯”å—å¹¶è¡Œæ›´ç²—çš„ç»†ç²’åº¦ã€‚</p>
<h2 id="çº¿ç¨‹é€šä¿¡">çº¿ç¨‹é€šä¿¡</h2>
<p>è¿™æ¬¡ç›®çš„åˆ†ä¸‰ä¸ªçº¿ç¨‹åšä¸‰ä¸ªä»»åŠ¡ï¼Œ1-5æ•°å­—è¿›è¡Œæ±‚å’Œï¼Œ1-5æ¯ä¸ªæ•°å­—æ±‚å¹³æ–¹å’Œï¼Œ1-5ç´¯ä¹˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ›´æ”¹addKernelå‡½æ•°å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a)</span> &#123;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹å—æ•°ï¼š1ï¼Œå—å·ä¸º0</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ•°ï¼š5ï¼Œçº¿ç¨‹å·0~4</span></span><br><span class="line">    <span class="comment">// å…±äº«å­˜å‚¨å™¨å¤§å°ï¼š5ä¸ªintå‹å˜é‡å¤§å°ï¼ˆ5 * sizeof(intï¼‰)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    <span class="comment">// å°†æ•°æ®ä¸€æ¬¡è¯»å…¥åˆ°SMï¼ˆShared Memoryï¼‰å†…éƒ¨</span></span><br><span class="line">    <span class="keyword">extern</span> __shared__ <span class="type">int</span> smem[];</span><br><span class="line">    smem[i] = a[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0å·çº¿ç¨‹åšå¹³æ–¹å’Œ</span></span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">0</span>) &#123;</span><br><span class="line">        c[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> d = <span class="number">0</span>; d &lt; <span class="number">5</span>; d++) &#123;</span><br><span class="line">            c[<span class="number">0</span>] += smem[d] * smem[d];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1å·çº¿ç¨‹åšç´¯åŠ </span></span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">        c[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> d = <span class="number">0</span>; d &lt; <span class="number">5</span>; d++) &#123;</span><br><span class="line">            c[<span class="number">1</span>] += smem[d];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2å·çº¿ç¨‹åšç´¯ä¹˜</span></span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">2</span>) &#123;</span><br><span class="line">        c[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">0</span>; d &lt; <span class="number">5</span>; d++) &#123;</span><br><span class="line">            c[<span class="number">2</span>] *= smem[d];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ”¹mainå‡½æ•°çš„å†…å®¹</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"> 	<span class="comment">// è·Ÿæ™®é€šçš„Cè¯­è¨€ä»£ç ç¼–å†™å·®ä¸å¤š</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> arraySize = <span class="number">5</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a[arraySize] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">int</span> c[arraySize] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    cudaError_t cudaStatus = addWithCuda(c, a, arraySize);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;addWithCuda failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\t1+2+3+4+5 = %d\n\t1^2+2^2+3^2+4^2+5^2 = %d\n\t1*2*3*4*5 = %d\n\n\n\n\n\n&quot;</span>, c[<span class="number">1</span>], c[<span class="number">0</span>], c[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaThreadExit();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadExit failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ”¹addWithCudaå†…å®¹</span></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a,  <span class="type">size_t</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å»é™¤cå˜é‡ç›¸å…³å†…å®¹ï¼Œå¦‚ç”³è¯·å†…å­˜ã€GPUè®¾å¤‡ç«¯æŒ‡é’ˆã€‚å…¶ä½™å†…å®¹å·®ä¸å¤š</span></span><br><span class="line">    <span class="type">int</span> *dev_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_c = <span class="number">0</span>;</span><br><span class="line">    cudaError_t cudaStatus;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaSetDevice(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaSetDevice failed!  Do you have a CUDA-capable GPU installed?&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_a, a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå…±äº«å†…å­˜å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰</span></span><br><span class="line">    addKernel&lt;&lt;&lt;<span class="number">1</span>, size, size * <span class="title function_">sizeof</span><span class="params">(<span class="type">int</span>)</span>, 0&gt;&gt;&gt;<span class="params">(dev_c, dev_a)</span>;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaThreadSynchronize();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadSynchronize returned error code %d after launching addKernel!\n&quot;</span>, cudaStatus);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMemcpy(c, dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyDeviceToHost);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Error:</span><br><span class="line">    cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    <span class="keyword">return</span> cudaStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€§èƒ½å‰–æ">æ€§èƒ½å‰–æ</h2>
<p>æµ‹è¯•å¯¹æ¯”çº¿ç¨‹å¹¶è¡Œå’Œå—å¹¶è¡Œçš„é€Ÿåº¦</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cuda_runtime.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;device_launch_parameters.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span>;</span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel_blk</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = blockIdx.x;</span><br><span class="line">    c[i] = a[i]+ b[i];</span><br><span class="line">&#125;</span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">addKernel_thd</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    c[i] = a[i]+ b[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> arraySize = <span class="number">1024</span>;</span><br><span class="line">    <span class="type">int</span> a[arraySize] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> b[arraySize] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; arraySize;i++) &#123;</span><br><span class="line">        a[i] = i;</span><br><span class="line">        b[i] = arraySize-i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> c[arraySize] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    cudaError_t cudaStatus;</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è®¾å¤‡å±æ€§ç»“æ„ä½“</span></span><br><span class="line">    cudaDeviceProp prop;</span><br><span class="line">    <span class="comment">// è·å–è®¾å¤‡æ€»æ•°</span></span><br><span class="line">    cudaStatus = cudaGetDeviceCount(&amp;num);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;num;i++) &#123;</span><br><span class="line">        <span class="comment">// è·å–è®¾å¤‡å±æ€§</span></span><br><span class="line">        cudaGetDeviceProperties(&amp;prop,i);</span><br><span class="line">    &#125;</span><br><span class="line">    cudaStatus = addWithCuda(c, a, b, arraySize);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;addWithCuda failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaThreadExit();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadExit failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;arraySize;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(c[i] != (a[i]+b[i])) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error in %d\n&quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cudaError_t <span class="title function_">addWithCuda</span><span class="params">(<span class="type">int</span> *c, <span class="type">const</span> <span class="type">int</span> *a, <span class="type">const</span> <span class="type">int</span> *b, <span class="type">size_t</span> size)</span> &#123;</span><br><span class="line">    <span class="type">int</span> *dev_a = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> *dev_c = <span class="number">0</span>;</span><br><span class="line">    cudaError_t cudaStatus;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaSetDevice(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaSetDevice failed!  Do you have a CUDA-capable GPU installed?&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    cudaStatus = cudaMalloc((<span class="type">void</span>**)&amp;dev_b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMalloc failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Copy input vectors from host memory to GPU buffers.</span></span><br><span class="line">    cudaStatus = cudaMemcpy(dev_a, a, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    cudaStatus = cudaMemcpy(dev_b, b, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyHostToDevice);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¡ç®—æ ¸å‡½æ•°æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">    cudaEvent_t start, stop;</span><br><span class="line">    cudaEventCreate(&amp;start);</span><br><span class="line">    cudaEventCreate(&amp;stop);</span><br><span class="line">    cudaEventRecord(start, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// ç”±äºæ•°æ®é‡å°ï¼Œæ‰§è¡Œ1000æ¬¡æ‰©å¤§æ‰§è¡Œæ—¶é—´ã€‚blkæ˜¯å—å¹¶è¡Œï¼Œthdæ˜¯çº¿ç¨‹å¹¶è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++) &#123;</span><br><span class="line"><span class="comment">//      addKernel_blk&lt;&lt;&lt;size,1&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span></span><br><span class="line">        addKernel_thd&lt;&lt;&lt;<span class="number">1</span>,size&gt;&gt;&gt;(dev_c, dev_a, dev_b);</span><br><span class="line">    &#125;</span><br><span class="line">    cudaEventRecord(stop,<span class="number">0</span>);</span><br><span class="line">    cudaEventSynchronize(stop);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// stop-startï¼Œæ‰§è¡Œæ€»æ—¶é—´</span></span><br><span class="line">    <span class="type">float</span> tm;</span><br><span class="line">    cudaEventElapsedTime(&amp;tm, start, stop);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;GPU Elapsed time:%.6f ms.\n&quot;</span>, tm);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// cudaThreadSynchronize waits for the kernel to finish, and returns</span></span><br><span class="line">    <span class="comment">// any errors encountered during the launch.</span></span><br><span class="line">    cudaStatus = cudaThreadSynchronize();</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaThreadSynchronize returned error code %d after launching addKernel!\n&quot;</span>, cudaStatus);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Copy output vector from GPU buffer to host memory.</span></span><br><span class="line">    cudaStatus = cudaMemcpy(c, dev_c, size * <span class="keyword">sizeof</span>(<span class="type">int</span>), cudaMemcpyDeviceToHost);</span><br><span class="line">    <span class="keyword">if</span> (cudaStatus != cudaSuccess) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;cudaMemcpy failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> Error;</span><br><span class="line">    &#125;</span><br><span class="line">Error:</span><br><span class="line">    cudaFree(dev_c);</span><br><span class="line">    cudaFree(dev_a);</span><br><span class="line">    cudaFree(dev_b);</span><br><span class="line">    <span class="keyword">return</span> cudaStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CUDA</category>
      </categories>
      <tags>
        <tag>GPU</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDAå®˜æ–¹æ–‡æ¡£ç¬”è®°</title>
    <url>/hexo_blog/2018/05/18/CUDA/CUDA%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>ç”¨CUDAå®ç°é«˜æ•ˆçš„çŸ©é˜µè¿ç®—â€”â€”ä»ä¸€ç»´åˆ°ä¸‰ç»´å‘é‡åŠ æ³•ã€å…±äº«å†…å­˜çŸ©é˜µä¹˜æ³•2.0ã€‚æ¥
<a href="/hexo_blog/2018/05/13/CUDA/CUDA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" title="CUDAç¼–ç¨‹å…¥é—¨">CUDAç¼–ç¨‹å…¥é—¨</a>ã€‚</p>
<span id="more"></span>
<p><a
href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html">å®˜æ–¹æ–‡æ¡£</a></p>
<p>ä¸€ç»´å‘é‡åŠ æ³•1.0</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ¸å‡½æ•°å®šä¹‰</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">VecAdd</span><span class="params">(<span class="type">float</span>* A, <span class="type">float</span>* B, <span class="type">float</span>* C)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    C[i] = A[i] + B[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// ç”¨Nä¸ªçº¿ç¨‹è°ƒç”¨æ ¸å‡½æ•°ï¼ŒNç›®å‰æœ€å¤šä¸º1024</span></span><br><span class="line">    VecAdd&lt;&lt;&lt;<span class="number">1</span>, N&gt;&gt;&gt;(A, B, C);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºŒç»´å‘é‡åŠ æ³•1.0</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ¸å‡½æ•°ï¼ŒäºŒç»´æ•°ç»„</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MatAdd</span><span class="params">(<span class="type">float</span> A[N][N], <span class="type">float</span> B[N][N],</span></span><br><span class="line"><span class="params">                       <span class="type">float</span> C[N][N])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = threadIdx.x;</span><br><span class="line">    <span class="type">int</span> j = threadIdx.y;</span><br><span class="line">    C[i][j] = A[i][j] + B[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// è®¾ç½®è°ƒç”¨GPUå‚æ•°</span></span><br><span class="line">    <span class="comment">// N * N * 1 threads</span></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªblockï¼Œé‡Œé¢æœ‰Nä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="type">int</span> numBlocks = <span class="number">1</span>;</span><br><span class="line">    dim3 <span class="title function_">threadsPerBlock</span><span class="params">(N, N)</span>;</span><br><span class="line">    MatAdd&lt;&lt;&lt;numBlocks, threadsPerBlock&gt;&gt;&gt;(A, B, C);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºŒç»´å‘é‡åŠ æ³•2.0</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MatAdd</span><span class="params">(<span class="type">float</span> A[N][N], <span class="type">float</span> B[N][N],</span></span><br><span class="line"><span class="params"><span class="type">float</span> C[N][N])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨block</span></span><br><span class="line">    <span class="type">int</span> i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">int</span> j = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; N &amp;&amp; j &lt; N)</span><br><span class="line">        C[i][j] = A[i][j] + B[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// è®¾ç½®çº¿ç¨‹å‚æ•°ï¼Œblockå‚æ•°ã€‚çº¿ç¨‹blockä¸€èˆ¬ä¸º16*16</span></span><br><span class="line">    dim3 <span class="title function_">threadsPerBlock</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>)</span>;</span><br><span class="line">    dim3 <span class="title function_">numBlocks</span><span class="params">(N / threadsPerBlock.x, N / threadsPerBlock.y)</span>;</span><br><span class="line">    MatAdd&lt;&lt;&lt;numBlocks, threadsPerBlock&gt;&gt;&gt;(A, B, C);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ç»´å‘é‡2.0</p>
<p>è¿™é‡Œçš„è®¾å¤‡æŒ‡çš„æ˜¯GPU</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ¸å‡½æ•°ï¼Œä½¿ç”¨block</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">VecAdd</span><span class="params">(<span class="type">float</span>* A, <span class="type">float</span>* B, <span class="type">float</span>* C, <span class="type">int</span> N)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = blockDim.x * blockIdx.x + threadIdx.x;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; N)</span><br><span class="line">        C[i] = A[i] + B[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°ï¼Œè°ƒç”¨CPU</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> N = ...;</span><br><span class="line">    <span class="type">size_t</span> size = N * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”³è¯·ä¸»æœºæŒ‡é’ˆå†…å­˜</span></span><br><span class="line">    <span class="type">float</span>* h_A = (<span class="type">float</span>*)<span class="built_in">malloc</span>(size);</span><br><span class="line">    <span class="type">float</span>* h_B = (<span class="type">float</span>*)<span class="built_in">malloc</span>(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¸€äº›è¾“å…¥å‘é‡ï¼ˆå‚æ•°ï¼‰</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”³è¯·åˆ†é…è®¾å¤‡å†…å­˜</span></span><br><span class="line">    <span class="type">float</span>* d_A;</span><br><span class="line">    cudaMalloc(&amp;d_A, size);</span><br><span class="line">    <span class="type">float</span>* d_B;</span><br><span class="line">    cudaMalloc(&amp;d_B, size);</span><br><span class="line">    <span class="type">float</span>* d_C;</span><br><span class="line">    cudaMalloc(&amp;d_C, size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´ä¸»æœºå†…å­˜åˆ°è®¾å¤‡ä¸­</span></span><br><span class="line">    cudaMemcpy(d_A, h_A, size, cudaMemcpyHostToDevice);</span><br><span class="line">    cudaMemcpy(d_B, h_B, size, cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨å†…æ ¸</span></span><br><span class="line">    <span class="type">int</span> threadsPerBlock = <span class="number">256</span>;</span><br><span class="line">    <span class="type">int</span> blocksPerGrid =</span><br><span class="line">            (N + threadsPerBlock - <span class="number">1</span>) / threadsPerBlock;</span><br><span class="line">    VecAdd&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;(d_A, d_B, d_C, N);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»è®¾å¤‡ä¸­æ‹·è´çš„h_Cï¼ˆç»“æœï¼‰åˆ°ä¸»æœºä¸­</span></span><br><span class="line">    <span class="comment">// h_Cï¼ˆç»“æœï¼‰åœ¨ä¸»æœºå†…å­˜ä¸­åŒ…å«ç»“æœ</span></span><br><span class="line">    cudaMemcpy(h_C, d_C, size, cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾è®¾å¤‡å†…å­˜</span></span><br><span class="line">    cudaFree(d_A);</span><br><span class="line">    cudaFree(d_B);</span><br><span class="line">    cudaFree(d_C);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾ä¸»æœºå†…å­˜</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºŒç»´å’Œä¸‰ç»´æ•°ç»„åˆ†åˆ«éœ€è¦ä½¿ç”¨ <code>cudaMallocPitch()</code>å’Œ
<code>cudaMalloc3D()</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">// Host code</span></span><br><span class="line"><span class="type">int</span> width = <span class="number">64</span>, height = <span class="number">64</span>;</span><br><span class="line"><span class="type">float</span>* devPtr;</span><br><span class="line"><span class="type">size_t</span> pitch;</span><br><span class="line">cudaMallocPitch(&amp;devPtr, &amp;pitch,</span><br><span class="line">                width * <span class="keyword">sizeof</span>(<span class="type">float</span>), height);</span><br><span class="line">MyKernel&lt;&lt;&lt;<span class="number">100</span>, <span class="number">512</span>&gt;&gt;&gt;(devPtr, pitch, width, height);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Device code</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MyKernel</span><span class="params">(<span class="type">float</span>* devPtr,</span></span><br><span class="line"><span class="params">                         <span class="type">size_t</span> pitch, <span class="type">int</span> width, <span class="type">int</span> height)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; height; ++r) &#123;</span><br><span class="line">        <span class="type">float</span>* row = (<span class="type">float</span>*)((<span class="type">char</span>*)devPtr + r * pitch);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; width; ++c) &#123;</span><br><span class="line">            <span class="type">float</span> element = row[c];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‰ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">// Host code</span></span><br><span class="line"><span class="type">int</span> width = <span class="number">64</span>, height = <span class="number">64</span>, depth = <span class="number">64</span>;</span><br><span class="line">cudaExtent extent = make_cudaExtent(width * <span class="keyword">sizeof</span>(<span class="type">float</span>),</span><br><span class="line">                                    height, depth);</span><br><span class="line">cudaPitchedPtr devPitchedPtr;</span><br><span class="line">cudaMalloc3D(&amp;devPitchedPtr, extent);</span><br><span class="line">MyKernel&lt;&lt;&lt;<span class="number">100</span>, <span class="number">512</span>&gt;&gt;&gt;(devPitchedPtr, width, height, depth);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Device code</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MyKernel</span><span class="params">(cudaPitchedPtr devPitchedPtr,</span></span><br><span class="line"><span class="params">                         <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> depth)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span>* devPtr = devPitchedPtr.ptr;</span><br><span class="line">    <span class="type">size_t</span> pitch = devPitchedPtr.pitch;</span><br><span class="line">    <span class="type">size_t</span> slicePitch = pitch * height;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> z = <span class="number">0</span>; z &lt; depth; ++z) &#123;</span><br><span class="line">        <span class="type">char</span>* slice = devPtr + z * slicePitch;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; height; ++y) &#123;</span><br><span class="line">            <span class="type">float</span>* row = (<span class="type">float</span>*)(slice + y * pitch);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; width; ++x) &#123;</span><br><span class="line">                <span class="type">float</span> element = row[x];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒç»´ã€ä¸‰ç»´æ•°ç»„è·å–å…¨å±€å˜é‡çš„æ–¹æ³•</span></span><br><span class="line">__constant__ <span class="type">float</span> constData[<span class="number">256</span>];</span><br><span class="line"><span class="type">float</span> data[<span class="number">256</span>];</span><br><span class="line">cudaMemcpyToSymbol(constData, data, <span class="keyword">sizeof</span>(data));</span><br><span class="line">cudaMemcpyFromSymbol(data, constData, <span class="keyword">sizeof</span>(data));</span><br><span class="line"></span><br><span class="line">__device__ <span class="type">float</span> devData;</span><br><span class="line"><span class="type">float</span> value = <span class="number">3.14f</span>;</span><br><span class="line">cudaMemcpyToSymbol(devData, &amp;value, <span class="keyword">sizeof</span>(<span class="type">float</span>));</span><br><span class="line"></span><br><span class="line">__device__ <span class="type">float</span>* devPointer;</span><br><span class="line"><span class="type">float</span>* ptr;</span><br><span class="line">cudaMalloc(&amp;ptr, <span class="number">256</span> * <span class="keyword">sizeof</span>(<span class="type">float</span>));</span><br><span class="line">cudaMemcpyToSymbol(devPointer, &amp;ptr, <span class="keyword">sizeof</span>(ptr));</span><br></pre></td></tr></table></figure>
<p>å…±äº«å†…å­˜â€”â€”çŸ©é˜µä¹˜æ³•1.0</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªçŸ©é˜µçš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="comment">// Matrices are stored in row-major order:</span></span><br><span class="line"><span class="comment">// M(row, col) = *(M.elements + row * M.width + col)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> width;</span><br><span class="line">    <span class="type">int</span> height;</span><br><span class="line">    <span class="type">float</span>* elements;</span><br><span class="line">&#125; Matrix;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹é”å¤§å°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLOCK_SIZE 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æå‰å£°æ˜çŸ©é˜µä¹˜æ³•æ ¸å‡½æ•°</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MatMulKernel</span><span class="params">(<span class="type">const</span> Matrix, <span class="type">const</span> Matrix, Matrix)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ©é˜µä¹˜æ³•ä¸»æœºä»£ç </span></span><br><span class="line"><span class="comment">// çŸ©é˜µç»´åº¦è®¾ä¸ºçº¿ç¨‹é”å¤§å°çš„å€æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MatMul</span><span class="params">(<span class="type">const</span> Matrix A, <span class="type">const</span> Matrix B, Matrix C)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Load A and B to device memory</span></span><br><span class="line">    Matrix d_A;</span><br><span class="line">    d_A.width = A.width; d_A.height = A.height;</span><br><span class="line">    <span class="type">size_t</span> size = A.width * A.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_A.elements, size);</span><br><span class="line">    cudaMemcpy(d_A.elements, A.elements, size,</span><br><span class="line">               cudaMemcpyHostToDevice);</span><br><span class="line">    Matrix d_B;</span><br><span class="line">    d_B.width = B.width; d_B.height = B.height;</span><br><span class="line">    size = B.width * B.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_B.elements, size);</span><br><span class="line">    cudaMemcpy(d_B.elements, B.elements, size,</span><br><span class="line">               cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate C in device memory</span></span><br><span class="line">    Matrix d_C;</span><br><span class="line">    d_C.width = C.width; d_C.height = C.height;</span><br><span class="line">    size = C.width * C.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_C.elements, size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invoke kernel</span></span><br><span class="line">    dim3 <span class="title function_">dimBlock</span><span class="params">(BLOCK_SIZE, BLOCK_SIZE)</span>;</span><br><span class="line"></span><br><span class="line">    dim3 <span class="title function_">dimGrid</span><span class="params">(B.width / dimBlock.x, A.height / dimBlock.y)</span>;</span><br><span class="line">    MatMulKernel&lt;&lt;&lt;dimGrid, dimBlock&gt;&gt;&gt;(d_A, d_B, d_C);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read C from device memory</span></span><br><span class="line">    cudaMemcpy(C.elements, d_C.elements, size,</span><br><span class="line">               cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Free device memory</span></span><br><span class="line">    cudaFree(d_A.elements);</span><br><span class="line">    cudaFree(d_B.elements);</span><br><span class="line">    cudaFree(d_C.elements);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Matrix multiplication kernel called by MatMul()</span></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MatMulKernel</span><span class="params">(Matrix A, Matrix B, Matrix C)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Each thread computes one element of C</span></span><br><span class="line">    <span class="comment">// by accumulating results into Cvalue</span></span><br><span class="line">    <span class="type">float</span> Cvalue = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="type">int</span> col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> e = <span class="number">0</span>; e &lt; A.width; ++e)</span><br><span class="line">        Cvalue += A.elements[row * A.width + e]</span><br><span class="line">                * B.elements[e * B.width + col];</span><br><span class="line">    C.elements[row * C.width + col] = Cvalue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çŸ©é˜µä¹˜æ³•2.0</p>
<p>ä½¿ç”¨ <code>__device__</code>è·å–çŸ©é˜µä¸­å…ƒç´ å’Œè®¾å®šå…ƒç´ </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Matrices are stored in row-major order:</span></span><br><span class="line"><span class="comment">// M(row, col) = *(M.elements + row * M.stride + col)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> width;</span><br><span class="line">    <span class="type">int</span> height;</span><br><span class="line">    <span class="type">int</span> stride;</span><br><span class="line">    <span class="type">float</span>* elements;</span><br><span class="line">&#125; Matrix;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–çŸ©é˜µå…ƒç´ </span></span><br><span class="line">__device__ <span class="type">float</span> <span class="title function_">GetElement</span><span class="params">(<span class="type">const</span> Matrix A, <span class="type">int</span> row, <span class="type">int</span> col)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> A.elements[row * A.stride + col];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾å®šçŸ©é˜µå…ƒç´ </span></span><br><span class="line">__device__ <span class="type">void</span> <span class="title function_">SetElement</span><span class="params">(Matrix A, <span class="type">int</span> row, <span class="type">int</span> col,</span></span><br><span class="line"><span class="params">                           <span class="type">float</span> value)</span></span><br><span class="line">&#123;</span><br><span class="line">    A.elements[row * A.stride + col] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®çº¿ç¨‹é”çš„å¤§å°æ„å»ºç»™å®šçŸ©é˜µçš„å­çŸ©é˜µ</span></span><br><span class="line"> __device__ Matrix <span class="title function_">GetSubMatrix</span><span class="params">(Matrix A, <span class="type">int</span> row, <span class="type">int</span> col)</span></span><br><span class="line">&#123;</span><br><span class="line">    Matrix Asub;</span><br><span class="line">    Asub.width    = BLOCK_SIZE;</span><br><span class="line">    Asub.height   = BLOCK_SIZE;</span><br><span class="line">    Asub.stride   = A.stride;</span><br><span class="line">    Asub.elements = &amp;A.elements[A.stride * BLOCK_SIZE * row</span><br><span class="line">                                         + BLOCK_SIZE * col];</span><br><span class="line">    <span class="keyword">return</span> Asub;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLOCK_SIZE 16</span></span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">MatMulKernel</span><span class="params">(<span class="type">const</span> Matrix, <span class="type">const</span> Matrix, Matrix)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MatMul</span><span class="params">(<span class="type">const</span> Matrix A, <span class="type">const</span> Matrix B, Matrix C)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    Matrix d_A;</span><br><span class="line">    d_A.width = d_A.stride = A.width; d_A.height = A.height;</span><br><span class="line">    <span class="type">size_t</span> size = A.width * A.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_A.elements, size);</span><br><span class="line">    cudaMemcpy(d_A.elements, A.elements, size,</span><br><span class="line">               cudaMemcpyHostToDevice);</span><br><span class="line">    Matrix d_B;</span><br><span class="line">    d_B.width = d_B.stride = B.width; d_B.height = B.height;</span><br><span class="line">    size = B.width * B.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_B.elements, size);</span><br><span class="line">    cudaMemcpy(d_B.elements, B.elements, size,</span><br><span class="line">    cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line">    Matrix d_C;</span><br><span class="line">    d_C.width = d_C.stride = C.width; d_C.height = C.height;</span><br><span class="line">    size = C.width * C.height * <span class="keyword">sizeof</span>(<span class="type">float</span>);</span><br><span class="line">    cudaMalloc(&amp;d_C.elements, size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invoke kernel</span></span><br><span class="line">    dim3 <span class="title function_">dimBlock</span><span class="params">(BLOCK_SIZE, BLOCK_SIZE)</span>;</span><br><span class="line">    dim3 <span class="title function_">dimGrid</span><span class="params">(B.width / dimBlock.x, A.height / dimBlock.y)</span>;</span><br><span class="line">    MatMulKernel&lt;&lt;&lt;dimGrid, dimBlock&gt;&gt;&gt;(d_A, d_B, d_C);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read C from device memory</span></span><br><span class="line">    cudaMemcpy(C.elements, d_C.elements, size,</span><br><span class="line">               cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Free device memory</span></span><br><span class="line">    cudaFree(d_A.elements);</span><br><span class="line">    cudaFree(d_B.elements);</span><br><span class="line">    cudaFree(d_C.elements);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Matrix multiplication kernel called by MatMul()</span></span><br><span class="line"> __global__ <span class="type">void</span> <span class="title function_">MatMulKernel</span><span class="params">(Matrix A, Matrix B, Matrix C)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å—çš„è¡Œä¸åˆ—</span></span><br><span class="line">    <span class="type">int</span> blockRow = blockIdx.y;</span><br><span class="line">    <span class="type">int</span> blockCol = blockIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸ªçº¿ç¨‹å—è®¡ç®—æ¯ä¸€ä¸ªå­çŸ©é˜µ</span></span><br><span class="line">    Matrix Csub = GetSubMatrix(C, blockRow, blockCol);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸ªçº¿ç¨‹è®¡ç®—æ¯ä¸ªçŸ©é˜µçš„å…ƒç´ ï¼Œç»“æœä¿ç•™åœ¨Cvalueä¸­</span></span><br><span class="line">    <span class="type">float</span> Cvalue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰Csubä¸­çº¿ç¨‹çš„è¡Œåˆ—</span></span><br><span class="line">    <span class="type">int</span> row = threadIdx.y;</span><br><span class="line">    <span class="type">int</span> col = threadIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹çŸ©é˜µAã€Bçš„æ‰€æœ‰å­çŸ©é˜µè¿›è¡Œå¾ªç¯</span></span><br><span class="line">    <span class="comment">// è®¡ç®—Csubï¼ŒæŠŠæ¯ä¸€å¯¹å­çŸ©é˜µCsubå¾ªç¯ï¼Œä¹‹åç´¯åŠ æ±‚å’Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> m = <span class="number">0</span>; m &lt; (A.width / BLOCK_SIZE); ++m) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–çŸ©é˜µAã€Bçš„å­çŸ©é˜µ</span></span><br><span class="line">        Matrix Asub = GetSubMatrix(A, blockRow, m);</span><br><span class="line">        Matrix Bsub = GetSubMatrix(B, m, blockCol);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜å‚¨Aã€BçŸ©é˜µçš„å­çŸ©é˜µAsubå’ŒBsubç”¨äºå…±äº«</span></span><br><span class="line">        __shared__ <span class="type">float</span> As[BLOCK_SIZE][BLOCK_SIZE];</span><br><span class="line">        __shared__ <span class="type">float</span> Bs[BLOCK_SIZE][BLOCK_SIZE];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»è®¾å¤‡ä¸­è½½å…¥Asubä¸Bsubåˆ°å…±äº«å†…å­˜ä¸­</span></span><br><span class="line">        <span class="comment">// æ¯ä¸ªçº¿ç¨‹åŠ è½½æ¯ä¸ªå­çŸ©é˜µçš„ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        As[row][col] = GetElement(Asub, row, col);</span><br><span class="line">        Bs[row][col] = GetElement(Bsub, row, col);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨å¼€å§‹è®¡ç®—å‰åŒæ­¥ä»¥ç¡®ä¿å­çŸ©é˜µè¢«åŠ è½½</span></span><br><span class="line">        __syncthreads();</span><br><span class="line">        <span class="comment">// åŒæ—¶è®¡ç®—Aã€Bå­çŸ©é˜µ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e = <span class="number">0</span>; e &lt; BLOCK_SIZE; ++e)</span><br><span class="line">            Cvalue += As[row][e] * Bs[e][col];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒæ­¥ä»¥ç¡®ä¿Aã€Bå­çŸ©é˜µåœ¨ä¸‹æ¬¡è¿­ä»£å‰è®¡ç®—å®Œæˆ</span></span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥Cå­çŸ©é˜µåˆ°è®¾å¤‡å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹å†™å…¥ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    SetElement(Csub, row, col, Cvalue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CUDA</category>
      </categories>
      <tags>
        <tag>GPU</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°è¢«CUDAæŠ˜è…¾æ­»å»æ´»æ¥çš„é‚£åå¤©</title>
    <url>/hexo_blog/2018/05/05/CUDA/%E8%AE%B0%E8%A2%ABCUDA%E6%8A%98%E8%85%BE%E6%AD%BB%E5%8E%BB%E6%B4%BB%E6%9D%A5%E7%9A%84%E9%82%A3%E5%8D%81%E5%A4%A9/</url>
    <content><![CDATA[<p>è°¨ä»¥æ­¤æ–‡ç« çºªå¿µå¤§äºŒçš„ä¸€æ¬¡æŠ˜è…¾CUDAç¯å¢ƒæ­å»ºç»å†ã€‚</p>
<span id="more"></span>
<p>ä¸ºäº†æé«˜çŸ©é˜µè¿ç®—çš„é€Ÿåº¦å’Œä¸æµªè´¹å®éªŒå®¤çš„GPUï¼Œæ‰€ä»¥å¼€å§‹æŠ˜è…¾CUDAç¯å¢ƒï¼Œå…¥é—¨GPU
Coderã€‚æ„Ÿè°¢@å°å²³å²³ å…¨ç¨‹çš„å¸®åŠ©ï¼Œå­¦ä¹ äº†å¾ˆå¤šç¡¬ä»¶çŸ¥è¯†ï¼›æ„Ÿè°¢@æµªæµª
å­¦é•¿çš„æŒ‡å¯¼ï¼Œå°‘èµ°äº†ä¸€äº›å¼¯è·¯ã€‚æœ¬æ–‡ä¼šå°½é‡ä»é›¶å¼€å§‹ä»‹ç»ç¡¬ä»¶çŸ¥è¯†è¿‡æ¸¡åˆ°ç³»ç»Ÿå’Œè½¯ä»¶ç¯å¢ƒçš„æ­å»ºã€‚</p>
<p>è´´ä¸Šå­¦é•¿çš„åšå®¢<a href="http://amourll.cn/2018/03/27/gpu-coder/">GPU
Coderåˆä½“éªŒ</a></p>
<h2 id="åŸºç¡€ä»‹ç»">åŸºç¡€ä»‹ç»</h2>
<p>é¦–å…ˆç¥­å‡ºæ˜¾å¡å¤©æ¢¯å›¾ï¼Œæ—¶é—´æˆªæ­¢äºåšå®¢ç¼–è¾‘å®Œçš„æ—¥æœŸï¼ˆ2018å¹´4æœˆï¼‰ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/cuda/5af851eca8de0.jpg" /></p>
<p>å…³äºæ˜¾å¡çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†å¯ä»¥çœ‹çŸ¥ä¹çš„è¿™ä¸ªè´´ï¼š<a
href="https://zhuanlan.zhihu.com/p/33743591">çŸ¥è¯†æ‰«ç›²Iç»™å¤§ä¼—çš„ç”µè„‘æ˜¾å¡é€‰è´­æŒ‡å—</a></p>
<p>è¿™é‡Œå†ç®€å•è¡¥å……ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼ŒGPUï¼ˆGraphic Process Unit
ï¼‰å…¶å®æ˜¯æ˜¾å¡çš„æ ¸å¿ƒéƒ¨ä»¶ï¼Œåˆ†ä¸ºAMDå’ŒNvidiaä¸¤ç§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåšç§‘å­¦è®¡ç®—æˆ–è€…æ·±åº¦å­¦ä¹ éƒ½æ˜¯ç”¨Nvidiaæ˜¾å¡ï¼Œå½“ç„¶ç”¨AMDçš„ä¹Ÿæœ‰åœ¨è¿™é‡Œæˆ‘ç”¨çš„æ˜¯Nvidiaæ‰€ä»¥å°±ä¸ä»‹ç»å¦‚ä½•æ­å»ºAMDçš„ç¼–ç¨‹ç¯å¢ƒäº†ã€‚</p>
<h3 id="å…³äºgpuç¼–ç¨‹">å…³äºGPUç¼–ç¨‹</h3>
<p>æ‰€è°“GPUç¼–ç¨‹ï¼Œæˆ‘çš„ç†è§£æ˜¯ç”¨ä»£ç æ“ä½œGPUè¿›è¡Œè¿ç®—ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å†™ä»£ç ç”¨è½¯ä»¶éƒ½æ˜¯è°ƒç”¨CPUæ¥å·¥ä½œçš„ï¼Œæ˜¾å¡åœ¨å¸¸è§„çš„è®¤çŸ¥ä¸­ï¼ˆæŸæŸå¹´ä»¥å‰ï¼‰éƒ½æ˜¯ç”¨æ¥ä½œä¸ºå›¾åƒæ¸²æŸ“ã€ç©æ¸¸æˆçš„ã€‚éšç€æ—¶ä»£çš„å‘å±•ï¼Œå…³äºå›¾åƒå¤„ç†çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œäº¤ç»™CPUæ¥è®¡ç®—å°±æ˜¾å¾—è¿‡æ…¢ï¼Œæ‰€ä»¥äººä»¬å¼€å§‹ç”¨èµ·äº†GPUï¼ŒGPUåŸæœ¬å‘æ˜çš„ç”¨é€”å°±æ˜¯ä¸ºäº†å¤„ç†å›¾åƒã€‚æ‰€ä»¥å¦‚æœæ•°æ®æ˜¯å…³äºå›¾åƒå¤„ç†çš„ï¼Œäº¤ç»™GPUæ¥è®¡ç®—è¿œè¿œå¥½äºCPUçš„ã€‚</p>
<h3 id="å…³äºå¹¶è¡Œè®¡ç®—">å…³äºå¹¶è¡Œè®¡ç®—</h3>
<p>GPUå¹¶è¡Œï¼šCUDAï¼ŒOpenCLï¼ˆéƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œå»ºè®®CUDAï¼‰
CPUå¹¶è¡Œï¼šMPIï¼ŒOpenMPã€‚MPIæ¯”è¾ƒéº»çƒ¦ï¼ŒOpenMPå®¹æ˜“å®ç°</p>
<p>OpenAccï¼šOpenMPå’ŒCUDAçš„æ··åˆ</p>
<p>è¿™é‡Œä½¿ç”¨çš„æ–¹æ¡ˆæ˜¯CUDAï¼ˆè¯»ä½œï¼šåº“è¾¾ï¼‰ã€‚</p>
<h3 id="å®éªŒå®¤çš„æ˜¾å¡ä»‹ç»">å®éªŒå®¤çš„æ˜¾å¡ä»‹ç»</h3>
<p>Tesla C2050ã€ä¸¤å—Titans
Xã€ä¸€å—2010/2011å¹´çš„AMDå¡ï¼ˆå…·ä½“å¿˜äº†ï¼Œåæ­£åªç”¨æ¥åšå›¾åƒæ˜¾ç¤ºï¼‰</p>
<p>é…ç½®æƒ…å†µï¼šç‰¹æ–¯æ‹‰+AMDï¼ŒAMDç”¨åšæ˜¾ç¤ºï¼Œç‰¹æ–¯æ‹‰ç”¨æ¥è®¡ç®—ã€‚è‡³äºä¸ºä»€ä¹ˆä¸ä¸Šæ³°å¦ï¼Œæ˜¯å› ä¸ºè¦é¢„å¤‡ç•™ç€åé¢ä¹°çš„æ–°æœåŠ¡å™¨ï¼Œè¿™å°æ˜¯ä¹‹å‰ï¼ˆ2010/2011ï¼‰çš„æœåŠ¡å™¨ã€‚ç®€å•è¯´è¯´ç‰¹æ–¯æ‹‰æ˜¾å¡ï¼Œç‰¹æ–¯æ‹‰æ˜¾ç¤ºæ˜¯è‹±ä¼Ÿè¾¾ä¸“é—¨ç”Ÿäº§ç”¨ä½œç§‘å­¦è®¡ç®—çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç‰¹æ–¯æ‹‰æ˜¾å¡çš„ä»·æ ¼å’Œè®¡ç®—æ€§èƒ½éƒ½å¯ä»¥ç¢¾å‹å…¶ä»–ç±»å‹çš„æ˜¾å¡ï¼Œè€Œä¸”æ”¯æŒåŒç²¾åº¦ã€‚ä¸è¿‡åœ¨è¿™çš„è¯ï¼Œæ³°å¦è¿˜æ˜¯å¯ä»¥åŠæ‰“è¿™å—ç‰¹æ–¯æ‹‰çš„ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å¤§æ¦‚æ³°å¦æ˜¯ä¸æ”¯æŒåŒç²¾åº¦å§ã€‚</p>
<h2 id="æ­£æ–‡">æ­£æ–‡</h2>
<h3 id="ubuntu-tesla-amd">Ubuntu + Tesla + AMD</h3>
<h4 id="ç»“æœ">ç»“æœ</h4>
<p>å®‰è£…å¤±è´¥</p>
<h4 id="é‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">é‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h4>
<ol type="1">
<li>ç‰¹æ–¯æ‹‰ä¸èƒ½ä½œä¸ºå›¾åƒæ˜¾ç¤ºã€‚è§£å†³æ–¹æ¡ˆï¼šæ¢AMDæ˜¾å¡åšæ˜¾ç¤ºã€‚ã€‚ã€‚</li>
<li>Ubuntu16.04ä¹‹åä¸æ”¯æŒAMDæ˜¾å¡é©±åŠ¨ã€‚è§£å†³æ–¹æ¡ˆï¼šè€ç‰ˆæœ¬çš„Ubuntuæˆ–è€…æœç´¢å…³é”®è¯<code>amdgpu-pro</code>ã€<code>Ubuntu</code></li>
<li>å®‰è£…CUDAæ˜¯å¦è¿˜éœ€è¦å®‰è£…è‹±ä¼Ÿè¾¾çš„é©±åŠ¨ã€‚Windowsä¸‹æ˜¯ä¸éœ€è¦çš„ï¼ŒUbuntuä¸çŸ¥é“ï¼Œå¾ˆå¤šåšå®¢ä¸­éƒ½æœ‰å®‰è£…è‹±ä¼Ÿè¾¾é©±åŠ¨è¿™ä¸€æ­¥éª¤ã€‚</li>
<li>å®‰è£…å®Œè‹±ä¼Ÿè¾¾é©±åŠ¨ä¹‹åï¼Œå‡ºç°å¾ªç¯ç™»é™†æˆ–è€…ä¸èƒ½æ˜¾ç¤ºå›¾å½¢ç•Œé¢çš„æƒ…å†µã€‚è§£å†³æ–¹æ¡ˆï¼šå¸è½½è‹±ä¼Ÿè¾¾é©±åŠ¨ï¼Œé‡å¯ã€‚</li>
<li>è‹±ä¼Ÿè¾¾ï¼ˆç‰¹æ–¯æ‹‰ï¼‰å’ŒAMDåŒæ˜¾å¡çš„é—®é¢˜ã€‚è¿™ç§æƒ…å†µç½‘ä¸Šæœå‡ºæ¥çš„ç»“æœæ¯”è¾ƒå°‘ï¼Œå¤§å¤šéƒ½æ˜¯æ ¸æ˜¾æˆ–é›†æ˜¾+è‹±ä¼Ÿè¾¾æ˜¾å¡ã€‚æ‰€ä»¥åœ¨å°è¯•äº†Næ¬¡ä¹‹åï¼Œæ”¾å¼ƒäº†ã€‚</li>
</ol>
<h4 id="è¡¥å……">è¡¥å……</h4>
<p>å½“æ—¶ä¸çŸ¥é“è£…CUDAæ˜¯å¦éœ€è¦å®‰è£…è‹±ä¼Ÿè¾¾é©±åŠ¨ï¼Œæ‰€ä»¥å°±å®‰è£…äº†ã€‚ä½†æ˜¯å®‰è£…å®Œä¹‹åé‡å¯ï¼Œå°±ä¸èƒ½æ˜¾ç¤ºå›¾å½¢ç•Œé¢ï¼ŒåŸå› å¦‚é—®é¢˜ä¸€ã€‚å¾ˆçŸ›ç›¾çš„ç‚¹å°±åœ¨äºï¼Œå¦‚æœåªå®‰è£…CUDAä¸è£…è‹±ä¼Ÿè¾¾é©±åŠ¨ï¼Œå®‰è£…CUDAæ˜¯å¤±è´¥çš„ã€‚ç»¼ä¸Šï¼Œä¸æ‡‚å¦‚ä½•åœ¨AMDçš„åŸºç¡€ä¸Šç”¨ç‰¹æ–¯æ‹‰æ­å»ºç¯å¢ƒã€‚ï¼ˆæœ€åå¯èƒ½æ€€ç–‘æ˜¯æ˜¾å¡æœ¬èº«å‡ºäº†é—®é¢˜ï¼‰</p>
<p><a
href="https://developer.nvidia.com/cuda-downloads">CUDAä¸‹è½½åœ°å€</a>ï¼Œè¿™é‡Œé€‰æ‹©å¥½ç³»ç»Ÿç¯å¢ƒï¼Œå¼ºçƒˆæ¨èä¸‹è½½<code>runfile</code>ï¼Œç”¨å®ƒè¿›è¡Œå®‰è£…ã€‚ä¸æ¨èå®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚CUDAå®˜ç½‘è™½å£°æ˜è¯´CUDAå‘ä¸‹å…¼å®¹ï¼Œä½†æ ¹æ®ç½‘ä¸Šåé¦ˆå’Œè‡ªå·±çš„å®éªŒæ¥çœ‹ï¼ŒCUDAå¹¶æ²¡æœ‰åšåˆ°ã€‚å…³äºä¸»æ¿BIOSè®¾ç½®æ˜¾å¡çš„é—®é¢˜ï¼Œå®éªŒå®¤è¿™å—å¹¶ä¸æ”¯æŒã€‚ã€‚ã€‚ã€‚å‡‰å‡‰</p>
<h4 id="ä¸€äº›å®ç”¨å‘½ä»¤">ä¸€äº›å®ç”¨å‘½ä»¤</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸èƒ½è¿›å…¥å›¾å½¢ç•Œé¢çš„æ—¶å€™ï¼ŒæŒ‰ä½Ctrl+Alt+F1/F2/F3è¿›å…¥ç»ˆç«¯ç•Œé¢ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤å¸è½½è‹±ä¼Ÿè¾¾é©±åŠ¨ã€‚å¸è½½å®Œé‡å¯å³å¯</span></span><br><span class="line">$ <span class="built_in">sudo</span> apt-get remove --purge nvidia-*</span><br><span class="line">$ reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯</span></span><br><span class="line">$ lspci | grep -i vga</span><br><span class="line"><span class="comment"># æŸ¥çœ‹GPUå‹å·</span></span><br><span class="line">$ lspci | grep -i nvidia</span><br><span class="line"><span class="comment"># æŸ¥çœ‹NVIDIAé©±åŠ¨ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> dpkg --list | grep nvidia-*</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‚è€ƒçš„ä¸€äº›åšå®¢å¦‚ä¸‹ï¼š</p>
<p><a
href="https://blog.csdn.net/chaihuimin/article/details/71006654?locationNum=2&amp;fps=1">Ubuntu16.04å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAæ—¶çš„ä¸€äº›å‘ä¸è§£å†³æ–¹æ¡ˆ</a></p>
<p><a href="http://www.cnblogs.com/sp-li/p/7680526.html">ubuntu16.04
å®‰è£…NVIDIAå’ŒCUDA8.0</a></p>
<p><a
href="https://blog.csdn.net/wonengguwozai/article/details/52664597">Ubuntuå®‰è£…å’ŒNVIDIAé©±åŠ¨å’Œå®‰è£…</a></p>
<p><a
href="https://jingyan.baidu.com/article/d8072ac468a91dec95cefdf0.html">ä¸»æ¿è®¾ç½®ç‹¬æ˜¾/é›†æ˜¾</a></p>
<p>ä»¥ä¸Šï¼Œæ¥æ¥å›å›é‡è£…è¿‡æ— æ•°éç³»ç»Ÿï¼Œè€—æ—¶5-6å¤©ã€‚å…¶ä¸­ï¼Œå¤§éƒ¨åˆ†è€—è´¹çš„æ—¶é—´åœ¨äºä¸‹è½½å’Œå®‰è£…ï¼Œå½“ç„¶è¿˜æœ‰ç›¸å½“ä¸€éƒ¨åˆ†åœ¨é‡è£…ç³»ç»Ÿçš„æ—¶é—´ä¸Šï¼Œè€Œä¸”ä¸€å¼€å§‹è£…çš„æ˜¯æœ€æ–°çš„17.10ï¼Œä¹‹ååˆå›é€€åˆ°äº†16.04ï¼Œåšäº†å‡ æ¬¡ç³»ç»Ÿç›˜é‡è£…äº†æ— æ•°æ¬¡ç³»ç»Ÿï¼Œå¹¶ä¸”è¿˜åªèƒ½åœ¨è¯¾ä½™æ—¶é—´ï¼ˆåŸºæœ¬æ˜¯æ™šä¸Šï¼Œå’Œå²³å²³åœ¨å®éªŒå®¤æŠ˜è…¾ï¼‰ã€‚å¯ä»¥è¯´æ˜¯ç›¸å½“æƒ¨äº†ï¼Œåç»­å·²ç»åŸºæœ¬ç†Ÿç»ƒåˆ°ï¼Œå‡ºäº†é—®é¢˜ç›´æ¥æ‰‹æ•²å‘½ä»¤é‡æ–°æ¥ä¸€éï¼Œä¸éœ€è¦æŸ¥èµ„æ–™ï¼ˆç†Ÿæ‚‰åˆ°ä»¤äººå¿ƒç–¼ï¼‰ã€‚</p>
<h4 id="æ€»ç»“ç»éªŒæ•™è®­">æ€»ç»“ç»éªŒæ•™è®­</h4>
<ol type="1">
<li>è¸©å‘ä¹‹å‰ï¼Œå…ˆå»è¯·æ•™å·²ç»è¸©è¿‡å‘çš„æœ‹å‹æˆ–è€…å»å®˜æ–¹è®ºå›æŸ¥çœ‹å®‰è£…è®°å½•æˆ–è€…æœç´¢ç›¸å…³åšå®¢ã€‚å·²ç»ä¸¤å¹´äº†ï¼Œæˆ‘çš„ä¹ æƒ¯è¿˜æ²¡æœ‰æ”¹è¿‡æ¥QAQï¼Œå–œæ¬¢è‡ªå·±ä¸€éåˆä¸€éè¸©å‘ä¹‹åå†æœç´¢</li>
<li>æå‰å‡†å¤‡ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚å¦‚æœæ˜¯å¤§å‹å·¥å…·ï¼Œå°±å¯èƒ½ä¼šå¼„åï¼ˆâ€œè„â€ï¼‰ç³»ç»Ÿï¼Œå¤‡ä¸€ä¸ªç³»ç»Ÿç›˜ã€‚è¿˜æœ‰ä¸€äº›èƒ½æå‰è·å–çš„å‹ç¼©åŒ…æˆ–è€…å®‰è£…åŒ…ã€‚</li>
<li>è¸©å‘çš„æ—¶å€™è¦è„šè¸å®åœ°ï¼Œä¸è¦æµ®èºå†²åŠ¨ã€‚æ˜æ˜ä¸éœ€è¦é‡è£…ç³»ç»Ÿï¼Œæµªè´¹æ—¶é—´ï¼Œå°±ä¸è¦ç›´æ¥åŠ¨æ‰‹æ ¼ç›˜é‡è£…</li>
</ol>
<h3 id="windows10-tesla-amd">Windows10 + Tesla + AMD</h3>
<p>æŒ‰ç…§å°å²³å²³çš„æ„æ€ï¼ŒWindowsè£…è¿™ç§åŒæ˜¾å¡é©±åŠ¨å•¥çš„ä¼šæ¯”Linuxæ–¹ä¾¿å¾ˆå¤šï¼Œæ‰€ä»¥æ”¹æˆ˜Windowsï¼Œé‡è£…çš„ç³»ç»Ÿç‰ˆæœ¬æ˜¯ä¸“ä¸šç‰ˆã€‚</p>
<h4 id="ç»“æœ-1">ç»“æœ</h4>
<p>å¤±è´¥</p>
<h4 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h4>
<p>AMDé©±åŠ¨èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºå›¾å½¢å¹¶ä¸”å¯ä»¥æ­£å¸¸å®‰è£…é©±åŠ¨ï¼Œä½†æ˜¯é‚£å—ç‰¹æ–¯æ‹‰æ˜¾å¡ä¸è¡Œã€‚ç³»ç»Ÿèƒ½è¯†åˆ«å‡ºæ¥æœ‰ä¸¤å—æ˜¾å¡ï¼Œä½†æ˜¯åœ¨å®‰è£…å®Œè‹±ä¼Ÿè¾¾é©±åŠ¨ä¹‹åï¼Œå¹¶ä¸èƒ½è®¾ç½®ç‰¹æ–¯æ‹‰ã€‚ä¸”ä¸¤å—æ˜¾å¡ï¼ŒAMDæ˜¾ç¤ºæ­£å¸¸ï¼Œç‰¹æ–¯æ‹‰æœ‰ä¸ªé»„è‰²çš„æ„Ÿå¹å·ã€‚æ‰€ä»¥æ˜¯å¦æ€€ç–‘æ˜¯å¦æ˜¯æ˜¾å¡æœ¬èº«æœ‰äº†é—®é¢˜ï¼ˆæ¯•ç«Ÿè¿™ä¹ˆä¹…äº†QAQï¼‰</p>
<h4 id="è¡¥å……-1">è¡¥å……</h4>
<p>ç‰¹æ–¯æ‹‰æ˜¾å¡æœ¬èº«ä¸æ˜¯å®‰è£…ä¸€èˆ¬çš„è‹±ä¼Ÿè¾¾é©±åŠ¨çš„ï¼Œè€Œæ˜¯éœ€è¦å®‰è£…<code>TCC</code>é©±åŠ¨ç¨‹åºï¼Œ<a
href="http://www.nvidia.cn/object/software-for-tesla-products-cn.html">å®˜ç½‘ä»‹ç»</a>ã€‚è¿™é‡Œä¸€å¼€å§‹æˆ‘æ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥å¯èƒ½æ˜¯è¿™é‡Œå‡ºäº†é—®é¢˜ã€‚ä½†æ˜¯å¾ˆçŸ›ç›¾çš„ç‚¹åœ¨äºï¼ŒCUDAåœ¨Windowså¯ä»¥ç›´æ¥å®‰è£…é©±åŠ¨ç¨‹åºã€‚æˆ‘ä¹Ÿè¯•è¿‡ç›´æ¥å®‰è£…CUDAä¹Ÿä¸è¡Œã€‚æµªæµªçš„æ„æ€æ˜¯ï¼Œç‰¹æ–¯æ‹‰åªèƒ½åœ¨Serverç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œæˆ‘å’Œå°å²³å²³å¯¹è¿™ä¸€ç‚¹æŒæ€€ç–‘æ€åº¦ã€‚</p>
<p>å…³äºå®Œæ•´çš„å®‰è£…è¿‡ç¨‹å°±ä¸åœ¨è¿™ä¸ªå¤±è´¥éƒ¨åˆ†ä»‹ç»äº†ï¼Œä¸‹ä¸€èŠ‚å®Œæ•´çš„è¯´æ˜Windowsä¸‹å®‰è£…è¿‡ç¨‹åŠæ³¨æ„äº‹é¡¹ã€‚æ­¤éƒ¨åˆ†è€—æ—¶2-3å¤©ã€‚</p>
<h3 id="windows10-titan-x">Windows10 + Titan X</h3>
<p>ç”±äºä»¥ä¸Šç§ç§åŸå› ï¼Œå¹¶ä¸”å·²ç»å¿«æŠ˜è…¾ä¸ä¸‹å»äº†ï¼Œæ‰€ä»¥è·Ÿæ•™æˆç›´æ¥ç”³è¯·æ¢æ³°å¦ã€‚å—¯ï¼Œæ‰€ä»¥è¿™ä¸€æ³¢ä¸€å¤©åŠå¤§æ¦‚å°±æˆåŠŸäº†ï¼Œåªå¤±è´¥äº†ä¸€æ¬¡ã€‚æ³°å¦æ˜¯æ”¯æŒå›¾å½¢æ˜¾ç¤ºçš„ï¼Œä¸ºäº†å‡å°‘é—®é¢˜æ‰€ä»¥ä¹Ÿå°†AMDæ¢ä¸‹äº†ï¼ˆç¬¬ä¸€æ¬¡æ²¡å¸ï¼Œå‡ºäº†ä¸€ç‚¹é—®é¢˜ï¼Œå¯èƒ½è·ŸAMDæœ‰å…³ï¼‰ã€‚</p>
<h4 id="è½¯ä»¶ç‰ˆæœ¬">è½¯ä»¶ç‰ˆæœ¬</h4>
<p>Windows10ä¸“ä¸šç‰ˆ+VS2013ä¸“ä¸šç‰ˆ+CUDA7.5</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‰æ–‡ä¸­æåˆ°CUDAä¸å‘ä¸‹å…¼å®¹ï¼Œæ‰€ä»¥æ¨èä¸å®‰è£…æœ€æ–°çš„ï¼Œä¿é™©èµ·è§å°±é€‰äº†è¾ƒæ—§çš„ç‰ˆæœ¬ã€‚å…³äºVSç‰ˆæœ¬é€‰æ‹©é—®é¢˜ï¼Œè¿™é‡ŒCUDA7.5ç½‘ä¸Šæœ€å¤šçš„æ­é…æ˜¯VS2013ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦è¯´æ˜VS2013å¿…é¡»è¦æ˜¯ä¸“ä¸šç‰ˆï¼Œå¦åˆ™ä¸æ”¯æŒCUDAã€‚åœ¨VS2015ä¹‹åçš„ç‰ˆæœ¬å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚è¿˜æœ‰å°±æ˜¯é¡ºåºé—®é¢˜ï¼Œ<strong>ä¸€å®šè¦å…ˆå®‰è£…VSå†å®‰è£…CUDA</strong>ï¼Œä¸éœ€è¦å®‰è£…è‹±ä¼Ÿè¾¾é©±åŠ¨ã€‚</p>
<h4 id="æ€»ä½“æµç¨‹">æ€»ä½“æµç¨‹</h4>
<ol type="1">
<li><p>å®‰è£…Windowsç³»ç»Ÿï¼Œæ¿€æ´»ç³»ç»Ÿï¼Œæœ€å¥½ä¸è¿›è¡Œå®‰å…¨æ›´æ–°ã€‚å¸è½½ä¸€äº›ä¸å¿…è¦çš„è½¯ä»¶é˜²æ­¢å ç”¨ç©ºé—´å¤§å°ï¼ˆæ¯”å¦‚è¯´æˆ‘åªæœ‰ä¸€å—128Gçš„å›ºæ€ï¼Œæƒ¨ï¼ï¼‰</p></li>
<li><p>å®‰è£…VS2013ä¸“ä¸šç‰ˆ</p></li>
<li><p>å®‰è£…CUDA7.5ï¼Œå»ºè®®localç‰ˆã€‚å¦‚æœè¿™é‡Œå®‰è£…å¤±è´¥å¯ä»¥è¿›å…¥<strong>æœåŠ¡</strong>ï¼Œæ‰¾åˆ°<strong>Windows
Installer</strong>ï¼Œæ‰‹åŠ¨å¯åŠ¨å®ƒå³å¯ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–é—®é¢˜ï¼Œåœ¨æ–‡æœ«è´´äº†é“¾æ¥ã€‚</p></li>
<li><p>å†™CUDAçš„ç¯å¢ƒé…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cuda7.5å®‰è£…å®Œæˆä¹‹ååœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è‡ªåŠ¨é…ç½®äº†ä¸¤ä¸ªç³»ç»Ÿå˜é‡</span></span><br><span class="line">CUDA_PATHï¼šC:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5</span><br><span class="line">CUDA_PATH_V7_5ï¼šC:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5</span><br><span class="line"><span class="comment"># ä½†æ˜¯ä¸ºäº†ä¹‹åçš„vs2013çš„é…ç½®åšå‡†å¤‡æˆ‘ä»¬éœ€è¦åœ¨é…ç½®äº”ä¸ªç³»ç»Ÿå˜é‡ï¼Œè¯·æ ¹æ®å…·ä½“çš„å®‰è£…è·¯å¾„è¿›è¡Œè®¾ç½®CUDA_SDK_PATH, è¿™é‡Œæˆ‘ç”¨çš„æ˜¯é»˜è®¤è®¾ç½®</span></span><br><span class="line">CUDA_BIN_PATHï¼š%CUDA_PATH%\bin</span><br><span class="line">CUDA_LIB_PATHï¼š%CUDA_PATH%\lib\Win32</span><br><span class="line">CUDA_SDK_BINï¼š%CUDA_SDK_PATH%\bin\Win64</span><br><span class="line">CUDA_SDK_LIBï¼š%CUDA_SDK_PATH%\common\lib\x64</span><br><span class="line">CUDA_SDK_PATHï¼šC:\ProgramData\NVIDIA Corporation\CUDA Samples\v7.5</span><br><span class="line"><span class="comment"># åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡pathåæ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">%CUDA_LIB_PATH%</span><br><span class="line">%CUDA_BIN_PATH%</span><br><span class="line">%CUDA_SDK_LIB_PATH%</span><br><span class="line">%CUDA_SDK_BIN_PATH%</span><br></pre></td></tr></table></figure></li>
<li><p>è¿›è¡Œæµ‹è¯•</p></li>
</ol>
<h4 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h4>
<p><a
href="https://blog.csdn.net/u011821462/article/details/50145221">win10+vs2013+cuda7.5ç¯å¢ƒæ­å»º</a></p>
<p><a
href="https://blog.csdn.net/u012033124/article/details/52169823">VS2013ä¸‹CUDA
7.5å®‰è£…</a></p>
<p>CUDAå®‰è£…çš„ä¸€äº›é”™è¯¯å¯ä»¥å‚è€ƒ<a
href="https://blog.csdn.net/xuxiatian/article/details/50577960">è¿™ç¯‡æ–‡ç« </a>ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ç³»ç»Ÿç¯å¢ƒå·²ç»è¢«æ±¡æŸ“äº†ï¼Œæœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯é‡è£…ç³»ç»Ÿã€‚</p>
<p>è€—æ—¶1-2å¤©ï¼Œæ€»å½’æ˜¯å¾ˆæ„‰å¿«çš„ç»“æŸäº†æ•´ä¸ªç¯å¢ƒæ­å»ºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰äº›ç¯å¢ƒçš„æ­å»ºä¸ä¸€å®šéœ€è¦ï¼ˆæœ€å¥½ä¸è¦ï¼‰ç”¨æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›bugï¼Œè€Œä¸”ä¹‹å‰è¸©å‘çš„äººæ¯”è¾ƒå°‘å¯å€Ÿé‰´çš„ä¸œè¥¿è¾ƒå°‘ã€‚æ€»ä½“æ¥è¯´ï¼ŒæŠ›å¼€ä¹‹å‰å¾ˆå¥‡æ€ªçš„ç¡¬ä»¶é…ç½®ä¹‹å¤–ï¼Œå®‰è£…è¿‡ç¨‹è¿˜æ˜¯å¹¶ä¸éš¾çš„ã€‚æ¥ä¸‹æ¥ï¼Œä¾¿å¼€å§‹äº†æˆ‘çš„CUDAç¼–ç¨‹ä¹‹æ—…ã€‚</p>
<p>äººç”Ÿè·¯æ¼«æ¼«ï¼Œè°¨ä»¥æ­¤æ–‡ç« çºªå¿µä¸Šå¤§å­¦æ¥æŠ˜è…¾ç¯å¢ƒæœ€å‘çˆ¹çš„ä¸€æ¬¡è®°å½•ã€‚</p>
]]></content>
      <categories>
        <category>Environment</category>
      </categories>
      <tags>
        <tag>GPU</tag>
        <tag>CUDA</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenWrtè·¯ç”±å™¨æŠ˜è…¾è®°å½•</title>
    <url>/hexo_blog/2023/01/10/IOT/OpenWrt%E8%B7%AF%E7%94%B1%E5%99%A8%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>åœ¨è·¯ç”±å™¨ä¸Šå®‰è£…å’Œé…ç½®OpenWrtã€‚å®ƒåŒ…æ‹¬å®‰è£…è½¯ä»¶åŒ…å’Œè®¾ç½®é˜²ç«å¢™ã€æ¥å£å’Œå„ç§ç½‘ç»œè¿æ¥çš„åˆ†æ­¥è¯´æ˜ã€‚</p>
<span id="more"></span>
<h2 id="åŸºæœ¬ç•Œé¢">åŸºæœ¬ç•Œé¢</h2>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673353557758.png" /></p>
<p>å‡†å¤‡ï¼š</p>
<ul>
<li>å›ºä»¶</li>
<li>å¾…æ¢å¤çš„é…ç½®</li>
<li>éœ€è¦å®‰è£…çš„è½¯ä»¶+è¿è¡Œçš„å‘½ä»¤</li>
</ul>
<p>é…ç½®å‡ºé—®é¢˜ï¼Œç›´æ¥é‡åˆ·ã€‚åŒæ—¶æ–¹ä¾¿èµ·è§ï¼Œè¦åŠæ—¶å¤‡ä»½å½“å‰çš„é…ç½®ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673353799884.png" /></p>
<h2 id="è½¯ä»¶åŒ…çš„å®‰è£…">è½¯ä»¶åŒ…çš„å®‰è£…</h2>
<p>èƒ½åœ¨çº¿å®‰è£…çš„å¯ä»¥ç›´æ¥åœ¨çº¿å®‰è£…ã€‚ç›´æ¥ä»"ç³»ç»Ÿ-&gt;è½¯ä»¶åŒ…"é‡Œé¢æ‰¾åˆ°éœ€è¦å®‰è£…çš„è½¯ä»¶ã€‚</p>
<p>ä½†æœ‰æ—¶å€™åœ¨çº¿å®‰è£…ä¼šç”±äºç½‘ç»œï¼Œè½¯ä»¶æºã€è½¯ä»¶ç‰ˆæœ¬ç­‰é—®é¢˜ï¼Œæ— æ³•è‡ªåŠ¨å®‰è£…ã€‚å› æ­¤éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‰¾åˆ°ipkæ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">opkg install XXX</span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹è½¯ä»¶ä¸‹è½½ç½‘é¡µï¼š<a
href="https://downloads.openwrt.org/releases/">https://downloads.openwrt.org/releases/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç³»ç»Ÿç‰ˆæœ¬å¯ä»¥ç›´æ¥ä»ç®¡ç†ç•Œé¢çš„æ¦‚å†µä¸­å¾—çŸ¥ï¼Œè¿™é‡Œæ˜¯17.01.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">&gt;&gt;&gt; <span class="built_in">uname</span> -a </span><br><span class="line">Linux dw33d 4.4.194 <span class="comment">#0 Tue Oct 17 17:46:20 2017 mips GNU/Linux</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ”¯æŒçš„æ¶æ„</span></span><br><span class="line">&gt;&gt;&gt; opkg print-architecture</span><br><span class="line"><span class="built_in">arch</span> all 1</span><br><span class="line"><span class="built_in">arch</span> noarch 1</span><br><span class="line"><span class="built_in">arch</span> mips_24kc 10</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”æˆ‘è¿™é‡Œçš„ç¬¬ä¸‰æ–¹åŒ…å°±æ˜¯ï¼š<a
href="https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/packages/">https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/packages/</a></p>
<p>åŸºç¡€çš„åº“ï¼š<a
href="https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/base">https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/base</a></p>
<p>luciï¼š<a
href="https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/luci/">https://downloads.openwrt.org/releases/17.01.4/packages/mips_24kc/luci/</a></p>
<h3 id="tmux">tmux</h3>
<p>ä»¥tmuxå®‰è£…ä¸ºä¾‹ï¼Œè¯¥è½¯ä»¶æ— æ³•ç›´æ¥å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. ä»packageé‡Œé¢ä¸‹è½½tmuxçš„ipkgæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># 2. æ‰§è¡Œå®‰è£…å‘½ä»¤</span></span><br><span class="line">&gt;&gt;&gt;opkg install tmux_2.3-1_mips_24kc.ipk</span><br><span class="line"><span class="comment"># 3. æŠ¥é”™ä¿¡æ¯ï¼Œä¸€äº›ä¾èµ–æ–‡ä»¶æ²¡æœ‰ã€‚æ‰€ä»¥ä»baseé‡Œé¢æ‰¾åˆ°å¯¹åº”ç¼ºå¤±çš„ipkæ–‡ä»¶ã€‚å¹¶è¿›è¡Œå®‰è£…</span></span><br><span class="line">&gt;&gt;&gt;opkg install terminfo_6.0-1_mips_24kc.ipk libncurses_6.0-1_mips_24kc.ipk</span><br><span class="line"><span class="comment"># 4. æ­¤æ—¶ï¼Œå†å®‰è£…tmuxã€‚å®‰è£…æˆåŠŸ</span></span><br><span class="line">&gt;&gt;&gt;opkg install tmux_2.3-1_mips_24kc.ipk</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½†å®‰è£…libevent2è¿™ä¸ªåº“æ—¶ï¼Œæç¤ºå½“å‰å·²å®‰è£…ï¼Œå¹¶ä¸”ç‰ˆæœ¬è¿‡é«˜ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨é™çº§ã€‚æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¸è½½åŸæœ‰çš„è½¯ä»¶</span></span><br><span class="line">&gt;&gt;&gt;opkg remove libevent2 --force-depends</span><br><span class="line"><span class="comment"># å¸è½½å¤±è´¥ï¼Œæç¤ºå·²æœ‰è½¯ä»¶ä¾èµ–è¯¥åº“ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼ºåˆ¶è¿›è¡Œå¸è½½ï¼Œå°†ä¾èµ–è½¯ä»¶ä¹Ÿè¿›è¡Œå¸è½½ã€‚åŠ ä¸Š--force å‘½ä»¤</span></span><br><span class="line"><span class="comment"># ä¹‹åå†å®‰è£…ä½ç‰ˆæœ¬çš„libncurses</span></span><br><span class="line">&gt;&gt;&gt;opkg install libevent2_2.0.22-1_mips_24kc.ipk</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åå†è¿è¡Œtmuxï¼ŒæˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–è½¯ä»¶åº”è¯¥åŒç†ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ‰¾åˆ°ä¾èµ–æ–‡ä»¶ï¼Œå¹¶ä¸”è€å¿ƒåœ°è§£å†³å„ç§é—®é¢˜ã€‚dw33då†…ç½®äº†ä¸€ä¸ª16gçš„sdå¡ï¼Œæ‰€ä»¥æˆ‘æŠŠä¸€äº›é‡è£…å¿…å¤‡çš„ipkæ–‡ä»¶æ”¾åˆ°é‡Œé¢ï¼Œä¾¿äºå¿«é€Ÿå®‰è£…ã€‚å¹¶ä¸”åˆ·å†™å›ºä»¶å¹¶ä¸ä¼šå½±å“è¯¥sdå¡çš„å†…å®¹ï¼Œå¯ä»¥æ”¾å¿ƒå­˜å‚¨ã€‚</p>
<h3 id="tailscale">Tailscale</h3>
<p>å¼‚åœ°ç»„ç½‘å·¥å…·ï¼Œä»å®˜ç½‘ä¸‹è½½æ‰¾åˆ°mipsç‰ˆæœ¬ï¼Œæ”¾åˆ°sdå¡ä¸­ï¼Œé¿å…åˆ·æ–°å›ºä»¶æœ‰å½±å“ã€‚ç›¸å½“äºå•æ–‡ä»¶å°±å¯ä»¥è¿è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹æ–‡ä»¶</span></span><br><span class="line">&gt;&gt;&gt; tar zxvf tailscale_1.34.1_mips.tgz</span><br><span class="line"><span class="comment"># åˆ°å¯¹åº”çš„ç›®å½•ä¸­ï¼Œé‡Œé¢ä¼šæœ‰ä¸€äº›æ–‡ä»¶ã€‚ä¸»è¦æ˜¯ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶tailscaleå’Œtailscaledã€‚</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡è¿è¡Œéœ€è¦å¯åŠ¨tailscaledæœåŠ¡</span></span><br><span class="line">&gt;&gt;&gt;./tailscaled --state=tailscaled.state</span><br><span class="line"><span class="comment"># æ­¤æ—¶éœ€è¦æ–°å¼€ä¸€ä¸ªçª—å£ï¼Œç™»å½•tailscale</span></span><br><span class="line">&gt;&gt;&gt;./tailscale login </span><br><span class="line"><span class="comment"># å¯ä»¥ç›´æ¥æŠŠç½‘å€å¤åˆ¶å‡ºæ¥ï¼Œç”¨å…¶ä»–è®¾å¤‡çš„æµè§ˆå™¨è¿›è¡Œç™»å½•</span></span><br></pre></td></tr></table></figure>
<p>ç™»å½•å®Œæ¯•ä¹‹åï¼Œç»„ç½‘å°±å®Œæˆäº†ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å…³é—­è¯¥çª—å£ã€‚ä½†ä¸ºäº†åå°å¯åŠ¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨tmuxï¼Œæˆ–è€…nohupå‘½ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./tailscaled --state=tailscaled.state &gt; t.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ä¸ºäº†ä¿è¯å¼€æœºè‡ªå¯åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨webç®¡ç†ç•Œé¢ä¸­"ç³»ç»Ÿ-&gt;å¯åŠ¨é¡¹"ä¸­ï¼Œæœ€åçš„"æœ¬åœ°å¯åŠ¨è„šæœ¬"ä¸­æ’å…¥(<code>exit 0</code>ä¹‹å‰è¡Œ)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆåˆ‡æ¢åˆ°å¯¹åº”ç›®å½•ï¼Œå†æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/sda1/tailscale_1.34.1_mips &amp;&amp; <span class="built_in">nohup</span> ./tailscaled --state=tailscaled.state &gt; t.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œå°±èƒ½ä¿è¯å¼‚åœ°ç®¡ç†è¯¥è·¯ç”±å™¨çš„webç•Œé¢ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥sshç™»å½•</p>
<h2 id="é˜²ç«å¢™">é˜²ç«å¢™</h2>
<p>"ç½‘ç»œ-&gt;é˜²ç«å¢™"ä¸­çš„é»˜è®¤é…ç½®ï¼Œwanå£æ˜¯æ‹’ç»å…¥ç«™æ•°æ®çš„ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´å¦‚æœè¯¥è·¯ç”±å™¨è·Ÿå…¶ä»–è®¾å¤‡åŒå±äºä¸€ä¸ªå±€åŸŸç½‘ï¼Œsshå’Œwebç•Œé¢å‡ä¸èƒ½é€šè¿‡ipç™»å½•ã€‚å…·ä½“çš„ä¾‹å­æ˜¯ï¼š</p>
<ul>
<li>è¯¥è·¯ç”±å™¨è¿æ¥äº†ä¸€ä¸ªä¸Šçº§è·¯ç”±å™¨Aï¼Œè·å–åˆ°çš„IPæ˜¯192.168.0.Xã€‚åˆ†é…ç»™ä¸‹é¢çš„è®¾å¤‡çš„IPæ˜¯192.168.1.X</li>
<li>å¦ä¸€ä¸ªè®¾å¤‡æ¥å…¥è·¯ç”±å™¨Aæ—¶ï¼Œè·å–åˆ°çš„IPæ˜¯192.168.0.Yã€‚æ­¤æ—¶èƒ½pingé€š192.168.0.Xï¼Œä½†æ˜¯æ— æ³•è¿›è¡Œsshï¼Œä¹Ÿæ— æ³•é€šè¿‡192.168.0.Xè®¿é—®ç®¡ç†ç•Œé¢</li>
<li>å¦ä¸€ä¸ªè®¾å¤‡æ¥å…¥è¯¥è·¯ç”±å™¨æ—¶ï¼Œè·å–åˆ°çš„IPæ˜¯192.168.1.Yã€‚æ­¤æ—¶èƒ½å¤Ÿé€šè¿‡sshå’Œwebè®¿é—®192.168.1.Xã€‚</li>
</ul>
<p>éœ€æ±‚ï¼šåœ¨åŒå±€åŸŸç½‘ä¸‹çš„å…¶ä»–è®¾å¤‡ä¹Ÿèƒ½è®¿é—®è¯¥è·¯ç”±å™¨ã€‚</p>
<p>åšæ³•ï¼š</p>
<ul>
<li>ä¸€ä¸ªç®€å•çš„åšæ³•å°±æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŠŠ"é˜²ç«å¢™"ä¸­çš„"å¸¸è§„è®¾ç½®"é‡Œé¢çš„wanå£ï¼Œå…¥ç«™æ•°æ®ä»<strong>æ‹’ç»</strong>æ”¹æˆ<strong>æ¥å—</strong>ã€‚ï¼ˆé»˜è®¤æ˜¯æ‹’ç»å…¥ç«™çš„ï¼‰</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1680509223.png" /></p>
<ul>
<li>å¦ä¸€ä¸ªåšæ³•æ˜¯é…ç½®"é˜²ç«å¢™-&gt;ç«¯å£è½¬å‘"ï¼ŒæŠŠéœ€è¦é…ç½®çš„ç«¯å£è½¬å‘å‡ºæ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œwebç•Œé¢çš„ç«¯å£æ˜¯80ã€‚æ‰€ä»¥ä»wanå£å‡ºæ¥çš„è®¿é—®80ç«¯å£çš„æµé‡ï¼Œç›´æ¥è½¬å‘åˆ°192.168.4.1ï¼ˆè¯¥è·¯ç”±å™¨åˆ†é…ç»™ä¸‹é¢çš„IPï¼Œä¸æ˜¯è·å–çš„IPï¼‰</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673356610477.png" /></p>
<p>å…³äºæµé‡è§„åˆ™è¿™é‡Œï¼Œåˆ™æ˜¯åœ¨ç³»ç»Ÿå†…éƒ¨å†³å®šæ˜¯å¦å¼€æ”¾æŸä¸ªç«¯å£ã€‚å¯ä»¥å‚è€ƒé»˜è®¤çš„ä¸€äº›é…ç½®è¿›è¡Œå¼€æ”¾ï¼Œä¸€èˆ¬åº”è¯¥æ˜¯ä¸éœ€è¦è°ƒæ•´çš„ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673356804612.png" /></p>
<h2 id="æ¥å£">æ¥å£</h2>
<p>"ç½‘ç»œ-&gt;æ¥å£"</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673357070459.png" /></p>
<p>æˆ‘ä¸»è¦ä¼šæœ‰ä»¥ä¸‹å››ç§ä¸Šç½‘æ–¹å¼ï¼ˆä¸ä¼šä¸“ä¸šæœ¯è¯­ï¼Œç®€å•æè¿°ç°è±¡ï¼‰ï¼š</p>
<ul>
<li><p>æ¡¥æ¥å…‰çŒ«</p>
<ul>
<li>å°†è·¯ç”±å™¨WANå£æ¥å…¥å…‰çŒ«LANå£ï¼Œä»£æ›¿å…‰çŒ«è¿›è¡Œæ‹¨å·ï¼Œéœ€è¦çŸ¥é“å®½å¸¦çš„è´¦å·å¯†ç ã€‚</li>
<li>åœ¨WANå£ä¸­ï¼Œåè®®é€‰æ‹©<strong>PPPoE</strong>ï¼Œè¾“å…¥è´¦å·å¯†ç </li>
<li>æ­¤æ—¶è¯¥è·¯ç”±å™¨å°±æ˜¯ä¸»è·¯ç”±å™¨ï¼Œä¸€èˆ¬åŒæ—¶æœ‰ipv4å’Œipv6ä¸¤ä¸ªåœ°å€ï¼Œå‡è®¾ipv4çš„ipä¸º192.168.1.1</li>
<li>æ¥å…¥è¯¥è·¯ç”±å™¨çš„è®¾å¤‡ï¼Œç”±è¯¥è·¯ç”±å™¨è¿›è¡Œåˆ†é…ipï¼Œipä¸è·¯ç”±å™¨åŒç½‘æ®µï¼Œå¦‚192.168.1.2</li>
</ul></li>
<li><p>æ¡¥æ¥ä¸Šä¸€çº§è·¯ç”±å™¨</p>
<ul>
<li>å°†è·¯ç”±å™¨WANå£æ¥å…¥ä¸Šä¸€çº§è·¯ç”±å™¨LANå£ï¼Œæ— éœ€çŸ¥é“è´¦å·å¯†ç </li>
<li>åœ¨WANå£ä¸­ï¼Œåè®®é€‰æ‹©<strong>DHCPå®¢æˆ·ç«¯</strong></li>
<li>åœ¨ç‰©ç†è®¾ç½®ä¸­ï¼Œé€‰æ‹©æ¡¥æ¥æ¥å£ï¼Œé»˜è®¤<strong>ä»¥å¤ªç½‘äº¤æ¢æœº:
eth0</strong>å¼€å¯ã€‚å‹¾é€‰ä¸¤ä¸ªæ— çº¿ç½‘ç»œã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</li>
<li><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673524264094.png" /></li>
<li>æ­¤æ—¶ï¼ŒIPåŒä¸Šä¸€çº§è·¯ç”±å™¨åŒç½‘æ®µï¼Œä¸”å¦‚æœæœ‰IPv6ï¼Œåˆ™è¿æ¥è¯¥è·¯ç”±å™¨çš„è®¾å¤‡ä¹Ÿæœ‰IPv6</li>
</ul></li>
<li><p>åšNAT</p>
<ul>
<li>å°†è·¯ç”±å™¨WANæ¥å…¥ä¸Šä¸€çº§è·¯ç”±å™¨çš„LANå£ï¼Œç›¸å½“äºæŠŠè¯¥è·¯ç”±å™¨åšä¸€ä¸ªæ–°çš„å…¥å£ã€‚</li>
<li>åœ¨WANä¸­ï¼Œåè®®é€‰æ‹©<strong>DHCPå®¢æˆ·ç«¯</strong>æˆ–<strong>é™æ€åœ°å€</strong>ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰</li>
<li>æ­¤æ—¶ï¼Œæ¥å…¥è¯¥è·¯ç”±å™¨çš„è®¾å¤‡ä¼šç‹¬ç«‹ä¸Šä¸€çº§è·¯ç”±å™¨çš„è®¾å¤‡ï¼Œå³ç½‘æ®µä¸åŒã€‚</li>
<li>æ³¨ï¼šå¦‚æœæ­¤æ—¶è¿˜éœ€è¦ipv6ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚<a
href="https://www.lategege.com/?p=676">https://www.lategege.com/?p=676</a>
<ul>
<li>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯éœ€è¦é€‰æ‹©é™æ€IPï¼Œå¹¶åœ¨<strong>WANå£</strong>å’Œ<strong>LAN</strong>ä¸­çš„"DHCPæœåŠ¡å™¨"ä¸­çš„IPv6è®¾ç½®ä¸­ï¼Œè·¯ç”±å™¨å¹¿å‘ŠæœåŠ¡ï¼ŒDHCPv6æœåŠ¡ï¼ŒNDP-ä»£ç†ä¸‰ä¸ªå‡é€‰æ‹©ä¸­ç»§æ¨¡å¼</li>
<li>å¹¶ä¸”åœ¨ç»ˆç«¯ä¸­ <code>vim /etc/config/dhcp</code>ï¼Œæ‰¾åˆ°
<code>config dhcp 'wan'</code>å¯¹åº”çš„é€‰é¡¹ï¼ŒåŠ å…¥
<code>option master '1'</code>è¿™ä¸€è¡Œ</li>
</ul></li>
</ul></li>
<li><p>WiFiæ”¾å¤§å™¨</p>
<ul>
<li><p>æ— éœ€ç½‘çº¿</p></li>
<li><p>"ç½‘ç»œ-&gt;æ— çº¿"ä¸­çš„æœç´¢ï¼Œæ‰¾åˆ°éœ€è¦æ”¾å¤§WiFiï¼ŒåŠ å…¥ç½‘ç»œã€‚çœ‹æƒ…å†µé€‰æ‹©æ”¾å¤§2.4Gè¿˜æ˜¯5Gçš„WiFi</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673357519480.png" /></p></li>
<li><p>WPAå¯†é’¥å°±æ˜¯WiFiå¯†ç ï¼Œæ–°çš„ç½‘ç»œåç§°å¯ä»¥é»˜è®¤ä¹Ÿå¯ä»¥å¦èµ·ä¸€ä¸ªä»¥ä¾¿åŒºåˆ†ã€‚</p></li>
<li><p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/openwrt/1673357576678.png" /></p></li>
<li><p>æ­¤æ—¶æ¥å£ä¸­ä¼šå¤šä¸€ä¸ªæ¥å£</p></li>
<li><p>å…¶ä»–åŒæ¡¥æ¥</p></li>
</ul></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>è·¯ç”±å™¨</tag>
        <tag>OpenWrt</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“æ‰‹æœºåˆ©ç”¨Termuxå®‰è£…Linux</title>
    <url>/hexo_blog/2021/07/21/IOT/%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E5%88%A9%E7%94%A8Termux%E5%AE%89%E8%A3%85Linux/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨å®‰å“æ‰‹æœºä¸Šå®‰è£…å’Œè¿è¡ŒUbuntuç³»ç»Ÿï¼Œå¹¶é€šè¿‡sshè¿æ¥è¿›è¡Œæ“ä½œï¼ŒåŒæ—¶ç»™å‡ºäº†ä¸€äº›å…¶ä»–æœ‰ç”¨çš„å‘½ä»¤å’Œé…ç½®è¯´æ˜ã€‚</p>
<span id="more"></span>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>ä¸è¦ä»Google Playä¸Šå®‰è£…ï¼Œæ­£ç¡®çš„å®‰è£…åŒ…åœ°å€<a
href="https://f-droid.org/packages/com.termux/">f-droid</a></p>
<p>ä¸‹è½½å®Œæˆåï¼Œæ­£å¸¸å®‰è£…ï¼Œä½†éœ€è¦é¢å¤–çš„ç»™å­˜å‚¨ç©ºé—´æƒé™ã€‚</p>
<p>è™½ç„¶è¯´å¯ä»¥å…rootå®‰è£…ï¼Œä½†æ²¡æœ‰rootæƒé™ï¼Œæœ‰äº›æ“ä½œä¸èƒ½å¾ˆå¥½çš„å®Œæˆï¼Œå¦‚
<code>top</code></p>
<h3 id="è¿æ¥">è¿æ¥</h3>
<p>åœ¨æ‰‹æœºä¸Šé…ç½®å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨åŒä¸€å±€åŸŸç½‘ä¸‹çš„ç”µè„‘è¿›è¡Œé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹æœºä¸Š</span></span><br><span class="line"><span class="comment"># å®‰è£…sshæœåŠ¡</span></span><br><span class="line">pkg install openssh -y</span><br><span class="line"><span class="comment"># å¼€å¯sshæœåŠ¡å™¨</span></span><br><span class="line">sshd</span><br><span class="line"><span class="comment"># é…ç½®å¯†ç </span></span><br><span class="line">passwd</span><br><span class="line"><span class="comment"># è¾“å…¥æƒ³è¦é…ç½®çš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”µè„‘ç»ˆç«¯, ipå¡«å†™å¯¹åº”çš„æ‰‹æœºipï¼Œ8022æ˜¯termuxé»˜è®¤çš„sshç«¯å£</span></span><br><span class="line">ssh root@[ip] -p8022</span><br><span class="line"><span class="comment"># è¾“å…¥åˆšåˆšçš„å¯†ç </span></span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œå°±èƒ½åœ¨ç”µè„‘ç«¯è¿›è¡Œé…ç½®</p>
<h3 id="é…ç½®">é…ç½®</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ç¬¬ä¸‰æ–¹åº“</span></span><br><span class="line">pkg install proot git python wget -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®å®‰è£…é¡¹ç›®</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/sqlsec/termux-install-linux.git</span><br><span class="line"><span class="built_in">cd</span> termux-install-linux</span><br><span class="line">python termux-linux-install.py</span><br><span class="line"><span class="comment"># é€‰æ‹©Ubuntu</span></span><br><span class="line"><span class="built_in">cd</span> ~/Termux-Linux/Ubuntu</span><br><span class="line">./start-ubuntu.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ï¼Œubuntuç‰ˆæœ¬ï¼Œæœ€æ–°æ”¯æŒ20.04</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/MFDGaming/ubuntu-in-termux</span><br><span class="line"><span class="built_in">cd</span> ubuntu-in-termux</span><br><span class="line"><span class="built_in">chmod</span> +x ubuntu.sh</span><br><span class="line">./ubuntu.sh -y</span><br><span class="line">./startubuntu.sh</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å®‰è£…çš„Linuxæ˜¯ä¸Termuxå…±äº«æ–‡ä»¶ç›®å½•çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†æ–‡ä»¶æ‹·è´åœ¨
<code>ubuntu-fs/root</code>æ–‡ä»¶å¤¹ä¸­ï¼Œå¯åŠ¨
<code>./startubuntu.sh</code>åï¼Œå°±èƒ½ç›´æ¥çœ‹åˆ°æ–‡ä»¶ã€‚</p>
<p>æ³¨ï¼šè‹¥è¿›å…¥ç³»ç»Ÿåï¼Œæ— æ³•æ›´æ–°è½¯ä»¶æºï¼Œå¯èƒ½æ˜¯dnså­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥åœ¨termuxä¸­æ›´æ”¹dnsè§£æï¼ˆå› ä¸ºç³»ç»Ÿä¸­ä¸å¥½ç¼–è¾‘ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ubuntu-fs/etc/resolv.conf</span><br><span class="line"></span><br><span class="line">`</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">`</span><br><span class="line"><span class="comment"># è‹¥ä¾æ—§ä¸è¡Œï¼Œå¯å°è¯•å…¶ä»–dnsï¼Œå¦‚1.1.1.1ç­‰</span></span><br></pre></td></tr></table></figure>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pkg install vim tmux -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># frpé¡¹ç›®åœ°å€ï¼Œæ‰‹æœºè¯·æ³¨æ„ä¸‹è½½armç‰ˆæœ¬ï¼Œä¸€èˆ¬ä¸ºarm64ï¼Œä¸èƒ½ç›´æ¥åœ¨Linuxç³»ç»Ÿä¸­é…ç½®ï¼Œå¿…é¡»å¾—åœ¨Termuxä¸­æ“ä½œ</span></span><br><span class="line">[https://github.com/fatedier/frp/releases](https://github.com/fatedier/frp/releases)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰‹æœºæ¸©åº¦ï¼Œéœ€è¦é™¤ä»¥1000</span></span><br><span class="line"><span class="built_in">cat</span> /sys/class/thermal/thermal_zone0/temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰‹æœºç”µæ± å®¹é‡ï¼Œéœ€root</span></span><br><span class="line"><span class="built_in">cat</span> /sys/class/power_supply/battery/capacity</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®termuxçš„å¯åŠ¨æ“ä½œ</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line">`</span><br><span class="line">sshd <span class="comment"># å¼€å¯sshæœåŠ¡ï¼Œä¾¿äºè¿æ¥</span></span><br><span class="line"><span class="comment"># é…ç½®frpç›¸å…³æ“ä½œï¼Œä¾¿äºç›´æ¥è¿œç¨‹è¿æ¥</span></span><br><span class="line"><span class="comment"># é…ç½®è¿›å…¥Linuxç³»ç»Ÿæ“ä½œ</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Android</tag>
        <tag>Termux</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¹å„ç§ç”µå­äº§å“çš„æ‹“å±•ç©æ³•ä¸äº’è”</title>
    <url>/hexo_blog/2019/09/14/IOT/%E5%AF%B9%E5%90%84%E7%A7%8D%E7%94%B5%E5%AD%90%E8%AE%BE%E5%A4%87%E7%9A%84%E6%8B%93%E5%B1%95%E7%8E%A9%E6%B3%95%E4%B8%8E%E4%BA%92%E8%81%94/</url>
    <content><![CDATA[<p>ä»‹ç»æ‰‹ä¸­å„ç§ç”µå­äº§å“åŠå„è‡ªçš„æ‹“å±•ç©æ³•</p>
<span id="more"></span>
<h2
id="å¯¹å„ç§ç”µå­äº§å“çš„æ‹“å±•ç©æ³•ä¸äº’è”">å¯¹å„ç§ç”µå­äº§å“çš„æ‹“å±•ç©æ³•ä¸äº’è”</h2>
<p>æ‰‹ä¸Šæœ‰çš„ç”µå­äº§å“ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†åº”è¯¥æ˜¯æ¯ä¸ªäººéƒ½æœ‰çš„ã€‚</p>
<ul>
<li><p>é­…æ—æ‰‹æœº</p></li>
<li><p>ç¬”è®°æœ¬ç”µè„‘ï¼ˆWin10ï¼‰</p></li>
<li><p>1Tçš„æœºæ¢°ç§»åŠ¨ç¡¬ç›˜</p></li>
<li><p>è‹¥å¹²Uç›˜ã€‚ã€‚</p></li>
<li><p>Kindle Paper White 3</p></li>
<li><p>æ ‘è“æ´¾Zero</p></li>
<li><p>IPad 2018ï¼ˆIOS13å‰ï¼‰</p></li>
</ul>
<h3 id="æ‰‹æœºä¸ipad">æ‰‹æœºä¸IPad</h3>
<p>è¿™ä¸¤ä¸ªæ”¾åœ¨ä¸€èµ·çš„åŸå› æ˜¯ï¼Œåœ¨IOS13ä¹‹å‰ï¼ŒIPadå…¶å®å·®ä¸å¤šå¯ä»¥ç­‰åŒäºå¤§å°ºå¯¸IPoneã€‚æ‰€ä»¥è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå®‰å“æ‰‹æœºï¼ˆæœªROOTï¼‰ä¸IPoneçš„ä»‹ç»ï¼Œè¿™é‡Œçš„ç©æ³•ä¹Ÿç®—æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ã€‚å…³äºAPPçš„å®‰è£…åŒ…åœ¨æ­¤å°±ä¸æä¾›äº†ï¼Œè¯·è¯»è€…è‡ªè¡Œæœç´¢ã€‚å½“ç„¶è¿˜æœ‰ADBè¿™ç§ç©æ³•ï¼Œä¹Ÿä¸åšä»‹ç»ï¼Œå¯å‚è€ƒ
<a href="#">Post not found: IOT/ç”¨ADBè°ƒè¯•å®‰å“æ‰‹æœº.md</a></p>
<h4 id="termuxä¸juicessh">Termuxä¸JuiceSSH</h4>
<p>æ”¾åœ¨æœç´¢å¼•æ“ä¸€æœï¼Œå…¶å®è¿™ä¸¤ä¸ªAPPå°±æœ‰å¾ˆå¤šç›¸å…³ä»‹ç»äº†ã€‚ä½†è¿™é‡Œæˆ‘æƒ³ä»‹ç»ä¸€äº›ä¸ä¸€æ ·çš„ç©æ³•ã€‚å…³äºTermuxæ“ä½œä¸æ–¹ä¾¿è¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨JuiceSSHè¿æ¥localhostæ¥æ“ä½œï¼Œå…·ä½“æ“ä½œä¸ä»‹ç»ã€‚</p>
<p><strong>ä¸‹è½½</strong>ï¼šå¦‚ä½•åœ¨æ‰‹æœºä¸Šå®ç°å¤šçº¿ç¨‹ä¸‹è½½ï¼Ÿä¸‹ä¸€ä¸ªADMï¼Ÿå½“ç„¶è¿™æ ·å¾ˆæ–¹ä¾¿ï¼Œä½†æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨Termuxæ¥å®Œæˆè¿™ä¸€ç‚¹ã€‚Termuxå®‰è£…Axelï¼ˆ<code>pkg install axel</code>ï¼‰ï¼Œä¸‹è½½<code>axel -n 32 url</code>ï¼Œä½¿ç”¨32ä¸ªçº¿ç¨‹ä¸‹è½½é“¾æ¥ã€‚å»ºè®®å…ˆ<code>cd /sdcard/</code>ä¸­ã€‚</p>
<p><strong>æ•°æ®ä¼ è¾“</strong>ï¼šä¸€ä¸ªæ‰‹æœºå’Œä¸€ä¸ªIPadï¼Œå¦‚ä½•åœ¨ä¸å€ŸåŠ©å…¶ä»–ä»‹è´¨çš„å‰æä¸‹å¿«é€Ÿä¼ è¾“ã€‚QQã€å¾®ä¿¡ã€å¿«ç‰™ç­‰ä¼ è¾“æ–‡ä»¶å·¥å…·éƒ½è¡Œï¼Œä½†è¿™é‡Œæˆ‘è‡ªå·±å®æµ‹é€Ÿåº¦éƒ½ä¸å¦‚è¿™é‡Œçš„æ–¹æ³•å¿«ã€‚å°±æ‹¿å¿«ç‰™ä¸¾ä¾‹ï¼Œå®ƒå®é™…æ˜¯ç”¨æ‰‹æœºå¼€æ”¾ä¸€ä¸ª<code>2.4G</code>çš„çƒ­ç‚¹ï¼Œç„¶åç”¨äºŒç»´ç è¿›è¡Œé“¾æ¥ä¼ è¾“ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ€è·¯ï¼Œæ‰‹æœºå¼€æ”¾<code>5G</code>çƒ­ç‚¹ï¼ŒIPadæ‰‹åŠ¨è¿æ¥æ­¤WIFIã€‚æ‰“å¼€Termuxï¼Œå…ˆ<code>ifconfig</code>çŸ¥é“æœ¬åœ°IPï¼Œå½¢å¦‚<code>192.168.x.1</code>è¿™ç§ï¼Œå†<code>cd</code>åˆ°ä¼ è¾“æ–‡ä»¶çš„ç›®å½•ï¼Œåˆ©ç”¨Pythonçš„é™æ€èµ„æºæœåŠ¡å™¨<code>python3 -m http.server</code>ï¼Œè¿™æ ·ï¼Œèµ„æºå°±å¯¹å±€åŸŸç½‘å†…è®¾å¤‡ï¼ˆè¿æ¥åˆ°æ‰‹æœºçƒ­ç‚¹çš„è®¾å¤‡ï¼‰å¼€æ”¾ã€‚æ¥ä¸‹æ¥æ“ä½œIPadï¼Œç”±äºIOS13ä¹‹å‰ï¼Œ<code>Safari</code>ä¸æ”¯æŒè¾“å…¥é“¾æ¥ä¸‹è½½ï¼Œæ‰€ä»¥è¿™é‡Œæ¨è<code>Alook</code>ä¸<code>Documents</code>ï¼ˆåè€…å…è´¹ï¼‰ï¼Œåœ¨<code>Documents</code>ä¸­çš„æµè§ˆå™¨è¾“å…¥åˆšåˆšçš„æ‰‹æœº<code>ip:8000</code>ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°æ‰‹æœºèµ„æºæ‰€åœ¨æ–‡ä»¶ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç‚¹å‡»å³å¯ä¸‹è½½ã€‚å®æµ‹å•ä¸ªæ–‡ä»¶é€Ÿåº¦å¤§æ¦‚æ¯”<code>2.4G</code>å¿«3å€ï¼ˆæ— éœ€æµé‡ï¼‰ã€‚å½“ç„¶è¿™é‡Œæ‰‹æœºå’ŒIPadä¹Ÿå¯ä»¥åŒæ—¶è¿æ¥åŒä¸€ä¸ªWIFIï¼Œç„¶åä½¿ç”¨åŒä¸Šæ–¹æ³•è¿›è¡Œä¼ è¾“ï¼ˆé€Ÿåº¦å–å†³äºè·¯ç”±å™¨å’Œç½‘ç»œå¸¦å®½ï¼‰ã€‚</p>
<p><strong>è¿œç¨‹æ‰‹æœº</strong>ï¼šå¦‚ä½•åœ¨æ‰‹æœºä¸è¿æ¥WIFIï¼Œä¸è¿æ¥æ•°æ®çº¿çš„å‰æä¸‹ï¼Œç”¨å…¶ä»–è®¾å¤‡è®¿é—®æ‰‹æœºï¼ˆæ‰‹æœºä¸å…¶ä»–è®¾å¤‡çš„å®é™…è·ç¦»ä¹Ÿå¯ä»¥å¾ˆè¿œï¼‰ï¼Œå‰ææ‰‹æœºèƒ½ä¸Šç½‘ã€‚è¿™ä¸€æ–¹æ³•ä¸ªäººæš‚æ²¡æœ‰ç‰¹åˆ«ç”¨é€”ï¼Œä½†<code>Just for fun</code>ã€‚é¦–å…ˆï¼Œéœ€è¦ä¸€ä¸ªå…¬ç½‘IPæœåŠ¡å™¨ï¼›æ¥ä¸‹æ¥éœ€è¦ä¼šç©sshï¼Œ<code>Termux</code>ä¸æœåŠ¡å™¨é…ç½®å¥½sshï¼Œ<code>Termux</code>èƒ½å¤Ÿsshåˆ°æœåŠ¡å™¨ä¸Šå³å¯ã€‚æœ€åä¸€æ­¥ï¼Œå‚è€ƒ
<a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a>ã€‚</p>
<h4 id="spacedesk">spacedesk</h4>
<p>ç”µè„‘æŠ•å±ï¼Œä½¿ç”¨USBæ•°æ®çº¿è¿æ¥è®¾å¤‡å’Œç”µè„‘ï¼Œç”¨è¿™ä¸ªè½¯ä»¶è¿›è¡ŒæŠ•å±ã€‚æˆ‘è§‰å¾—æŒºé¸¡è‚‹çš„ã€‚ã€‚ã€‚å®‰å“æ‰‹æœºå±å¹•åˆå¤ªå°ï¼Œæµ‹è¯•IPadçš„æ—¶å€™å‘ç°é—ªé€€ã€‚</p>
<h4
id="androidhttpcaptureå’Œhttpcanary">AndroidHttpCaptureå’ŒHttpCanary</h4>
<p>å®‰å“æŠ“åŒ…å·¥å…·ï¼Œåè€…çš„åŠŸèƒ½æ¯”å‰è€…æ›´å¼ºå¤§ä¸€äº›ã€‚æœ‰æ—¶å€™èº«è¾¹æ²¡æœ‰ç”µè„‘ï¼Œéœ€è¦æ‰‹æœºæŠ“åŒ…çœ‹æ•°æ®ï¼Œæ‰€ä»¥å°±åªèƒ½ç›´æ¥ç”¨æ‰‹æœºçœ‹æ•°æ®åŒ…äº†ã€‚å‰è€…åŸºæœ¬æ»¡è¶³äº†å¤§éƒ¨åˆ†åœºæ™¯çš„æŠ“åŒ…æ•°æ®ã€‚ä½†å½“æŸäº›æ—¶å€™ï¼ˆæ¯”å¦‚æŸäº›APPçš„æ•°æ®äº¤äº’ä¸æ˜¯ä½¿ç”¨HTTPç­‰å¸¸ç”¨åè®®ï¼Œå¯èƒ½å°±æ²¡åŠæ³•æŠ“åŒ…ï¼Œæ­¤æ—¶ç”µè„‘ä¸Šæ²¡åŠæ³•ç›´æ¥æŠ“åŒ…ï¼‰ï¼Œæ‰€ä»¥å°±éœ€è¦ä½¿ç”¨<code>HttpCanary</code>ï¼ˆéœ€è¦ROOTï¼‰æ¥å¯¹ç½‘ç»œè¿›è¡Œä»£ç†ï¼Œåœ¨è§£ææ•°æ®ã€‚æµ‹è¯•å¦‚æœç”µè„‘ä¸Šä½¿ç”¨<code>WireShark</code>ï¼Œç¡®å®æ˜¯å¯ä»¥æŠ“åˆ°åŒ…çš„ï¼Œä½†æ˜¯ä¼šä¹±ç ã€‚æ‰€ä»¥å¯èƒ½ä½¿ç”¨<code>HttpCanary</code>è¿˜æ›´ä¸ºæ–¹ä¾¿ä¸€äº›ã€‚</p>
<h4 id="netxä¸net-analyzer">NetXä¸Net Analyzer</h4>
<p>å®‰å“å±€åŸŸç½‘è®¾å¤‡åˆ†æå·¥å…·ï¼Œç”¨çš„ä¸å¤šï¼Œå…·ä½“ä¸ä»‹ç»ï¼Œæœ‰å…´è¶£è‡ªè¡Œä¸‹è½½ã€</p>
<h4 id="iosåŒç±»è½¯ä»¶å…è´¹">IOSåŒç±»è½¯ä»¶ï¼Œå…è´¹</h4>
<ul>
<li><p><code>iTerminal</code>ï¼ŒåŒ<code>JuiceSSH</code></p></li>
<li><p><code>Stream</code>ï¼ŒåŒ<code>AndroidHttpCapture</code></p></li>
<li><p><code>Fing</code>ï¼ŒåŒ<code>NetX</code></p></li>
</ul>
<h4 id="scrcpy">scrcpy</h4>
<p>åœ¨ç”µè„‘ä¸Šä½¿ç”¨ï¼Œå®‰å“æŠ•å±å·¥å…·ï¼Œ<a
href="https://github.com/Genymobile/scrcpy">scrcpy</a>ï¼Œç”±äºé­…æ—æ‰‹æœºä¸€äº›ç‹¬ç‰¹çš„æ“ä½œï¼Œæ‰€ä»¥éœ€è¦æ›¿æ¢jaræ–‡ä»¶ï¼Œ<a
href="https://github.com/taie02/taie02.github.io/tree/master/2019/03/03/scrcpy_usage">æ­¤é¡¹ç›®</a>ã€‚</p>
<h4 id="otg">OTG</h4>
<p>å…³äºOTGè¿™ä¸€é¡¹ï¼Œå…¶å®æ˜¯å±äºå¤–æ¥è®¾å¤‡è¿™ä¸€é¡¹ï¼Œé€šè¿‡å……ç”µæ¥å£è½¬USBæ¥å£å¯ä»¥æ¥å¤§éƒ¨åˆ†usbè®¾å¤‡ï¼Œæ¯”å¦‚uç›˜è¿™ç§ã€‚ç”šè‡³è¿˜å¯ä»¥åå‘å……ç”µï¼Œæ¥é¼ æ ‡é”®ç›˜ç­‰ã€‚</p>
<h3 id="uç›˜ä¸ç§»åŠ¨ç¡¬ç›˜">Uç›˜ä¸ç§»åŠ¨ç¡¬ç›˜</h3>
<p>äºŒè€…éƒ½å±äºç§»åŠ¨å­˜å‚¨ä»‹è´¨ï¼Œå…¶å®ä¹Ÿæ²¡ä»€ä¹ˆå¥½ä»‹ç»çš„ã€‚ã€‚ã€‚å¯ä»¥æå‡ ç‚¹ï¼ŒWindows
To
Goï¼ˆWTGï¼‰å¯ä»¥æï¼ˆé«˜æ€§èƒ½çš„ç§»åŠ¨ç›˜ï¼‰ï¼Œè‡ªå·±æ²¡å°è¯•è¿‡ã€‚åœ¨ç§»åŠ¨ç¡¬ç›˜ä¸Šè£…äº†ä¸¤ä¸ªLinuxç³»ç»Ÿã€‚</p>
<p>å…³äºå¦‚ä½•è£…ç³»ç»Ÿå°±ä¸ä»‹ç»äº†ï¼Œè¿™é‡Œåªæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯å¤‡ä»½å¥½æ•°æ®å†åˆ†åŒºï¼Œåœ¨è£…ç³»ç»Ÿçš„æ—¶å€™å¼•å¯¼è£…è½½ç§»åŠ¨ç¡¬ç›˜ä¸Šï¼Œè¦ä¸ç„¶ç§»åŠ¨ç¡¬ç›˜ä¸Šåªèƒ½åœ¨è£…ç³»ç»Ÿçš„è®¾å¤‡ä¸Šå¯åŠ¨ã€‚</p>
<h3 id="kindle">Kindle</h3>
<p>è¿™é‡Œä¸ä»‹ç»è¶Šç‹±ä¹‹ç±»çš„æ“ä½œï¼Œåªæœ‰å¸¸è§„æ“ä½œã€‚ã€‚ã€‚</p>
<ul>
<li><p><a
href="https://bookfere.com/post/19.html">æ­å»ºä¸ªäººæ¨é€ç½‘ç«™</a></p></li>
<li><p><a href="https://volmoe.com/">æ¼«ç”»</a></p></li>
<li><p>Chromeæ’ä»¶ï¼šPush to Kindle</p></li>
</ul>
<h3 id="æ ‘è“æ´¾">æ ‘è“æ´¾</h3>
<p>åƒç°æ´¾ã€‚ã€‚ã€‚å¤§æ¦‚ä¹Ÿå°±èƒ½è·‘è·‘å°demoï¼Œçˆ¬æ•°æ®ï¼Œåˆ©ç”¨ç©ºé—²ç½‘ç»œå¸¦å®½ä¸‹ä¸œè¥¿ã€‚åŒæ ·ä¹Ÿå¯ä»¥åˆ©ç”¨sshï¼Œè¿›è¡Œç«¯å£è½¬å‘ï¼Œè¿œç¨‹è¿æ¥ã€‚</p>
<p>åç»­å†æ›´ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>Raspberry</tag>
        <tag>Linux</tag>
        <tag>Android</tag>
        <tag>Windows</tag>
        <tag>IOS</tag>
        <tag>Kindle</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ADBè°ƒè¯•å®‰å“æ‰‹æœº</title>
    <url>/hexo_blog/2018/01/25/IOT/%E7%94%A8ADB%E8%B0%83%E8%AF%95%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA/</url>
    <content><![CDATA[<p>ä½¿ç”¨adbå·¥å…·å®ç°å¯¹å®‰å“æ‰‹æœºçš„è°ƒè¯•ï¼ŒåŒ…æ‹¬å®‰è£…åº”ç”¨ã€æŸ¥çœ‹è¿è¡ŒAppã€å½•å±ã€æˆªå›¾ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†adbå·¥å…·çš„å®‰è£…ã€é…ç½®å’Œä½¿ç”¨æ–¹æ³•ï¼Œå¹¶åˆ—å‡ºäº†ä¸€äº›å®ç”¨çš„å‘½ä»¤ï¼ŒåŒæ—¶è¿˜ä»‹ç»äº†æ— çº¿ç½‘è°ƒè¯•è®¾å¤‡çš„æ–¹æ³•ã€‚</p>
<span id="more"></span>
<p>å†™åœ¨å¼€å¤´ï¼Œä¸€äº›æ¨èé˜…è¯»çš„åšå®¢æ–‡ç« </p>
<p><a
href="http://blog.csdn.net/fasfaf454/article/details/51438743?locationNum=14">é€šè¿‡adbè·å–æ‰‹æœºä¿¡æ¯</a></p>
<p><a href="https://www.jianshu.com/p/5980c8c282ef">Android
adbä½ çœŸçš„ä¼šç”¨å—?</a></p>
<p><a
href="http://blog.csdn.net/qq_15364915/article/details/52369266">ADBè°ƒè¯•å‘½ä»¤å¤§å…¨</a></p>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>adbæ˜¯å®‰å“å¼€å‘è°ƒè¯•å·¥å…·ï¼Œæ¥è§¦åˆ°è¿™ä¸ªè¿˜æ˜¯å› ä¸ºå¾®ä¿¡è·³ä¸€è·³çš„å¤–æŒ‚åŸå› ã€‚çœ‹æ–‡æ¡£è¯´æ˜ä¹‹åå¾—çŸ¥éœ€è¦adbå·¥å…·ï¼Œè¿›è¡Œç®€å•å°è¯•åï¼Œå‘ç°è¿™ç©æ„è¿˜çœŸçš„æ˜¯æŒºå¥½ç”¨çš„ã€‚å¡«è¡¥äº†è‡ªå·±ç”¨ä»£ç æ§åˆ¶å®‰å“æ‰‹æœºçš„ç©ºç¼ºï¼ˆä¹‹å‰ä¹Ÿç©è¿‡æŒ‰é”®ç²¾çµï¼Œä½†æ˜¯éœ€è¦Rootæƒé™ï¼‰ã€‚</p>
<p><a
href="https://developer.android.com/studio/command-line/adb.html?hl=zh-cn"><strong>adbå®˜æ–¹è¯´æ˜</strong></a>ï¼š</p>
<p>Android è°ƒè¯•æ¡¥ (adb)
æ˜¯ä¸€ä¸ªé€šç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶å…è®¸æ‚¨ä¸æ¨¡æ‹Ÿå™¨å®ä¾‹æˆ–è¿æ¥çš„ Android
è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚å®ƒå¯ä¸ºå„ç§è®¾å¤‡æ“ä½œæä¾›ä¾¿åˆ©ï¼Œå¦‚å®‰è£…å’Œè°ƒè¯•åº”ç”¨ï¼Œå¹¶æä¾›å¯¹
Unix
shellï¼ˆå¯ç”¨æ¥åœ¨æ¨¡æ‹Ÿå™¨æˆ–è¿æ¥çš„è®¾å¤‡ä¸Šè¿è¡Œå„ç§å‘½ä»¤ï¼‰çš„è®¿é—®ã€‚è¯¥å·¥å…·ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨ç¨‹åºï¼ŒåŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼š</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>å¯å‚è€ƒæ–‡ç« : <a
href="https://www.xda-developers.com/install-adb-windows-macos-linux/">How
to Install ADB on Windows, macOS, and Linux</a></p>
<h4 id="windows">Windows</h4>
<p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯win10ã€‚å¦‚æœä»¥ä¸‹æ“ä½œä¸èƒ½æˆåŠŸé…ç½®ï¼Œå¯ä»¥ç™¾åº¦å…¶ä»–çš„å®‰è£…æ•™ç¨‹</p>
<ol type="1">
<li><p>ä¸‹è½½ã€‚<a
href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip">ä¸‹è½½é“¾æ¥</a></p></li>
<li><p>ç§»åŠ¨ç›®å½•</p>
<ol type="1">
<li>è§£å‹å‹ç¼©åŒ…</li>
<li>ç§»åŠ¨æ–‡ä»¶å¤¹ä½ æƒ³è®©å®ƒæ”¾ç½®çš„ä½ç½®</li>
</ol></li>
<li><p>ç¯å¢ƒé…ç½®</p>
<ol type="1">
<li>æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å¯ä»¥åœ¨cmdæˆ–è€…powershellä¸­ç›´æ¥ä½¿ç”¨adb</li>
<li>å³é”®"è®¡ç®—æœº"-&gt;"å±æ€§"-&gt;å·¦è¾¹çš„"é«˜çº§ç³»ç»Ÿè®¾ç½®"-&gt;"ç¯å¢ƒå˜é‡"&gt;-åœ¨ä¸Šé¢ç”¨æˆ·å˜é‡ä¸­çš„"Path"è¿›è¡Œç¼–è¾‘-&gt;"æ·»åŠ "åˆšåˆšæ”¾ç½®çš„æ–‡ä»¶å¤¹ç›®å½•ï¼Œç¡®è®¤ä¿å­˜å³å¯
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/adb/20180125135305187.png" /></li>
<li>è¿™æ ·å†æ‰“å¼€cmdæˆ–è€…powershellï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨adbå‘½ä»¤äº†</li>
</ol></li>
</ol>
<h4 id="linux">Linux</h4>
<p>Linuxç³»ç»Ÿå®‰è£…adbå·¥å…·è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Ubuntu17.10</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">&gt; <span class="built_in">sudo</span> apt updagte</span><br><span class="line">&gt; <span class="built_in">sudo</span> apt upgrade</span><br><span class="line">&gt; <span class="built_in">sudo</span> apt install android-tools-adb</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®">é…ç½®</h3>
<p>æ‰‹æœºéœ€è¦æ‰“å¼€USBè°ƒè¯•æ¨¡å¼ï¼Œåœ¨å®éªŒçš„æ—¶å€™ï¼Œå¸‚é¢ä¸Šæµè¡Œçš„å¤§éƒ¨åˆ†å®‰å“æ‰‹æœºUSBè°ƒå¼æ¨¡å¼å¼€å…³é»˜è®¤å…³é—­ã€‚å½“ç„¶å¦‚æœæ‰‹æœºé»˜è®¤å¼€å¯äº†USBè°ƒè¯•å¼€å…³ï¼Œè‡ªç„¶å¯ä»¥çœå»ä¸‹é¢ä¸€æ­¥ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ‰‹åŠ¨æ‰“å¼€USBè°ƒè¯•æ¨¡å¼å¼€å…³ï¼Œæ‰‹æœºâ€œè®¾ç½®â€â€”&gt;"å…³äºæ‰‹æœº"â€”&gt;ç‚¹å‡»"ç‰ˆæœ¬å·"7æ¬¡ã€‚æ¯ä¸ªæ‰‹æœºå¼€å¯çš„æ–¹å¼å¤§åŒå°å¼‚ï¼Œå¦‚æœæœ‰ä¸åŒï¼Œå¯ä»¥ç™¾åº¦â€œxxæ‰‹æœºå¦‚ä½•å¼€å¯USBè°ƒè¯•â€ã€‚</p>
<p>åœ¨USBè°ƒè¯•å¼€å…³å¼€å¯ä¹‹åï¼Œè¿›å…¥USBè°ƒè¯•ï¼Œæ‰“å¼€USBè°ƒè¯•å¼€å…³ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/adb/20180125135319543.png" width="300px" /></p>
<p>ä¹‹åä½¿ç”¨USBæ•°æ®çº¿è¿æ¥åˆ°ç”µè„‘ã€‚</p>
<p>è¿æ¥æˆåŠŸåï¼Œæ‰‹æœºéœ€è¦ä¿¡ä»»ç”µè„‘ã€‚ç”µè„‘æ‰“å¼€cmd/powershellï¼ˆWindowsï¼‰æˆ–è€…ç»ˆç«¯ï¼ˆLinuxï¼‰ï¼Œè¾“å…¥
<code>adb devices</code>ã€‚æŸ¥çœ‹è¾“å‡ºã€‚</p>
<p>å¦‚æœæœ‰è¾“å‡ºè®¾å¤‡åä¸”æ— è­¦å‘Šï¼Œåˆ™è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œå¦åˆ™éœ€è¦è¿›è¡Œä¸‹é¢ä¸€æ­¥çš„é…ç½®ã€‚</p>
<p><strong>Windows</strong></p>
<p>é¦–å…ˆéœ€è¦è¿æ¥æ‰‹æœºï¼Œç¡®ä¿æ‰‹æœºèƒ½è¿æ¥åˆ°ç”µè„‘ä¸”æ‰“å¼€äº†USBè°ƒè¯•ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œå³é”®"è®¡ç®—æœº"-&gt;"å±æ€§"-&gt;å·¦è¾¹çš„"è®¾å¤‡ç®¡ç†å™¨"-&gt;"ä¾¿æºè®¾å¤‡"-&gt;"è¯¦ç»†ä¿¡æ¯"-&gt;"å±æ€§"ä¸‹æ‹‰é€‰æ‹©"ç¡¬ä»¶Id"ï¼ŒæŸ¥çœ‹"å€¼"ä¸­çš„å†…å®¹ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œè¿›å…¥Cç›˜ç”¨æˆ·ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶å¤¹".android"ï¼Œç¼–è¾‘æˆ–è€…æ–°å»ºæ–‡ä»¶"adb_usb.ini"ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œåœ¨é‡Œé¢å†™ä¸Šå†…å®¹ã€‚æˆ‘è¿™é‡Œéœ€è¦å†™çš„æ˜¯"0x2A45"ï¼Œ0xæ˜¯å‰ç¼€ä¸éœ€è¦æ›´æ”¹ï¼Œåé¢çš„å­—ç¬¦ä¸²å¯¹åº”çš„æ›´æ”¹"ç¡¬ä»¶Id"é‡Œé¢"å€¼"çš„VIDåé¢çš„å››ä¸ªå­—ç¬¦ã€‚ä¿å­˜é€€å‡ºå³å¯</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/adb/20180125135348748.png" /></p>
<p>ç¬¬å››æ­¥ï¼Œæ–­å¼€USBè¿æ¥ï¼Œé‡æ–°è¿æ¥ï¼Œå†è¾“å…¥
<code>adb devices</code>ã€‚æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥ä¼šå‡ºç°è®¾å¤‡çš„æˆåŠŸè¿æ¥çš„ä¿¡æ¯</p>
<p><strong>Linux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿æ¥æ‰‹æœºï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼Œæ‰¾åˆ°å…³äºè¿æ¥æ‰‹æœºçš„é‚£ä¸€è¡Œ</span></span><br><span class="line">&gt; lsusb</span><br><span class="line"><span class="comment"># è¾“å‡ºå½¢å¦‚ä¸‹é¢ï¼Œæœ€åçš„&quot;Google Inc&quot;è¡¨ç¤ºçš„æ˜¯è®¾å¤‡åï¼Œè¿™é‡Œéœ€è¦æ‰¾åˆ°åŒ¹é…è‡ªå·±æ‰‹æœºçš„è®¾å¤‡ï¼Œå¹¶è®°å½•å¥½ID</span></span><br><span class="line">...</span><br><span class="line">Bus 001 Device 017: ID 18d1:d002 Google Inc.</span><br><span class="line">...</span><br><span class="line"><span class="comment"># åœ¨ç›®å½•/etc/udev/rules.d/ä¸‹ï¼Œæ·»åŠ æ–‡ä»¶70-android.rules(åå­—è²Œä¼¼æ— æ‰€è°“ï¼Ÿï¼Ÿï¼Ÿ)</span></span><br><span class="line">&gt; <span class="built_in">sudo</span> vim /etc/udev/rules.d/70-android.rules</span><br><span class="line"><span class="comment"># å†™å…¥ä¸‹é¢å†…å®¹ï¼ŒidVendorè¡¨ç¤ºIDå†’å·å‰çš„æ•°å­—ï¼ŒidProductè¡¨ç¤ºçš„æ˜¯IDå†’å·åçš„æ•°å­—ï¼ŒMODEå›ºå®šä¸º&quot;0666&quot;ï¼Œå…¶ä»–ä¸å˜</span></span><br><span class="line">SUBSYSTEM==<span class="string">&quot;usb&quot;</span>, ATTRS&#123;idVendor&#125;==<span class="string">&quot;18d1&quot;</span>, ATTRS&#123;idProduct&#125;==<span class="string">&quot;d002&quot;</span>,MODE=<span class="string">&quot;0666&quot;</span></span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡ºï¼Œä¿®æ”¹æƒé™</span></span><br><span class="line">&gt; <span class="built_in">sudo</span> <span class="built_in">chmod</span> 644   /etc/udev/rules.d/70-android.rules</span><br><span class="line">&gt; <span class="built_in">sudo</span> <span class="built_in">chown</span> root. /etc/udev/rules.d/70-android.rules</span><br><span class="line"><span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">&gt; <span class="built_in">sudo</span> service udev restart</span><br><span class="line">&gt; <span class="built_in">sudo</span> killall adb</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å…¥adb devicesæŸ¥çœ‹è¾“å‡ºï¼Œæ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">&gt; adb devices</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<p>è¯¦ç»†å¯å‚è€ƒè¿™ç¯‡åšå®¢: <a
href="http://blog.csdn.net/qq_15364915/article/details/52369266">ADBè°ƒè¯•å‘½ä»¤å¤§å…¨</a></p>
<p>åœ¨è¿™é‡Œè´´å‡ºä¸€äº›æˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰æ„æ€ä¸”å®ç”¨çš„åŠŸèƒ½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰è¿æ¥è®¾å¤‡</span></span><br><span class="line">&gt; adb devices</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œæˆªå›¾ä¿å­˜åœ¨sdå¡çš„æ ¹ç›®å½•ä¸‹ï¼Œåå­—ä¸ºscreen.png</span></span><br><span class="line">&gt; adb shell screencap -p /sdcard/screen.png</span><br><span class="line"><span class="comment"># å°†æˆªå›¾å‘é€åˆ°æœ¬åœ°ï¼ˆå½“å‰ç›®å½•ä¸‹ï¼‰ï¼Œä¹Ÿå¯ä»¥å‘é€å…¶ä»–æ–‡ä»¶</span></span><br><span class="line">&gt; adb pull /sdcard/screen.png</span><br><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">&gt; adb shell <span class="built_in">rm</span> /sdcard/screen.png</span><br><span class="line"><span class="comment"># å‘é€ç”µè„‘é‡Œçš„æ–‡ä»¶åˆ°è®¾å¤‡</span></span><br><span class="line">&gt; adb shell push screen.png /sdcard/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æ‰‹æœºçš„äº¤äº’ç¯å¢ƒï¼Œæ“ä½œç±»ä¼¼linuxç»ˆç«¯ï¼Œexitæˆ–è€…Ctrl+Cé€€å‡º</span></span><br><span class="line">&gt; adb shell</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‚¹å‡»æ‰‹æœºå±å¹•(1000,1000)çš„ä½ç½®</span></span><br><span class="line">&gt; adb shell input tap 1000 1000</span><br><span class="line"><span class="comment"># è¾“å…¥å­—ç¬¦ä¸²&quot;helloworld&quot;ï¼Œæ­¤å¤„ä¸èƒ½ç›´æ¥è¾“å…¥ä¸­æ–‡ï¼Œä¸”å­—ç¬¦ä¸²ä¸èƒ½æœ‰ç©ºæ ¼</span></span><br><span class="line">&gt; adb shell input text helloworld</span><br><span class="line"><span class="comment"># æ»‘åŠ¨å±å¹•ï¼Œä»ï¼ˆ100, 100)åˆ°ï¼ˆ1000,1000)ï¼Œç»å†10s(ä¹Ÿå¯ä»¥å½“ä½œé•¿æŒ‰å±å¹•æ¥ä½¿ç”¨)</span></span><br><span class="line">&gt; adb shell input swipe 100 100 1000 1000 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¿è¡Œçš„App, è¿™é‡ŒWindowsæ²¡æœ‰grepæ‰€ä»¥ä¼šè¿è¡Œå¤±è´¥ï¼Œå¯ä»¥è¿›å…¥å…ˆè¿›å…¥äº¤äº’ç¯å¢ƒå†è¾“å…¥ä¸‹é¢å»æ‰&quot;adb shell&quot;å‘½ä»¤</span></span><br><span class="line">&gt; adb shell dumpsys window | grep mCurrentFocus</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">&gt; adb shell dumpsys activity activities | grep mFocusedActivity</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ä¸‹ç”µæºé”®</span></span><br><span class="line">&gt; adb shell input keyevent 26</span><br><span class="line"><span class="comment"># æŒ‰ä¸‹è¿”å›é”®</span></span><br><span class="line">&gt; adb shell input keyevent 4</span><br><span class="line"><span class="comment"># æŒ‰ä¸‹HOMEå¥</span></span><br><span class="line">&gt; adb shell input keyevent 3</span><br><span class="line"><span class="comment"># ç‚¹äº®å±å¹•</span></span><br><span class="line">&gt; adb shell input keyevent 224</span><br><span class="line"><span class="comment"># ç†„ç­å±å¹•</span></span><br><span class="line">&gt; adb shell input keyevent 223</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰‹æœºå®‰è£…äº†å“ªäº›Appï¼Œè¾“å‡ºæŒ‰è¡Œè¾“å‡ºAppçš„åŒ…å</span></span><br><span class="line">&gt; adb shell pm list packages</span><br><span class="line"><span class="comment"># åŠ &quot;-s&quot;è¡¨ç¤ºåªè¾“å‡ºç³»ç»Ÿåº”ç”¨</span></span><br><span class="line"><span class="comment"># åŠ &quot;-3&quot;è¡¨ç¤ºåªè¾“å‡ºç¬¬ä¸‰æ–¹åº”ç”¨</span></span><br><span class="line"><span class="comment"># åŠ å­—ç¬¦ä¸²è¡¨ç¤ºè¿‡æ»¤åº”ç”¨åç§°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨grep</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…apk</span></span><br><span class="line">&gt; adb install &lt;packagename&gt;</span><br><span class="line"><span class="comment"># å¸è½½apk</span></span><br><span class="line">&gt; adb uninstall &lt;packagename&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ¡Œé¢å¯åŠ¨app</span></span><br><span class="line">&gt; adb shell monkey -p &lt;packagename&gt; -c android.intent.category.LAUNCHER 1</span><br><span class="line"><span class="comment"># å…³é—­app</span></span><br><span class="line">&gt; adb shell am force-stop &lt;packagename&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ— çº¿ç½‘è°ƒè¯•è®¾å¤‡">ä½¿ç”¨æ— çº¿ç½‘è°ƒè¯•è®¾å¤‡</h3>
<p>ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘å†…</p>
<p>å¦‚ä½•æŸ¥çœ‹æ‰‹æœºçš„ipï¼Œç”±äºæ¯ä¸ªè®¾å¤‡çš„æ–¹æ³•ä¸å¤§ç›¸åŒï¼Œåœ¨æ­¤ä¸è¿›è¡Œè¯´æ˜ï¼Œè¯·è¯»è€…è‡ªè¡Œç™¾åº¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨USBè¿æ¥è®¾å¤‡ï¼Œå¯åŠ¨æ‰‹æœº5555ç«¯å£</span></span><br><span class="line">&gt; adb tcpip 5555</span><br><span class="line"><span class="comment"># adbè¿æ¥å‘½ä»¤ï¼Œéœ€è¦çŸ¥é“æ‰‹æœºçš„ip</span></span><br><span class="line">&gt; adb connect 192.168.1.111</span><br><span class="line"><span class="comment"># è¾“å…¥å¦‚ä¸‹åˆ™è¡¨ç¤ºè¿æ¥æˆåŠŸ</span></span><br><span class="line">connected to 192.168.1.111:5555</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ¥ä¸‹æ¥çš„æ­¥éª¤æœªæ–­æ‰æ•°æ®çº¿ï¼Œåˆ™ç”µè„‘æ˜¯è¿æ¥äº†ä¸¤å°è®¾å¤‡çš„ï¼Œè¿›è¡Œæ“ä½œä¼šäº§ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥å¯ä»¥æ‹”æ‰æ•°æ®çº¿æˆ–è€…æ–­å¼€ç½‘ç»œæˆ–è€…æŒ‡å®šè®¾å¤‡è¿è¡Œ</span></span><br><span class="line"><span class="comment"># æ–­å¼€æ— çº¿ç½‘è¿æ¥</span></span><br><span class="line">&gt; adb disconnect 192.168.1.111</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ADB</tag>
      </tags>
  </entry>
  <entry>
    <title>Matplotlibç¬”è®°</title>
    <url>/hexo_blog/2017/08/26/PythonPackages/Matplotlib%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>è§£å†³Pythonä¸­æ–‡ä¹±ç é—®é¢˜çš„å®Œæ•´æ–¹æ¡ˆåŠMatplotlibç»˜å›¾åŸºç¡€æ“ä½œ</p>
<span id="more"></span>
<h1 id="ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ">ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ</h1>
<p>æ”¯æŒæ‰€æœ‰å¹³å°çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 id="å®šä½é»˜è®¤å­—ä½“ä½ç½®">å®šä½é»˜è®¤å­—ä½“ä½ç½®</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆè¿›å…¥pythonçš„äº¤äº’ç¯å¢ƒ</span></span><br><span class="line">&gt;&gt;&gt;python</span><br><span class="line"></span><br><span class="line">&gt;from matplotlib.font_manager import findfont, FontProperties</span><br><span class="line"><span class="comment"># å½“å‰ä½¿ç”¨çš„é»˜è®¤å­—ä½“</span></span><br><span class="line">&gt;findfont(FontProperties(family=FontProperties().get_family()))</span><br><span class="line"><span class="comment"># åœ¨æ­¤è®°ä½è¿”å›å€¼</span></span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½æ”¯æŒä¸­æ–‡çš„å­—ä½“">ä¸‹è½½æ”¯æŒä¸­æ–‡çš„å­—ä½“</h2>
<p>åœ¨è¿™é‡Œæ¨èå¾®è½¯é›…é»‘ï¼Œmsyh.ttfã€‚</p>
<p><a
href="http://www.monmonkey.com/sonota/font1/getfont.html">æ¨èé“¾æ¥</a></p>
<h2 id="å·æ¢æ¢æŸ±">å·æ¢æ¢æŸ±</h2>
<p>åœ¨åˆšåˆšæŸ¥è¯¢çš„é‚£ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå°†åŸæ¥çš„é»˜è®¤å­—ä½“é‡å‘½åï¼Œä¹‹åå°†æˆ‘ä»¬ä¸‹è½½msyh.ttfæ›¿æ¢è¿›å»ï¼Œå¹¶é‡å‘½åä¸ºé‚£ä¸ªé»˜è®¤å­—ä½“ä¹‹å‰çš„åå­—</p>
<h2 id="å¤§åŠŸå‘Šæˆ">å¤§åŠŸå‘Šæˆ</h2>
<p>å½“ç„¶ä¸ºäº†ä¿é™©èµ·è§ï¼Œè¿˜å¯ä»¥æ“ä½œä¸‹é¢ä¸€æ­¥ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå¯ä»¥æµ‹è¯•çœ‹çœ‹æ˜¯å¦æˆåŠŸè¾“å‡ºä¸­æ–‡ã€‚</p>
<p>æ‰¾åˆ°matplotlibçš„å®‰è£…ç›®å½•ï¼Œä¸€èˆ¬æ˜¯åœ¨pythonçš„å®‰è£…ç›®å½•ä¸‹çš„-packages-data,ä¹‹åä¿®æ”¹matplotlibrcæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†ä¸‹é¢è¿™ä¸¤è¡Œå†’å·åé¢çš„å­—ç¬¦æ›¿æ¢</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">#font.sans-serif     : nothing</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">#verbose.level  : debug</span></span><br></pre></td></tr></table></figure>
<h1 id="matplotlib.pyplot-åŸºç¡€æ“ä½œ">matplotlib.pyplot åŸºç¡€æ“ä½œ</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x_list = []</span><br><span class="line">y_list = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šç”»å¸ƒ</span></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">6</span>), dpi=<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»y_listçš„æŠ˜çº¿å›¾ï¼Œæ ¼å¼ä¸º&#x27;ro-&#x27;ï¼Œé¢œè‰²ä¸ºblue</span></span><br><span class="line">plt.plot(y_list, <span class="string">&#x27;ro-&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥x_listä¸ºxè½´ï¼Œy_listä¸ºyè½´ç”»æŠ˜çº¿å›¾ï¼Œå‰æx_listå†…å®¹å…¨ä¸ºæ•´å‹æ•°å­—</span></span><br><span class="line">plt.plot(x_list, y_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥x_listä¸ºxè½´ï¼Œy_listä¸ºyè½´ï¼Œx_listä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">x = <span class="built_in">range</span>(<span class="built_in">len</span>(x_list))</span><br><span class="line">plt.plot(x, y_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šæ¨ªåæ ‡, è·Ÿç€ä¸Šé¢çš„å­—ç¬¦ä¸²x_listçš„è®¾å®šï¼Œæ¯ä¸ªå­—ç¬¦ä¸²æ—‹è½¬è§’åº¦ä¸º45ï¼Œå­—ä½“å¤§å°ä¸º20</span></span><br><span class="line">plt.xticks(x, x_list, rotation=<span class="number">45</span>, fontsize=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šæ ‡é¢˜ï¼Œæ³¨å¦‚æœéœ€è¦è®¾å®šä¸­æ–‡éœ€è¦æ›´æ”¹matplotlibçš„å­—ä½“é…ç½®</span></span><br><span class="line">plt.title(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜å›¾ç‰‡åä¸ºplt</span></span><br><span class="line">plt.savefig(<span class="string">&quot;plt.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®Œæ‰“å¼€å›¾ç‰‡</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨ï¼šå¦‚æœéœ€è¦ä¿å­˜å›¾ç‰‡ï¼Œåˆ‡è®°éœ€è¦åœ¨æ‰“å¼€å›¾ç‰‡å‰æ‰§è¡Œå‘½ä»¤ï¼Œå¦åˆ™ä¿å­˜å›¾ç‰‡ä¸ºç©ºç™½</span></span><br></pre></td></tr></table></figure>
<h1 id="æ¬è¿å·¥ç³»åˆ—">æ¬è¿å·¥ç³»åˆ—</h1>
<p><a
href="https://juejin.im/post/5a9e14726fb9a028b86d87c9">5ç§å¿«é€Ÿæ˜“ç”¨çš„Python
Matplotlibæ•°æ®å¯è§†åŒ–æ–¹æ³•</a></p>
<p><a
href="http://www.labri.fr/perso/nrougier/teaching/matplotlib/">Matplotlib
æ•™ç¨‹</a></p>
<p><a
href="https://liam0205.me/2014/09/11/matplotlib-tutorial-zh-cn/">Matplotlib
æ•™ç¨‹ï¼ˆä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼‰</a></p>
]]></content>
      <categories>
        <category>Visualization</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Matplotlib</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜åŒ–pandaså†…å­˜å…¥é—¨</title>
    <url>/hexo_blog/2018/03/17/PythonPackages/%E4%BC%98%E5%8C%96pandas%E5%86%85%E5%AD%98%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p>é™ä½æ•°æ®å­˜å‚¨æ¶ˆè€—å¹¶æé«˜å¤„ç†æ•ˆç‡ï¼Œæœ¬æ–‡æ•™ä½ å¦‚ä½•é€šè¿‡ä¼˜åŒ–æ•°å€¼ç±»å‹ã€<code>object</code>ç±»å‹å’Œ
<code>datetime</code>ç±»å‹ä¸‰ä¸ªæ–¹é¢æ¥å‡å°‘å†…å­˜ä½¿ç”¨é‡ã€‚å…¶ä¸­ï¼Œä½¿ç”¨
<code>Categoricals</code>ä¼˜åŒ–
<code>object</code>ç±»å‹æ•°æ®æ˜¯æ•ˆæœæœ€æ˜¾è‘—çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ã€‚å¦å¤–ï¼Œè¿˜ä»‹ç»äº†å¦‚ä½•åœ¨è¯»å–æ•°æ®çš„æ—¶å€™å°±å®Œæˆä¼˜åŒ–æ­¥éª¤ï¼Œé¿å…åŠ è½½å®Œæ•°æ®å†åšä¼˜åŒ–çš„éº»çƒ¦ã€‚</p>
<span id="more"></span>
<h2 id="ç®€å•çš„æ¦‚å¿µ">ç®€å•çš„æ¦‚å¿µ</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æ•°æ®</span></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;test.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾—åˆ°ç²¾ç¡®çš„å†…å­˜ä¿¡æ¯</span></span><br><span class="line">df.info(memory_usage=<span class="string">&#x27;deep&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯´æ˜ï¼šä¹‹åéƒ½ç”¨dfæ¥è¡¨ç¤ºè¯»å–åˆ°çš„dataframe</span></span><br></pre></td></tr></table></figure>
<p>pandasä¸­æ¯ä¸€ä¸ªæ•°æ®ç±»å‹éƒ½æœ‰ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥å¤„ç†ã€‚</p>
<ul>
<li><code>ObjectBlock</code>ï¼š å­—ç¬¦ä¸²åˆ—çš„å—</li>
<li><code>FloatBlock</code>ï¼š æµ®ç‚¹æ•°åˆ—çš„å—</li>
<li><code>Numpy ndarray</code>ï¼šæ•´å‹å’Œæµ®ç‚¹æ•°å€¼çš„å—ï¼ˆéå¸¸å¿«ï¼Œç”¨Cæ•°ç»„æ„å»ºçš„ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> dtype <span class="keyword">in</span> [<span class="string">&#x27;float&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;object&#x27;</span>]:</span><br><span class="line">    <span class="comment"># é€‰ä¸­å¯¹åº”çš„dtypeåˆ—</span></span><br><span class="line">    selected_dtype = df.select_dtypes(include=[dtype])</span><br><span class="line">    <span class="comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡çš„å¹³å‡å€¼</span></span><br><span class="line">    mean_usage_b = selected_dtype.memory_usage(deep=<span class="literal">True</span>).mean()</span><br><span class="line">    <span class="comment"># è·å–åˆ°çš„æ•°æ®å•ä½ä¸ºK, è¿™é‡Œè½¬æ¢ä¸€ä¸‹</span></span><br><span class="line">    mean_usage_mb = mean_usage_b / <span class="number">1024</span> ** <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Average memory usage for &#123;&#125; columns:&#123;:03.2f&#125; MB&quot;</span>.<span class="built_in">format</span>(dtype, mean_usage_mb))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç° <code>object</code>ç±»å ç”¨å†…å­˜æœ€å¤§</p>
<h3 id="å­ç±»å‹subtype">å­ç±»å‹(subtype)</h3>
<table>
<thead>
<tr>
<th>memory usage</th>
<th>float</th>
<th>int</th>
<th>uint</th>
<th>datetime</th>
<th>bool</th>
<th>object</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 bytes</td>
<td></td>
<td>int8</td>
<td>uint8</td>
<td></td>
<td>bool</td>
<td></td>
</tr>
<tr>
<td>2 bytes</td>
<td>float16</td>
<td>int16</td>
<td>uint16</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4 bytes</td>
<td>float32</td>
<td>int32</td>
<td>uint32</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>8 bytes</td>
<td>float64</td>
<td>int64</td>
<td>uint64</td>
<td>datetime64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>variable</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>object</td>
</tr>
</tbody>
</table>
<p>ä¸€ä¸ª
<code>int8</code>ç±»å‹å€¼ä½¿ç”¨1ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥è¡¨ç¤º256(2^8)ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œå³-128åˆ°127çš„æ‰€æœ‰æ•´æ•°å€¼ã€‚æ ¹æ®è¡¨å¯ä»¥å¾—å‡ºï¼Œå¯¹äºæ¯ä¸ªåˆ—ï¼Œåº”è¯¥å°½å¯èƒ½"æŠ "ä¸€ç‚¹ï¼Œ
ç‰©å°½å…¶ç”¨ã€‚è¿™é‡Œçš„
<code>uint</code>è¡¨ç¤ºæ— ç¬¦å·æ•´å‹ï¼Œå¯ä»¥æ›´æœ‰æ•ˆåœ°å¤„ç†æ­£æ•´æ•°çš„åˆ—ã€‚</p>
<h2 id="ä¼˜åŒ–">ä¼˜åŒ–</h2>
<h3 id="æ•°å€¼å‹æ•°æ®">æ•°å€¼å‹æ•°æ®</h3>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ <code>to_numeric()</code>å¯¹æ•°å€¼ç±»å‹è¿›è¡Œ
<code>downcast</code>ï¼ˆå‘ä¸‹è½¬å‹ï¼‰çš„æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€‰ä¸­æ•´æ•°å‹çš„åˆ—</span></span><br><span class="line">df_int_columns = df.select_dtypes(include=[<span class="string">&#x27;int&#x27;</span>])</span><br><span class="line"><span class="comment"># å‘ä¸‹è½¬å‹</span></span><br><span class="line">df_int_columns.apply(pd.to_numeric, downcast=<span class="string">&#x27;unsigned&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰ä¸­æµ®ç‚¹å‹æ•°æ®</span></span><br><span class="line">df_float_columns = df.select_dtypes(include=[<span class="string">&#x27;float&#x27;</span>])</span><br><span class="line"><span class="comment"># å‘ä¸‹è½¬å‹</span></span><br><span class="line">df_float_columns.apply(pd.to_numeric, downcast=<span class="string">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å†…å­˜ï¼Œä½†æ˜¯ç¼ºç‚¹å¾ˆæ˜æ˜¾çš„å°±æ˜¯åªèƒ½ç”¨äºæ•°å€¼å‹æ•°æ®ï¼Œè€Œä¸”ä¼˜åŒ–çš„ç©ºé—´æœ‰é™ã€‚</p>
<h3 id="objectå‹æ•°æ®"><code>object</code>å‹æ•°æ®</h3>
<p><code>object</code>ç±»å‹å®é™…ä¸Šä½¿ç”¨çš„æ˜¯Pythonå­—ç¬¦ä¸²å¯¹åº”çš„å€¼ï¼Œç”±äºPythonè§£é‡Šæ€§è¯­è¨€çš„ç‰¹æ€§ï¼Œå­—ç¬¦ä¸²å­˜å‚¨æ–¹å¼å¾ˆç¢ç‰‡åŒ–ï¼ˆæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ï¼‰ã€‚<code>object</code>åˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚<code>object</code>ç±»å‹çš„æ•°æ®å†…å­˜ä½¿ç”¨æƒ…å†µæ˜¯å¯å˜çš„ã€‚å¦‚æœæ¯ä¸ªå­—ç¬¦ä¸²æ˜¯å•ç‹¬å­˜å‚¨çš„ï¼Œé‚£ä¹ˆå®é™…ä¸Šå­—ç¬¦ä¸²å ç”¨å†…å­˜æ˜¯å¾ˆå¤§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> sys <span class="keyword">import</span> getsizeof</span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²æœ¬èº«å†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">In [<span class="number">2</span>]: s1 = <span class="string">&quot;hello world!&quot;</span></span><br><span class="line">In [<span class="number">3</span>]: s2 = <span class="string">&quot;hello pandas!&quot;</span></span><br><span class="line">In [<span class="number">4</span>]: getsizeof(s1), getsizeof(s2)</span><br><span class="line">Out[<span class="number">4</span>]: (<span class="number">61</span>, <span class="number">62</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²(object)åœ¨pandasä¸­å†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">In [<span class="number">9</span>]: <span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">In [<span class="number">10</span>]: ser = pd.Series([s1, s2])</span><br><span class="line">In [<span class="number">11</span>]: ser.apply(getsizeof)</span><br><span class="line">Out[<span class="number">11</span>]:</span><br><span class="line"><span class="number">0</span>    <span class="number">61</span></span><br><span class="line"><span class="number">1</span>    <span class="number">62</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé€šè¿‡è§‚å¯Ÿçœ‹åˆ°ï¼Œåœ¨è¿™é‡Œpandasä½¿ç”¨äº†int64æ¥å­˜å‚¨ï¼Œå®é™…å ç”¨å¤§å°ä¸å­—ç¬¦ä¸²æœ¬èº«æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨
<code>Categoricals</code>æ¥ä¼˜åŒ–
<code>object</code>ç±»å‹ã€‚<code>Categoricals</code>çš„å·¥ä½œåŸç†æˆ‘ç†è§£ä¸ºï¼ŒæŸä¸ª
<code>object</code>ç±»æœ‰æœ‰é™çš„åˆ†ç±»æƒ…å†µ(æ¯”å¦‚åªæœ‰
<code>red</code>ã€<code>yellow</code>ã€<code>blue</code>ã€<code>black</code>ç­‰é¢œè‰²ç›¸å…³)ï¼Œé‚£ä¹ˆ
<code>Categoricals</code>å°†è¿™äº›åˆ†ç±» <code>object</code>å¯¹è±¡è½¬æ¢ä¸º
<code>int</code>å­ç±»å‹ï¼ˆå¯¹åº”ä¸Šé¢çš„0, 1, 2, 3ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€‰ä¸­objectç±»å‹</span></span><br><span class="line">df_obj_columns = df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>])</span><br><span class="line"><span class="comment"># æŸ¥çœ‹objectç±»å‹åˆ—çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">df_obj_columns.describe()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ
<code>unique</code>(ä¸åŒå€¼)çš„æ•°é‡å¾ˆå°‘ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ç§ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æŸä¸€åˆ—ç¬¦åˆä¼˜åŒ–æ¡ä»¶ï¼Œä¸ºdf_obj_lessï¼Œä½¿ç±»å‹è½¬æ¢ä¸ºcategory</span></span><br><span class="line">df_category_column = df_obj_less.astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"><span class="comment"># è½¬æ¢ä¹‹åï¼Œä¸»è§‚è§‚å¯Ÿæ•°æ®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯ç±»å‹æ”¹å˜äº†</span></span><br><span class="line"><span class="comment"># è§‚å¯Ÿè½¬æ¢ä¹‹åå®é™…ä¸Šçš„æ•°æ®</span></span><br><span class="line">df_category_column.cat.codes</span><br><span class="line"><span class="comment"># å˜æˆäº†ç”±0,1,2ç­‰æ•°å­—æ„æˆçš„int8ç±»å‹çš„æ•°æ®</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæå‡çš„ç©ºé—´è¿œè¿œè¶…è¿‡ç¬¬ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ï¼Œå…·ä½“è¦ç»“åˆæ•°æ®æ¥æ£€éªŒï¼ˆæœ€å¥½è²Œä¼¼å¯ä»¥å‡å°‘98%çš„ä½¿ç”¨é‡ï¼‰ã€‚è¿™é‡Œæœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹å°±æ˜¯æ— æ³•è¿›è¡Œæ•°å€¼è®¡ç®—ï¼Œå³æ²¡æœ‰åŠæ³•ä½¿ç”¨
<code>pd.Series.min()</code>ã€<code>pd.Series.max()</code>ç­‰ä¸æ•°å€¼ç›¸å…³æ“ä½œã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯åœ¨æœ‰å¤šå°‘ä¸ª
<code>unique</code>(ä¸åŒå€¼)çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚é¦–å…ˆï¼Œæ¯«æ— ç–‘é—®çš„æ˜¯å¦‚æœéœ€è¦è®¡ç®—æ“ä½œçš„åˆ—æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚ç¬¬äºŒæ˜¯å¦‚æœ
<code>unique</code>çš„æ¯”ä¾‹å°äº50%(ä¸ªäººè§‰å¾—æ¯”ä¾‹åº”è¯¥æ›´å°)å°±å¯ä»¥ä½¿ç”¨è¿™ç§æƒ…å†µï¼Œå¦‚æœè¿‡å¤šçš„è¯ï¼Œè½¬æ¢ä¹‹åæ¶ˆè€—çš„å†…å­˜ä¼šæ›´å¤šï¼ˆä¸ä»…éœ€è¦å­˜å‚¨stringè¿˜æœ‰intï¼‰ã€‚</p>
<p>é™„ä¸Šç­›é€‰ <code>unique</code>æ¯”ä¾‹å°äº50%çš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æå–uniqueå°‘äº50%çš„objectåˆ—</span></span><br><span class="line">df_obj_columns = df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>])</span><br><span class="line"><span class="keyword">for</span> obj_col <span class="keyword">in</span> df_obj_columns:</span><br><span class="line">    unique_values = <span class="built_in">len</span>(df_obj_columns[obj_col].unique())</span><br><span class="line">    total_values = <span class="built_in">len</span>(df_obj_columns[obj_col])</span><br><span class="line">    <span class="keyword">if</span> unique_values / total_values &lt; <span class="number">0.5</span>:</span><br><span class="line">        obj_col.astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºè®®æå‰copyä¸€ä»½æ•°æ®ï¼Œå†åšä¸Šé¢çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure>
<h3 id="datetimeç±»å‹"><code>datetime</code>ç±»å‹</h3>
<p>è¿™é‡Œå…¶å®ä¸èƒ½å«åšä¼˜åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å°†æ•°å€¼å‹æ•°æ®è½¬æ¢ä¸º
<code>datetime</code>ç±»å‹ï¼Œè™½ç„¶æé«˜äº†å†…å­˜çš„ä½¿ç”¨ï¼Œä½†æ˜¯è½¬æ¢ä¸º
<code>datetime</code>ç±»å‹çš„æ•°æ®æ›´å®¹æ˜“è¿›è¡Œåˆ†æï¼ˆæ—¶é—´åºåˆ—åˆ†æï¼‰ã€‚å½“ç„¶å¦‚æœæœ‰
<code>datetime</code>ç±»å‹ä¸åœ¨åˆ†æçš„èŒƒå›´å†…ï¼Œè‡ªç„¶å¯ä»¥æ— è§†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾df_num_colä¸ºéœ€è¦è½¬æ¢çš„åˆ—, è¿™é‡Œformatæ ¼å¼çœ‹æƒ…å†µæ›´æ”¹</span></span><br><span class="line">df_num_col = pd.to_datetime(df_num_col, <span class="built_in">format</span>=<span class="string">&quot;%Y%m%d&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å†™äº†è¿™ä¹ˆå¤šï¼Œå¦‚æœæ¯æ¬¡ç­‰åŠ è½½å®Œæ•°æ®å†åšä¼˜åŒ–æ“ä½œï¼Œæ„Ÿè§‰æœ‰äº›é¸¡è‚‹ã€‚ä½†æ˜¯å…¶å®å¯ä»¥ä½¿ç”¨
<code>read_csv</code>ç­‰è¯»å–å‡½æ•°çš„å‡ ä¸ªå‚æ•°æ¥å¸®åŠ©æˆ‘ä»¬åœ¨è¯»å–çš„æ—¶å€™å°±å®Œæˆä¼˜åŒ–æ­¥éª¤ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆï¼Œéœ€è¦æ•´ç†å‡ºæ¯ä¸€åˆ—æœ€ç»ˆçš„æ•°æ®ç±»å‹ï¼Œç»„æˆä¸€ä¸ªdict</span></span><br><span class="line">dtypes_lst = [col.name <span class="keyword">for</span> name <span class="keyword">in</span> df.dtypes]</span><br><span class="line">column_types = <span class="built_in">dict</span>(<span class="built_in">zip</span>(dtypes.index, dtypes_lst))</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°è¯»å–æ•°æ®, dtypeæŒ‡å®šæ•°æ®æ ¼å¼ï¼Œparse_datesæŒ‡å®šåˆ—è½¬æ¢æ ¼å¼ä¸ºdatetime,infer_datetime_formatå°è¯•è§£æå­—ç¬¦ä¸²å½¢å¼çš„datatimeæ ¼å¼ï¼ˆåœ¨ä¸€äº›æƒ…å†µä¸‹å¯ä»¥åŠ å¿«è§£æé€Ÿåº¦5-10å€ï¼‰</span></span><br><span class="line">new_df = pd.read_csv(<span class="string">&#x27;test.csv&#x27;</span>, dtpye=column_types, parse_dates=[<span class="string">&#x27;date&#x27;</span>], infer_datetime_format=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>Numpyçš„70ä¸ªæ“ä½œ</title>
    <url>/hexo_blog/2018/03/02/PythonPackages/Numpy%E7%9A%8470%E4%B8%AA%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Numpyä»å…¥é—¨åˆ°è¿›é˜¶çš„æ“ä½œ,
ç¿»è¯‘æ–‡ç« ï¼Œä¾¿äºè‡ªå·±ä½¿ç”¨æ—¶æŸ¥é˜…</p>
<span id="more"></span>
<p><a
href="https://www.machinelearningplus.com/101-numpy-exercises-python/">åŸæ–‡é“¾æ¥</a></p>
<p>æ³¨é‡ŠåŠè¾“å‡ºå‰å¸¦æœ‰ <code>#</code></p>
<h2 id="section">1-10</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹numpyçš„ç‰ˆæœ¬</span></span><br><span class="line">np.__version__</span><br><span class="line"><span class="comment"># 1.13.3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°æ®</span></span><br><span class="line">arr = np.arange(<span class="number">10</span>)</span><br><span class="line">arr</span><br><span class="line"><span class="comment"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå¸ƒå°”å‹æ•°ç»„</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">np.full((<span class="number">3</span>, <span class="number">3</span>), <span class="literal">True</span>, dtype=<span class="built_in">bool</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼š</span></span><br><span class="line">np.ones((<span class="number">3</span>, <span class="number">3</span>), dtype=<span class="built_in">bool</span>)</span><br><span class="line"><span class="comment"># array([[ True,  True,  True],</span></span><br><span class="line"><span class="comment">#        [ True,  True,  True],</span></span><br><span class="line"><span class="comment">#        [ True,  True,  True]], dtype=bool)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–æ•°ç»„ä¸­ä¸ºå¥‡æ•°çš„æ•°å­—</span></span><br><span class="line">arr = np.arange(<span class="number">10</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line">arr[arr % <span class="number">2</span> == <span class="number">1</span>]</span><br><span class="line"><span class="comment"># array([1, 3, 5, 7, 9])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢æ•°ç»„ä¸­ä¸ºå¥‡æ•°çš„æ•°å­—ä¸º-1</span></span><br><span class="line">arr = np.arange(<span class="number">10</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">arr[arr % <span class="number">2</span> == <span class="number">1</span>] = -<span class="number">1</span></span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ, æ›´åŠ å®‰å…¨çš„æ“ä½œæ–¹æ³•ï¼ˆè¿™é‡Œç®—æ–°çš„ä¸€ä¸ªæ“ä½œï¼‰ï¼š</span></span><br><span class="line">out = np.where(arr % <span class="number">2</span> == <span class="number">1</span>, -<span class="number">1</span>, arr)</span><br><span class="line">out</span><br><span class="line"><span class="comment"># array([ 0, -1,  2, -1,  4, -1,  6, -1,  8, -1])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°ç»„ç»´åº¦å˜æ¢</span></span><br><span class="line">arr = np.arange(<span class="number">10</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">arr.reshape(<span class="number">2</span>, -<span class="number">1</span>)</span><br><span class="line">arr</span><br><span class="line"><span class="comment"># array([[0, 1, 2, 3, 4],</span></span><br><span class="line"><span class="comment">#        [5, 6, 7, 8, 9]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çºµå‘å †å ä¸¤ä¸ªæ•°ç»„</span></span><br><span class="line">a = np.arange(<span class="number">10</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.repeat(<span class="number">1</span>, <span class="number">10</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">np.concatenate([a, b], axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ:</span></span><br><span class="line">np.vstack([a, b])</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸‰ï¼š</span></span><br><span class="line">np.r_[a, b]</span><br><span class="line"><span class="comment"># ä¸‰ç§æ–¹æ³•çš„è¾“å‡º</span></span><br><span class="line"><span class="comment"># array([[0, 1, 2, 3, 4],</span></span><br><span class="line"><span class="comment">#        [5, 6, 7, 8, 9],</span></span><br><span class="line"><span class="comment">#        [1, 1, 1, 1, 1],</span></span><br><span class="line"><span class="comment">#        [1, 1, 1, 1, 1]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨ªå‘å †å ä¸¤ä¸ªæ•°ç»„</span></span><br><span class="line">a = np.arange(<span class="number">10</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.repeat(<span class="number">1</span>, <span class="number">10</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">np.concatenate([a, b], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ:</span></span><br><span class="line">np.hstack([a, b])</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸‰ï¼š</span></span><br><span class="line">np.c_[a, b]</span><br><span class="line"><span class="comment"># ä¸‰ç§æ–¹æ³•çš„è¾“å‡º</span></span><br><span class="line"><span class="comment"># array([[0, 1, 2, 3, 4, 1, 1, 1, 1, 1],</span></span><br><span class="line"><span class="comment">#        [5, 6, 7, 8, 9, 1, 1, 1, 1, 1]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®åŸæœ‰çš„æ•°ç»„ï¼Œè‡ªç”±æ‹“å±•</span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">np.r_[np.repeat(a, <span class="number">3</span>), np.tile(a, <span class="number">3</span>)]</span><br><span class="line"><span class="comment"># array([1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3])</span></span><br></pre></td></tr></table></figure>
<h2 id="section-1">11-20</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ä¸¤ä¸ªæ•°ç»„ä¸­å…¬å…±çš„å…ƒç´ </span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])  <span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.array([<span class="number">7</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>]) <span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line">np.intersect1d(a, b)</span><br><span class="line"><span class="comment"># array([2, 4])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨aæ•°ç»„ä¸­ç§»å»aã€bæ•°ç»„ä¸­å…¬å…±çš„å…ƒç´ </span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])	<span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.array([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])	<span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line">np.setdiff1d(a, b)</span><br><span class="line"><span class="comment"># array([1, 2, 3, 4])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ä¸¤ä¸ªæ•°ç»„ä¸­å…¬å…±å…ƒç´ ï¼ˆç´¢å¼•ç›¸åŒï¼‰çš„ç´¢å¼•</span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])  <span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.array([<span class="number">7</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>]) <span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line">np.where(a == b)</span><br><span class="line"><span class="comment"># (array([1, 3, 5, 7], dtype=int64),)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šæ•°å€¼åŒºé—´çš„å…ƒç´ </span></span><br><span class="line">a = np.arange(<span class="number">15</span>) <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line">index = np.where((a &gt;= <span class="number">5</span>) &amp; (a &lt;= <span class="number">10</span>))</span><br><span class="line">a[index]</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">index = np.where(np.logical_and(a&gt;=<span class="number">5</span>, a&lt;=<span class="number">10</span>))</span><br><span class="line">a[index]</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸‰</span></span><br><span class="line">a[(a&gt;= <span class="number">5</span>) &amp; (a &lt;= <span class="number">10</span>)]</span><br><span class="line"><span class="comment"># array([ 5,  6,  7,  8,  9, 10])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># numpyè¿ç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maxx</span>(<span class="params">x, y</span>):		<span class="comment"># éœ€è¦ä½¿ç”¨çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= y:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">a = np.array([<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">5</span>]) <span class="comment"># åŸæ¥çš„æ•°ç»„a</span></span><br><span class="line">b = np.array([<span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">1</span>]) <span class="comment"># åŸæ¥çš„æ•°ç»„b</span></span><br><span class="line">pair_max = np.vectorize(maxx, dtypes=[<span class="built_in">float</span>])</span><br><span class="line">pair_max(a, b)</span><br><span class="line"><span class="comment"># array([ 6.,  7.,  9.,  8.,  9.,  7.,  5.])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„äº¤æ¢ä¸¤è¡Œ</span></span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)	<span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">arr[:, [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>]]</span><br><span class="line"><span class="comment"># array([[1, 0, 2],</span></span><br><span class="line"><span class="comment">#        [4, 3, 5],</span></span><br><span class="line"><span class="comment">#        [7, 6, 8]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„äº¤æ¢ä¸¤åˆ—</span></span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)	<span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">arr[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>], :]</span><br><span class="line"><span class="comment"># array([[3, 4, 5],</span></span><br><span class="line"><span class="comment">#        [0, 1, 2],</span></span><br><span class="line"><span class="comment">#        [6, 7, 8]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„æ¯è¡Œé€†åºè¾“å‡º</span></span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)  <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">arr[::-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># array([[6, 7, 8],</span></span><br><span class="line"><span class="comment">#        [3, 4, 5],</span></span><br><span class="line"><span class="comment">#        [0, 1, 2]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„æ¯åˆ—é€†åºè¾“å‡º</span></span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)  <span class="comment"># åŸæ¥çš„æ•°ç»„</span></span><br><span class="line">arr[::-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># array([[2, 1, 0],</span></span><br><span class="line"><span class="comment">#        [5, 4, 3],</span></span><br><span class="line"><span class="comment">#        [8, 7, 6]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ•°å€¼åŒºé—´ä¸º5-10</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line">rand_arr = np.random.randint(low=<span class="number">5</span>, high=<span class="number">10</span>, size=(<span class="number">5</span>,<span class="number">3</span>)) + np.random.random((<span class="number">5</span>,<span class="number">3</span>))</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">rand_arr = np.random.uniform(<span class="number">5</span>,<span class="number">10</span>, size=(<span class="number">5</span>,<span class="number">3</span>))</span><br><span class="line">rand_arr</span><br><span class="line"><span class="comment"># array([[ 6.75709583,  7.4662972 ,  7.2395679 ],</span></span><br><span class="line"><span class="comment">#        [ 9.7802112 ,  6.70830431,  6.76776651],</span></span><br><span class="line"><span class="comment">#        [ 6.35564151,  7.8632512 ,  8.53040631],</span></span><br><span class="line"><span class="comment">#        [ 7.99457763,  7.85526309,  8.96584465],</span></span><br><span class="line"><span class="comment">#        [ 6.18621991,  8.14214732,  7.31162037]])</span></span><br></pre></td></tr></table></figure>
<h2 id="section-2">21-30</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ•°ç»„æ—¶ï¼Œæ§åˆ¶è¾“å‡ºç²¾åº¦</span></span><br><span class="line">rand_arr = np.random.random([<span class="number">3</span>,<span class="number">3</span>]) / <span class="number">1e3</span>  <span class="comment"># åŸå§‹æ•°ç»„</span></span><br><span class="line">rand_arr</span><br><span class="line"><span class="comment"># array([[  5.43404942e-04,   2.78369385e-04,   4.24517591e-04],</span></span><br><span class="line"><span class="comment">#        [  8.44776132e-04,   4.71885619e-06,   1.21569121e-04],</span></span><br><span class="line"><span class="comment">#        [  6.70749085e-04,   8.25852755e-04,   1.36706590e-04]])</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªæ“ä½œï¼ŒæŒ‡å®šå°æ•°ç‚¹å3ä½æ•°</span></span><br><span class="line">np.set_printoptions(precision=<span class="number">3</span>)</span><br><span class="line">rand_arr</span><br><span class="line"><span class="comment"># array([[  5.434e-04,   2.784e-04,   4.245e-04],</span></span><br><span class="line"><span class="comment">#        [  8.448e-04,   4.719e-06,   1.216e-04],</span></span><br><span class="line"><span class="comment">#        [  6.707e-04,   8.259e-04,   1.367e-04]])</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ªæ“ä½œï¼Œé¿å…è¾“å‡ºe-04ï¼Œå¹¶æŒ‡å®šå°æ•°ç‚¹å6ä½æ•°</span></span><br><span class="line">np.set_printoptions(suppress=<span class="literal">True</span>, precision=<span class="number">6</span>)</span><br><span class="line"><span class="comment"># array([[ 0.000543,  0.000278,  0.000425],</span></span><br><span class="line"><span class="comment">#        [ 0.000845,  0.000005,  0.000122],</span></span><br><span class="line"><span class="comment">#        [ 0.000671,  0.000826,  0.000137]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å«æœ‰å¾ˆå¤šå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">a = np.arange(<span class="number">15</span>)	<span class="comment"># åŸå§‹æ•°ç»„</span></span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span></span><br><span class="line"><span class="comment"># è®¾å®šæ˜¾ç¤ºå…ƒç´ ä¸ªæ•°çš„é˜ˆå€¼</span></span><br><span class="line">np.set_printoptions(threshold=<span class="number">6</span>)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([ 0,  1,  2, ..., 12, 13, 14])</span></span><br><span class="line"><span class="comment"># è®¾å®šä¸éšè—å…ƒç´ è¾“å‡º</span></span><br><span class="line">np.set_printoptions(threshold=np.nan)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥ç½‘ç«™æ•°æ®</span></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line">iris = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">names = (<span class="string">&#x27;sepallength&#x27;</span>, <span class="string">&#x27;sepalwidth&#x27;</span>, <span class="string">&#x27;petallength&#x27;</span>, <span class="string">&#x27;petalwidth&#x27;</span>, <span class="string">&#x27;species&#x27;</span>)</span><br><span class="line">iris[:<span class="number">3</span>]</span><br><span class="line"><span class="comment"># array([[b&#x27;5.1&#x27;, b&#x27;3.5&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.0&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.7&#x27;, b&#x27;3.2&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;]], dtype=object)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–æŸä¸€åˆ—</span></span><br><span class="line">species = np.array([row[<span class="number">4</span>] <span class="keyword">for</span> row <span class="keyword">in</span> iris])</span><br><span class="line">species</span><br><span class="line"><span class="comment"># array([b&#x27;Iris-setosa&#x27;, b&#x27;Iris-setosa&#x27;, b&#x27;Iris-setosa&#x27;, b&#x27;Iris-setosa&#x27;,</span></span><br><span class="line"><span class="comment">#        b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#       dtype=&#x27;|S15&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–å¤šåˆ—</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼Œåœ¨å¯¼å…¥çš„æ—¶å€™æŒ‡å®šåˆ—</span></span><br><span class="line">iris = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼Œä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•</span></span><br><span class="line">iris = np.array([row.tolist()[:<span class="number">4</span>] <span class="keyword">for</span> row <span class="keyword">in</span> iris], dtype=<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line"><span class="comment"># array([[ 5.1,  3.5,  1.4,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.9,  3. ,  1.4,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.7,  3.2,  1.3,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.6,  3.1,  1.5,  0.2]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—å¹³å‡å€¼ã€æ–¹å·®ã€ä¸­ä½æ•°</span></span><br><span class="line">sepallength = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>])</span><br><span class="line">mu, med, sd = np.mean(sepallength), np.median(sepallength), np.std(sepallength)</span><br><span class="line"><span class="comment"># 5.84333333333 5.8 0.825301291785</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0-1åŒ–æ•°ç»„</span></span><br><span class="line">sepallength = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>])</span><br><span class="line">Smax, Smin = sepallength.<span class="built_in">max</span>(), sepallength.<span class="built_in">min</span>()</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">S = (sepallength - Smin)/(Smax - Smin)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼š</span></span><br><span class="line">S = (sepallength - Smin)/sepallength.ptp()</span><br><span class="line"><span class="comment"># array([ 0.222222,  0.166667,  0.111111, ...,  0.611111,  0.527778,</span></span><br><span class="line"><span class="comment">#         0.444444])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># softmaxæ•°ç»„</span></span><br><span class="line">sepallength = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">x</span>):</span><br><span class="line">    e_x = np.exp(x - np.<span class="built_in">max</span>(x))</span><br><span class="line">    <span class="keyword">return</span> e_x / e_x.<span class="built_in">sum</span>(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">softmax(sepallength)</span><br><span class="line"><span class="comment"># array([ 0.00222 ,  0.001817,  0.001488, ...,  0.009001,  0.006668,  0.00494 ])</span></span><br></pre></td></tr></table></figure>
<h2 id="section-3">31-40</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–æ•°æ®ä¸­ç™¾åˆ†ä½æ•°</span></span><br><span class="line">sepallength = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># æå–æ•°æ®ä¸­5%, 95%çš„æ•°</span></span><br><span class="line">np.percentile(sepallength, q=[<span class="number">5</span>, <span class="number">95</span>])</span><br><span class="line"><span class="comment"># array([ 4.6  ,  7.255])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ä¸­çš„ç¼ºå¤±å€¼æ›¿æ¢ä¸ºéšæœºæ•°</span></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line">iris_2d = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line">i, j = np.where(iris_2d)</span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">iris_2d[np.random.choice((i), <span class="number">20</span>), np.random.choice((j), <span class="number">20</span>)] = np.nan</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">iris_2d[np.random.randint(<span class="number">150</span>, size=<span class="number">20</span>), np.random.randint(<span class="number">4</span>, size=<span class="number">20</span>)] = np.nan</span><br><span class="line">iris_2d[:<span class="number">10</span>]</span><br><span class="line"><span class="comment"># array([[b&#x27;5.1&#x27;, b&#x27;3.5&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.0&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.7&#x27;, b&#x27;3.2&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;5.0&#x27;, b&#x27;3.6&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;5.4&#x27;, b&#x27;3.9&#x27;, b&#x27;1.7&#x27;, b&#x27;0.4&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.4&#x27;, b&#x27;1.4&#x27;, b&#x27;0.3&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;5.0&#x27;, b&#x27;3.4&#x27;, b&#x27;1.5&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.4&#x27;, nan, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.1&#x27;, b&#x27;Iris-setosa&#x27;]], dtype=object)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ•°æ®ä¸­ç¼ºå¤±å€¼ä½ç½®</span></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line">iris_2d = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">iris_2d[np.random.randint(<span class="number">150</span>, size=<span class="number">20</span>), np.random.randint(<span class="number">4</span>, size=<span class="number">20</span>)] = np.nan</span><br><span class="line"><span class="comment"># ç»Ÿè®¡ç¼ºå¤±å€¼ä¸ªæ•°</span></span><br><span class="line">np.isnan(iris_2d[:, <span class="number">0</span>]).<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡ç¼ºå¤±å€¼ä½ç½®</span></span><br><span class="line">np.where(np.isnan(iris_2d[:, <span class="number">0</span>]))</span><br><span class="line"><span class="comment"># (array([ 38,  80, 106, 113, 121], dtype=int64),)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„å¤šé‡æ¡ä»¶ç­›é€‰</span></span><br><span class="line">condition = (iris_2d[:, <span class="number">2</span>] &gt; <span class="number">1.5</span>) &amp; (iris_2d[:, <span class="number">0</span>] &lt; <span class="number">5.0</span>)</span><br><span class="line">iris_2d[condition]</span><br><span class="line"><span class="comment"># array([[ 4.8,  3.4,  1.6,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.8,  3.4,  1.9,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.7,  3.2,  1.6,  0.2],</span></span><br><span class="line"><span class="comment">#        [ 4.8,  3.1,  1.6,  nan],</span></span><br><span class="line"><span class="comment">#        [ 4.9,  2.4,  3.3,  1. ]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æœ‰ç¼ºå¤±å€¼çš„è¡Œï¼Œæ³¨æ„~</span></span><br><span class="line">any_nan_in_row = np.array([~np.<span class="built_in">any</span>(np.isnan(row)) <span class="keyword">for</span> row <span class="keyword">in</span> iris_2d])</span><br><span class="line"><span class="comment"># æœªåˆ é™¤å‰</span></span><br><span class="line">iris_2d.shape</span><br><span class="line"><span class="comment"># (150, 4)</span></span><br><span class="line"><span class="comment"># åˆ é™¤å</span></span><br><span class="line">iris_2d[any_nan_in_row].shape()</span><br><span class="line"><span class="comment"># (130, 4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ•°ç»„é—´å…³è”åº¦</span></span><br><span class="line">iris = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;float&#x27;</span>, usecols=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">np.corrcoef(iris[:, <span class="number">0</span>], iris[:, <span class="number">2</span>])[<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="comment"># 0.87175415730487182</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å«æœ‰ç¼ºå¤±å€¼</span></span><br><span class="line">np.isnan(iris_2d).<span class="built_in">any</span>()</span><br><span class="line"><span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢æ•°ç»„ä¸­çš„ç¼ºå¤±å€¼ä¸º0</span></span><br><span class="line">iris_2d[np.isnan(iris_2d)] = <span class="number">0</span></span><br><span class="line"><span class="comment"># æ›¿æ¢å‰</span></span><br><span class="line">np.isnan(iris_2d).<span class="built_in">any</span>()</span><br><span class="line"><span class="comment"># True</span></span><br><span class="line"><span class="comment"># æ›¿æ¢å</span></span><br><span class="line">np.isnan(iris_2d).<span class="built_in">any</span>()</span><br><span class="line"><span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ•°ç»„ä¸­éé‡å¤æ•°å€¼çš„æƒ…å†µ</span></span><br><span class="line">np.unique(iris, return_counts=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># ä¸Šé¢çš„æ•°ç»„çš„è¡¨ç¤ºæ•°å­—ï¼Œä¸‹é¢çš„æ•°ç»„è¡¨ç¤ºå‡ºç°æ¬¡æ•°</span></span><br><span class="line"><span class="comment"># (array([ 0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  1. ,  1.1,  1.2,  1.3,  1.4,</span></span><br><span class="line"><span class="comment">#          1.5,  1.6,  1.7,  1.8,  1.9,  2. ,  2.1,  2.2,  2.3,  2.4,  2.5,</span></span><br><span class="line"><span class="comment">#          2.6,  2.7,  2.8,  2.9,  3. ,  3.1,  3.2,  3.3,  3.4,  3.5,  3.6,</span></span><br><span class="line"><span class="comment">#          3.7,  3.8,  3.9,  4. ,  4.1,  4.2,  4.3,  4.4,  4.5,  4.6,  4.7,</span></span><br><span class="line"><span class="comment">#          4.8,  4.9,  5. ,  5.1,  5.2,  5.3,  5.4,  5.5,  5.6,  5.7,  5.8,</span></span><br><span class="line"><span class="comment">#          5.9,  6. ,  6.1,  6.2,  6.3,  6.4,  6.5,  6.6,  6.7,  6.8,  6.9,</span></span><br><span class="line"><span class="comment">#          7. ,  7.1,  7.2,  7.3,  7.4,  7.6,  7.7,  7.9]),</span></span><br><span class="line"><span class="comment">#  array([ 6, 28,  7,  7,  1,  1,  8,  4,  7, 20, 20, 26, 11,  6, 12,  7,  7,</span></span><br><span class="line"><span class="comment">#          6,  6, 12,  6, 11,  5,  9, 14, 10, 27, 12, 13,  8, 12,  8,  4,  4,</span></span><br><span class="line"><span class="comment">#          7,  5,  6,  4,  5,  3,  8,  9,  7,  7,  9, 11, 14, 17,  6,  3,  8,</span></span><br><span class="line"><span class="comment">#         10, 12, 11, 10,  5,  8,  9,  4, 10,  8,  5,  3, 10,  3,  5,  1,  1,</span></span><br><span class="line"><span class="comment">#          3,  1,  1,  1,  4,  1], dtype=int64))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°ç»„ä¸­å¤„äºç›¸åº”åŒºé—´çš„æ•°æ¢ä½æ–‡æœ¬</span></span><br><span class="line"><span class="comment"># å°†æ•°ç»„ä¸­æ•°ç»„ä½äº[0, 3, 5, 10]åŒºé—´å†…çš„è½¬æ¢ä¸ºå¯¹åº”çš„ç´¢å¼•</span></span><br><span class="line">petal_length_bin = np.digitize(iris[:, <span class="number">2</span>].astype(<span class="string">&#x27;float&#x27;</span>), [<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>])</span><br><span class="line">label_map = &#123;<span class="number">1</span>: <span class="string">&#x27;small&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;medium&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;large&#x27;</span>, <span class="number">4</span>: np.nan&#125;</span><br><span class="line">petal_length_cat = [label_map[x] <span class="keyword">for</span> x <span class="keyword">in</span> petal_length_bin]</span><br><span class="line">petal_length_cat[:<span class="number">4</span>]</span><br><span class="line"><span class="comment"># [&#x27;small&#x27;, &#x27;small&#x27;, &#x27;small&#x27;, &#x27;small&#x27;]</span></span><br></pre></td></tr></table></figure>
<h2 id="section-4">41-50</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å·²ç»å­˜åœ¨çš„æ•°ç»„ä¸­ï¼Œå¤šåŠ ä¸€åˆ—</span></span><br><span class="line">iris_2d = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line"><span class="comment"># è®¡ç®—</span></span><br><span class="line">sepallength = iris_2d[:, <span class="number">0</span>].astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">petallength = iris_2d[:, <span class="number">2</span>].astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">volume = (np.pi * petallength * (sepallength**<span class="number">2</span>))/<span class="number">3</span></span><br><span class="line">volume = volume[:, np.newaxis]</span><br><span class="line"><span class="comment"># æ¨ªå‘å †å </span></span><br><span class="line">out = np.hstack([iris_2d, volume])</span><br><span class="line">out[:<span class="number">4</span>]</span><br><span class="line"><span class="comment"># array([[b&#x27;5.1&#x27;, b&#x27;3.5&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;, 38.13265162927291],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.0&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;, 35.200498485922445],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.7&#x27;, b&#x27;3.2&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;, 30.0723720777127],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;, 33.238050274980004]], dtype=object)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•°ç»„è¿›è¡Œæ¦‚ç‡æŠ½æ ·</span></span><br><span class="line">iris = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">species = iris[:, <span class="number">4</span>]</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼šç”Ÿæˆæ¦‚ç‡æŠ½æ ·</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">a = np.array([<span class="string">&#x27;Iris-setosa&#x27;</span>, <span class="string">&#x27;Iris-versicolor&#x27;</span>, <span class="string">&#x27;Iris-virginica&#x27;</span>])</span><br><span class="line">species_out = np.random.choice(a, <span class="number">150</span>, p=[<span class="number">0.5</span>, <span class="number">0.25</span>, <span class="number">0.25</span>])</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼šç›´æ¥æ¦‚ç‡æŠ½æ ·</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">probs = np.r_[np.linspace(<span class="number">0</span>, <span class="number">0.500</span>, num=<span class="number">50</span>), np.linspace(<span class="number">0.501</span>, <span class="number">.750</span>, num=<span class="number">50</span>), np.linspace(<span class="number">.751</span>, <span class="number">1.0</span>, num=<span class="number">50</span>)]</span><br><span class="line">index = np.searchsorted(probs, np.random.random(<span class="number">150</span>))</span><br><span class="line">species_out = species[index]</span><br><span class="line">np.unique(species_out, return_counts=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># (array([b&#x27;Iris-setosa&#x27;, b&#x27;Iris-versicolor&#x27;, b&#x27;Iris-virginica&#x27;], dtype=object), array([77, 37, 36], dtype=int64))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç­›é€‰åçš„æ•°ç»„ï¼Œå–å‡ºç¬¬äºŒå¤§çš„æ•°</span></span><br><span class="line">petal_len_setosa = iris[iris[:, <span class="number">4</span>] == <span class="string">b&#x27;Iris-setosa&#x27;</span>, [<span class="number">2</span>]].astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">np.unique(np.sort(petal_len_setosa))[-<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 1.7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºŒç»´æ•°ç»„æŒ‰ç…§å…¶ä¸­æŸä¸€åˆ—è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment"># æŒ‰ç…§ç¬¬ä¸€åˆ—å‡åº</span></span><br><span class="line">iris[iris[:,<span class="number">0</span>].argsort()][:<span class="number">20</span>]</span><br><span class="line"><span class="comment"># array([[b&#x27;4.3&#x27;, b&#x27;3.0&#x27;, b&#x27;1.1&#x27;, b&#x27;0.1&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.4&#x27;, b&#x27;3.2&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.4&#x27;, b&#x27;3.0&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.4&#x27;, b&#x27;2.9&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.5&#x27;, b&#x27;2.3&#x27;, b&#x27;1.3&#x27;, b&#x27;0.3&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.6&#x27;, b&#x27;1.0&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.4&#x27;, b&#x27;1.4&#x27;, b&#x27;0.3&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.6&#x27;, b&#x27;3.2&#x27;, b&#x27;1.4&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.7&#x27;, b&#x27;3.2&#x27;, b&#x27;1.3&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.7&#x27;, b&#x27;3.2&#x27;, b&#x27;1.6&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.8&#x27;, b&#x27;3.0&#x27;, b&#x27;1.4&#x27;, b&#x27;0.1&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.8&#x27;, b&#x27;3.0&#x27;, b&#x27;1.4&#x27;, b&#x27;0.3&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.8&#x27;, b&#x27;3.4&#x27;, b&#x27;1.9&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.8&#x27;, b&#x27;3.4&#x27;, b&#x27;1.6&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.8&#x27;, b&#x27;3.1&#x27;, b&#x27;1.6&#x27;, b&#x27;0.2&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;2.4&#x27;, b&#x27;3.3&#x27;, b&#x27;1.0&#x27;, b&#x27;Iris-versicolor&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;2.5&#x27;, b&#x27;4.5&#x27;, b&#x27;1.7&#x27;, b&#x27;Iris-virginica&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.1&#x27;, b&#x27;Iris-setosa&#x27;],</span></span><br><span class="line"><span class="comment">#        [b&#x27;4.9&#x27;, b&#x27;3.1&#x27;, b&#x27;1.5&#x27;, b&#x27;0.1&#x27;, b&#x27;Iris-setosa&#x27;]], dtype=object)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°</span></span><br><span class="line">vals, counts = np.unique(iris[:, <span class="number">3</span>], return_counts=<span class="literal">True</span>)</span><br><span class="line">vals[np.argmax(counts)]</span><br><span class="line"><span class="comment"># b&#x27;0.2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°æ¯”ç»™å®šæ•°å­—å¤§çš„å€¼çš„ç¼©å½±</span></span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾å®šè¦æ‰¾æ¯”1.0å¤§çš„å€¼</span></span><br><span class="line">np.argmax(iris[:, <span class="number">3</span>].astype(<span class="string">&#x27;float&#x27;</span>) &gt; <span class="number">1.0</span>)</span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™å®šä¸€ä¸ªåŒºé—´ï¼Œå¦‚æœæ•°å­—ä¸åœ¨è¿™ä¸ªåŒºé—´å†…ï¼Œå°±æ›¿æ¢ä¸ºåŒºé—´çš„æœ€å°/æœ€å¤§å€¼</span></span><br><span class="line">a = np.random.uniform(<span class="number">1</span>,<span class="number">50</span>, <span class="number">20</span>)  <span class="comment"># åŸå§‹æ•°ç»„</span></span><br><span class="line"><span class="comment"># array([ 22.153505  ,  47.06146116,  41.06481956,  17.46948556,</span></span><br><span class="line"><span class="comment">#          9.59511223,  19.26877027,   1.27873686,  13.36889132,</span></span><br><span class="line"><span class="comment">#         39.98746292,   1.74749359,  30.34332547,  30.58642241,</span></span><br><span class="line"><span class="comment">#          6.15223659,  19.7152288 ,   2.78732677,  44.63016661,</span></span><br><span class="line"><span class="comment">#         49.06512199,   3.93715745,  44.63675129,  29.26817347])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">np.clip(a, a_min=<span class="number">10</span>, a_max=<span class="number">30</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼š</span></span><br><span class="line">np.where(a &lt; <span class="number">10</span>, <span class="number">10</span>, np.where(a &gt; <span class="number">30</span>, <span class="number">30</span>, a))</span><br><span class="line"><span class="comment"># array([ 22.153505  ,  30.        ,  30.        ,  17.46948556,</span></span><br><span class="line"><span class="comment">#         10.        ,  19.26877027,  10.        ,  13.36889132,</span></span><br><span class="line"><span class="comment">#         30.        ,  10.        ,  30.        ,  30.        ,</span></span><br><span class="line"><span class="comment">#         10.        ,  19.7152288 ,  10.        ,  30.        ,</span></span><br><span class="line"><span class="comment">#         30.        ,  10.        ,  30.        ,  29.26817347])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å‰nå¤§çš„å…ƒç´ ä½ç½®</span></span><br><span class="line">a = np.random.uniform(<span class="number">1</span>,<span class="number">50</span>, <span class="number">20</span>)  <span class="comment"># åŸå§‹æ•°ç»„</span></span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([ 22.153505  ,  47.06146116,  41.06481956,  17.46948556,</span></span><br><span class="line"><span class="comment">#          9.59511223,  19.26877027,   1.27873686,  13.36889132,</span></span><br><span class="line"><span class="comment">#         39.98746292,   1.74749359,  30.34332547,  30.58642241,</span></span><br><span class="line"><span class="comment">#          6.15223659,  19.7152288 ,   2.78732677,  44.63016661,</span></span><br><span class="line"><span class="comment">#         49.06512199,   3.93715745,  44.63675129,  29.26817347])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">a.argsort()[-<span class="number">5</span>:]</span><br><span class="line"><span class="comment"># array([ 2, 15, 18,  1, 16], dtype=int64)</span></span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼š</span></span><br><span class="line">np.argpartition(-a, <span class="number">5</span>)[:<span class="number">5</span>]</span><br><span class="line"><span class="comment"># array([16,  1, 18, 15,  2], dtype=int64)</span></span><br><span class="line"><span class="comment"># è·å–å‰nå¤§çš„å…ƒç´ </span></span><br><span class="line">a[a.argsort()][-<span class="number">5</span>:]</span><br><span class="line"><span class="comment"># æ–¹æ³•1:</span></span><br><span class="line">a[a.argsort()][-<span class="number">5</span>:]</span><br><span class="line"><span class="comment"># æ–¹æ³•2:</span></span><br><span class="line">np.sort(a)[-<span class="number">5</span>:]</span><br><span class="line"><span class="comment"># æ–¹æ³•3:</span></span><br><span class="line">np.partition(a, kth=-<span class="number">5</span>)[-<span class="number">5</span>:]</span><br><span class="line"><span class="comment"># å‰ä¸‰ä¸ªè¾“å‡ºéƒ½æ˜¯</span></span><br><span class="line"><span class="comment"># array([ 41.06481956,  44.63016661,  47.06146116,  44.63675129,  49.06512199])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•4:</span></span><br><span class="line">a[np.argpartition(-a, <span class="number">5</span>)][:<span class="number">5</span>]</span><br><span class="line"><span class="comment"># array([ 49.06512199,  47.06146116,  44.63675129,  44.63016661,  41.06481956])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æœ‰å”¯ä¸€å€¼çš„è¡Œæ•°,æ²¡çœ‹æ‡‚</span></span><br><span class="line">arr = np.random.randint(<span class="number">1</span>,<span class="number">11</span>,size=(<span class="number">6</span>, <span class="number">10</span>))</span><br><span class="line">arr</span><br><span class="line"><span class="comment"># array([[ 2,  6,  5,  3,  9,  4,  6,  1, 10,  4],</span></span><br><span class="line"><span class="comment">#        [ 7,  4,  5,  8,  7,  4, 10,  1,  5,  5],</span></span><br><span class="line"><span class="comment">#        [ 6,  8,  7,  7,  3,  5,  3,  8,  2,  7],</span></span><br><span class="line"><span class="comment">#        [ 7,  1,  8,  3,  4,  6,  5,  3,  5,  4],</span></span><br><span class="line"><span class="comment">#        [ 8, 10,  1,  1,  6, 10,  7,  7,  6,  7],</span></span><br><span class="line"><span class="comment">#        [ 5,  8,  4, 10,  3,  4,  9,  8,  2,  6]])</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">counts_of_all_values_rowwise</span>(<span class="params">arr2d</span>):</span><br><span class="line">    num_counts_array = [np.unique(row, return_counts=<span class="literal">True</span>) <span class="keyword">for</span> row <span class="keyword">in</span> arr2d]</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">int</span>(b[a==i]) <span class="keyword">if</span> i <span class="keyword">in</span> a <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> np.unique(arr2d)] <span class="keyword">for</span> a, b <span class="keyword">in</span> num_counts_array]</span><br><span class="line">counts_of_all_values_rowwise(arr)</span><br><span class="line"><span class="comment"># [[1, 1, 1, 2, 1, 2, 0, 0, 1, 1],</span></span><br><span class="line"><span class="comment">#  [1, 0, 0, 2, 3, 0, 2, 1, 0, 1],</span></span><br><span class="line"><span class="comment">#  [0, 1, 2, 0, 1, 1, 3, 2, 0, 0],</span></span><br><span class="line"><span class="comment">#  [1, 0, 2, 2, 2, 1, 1, 1, 0, 0],</span></span><br><span class="line"><span class="comment">#  [2, 0, 0, 0, 0, 2, 3, 1, 0, 2],</span></span><br><span class="line"><span class="comment">#  [0, 1, 1, 2, 1, 1, 0, 2, 1, 1]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„</span></span><br><span class="line">arr1 = np.arange(<span class="number">3</span>)</span><br><span class="line">arr2 = np.arange(<span class="number">3</span>,<span class="number">7</span>)</span><br><span class="line">arr3 = np.arange(<span class="number">7</span>,<span class="number">10</span>)</span><br><span class="line">array_of_arrays = np.array([arr1, arr2, arr3])</span><br><span class="line">array_of_arrays      <span class="comment"># åŸå§‹æ•°ç»„</span></span><br><span class="line"><span class="comment"># array([array([0, 1, 2]), array([3, 4, 5, 6]), array([7, 8, 9])], dtype=object)</span></span><br><span class="line">arr_2d = np.concatenate(array_of_arrays)</span><br><span class="line">arr_2d</span><br><span class="line"><span class="comment"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br></pre></td></tr></table></figure>
<h2 id="section-5">51-60</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># å”¯ä¸€ç¼–ç ä½ç½®</span></span><br><span class="line">np.random.seed(<span class="number">101</span>)</span><br><span class="line">arr = np.random.randint(<span class="number">1</span>,<span class="number">4</span>, size=<span class="number">6</span>)</span><br><span class="line">arr</span><br><span class="line"><span class="comment"># array([2, 3, 2, 2, 2, 1])</span></span><br><span class="line"><span class="comment"># è¿”å›æ•°ç»„æ˜¯3x6,å› ä¸ºæ•°ç»„é•¿åº¦ä¸º6ï¼Œæœ€å¤§æ•°ä¸º1ã€‚1å¯¹åº”çš„æ˜¯[1,0,0,],2å¯¹åº”çš„æ˜¯[0,1,0],3å¯¹åº”çš„æ˜¯[0,0,1]</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">one_hot_encodings</span>(<span class="params">arr</span>):</span><br><span class="line">    uniqs = np.unique(arr)</span><br><span class="line">    out = np.zeros((arr.shape[<span class="number">0</span>], uniqs.shape[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr):</span><br><span class="line">        out[i, k-<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line">one_hot_encodings(arr)</span><br><span class="line"><span class="comment"># array([[ 0.,  1.,  0.],</span></span><br><span class="line"><span class="comment">#        [ 0.,  0.,  1.],</span></span><br><span class="line"><span class="comment">#        [ 0.,  1.,  0.],</span></span><br><span class="line"><span class="comment">#        [ 0.,  1.,  0.],</span></span><br><span class="line"><span class="comment">#        [ 0.,  1.,  0.],</span></span><br><span class="line"><span class="comment">#        [ 1.,  0.,  0.]])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">(arr[:, <span class="literal">None</span>] == np.unique(arr)).view(np.int8)</span><br><span class="line"><span class="comment"># array([[0, 1, 0],</span></span><br><span class="line"><span class="comment">#        [0, 0, 1],</span></span><br><span class="line"><span class="comment">#        [0, 1, 0],</span></span><br><span class="line"><span class="comment">#        [0, 1, 0],</span></span><br><span class="line"><span class="comment">#        [0, 1, 0],</span></span><br><span class="line"><span class="comment">#        [1, 0, 0]], dtype=int8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”±å˜é‡ååˆ†ç»„çš„è¡Œå·</span></span><br><span class="line">url = <span class="string">&#x27;https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#x27;</span></span><br><span class="line">species = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;str&#x27;</span>, usecols=<span class="number">4</span>)</span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">species_small = np.sort(np.random.choice(species, size=<span class="number">20</span>))</span><br><span class="line">species_small</span><br><span class="line"><span class="comment"># array([&#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-setosa&#x27;, &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-versicolor&#x27;, &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-virginica&#x27;],</span></span><br><span class="line"><span class="comment">#       dtype=&#x27;&lt;U15&#x27;)</span></span><br><span class="line"></span><br><span class="line">[i <span class="keyword">for</span> val <span class="keyword">in</span> np.unique(species_small) <span class="keyword">for</span> i, grp <span class="keyword">in</span> <span class="built_in">enumerate</span>(species_small[species_small==val])]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®å·²çŸ¥åˆ†ç±»ç»„ååˆ›å»ºç´¢å¼•</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">species_small = np.sort(np.random.choice(species, size=<span class="number">20</span>))</span><br><span class="line">species_small</span><br><span class="line"><span class="comment"># array([&#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-setosa&#x27;, &#x27;Iris-setosa&#x27;, &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;, &#x27;Iris-versicolor&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-versicolor&#x27;, &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;, &#x27;Iris-virginica&#x27;],</span></span><br><span class="line"><span class="comment">#       dtype=&#x27;&lt;U15&#x27;)</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼Œç”¨åˆ—è¡¨è§£æå¼</span></span><br><span class="line">output = [np.argwhere(np.unique(species_small) == s).tolist()[<span class="number">0</span>][<span class="number">0</span>] <span class="keyword">for</span> val <span class="keyword">in</span> np.unique(species_small) <span class="keyword">for</span> s <span class="keyword">in</span> species_small[species_small==val]]</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼Œä¸ç”¨åˆ—è¡¨è§£æå¼ç›´æ¥å¾ªç¯</span></span><br><span class="line">output = []</span><br><span class="line">uniqs = np.unique(species_small)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> uniqs:  <span class="comment"># uniq values in group</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> species_small[species_small==val]:  <span class="comment"># each element in group</span></span><br><span class="line">        groupid = np.argwhere(uniqs == s).tolist()[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># groupid</span></span><br><span class="line">        output.append(groupid)</span><br><span class="line">output</span><br><span class="line"><span class="comment"># [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°å€¼æ’åºï¼Œè¾“å‡ºå¯¹åº”çš„ç´¢å¼•å€¼</span></span><br><span class="line">np.random.seed(<span class="number">10</span>)</span><br><span class="line">a = np.random.randint(<span class="number">20</span>, size=<span class="number">10</span>)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># [ 9  4 15  0 17 16 17  8  9  0]</span></span><br><span class="line">a.argsort().argsort()</span><br><span class="line"><span class="comment"># [4 2 6 0 8 7 9 3 5 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šç»´æ•°ç»„æ’åºï¼Œè¾“å‡ºå¯¹åº”çš„ç´¢å¼•å€¼</span></span><br><span class="line">np.random.seed(<span class="number">10</span>)</span><br><span class="line">a = np.random.randint(<span class="number">20</span>, size=[<span class="number">2</span>,<span class="number">5</span>])</span><br><span class="line">a</span><br><span class="line"><span class="comment"># [[ 9  4 15  0 17]</span></span><br><span class="line"><span class="comment">#  [16 17  8  9  0]]</span></span><br><span class="line">a.ravel().argsort().argsort().reshape(a.shape)</span><br><span class="line"><span class="comment"># [[ 9  4 15  0 17]</span></span><br><span class="line"><span class="comment">#  [16 17  8  9  0]]</span></span><br><span class="line"><span class="comment"># [[4 2 6 0 8]</span></span><br><span class="line"><span class="comment">#  [7 9 3 5 1]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå¤šç»´æ•°ç»„æ¯ä¸€è¡Œçš„æœ€å¤§å€¼</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">a = np.random.randint(<span class="number">1</span>,<span class="number">10</span>, [<span class="number">5</span>,<span class="number">3</span>])</span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([[9, 9, 4],</span></span><br><span class="line"><span class="comment">#        [8, 8, 1],</span></span><br><span class="line"><span class="comment">#        [5, 3, 6],</span></span><br><span class="line"><span class="comment">#        [3, 3, 3],</span></span><br><span class="line"><span class="comment">#        [2, 1, 9]])</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line">np.amax(a, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">np.apply_along_axis(np.<span class="built_in">max</span>, arr=a, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># array([9, 8, 6, 3, 9])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå¤šç»´æ•°ç»„æ¯è¡Œæœ€å°å€¼æ¯”æœ€å¤§å€¼</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">a = np.random.randint(<span class="number">1</span>,<span class="number">10</span>, [<span class="number">5</span>,<span class="number">3</span>])</span><br><span class="line">a</span><br><span class="line"><span class="comment"># array([[9, 9, 4],</span></span><br><span class="line"><span class="comment">#        [8, 8, 1],</span></span><br><span class="line"><span class="comment">#        [5, 3, 6],</span></span><br><span class="line"><span class="comment">#        [3, 3, 3],</span></span><br><span class="line"><span class="comment">#        [2, 1, 9]])</span></span><br><span class="line">np.apply_along_axis(<span class="keyword">lambda</span> x: np.<span class="built_in">min</span>(x)/np.<span class="built_in">max</span>(x), arr=a, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># array([ 0.44444444,  0.125     ,  0.5       ,  1.        ,  0.11111111])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºæ•°ç»„ä¸­é‡å¤çš„æ•°å€¼ï¼Œè¾“å‡ºå¸ƒå°”å‹</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">a = np.random.randint(<span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># [0 0 3 0 2 4 2 2 2 2]</span></span><br><span class="line">out = np.full(a.shape[<span class="number">0</span>], <span class="literal">True</span>)</span><br><span class="line">unique_positions = np.unique(a, return_index=<span class="literal">True</span>)[<span class="number">1</span>]</span><br><span class="line">out[unique_positions] = <span class="literal">False</span></span><br><span class="line">out</span><br><span class="line"><span class="comment"># [False  True False  True False False  True  True  True  True]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå¤šç»´æ•°ç»„æ¯ä¸€åˆ†ç±»çš„å¹³å‡å€¼</span></span><br><span class="line">iris = np.genfromtxt(url, delimiter=<span class="string">&#x27;,&#x27;</span>, dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">names = (<span class="string">&#x27;sepallength&#x27;</span>, <span class="string">&#x27;sepalwidth&#x27;</span>, <span class="string">&#x27;petallength&#x27;</span>, <span class="string">&#x27;petalwidth&#x27;</span>, <span class="string">&#x27;species&#x27;</span>)</span><br><span class="line">numeric_column = iris[:, <span class="number">1</span>].astype(<span class="string">&#x27;float&#x27;</span>)  <span class="comment"># sepalwidth</span></span><br><span class="line">grouping_column = iris[:, <span class="number">4</span>]  <span class="comment"># species</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼šåˆ—è¡¨è§£æ</span></span><br><span class="line">output = [[group_val, numeric_column[grouping_column==group_val].mean()] <span class="keyword">for</span> group_val <span class="keyword">in</span> np.unique(grouping_column)]</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼šä¸ç”¨åˆ—è¡¨è§£æç›´æ¥å¾ªç¯</span></span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> group_val <span class="keyword">in</span> np.unique(grouping_column):</span><br><span class="line">    output.append([group_val, numeric_column[grouping_column==group_val].mean()])</span><br><span class="line">output</span><br><span class="line"><span class="comment"># [[b&#x27;Iris-setosa&#x27;, 3.418],</span></span><br><span class="line"><span class="comment">#  [b&#x27;Iris-versicolor&#x27;, 2.770],</span></span><br><span class="line"><span class="comment">#  [b&#x27;Iris-virginica&#x27;, 2.974]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å›¾åƒè½¬æ¢ä¸ºæ•°ç»„å­˜å‚¨ï¼Œå¹¶å†è½¬æ¢å‡ºå›¾åƒæ˜¾ç¤º</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> PIL, requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;https://upload.wikimedia.org/wikipedia/commons/8/8b/Denali_Mt_McKinley.jpg&#x27;</span></span><br><span class="line">response = requests.get(URL)</span><br><span class="line">I = Image.<span class="built_in">open</span>(BytesIO(response.content))</span><br><span class="line">I = I.resize([<span class="number">150</span>,<span class="number">150</span>])</span><br><span class="line">arr = np.asarray(I)</span><br><span class="line">im = PIL.Image.fromarray(np.uint8(arr))</span><br><span class="line">Image.Image.show(im)</span><br></pre></td></tr></table></figure>
<h2 id="section-6">61-70</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»é™¤æ•°ç»„ä¸­æ‰€æœ‰çš„ç¼ºå¤±å€¼</span></span><br><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,np.nan,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,np.nan])</span><br><span class="line">a[~np.isnan(a)]</span><br><span class="line">array([ <span class="number">1.</span>,  <span class="number">2.</span>,  <span class="number">3.</span>,  <span class="number">5.</span>,  <span class="number">6.</span>,  <span class="number">7.</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸¤ä¸ªæ•°ç»„é—´çš„æ¬§å‡ é‡Œå¾—</span></span><br><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">b = np.array([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>])</span><br><span class="line">dist = np.linalg.norm(a-b)</span><br><span class="line">dist</span><br><span class="line"><span class="comment"># 6.7082039324993694</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºæ•°ç»„ä¸­æœ€å¤§çš„ä¸¤ä¸ªæ•°</span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">doublediff = np.diff(np.sign(np.diff(a)))</span><br><span class="line">peak_locations = np.where(doublediff == -<span class="number">2</span>)[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">peak_locations</span><br><span class="line"><span class="comment"># array([2, 5])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ•°ç»„æ•°ç»„æ•°å€¼æ¯é¡¹å‡å»ä¸€ç»´æ•°ç»„å¯¹åº”çš„è¡Œå·</span></span><br><span class="line">a_2d = np.array([[<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>],[<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>]])</span><br><span class="line">b_1d = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">a_2d - b_1d[:,<span class="literal">None</span>]</span><br><span class="line"><span class="comment"># [[2 2 2]</span></span><br><span class="line"><span class="comment">#  [2 2 2]</span></span><br><span class="line"><span class="comment">#  [2 2 2]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°ç»„ä¸­é‡å¤çš„ç¬¬næ¬¡çš„æ•°çš„ç´¢å¼•</span></span><br><span class="line">x = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">n = <span class="number">5</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼šåˆ—è¡¨è§£æ</span></span><br><span class="line">[i <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(x) <span class="keyword">if</span> v == <span class="number">1</span>][n-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼šnumpyæ–¹æ³•</span></span><br><span class="line">np.where(x == <span class="number">1</span>)[<span class="number">0</span>][n-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†`datetime64`æ ¼å¼è½¬æ¢ä¸º`datetime`</span></span><br><span class="line">dt64 = np.datetime64(<span class="string">&#x27;2018-02-25 22:10:10&#x27;</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼šåˆ©ç”¨datetimeæ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">dt64.tolist()</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼šnumpyç›´æ¥è½¬æ¢</span></span><br><span class="line">dt64.astype(datetime)</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">2</span>, <span class="number">25</span>, <span class="number">22</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªæ²¡çœ‹æ‡‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚ä½•è®¡ç®—numpyæ•°ç»„çš„ç§»åŠ¨å¹³å‡å€¼(ç´¯åŠ å’Œ)</span></span><br><span class="line">np.random.seed(<span class="number">100</span>)</span><br><span class="line">Z = np.random.randint(<span class="number">10</span>, size=<span class="number">10</span>)</span><br><span class="line">Z</span><br><span class="line"><span class="comment"># [8 8 3 7 7 0 4 2 5 2]</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€: np.cumsum</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">moving_average</span>(<span class="params">a, n=<span class="number">3</span></span>) :</span><br><span class="line">    ret = np.cumsum(a, dtype=<span class="built_in">float</span>)</span><br><span class="line">    ret[n:] = ret[n:] - ret[:-n]</span><br><span class="line">    <span class="keyword">return</span> ret[n - <span class="number">1</span>:] / n</span><br><span class="line">moving_average(Z, n=<span class="number">3</span>).<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ: np.convolve</span></span><br><span class="line">np.convolve(Z, np.ones(<span class="number">3</span>)/<span class="number">3</span>, mode=<span class="string">&#x27;valid&#x27;</span>)</span><br><span class="line"><span class="comment"># [ 6.33  6.    5.67  4.67  3.67  2.    3.67  3.  ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œåªç»™å‡ºèµ·å§‹å€¼ã€æ­¥é•¿ã€æ•°ç»„é•¿åº¦</span></span><br><span class="line">length = <span class="number">10</span></span><br><span class="line">start = <span class="number">5</span></span><br><span class="line">step = <span class="number">3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seq</span>(<span class="params">start, length, step</span>):</span><br><span class="line">    end = start + (step*length)</span><br><span class="line">    <span class="keyword">return</span> np.arange(start, end, step)</span><br><span class="line">seq(start, length, step)</span><br><span class="line"><span class="comment"># array([ 5,  8, 11, 14, 17, 20, 23, 26, 29, 32])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># numpyæ•°ç»„å¡«è¡¥ä¸å®Œæ•´çš„æ—¥æœŸ</span></span><br><span class="line">dates = np.arange(np.datetime64(<span class="string">&#x27;2018-02-01&#x27;</span>), np.datetime64(<span class="string">&#x27;2018-02-25&#x27;</span>), <span class="number">2</span>)</span><br><span class="line">dates</span><br><span class="line"><span class="comment"># [&#x27;2018-02-01&#x27; &#x27;2018-02-03&#x27; &#x27;2018-02-05&#x27; &#x27;2018-02-07&#x27; &#x27;2018-02-09&#x27;</span></span><br><span class="line"><span class="comment">#  &#x27;2018-02-11&#x27; &#x27;2018-02-13&#x27; &#x27;2018-02-15&#x27; &#x27;2018-02-17&#x27; &#x27;2018-02-19&#x27;</span></span><br><span class="line"><span class="comment">#  &#x27;2018-02-21&#x27; &#x27;2018-02-23&#x27;]</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€: åˆ—è¡¨è§£æ</span></span><br><span class="line">filled_in = np.array([np.arange(date, (date+d)) <span class="keyword">for</span> date, d <span class="keyword">in</span> <span class="built_in">zip</span>(dates, np.diff(dates))]).reshape(-<span class="number">1</span>)</span><br><span class="line">output = np.hstack([filled_in, dates[-<span class="number">1</span>]])</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ: ä¸ç”¨åˆ—è¡¨è§£æå¾ªç¯</span></span><br><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> date, d <span class="keyword">in</span> <span class="built_in">zip</span>(dates, np.diff(dates)):</span><br><span class="line">    out.append(np.arange(date, (date+d)))</span><br><span class="line">filled_in = np.array(out).reshape(-<span class="number">1</span>)</span><br><span class="line">output = np.hstack([filled_in, dates[-<span class="number">1</span>]])</span><br><span class="line">output</span><br><span class="line"><span class="comment"># array([&#x27;2018-02-01&#x27;, &#x27;2018-02-02&#x27;, &#x27;2018-02-03&#x27;, &#x27;2018-02-04&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2018-02-05&#x27;, &#x27;2018-02-06&#x27;, &#x27;2018-02-07&#x27;, &#x27;2018-02-08&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2018-02-09&#x27;, &#x27;2018-02-10&#x27;, &#x27;2018-02-11&#x27;, &#x27;2018-02-12&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2018-02-13&#x27;, &#x27;2018-02-14&#x27;, &#x27;2018-02-15&#x27;, &#x27;2018-02-16&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2018-02-17&#x27;, &#x27;2018-02-18&#x27;, &#x27;2018-02-19&#x27;, &#x27;2018-02-20&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2018-02-21&#x27;, &#x27;2018-02-22&#x27;, &#x27;2018-02-23&#x27;], dtype=&#x27;datetime64[D]&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™å®šä¸€ç»´æ•°ç»„ï¼Œå˜å½¢ä¸ºäºŒç»´æ•°ç»„ï¼ˆç»™å®šæ¯ç»´é•¿åº¦ï¼‰</span></span><br><span class="line">arr = np.arange(<span class="number">15</span>)</span><br><span class="line">arr</span><br><span class="line">array([ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_strides</span>(<span class="params">arr, stride_len=<span class="number">5</span>, window_len=<span class="number">5</span></span>):</span><br><span class="line">    n_strides = (a.size-window_len)//stride_len + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> np.array([a[s:(s+window_len)] <span class="keyword">for</span> s <span class="keyword">in</span> np.arange(<span class="number">0</span>, n_strides*stride_len, stride_len)])</span><br><span class="line">gen_strides(np.arange(<span class="number">15</span>), stride_len=<span class="number">2</span>, window_len=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># [[ 0  1  2  3]</span></span><br><span class="line"><span class="comment">#  [ 2  3  4  5]</span></span><br><span class="line"><span class="comment">#  [ 4  5  6  7]</span></span><br><span class="line"><span class="comment">#  [ 6  7  8  9]</span></span><br><span class="line"><span class="comment">#  [ 8  9 10 11]</span></span><br><span class="line"><span class="comment">#  [10 11 12 13]]</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Numpy</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Cpp å†™ PyTorch çš„æ’ä»¶</title>
    <url>/hexo_blog/2023/12/03/PyTorch/pytorch_cpp_extension/</url>
    <content><![CDATA[<p>ä»é›¶å¼€å§‹ï¼Œç”¨ Cpp å†™ PyTorch çš„æ’ä»¶ï¼ŒåŒ…æ‹¬ CPU å’Œ GPU çš„ç‰ˆæœ¬ã€‚</p>
<p><a
href="https://github.com/wnma3mz/pytorch_cuda_extension">ä»£ç </a></p>
<span id="more"></span>
<h2 id="ä¸ºä»€ä¹ˆ">ä¸ºä»€ä¹ˆ</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨åŸç”ŸåŠŸèƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„æ—¶å€™ï¼Œæ’ä»¶å¯ä»¥ä½œä¸ºè¡¥å……ã€‚æ¯”å¦‚ï¼ŒPyTorch
çš„ <code>torch.nn.functional</code> ä¸­æ²¡æœ‰ <code>softmax</code>
å‡½æ•°ï¼Œä½†æ˜¯ <code>torch.nn</code> ä¸­æœ‰ï¼Œæ‰€ä»¥å¯ä»¥ç”¨
<code>torch.nn.functional.softmax</code> æ¥ä»£æ›¿ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦ç”¨
<code>softmax</code> çš„å¯¼æ•°ï¼Œå°±éœ€è¦ç”¨åˆ° <code>softmax</code>
çš„åŸå§‹å®šä¹‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è‡ªå·±å†™æ’ä»¶äº†ã€‚</p>
<p>å¦‚æœæ˜¯æ¯”è¾ƒç®€å•çš„éœ€æ±‚ï¼Œåˆ™å¯ä»¥ç›´æ¥ç”¨ Python
å®Œæˆã€‚ç„¶è€Œï¼Œå½“å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜æ—¶ï¼Œå¾€å¾€ä¼šä½¿ç”¨ Cpp
æ¥å†™æ’ä»¶ï¼Œæœ€åç”šè‡³ä¼šä¼˜åŒ–ä¸º CUDA ä»£ç ã€‚</p>
<h2 id="æ€ä¹ˆå†™">æ€ä¹ˆå†™</h2>
<p>ä»ä¾‹å­å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ¥å†™ã€‚å‡è®¾è¦å®ç°ä¸€ä¸ªæœ€ç®€å•çš„ Attention æ¨¡å—ï¼Œè¾“å…¥ä¸º
<span class="math inline">\(q,k,v \in \mathbb{R}^{M \times
N}\)</span>ï¼Œè¾“å‡ºä¸º <span class="math inline">\(out \in \mathbb{R}^{M
\times N}\)</span>ï¼ˆä¸è€ƒè™‘ Batch Size ä»¥åŠ Head æ•°é‡çš„æƒ…å†µï¼‰ã€‚Attention
æ¨¡å—çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<p><span class="math display">\[
out = \text{softmax}(qk^T)v
\]</span></p>
<p>åªå®ç° <code>forward</code> å‡½æ•°ï¼Œä¸å®ç° <code>backward</code>
å‡½æ•°ã€‚</p>
<h3 id="cpu-ç‰ˆæœ¬">CPU ç‰ˆæœ¬</h3>
<p>ç±»ä¼¼äºå†™ Python çš„åº“ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">attention</span><br><span class="line">â”œâ”€â”€ attention.cpp</span><br><span class="line">â”œâ”€â”€ setup.py</span><br><span class="line">â””â”€â”€ __init__.py</span><br></pre></td></tr></table></figure>
<h4 id="python-éƒ¨åˆ†">Python éƒ¨åˆ†</h4>
<p>æ ¸å¿ƒä»£ç åœ¨ <code>attention.cpp</code> ä¸­ ï¼Œé¦–å…ˆåœ¨
<code>setup.py</code> ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">from</span> torch.utils.cpp_extension <span class="keyword">import</span> BuildExtension, CppExtension</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;attention&#x27;</span>,</span><br><span class="line">    ext_modules=[</span><br><span class="line">        CppExtension(<span class="string">&#x27;attention&#x27;</span>, [<span class="string">&#x27;attention.cpp&#x27;</span>]),</span><br><span class="line">    ],</span><br><span class="line">    cmdclass=&#123;</span><br><span class="line">        <span class="string">&#x27;build_ext&#x27;</span>: BuildExtension</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œå°±å¯ä»¥ç”¨ <code>python setup.py install</code>
æ¥å®‰è£…æ’ä»¶äº†ã€‚æˆ–è€…ç”¨ <code>pip install -e attention</code>
ä»¥ä¾¿äºå¿«é€Ÿè°ƒè¯•</p>
<p>åœ¨ <code>__init__.py</code> ä¸­å¯¼å…¥ <code>attention</code> æ¨¡å—ï¼Œä»¥åœ¨
Python ä¸­è°ƒç”¨ <code>forward</code> å‡½æ•°ï¼Œç›´æ¥è®¡ç®— attentionã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> .attention <span class="keyword">import</span> forward</span><br></pre></td></tr></table></figure>
<h4 id="cpp-éƒ¨åˆ†">Cpp éƒ¨åˆ†</h4>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>attention.cpp</code> ä¸­å®ç°
<code>forward</code> å‡½æ•°ï¼Œä¸ºè¿›è¡ŒåŒºåˆ†ï¼Œè¿™é‡Œä½¿ç”¨è¿™ä¸ªå‡½æ•°åç§°
<code>attention_forward</code> ï¼Œè¿™ä¸ªå‡½æ•°çš„è¾“å…¥æ˜¯ qã€kã€v ä¸‰ä¸ª
<code>Tensor</code>ï¼Œè¾“å‡ºæ˜¯
<code>torch::Tensor</code>ã€‚è€Œå…·ä½“çš„è®¡ç®—æ­¥éª¤å¯ä»¥æ‹†è§£ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol type="1">
<li>çŸ©é˜µçš„ä¹˜æ³•</li>
<li>softmax</li>
<li>çŸ©é˜µçš„ä¹˜æ³•</li>
</ol>
<p>ä½¿ç”¨ <code>PYBIND11_MODULE</code>æŠŠ
<code>attention_forward</code>å‡½æ•°æš´éœ²å‡ºå»ï¼Œç»‘å®šåˆ°
<code>forward</code>ä¸Šï¼Œè¿™æ ·å°±èƒ½ç”¨ <code>forward</code>å‡½æ•°æ¥è°ƒç”¨
<code>attention_forward</code>ã€‚æ•´åˆåçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;torch/extension.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šqueries(Q)ï¼Œkeys(K)ï¼Œvalues(V)</span></span><br><span class="line"><span class="comment">// è¿”å›ï¼šæ–¹ä¾¿èµ·è§ï¼Œè¿”å›ä¸€ä¸ª vectorï¼Œå®é™…ä¸Šåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¾¿äºåç»­æ‰©å±•</span></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor&amp; q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor&amp; k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor&amp; v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    torch::Tensor scores = torch::<span class="built_in">matmul</span>(q, k.<span class="built_in">transpose</span>(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">    scores = torch::<span class="built_in">softmax</span>(scores, <span class="number">1</span>);</span><br><span class="line">    torch::Tensor attention = torch::<span class="built_in">matmul</span>(scores, v);</span><br><span class="line">    <span class="keyword">return</span> &#123;attention&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(TORCH_EXTENSION_NAME, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;forward&quot;</span>, &amp;attention_forward, <span class="string">&quot;Attention forward (CPU)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<p>ç”¨ Python ç‰ˆæœ¬çš„å®ç°æ¥æµ‹è¯• Cpp ç‰ˆæœ¬çš„å®ç°æ˜¯å¦æ­£ç¡®ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> attention</span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">torch.manual_seed(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">py_attention</span>(<span class="params">q, k, v</span>):</span><br><span class="line">    <span class="keyword">return</span> torch.softmax(q @ k.T, dim=<span class="number">1</span>) @ v</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_forward</span>(<span class="params">q, k, v</span>):</span><br><span class="line">    baseline_values = py_attention(q, k, v)</span><br><span class="line">    cpp_values = attention.forward(q, k, v)[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;base o&quot;</span>, baseline_values)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cpp  o&quot;</span>, cpp_values)</span><br><span class="line">    <span class="built_in">print</span>(torch.<span class="built_in">all</span>(torch.isclose(baseline_values, cpp_values)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_time</span>(<span class="params">q, k, v, loop=<span class="number">100</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;py&quot;</span>, timeit.timeit(<span class="keyword">lambda</span>: py_attention(q, k, v), number=loop))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cpp&quot;</span>, timeit.timeit(<span class="keyword">lambda</span>: attention.forward(q, k, v), number=loop))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    m, n = <span class="number">2</span>, <span class="number">4</span></span><br><span class="line">    device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">    q, k, v = torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;q&quot;</span>, q)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;k&quot;</span>, k)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;v&quot;</span>, v)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">    check_forward(q, k, v)</span><br><span class="line">    compare_time(q, k, v)</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥å†ä½¿ç”¨ <code>compare_time</code>
å‡½æ•°å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„é€Ÿåº¦ã€‚ç†è®ºä¸Šï¼ŒäºŒè€…çš„é€Ÿåº¦æ˜¯ç›¸å·®æ— å‡ çš„ã€‚å› ä¸ºå‡ç”¨çš„æ˜¯
PyTorch çš„çŸ©é˜µä¹˜æ³•å’Œ softmax å‡½æ•°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„ä¼˜åŒ–æŠ€å·§ï¼Œé‚£ä¹ˆå°±éœ€è¦è‡ªå·±å®ç°çŸ©é˜µä¹˜æ³•å’Œ
softmax å‡½æ•°äº†ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åªå®ç°æœ€ç®€å•çš„çŸ©é˜µä¹˜æ³•å’Œ softmax
å‡½æ•°ï¼Œç„¶åå†å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„é€Ÿåº¦ã€‚</p>
<h4 id="çŸ©é˜µä¹˜æ³•">çŸ©é˜µä¹˜æ³•</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">torch::Tensor <span class="title">my_matmul</span><span class="params">(<span class="type">const</span> torch::Tensor &amp;a, <span class="type">const</span> torch::Tensor &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">TORCH_CHECK</span>(a.<span class="built_in">dim</span>() == <span class="number">2</span> &amp;&amp; b.<span class="built_in">dim</span>() == <span class="number">2</span>, <span class="string">&quot;Input tensors must be 2-dimensional&quot;</span>);</span><br><span class="line">    <span class="built_in">TORCH_CHECK</span>(a.<span class="built_in">size</span>(<span class="number">1</span>) == b.<span class="built_in">size</span>(<span class="number">0</span>), <span class="string">&quot;Dimensions mismatch&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> m = a.<span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">auto</span> n = b.<span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> p = a.<span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    torch::Tensor result = torch::<span class="built_in">zeros</span>(&#123;m, n&#125;, torch::<span class="built_in">dtype</span>(torch::kFloat32));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="type">float</span> sum = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; p; k++) &#123;</span><br><span class="line">                sum += a[i][k].<span class="built_in">item</span>&lt;<span class="type">float</span>&gt;() * b[k][j].<span class="built_in">item</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            result[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="softmax">softmax</h4>
<p>ç”±äº
<code>softmax</code>å‡½æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œåç»­ä¼šç»“åˆç®—å­èåˆä¸€èµ·ä¼˜åŒ–ï¼Œæ‰€ä»¥ç®€å•çš„å¯¹å…¶è¿›è¡Œå±•å¼€ã€‚ç”¨
<code>torch::exp</code>å’Œ
<code>torch::sum</code>å®ç°äº†ä¸€éï¼Œä¸ºäº†æ–¹ä¾¿ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨
<code>torch::softmax(scores, 1)</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">torch::Tensor <span class="title">my_softmax</span><span class="params">(<span class="type">const</span> torch::Tensor&amp; scores)</span> </span>&#123;</span><br><span class="line">    torch::Tensor exponents = torch::<span class="built_in">exp</span>(scores);</span><br><span class="line">    torch::Tensor sum = torch::<span class="built_in">sum</span>(exponents, <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> exponents / sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æŠŠè¿™ä¸¤ä¸ªå‡½æ•°æ›¿æ¢åˆ° <code>attention_forward</code>å‡½æ•°ä¸­åï¼Œå†æ¬¡è¿è¡Œ
<code>compare_time</code>å‡½æ•°ï¼Œå‘ç°æ‰‹å†™çš„ Cpp ç‰ˆæœ¬çš„å®ç°è¦æ¯” Python
ç‰ˆæœ¬çš„å®ç°æ…¢ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºï¼Œå½“å‰åªæ˜¯ç®€å•çš„å®ç°äº†çŸ©é˜µä¹˜æ³•å’Œ softmaxï¼Œè€Œ
PyTorch ä¸­çš„çŸ©é˜µä¹˜æ³•å’Œ softmax éƒ½æ˜¯ç»è¿‡ä¼˜åŒ–çš„ï¼Œæ‰€ä»¥é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p>
<p>å¦å¤–ï¼Œä½¿ç”¨åŸç”Ÿçš„çŸ©é˜µä¹˜æ³•å’Œ softmax å‡½æ•°ï¼Œå¯ä»¥åœ¨ GPU
ä¸Šè¿è¡Œï¼Œè€Œæ‰‹å†™çš„çŸ©é˜µä¹˜æ³•å’Œ softmax å‡½æ•°ï¼Œåªèƒ½åœ¨ CPU
ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥å°†å…¶æ”¹é€ ä¸º GPU ç‰ˆæœ¬ï¼Œç„¶åå†è¿›è¡Œä¼˜åŒ–ã€‚</p>
<h3 id="gpu-ç‰ˆæœ¬">GPU ç‰ˆæœ¬</h3>
<h4 id="python-éƒ¨åˆ†-1">Python éƒ¨åˆ†</h4>
<p>åœ¨ <code>setup.py</code> ä¸­æ›´æ”¹ä¸ºå¦‚ä¸‹ä»£ç ï¼ŒæŠŠ
<code>CppExtension</code> æ”¹ä¸º <code>CUDAExtension</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">from</span> torch.utils.cpp_extension <span class="keyword">import</span> BuildExtension, CUDAExtension </span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;attention&#x27;</span>,</span><br><span class="line">    ext_modules=[</span><br><span class="line">        CUDAExtension(<span class="string">&#x27;attention&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;attention.cpp&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;attention_kernel.cu&#x27;</span>,</span><br><span class="line">        ])      </span><br><span class="line">    ],</span><br><span class="line">    cmdclass=&#123;</span><br><span class="line">        <span class="string">&#x27;build_ext&#x27;</span>: BuildExtension</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="cpp-éƒ¨åˆ†-1">Cpp éƒ¨åˆ†</h4>
<p>ä¸ºäº†å…¼å®¹ä¹‹å‰çš„ä»£ç ï¼Œè¿™é‡Œå°†ä¹‹å‰çš„ <code>attention_forward</code>æ›´æ–°ä¸º
<code>attention_cpu_forward</code>ï¼ŒåŒæ—¶åŠ äº†ä¸€ä¸ªç±»å‹åˆ¤æ–­ï¼Œå¦‚æœè¾“å…¥çš„
<code>Tensor</code>ä¸åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚è€Œå¯¹äº
<code>attention_cuda_forward</code>çš„å®ç°éœ€è¦åœ¨
<code>attention_kernel.cu</code>ä¸­å®ç°ã€‚æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æå‰å®šä¹‰å¥½
<code>attention_cuda_forward</code>å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;torch/extension.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_cuda_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">torch::Tensor <span class="title">my_matmul</span><span class="params">(<span class="type">const</span> torch::Tensor &amp;a, <span class="type">const</span> torch::Tensor &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">TORCH_CHECK</span>(a.<span class="built_in">dim</span>() == <span class="number">2</span> &amp;&amp; b.<span class="built_in">dim</span>() == <span class="number">2</span>, <span class="string">&quot;Input tensors must be 2-dimensional&quot;</span>);</span><br><span class="line">    <span class="built_in">TORCH_CHECK</span>(a.<span class="built_in">size</span>(<span class="number">1</span>) == b.<span class="built_in">size</span>(<span class="number">0</span>), <span class="string">&quot;Dimensions mismatch&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> m = a.<span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">auto</span> n = b.<span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> p = a.<span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    torch::Tensor result = torch::<span class="built_in">zeros</span>(&#123;m, n&#125;, torch::<span class="built_in">dtype</span>(torch::kFloat32));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="type">float</span> sum = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; p; k++) &#123;</span><br><span class="line">                sum += a[i][k].<span class="built_in">item</span>&lt;<span class="type">float</span>&gt;() * b[k][j].<span class="built_in">item</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            result[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_cpu_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor v)</span> </span>&#123;</span><br><span class="line">    torch::Tensor scores = <span class="built_in">my_matmul</span>(q, k);</span><br><span class="line">    torch::Tensor attention = <span class="built_in">my_matmul</span>(torch::<span class="built_in">softmax</span>(scores, <span class="number">1</span>), v);</span><br><span class="line">    <span class="keyword">return</span> &#123;scores, attention&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šqueries(Q)ï¼Œkeys(K)ï¼Œvalues(V)</span></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor &amp;q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor &amp;k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor &amp;v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(q.<span class="built_in">device</span>().<span class="built_in">type</span>() == k.<span class="built_in">device</span>().<span class="built_in">type</span>() &amp;&amp; q.<span class="built_in">device</span>().<span class="built_in">type</span>() == v.<span class="built_in">device</span>().<span class="built_in">type</span>())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Input tensors q, k, and v must be on the same device&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (q.<span class="built_in">is_cuda</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">attention_cuda_forward</span>(q, k.<span class="built_in">transpose</span>(<span class="number">0</span>, <span class="number">1</span>), v);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">attention_cpu_forward</span>(q, k.<span class="built_in">transpose</span>(<span class="number">0</span>, <span class="number">1</span>), v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(TORCH_EXTENSION_NAME, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;forward&quot;</span>, &amp;attention_forward, <span class="string">&quot;Attention forward (CUDA)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="cu-éƒ¨åˆ†">Cu éƒ¨åˆ†</h4>
<p>åœ¨åŒçº§ç›®å½•ä¸‹ï¼Œåˆ›å»º <code>attention_kernel.cu</code>æ–‡ä»¶ã€‚é¦–å…ˆå®ç°
<code>attention_cuda_forward</code>å‡½æ•°çš„ä¸»è¦é€»è¾‘ã€‚å…¶ä¸­ï¼Œä¸»è¦å¯¹çŸ©é˜µä¹˜æ³•è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿ç”¨äº†
CUDA çš„å¹¶è¡Œè®¡ç®—ã€‚ç„¶åï¼Œä½¿ç”¨
<code>AT_DISPATCH_FLOATING_TYPES</code>å®æ¥å®ç°å¯¹ä¸åŒç±»å‹çš„æ”¯æŒï¼Œè¿™æ ·å°±å¯ä»¥æ”¯æŒ
<code>float</code>å’Œ <code>double</code>ç±»å‹äº†ã€‚</p>
<p>å¯¹äº
<code>matrix_multiply</code>å‡½æ•°ï¼Œä¸ä¸€èˆ¬å†™æ³•ä¸åŒçš„æ˜¯ï¼Œéœ€è¦æå‰åˆ›å»ºå¥½è¾“å‡ºçš„
<code>Tensor</code>ï¼Œç„¶åå†ä¼ å…¥åˆ° CUDA çš„å‡½æ•°ä¸­ã€‚å¹¶ä¸”éœ€è¦åˆ›å»ºå¥½
<code>blocks</code>å’Œ <code>threads</code>ï¼Œç„¶åå†è°ƒç”¨ CUDA
çš„å‡½æ•°ã€‚è¿™é‡ŒæŒ‡å®šäº†æ¯ä¸ª CUDA æ˜¯æœ‰ 16 x 16
çº¿ç¨‹çš„å—ï¼Œè€Œè¿™äº›å—æ˜¯å¯ä»¥å¹¶è¡Œè®¡ç®—çš„ï¼Œæ‰€ä»¥èƒ½å¤ŸåŠ é€Ÿè®¡ç®—ã€‚å¯å‚è€ƒ <a
href="https://devblogs.nvidia.com/even-easier-introduction-cuda">An Even
Easier Introduction to CUDA</a></p>
<p>è€Œåœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ <code>packed_accessor</code>ã€‚è¿™é‡Œçš„
<code>packed_accessor</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯
<code>Tensor</code>çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯
<code>Tensor</code>çš„ç»´åº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯
<code>Tensor</code>çš„ç±»å‹ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯
<code>Tensor</code>çš„ç»´åº¦ã€‚è¿™é‡Œçš„
<code>packed_accessor</code>çš„ç¬¬ä¸‰ä¸ªå‚æ•°å’Œç¬¬å››ä¸ªå‚æ•°ï¼Œæ˜¯ä¸ºäº†æ”¯æŒ CUDA
çš„ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å®ç°
<code>matrix_multiply_kernel</code>ã€‚çŸ©é˜µçš„ä¹˜æ³•ä¸­ï¼Œå¦‚æœè¦è®¡ç®—è¾“å‡ºçŸ©é˜µçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œåˆ™éœ€è¦ç”¨åˆ°è¾“å…¥çŸ©é˜µçš„ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ã€‚å› æ­¤ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®
<code>block</code>å’Œ
<code>thread</code>çš„ç´¢å¼•ï¼Œæ¥è®¡ç®—å‡ºå¯¹åº”çš„è¡Œå’Œåˆ—ã€‚ç„¶åï¼Œå°±æ˜¯æ™®é€šçš„çŸ©é˜µä¹˜æ³•çš„å®ç°äº†ã€‚åŸæ¥çš„çŸ©é˜µä¹˜æ³•çš„å®ç°æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">            out[i][j] += input1[i][k] * input2[k][j]</span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºæŠŠå¤–é¢ä¸¤ä¸ªå¾ªç¯åˆ†åˆ«äº¤ç»™äº† CUDA çš„ <code>block</code>å’Œ
<code>thread</code>æ¥è®¡ç®—ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥å®ç°å¹¶è¡Œè®¡ç®—äº†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;torch/extension.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda_runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Matrix multiply kernel</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> <span class="type">scalar_t</span>&gt;</span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">matrix_multiply_kernel</span><span class="params">(<span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input1,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input2,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; output)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="type">int</span> col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>) &amp;&amp; col &lt; input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="type">scalar_t</span> value = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>); ++k) &#123;</span><br><span class="line">            value += input1[row][k] * input2[k][col];</span><br><span class="line">        &#125;</span><br><span class="line">        output[row][col] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">torch::Tensor <span class="title">matrix_multiply</span><span class="params">(torch::Tensor input1, torch::Tensor input2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> rows1 = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> cols1 = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> cols2 = input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> options = torch::<span class="built_in">TensorOptions</span>().<span class="built_in">device</span>(input<span class="number">1.</span><span class="built_in">device</span>());</span><br><span class="line">    torch::Tensor output = torch::<span class="built_in">zeros</span>(&#123;rows1, cols2&#125;, options);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">threads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">blocks</span><span class="params">((cols2 + threads.x - <span class="number">1</span>) / threads.x,</span></span></span><br><span class="line"><span class="params"><span class="function">                      (rows1 + threads.y - <span class="number">1</span>) / threads.y)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AT_DISPATCH_FLOATING_TYPES</span>(input<span class="number">1.</span><span class="built_in">scalar_type</span>(), <span class="string">&quot;matrix_multiply_kernel&quot;</span>, ([&amp;] &#123;</span><br><span class="line">        matrix_multiply_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</span><br><span class="line">            input<span class="number">1.</span><span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            input<span class="number">2.</span><span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            output.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;());</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_cuda_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    torch::Tensor scores = <span class="built_in">matrix_multiply</span>(q, k);</span><br><span class="line">    torch::Tensor attention = <span class="built_in">matrix_multiply</span>(torch::<span class="built_in">softmax</span>(scores, <span class="number">1</span>), v);</span><br><span class="line">    <span class="keyword">return</span> &#123;scores, attention&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ä¸å˜ï¼Œä¾æ—§å¯ä»¥ç”¨ä¸Šé¢çš„æ¥è¿›è¡Œæ£€éªŒã€‚è‡³æ­¤ï¼Œæœ€ç®€å•çš„å®éªŒå°±å®Œæˆäº†ã€‚æ¥ä¸‹æ¥ï¼Œå°±æ˜¯å¯¹å…¶è¿›è¡Œä¼˜åŒ–äº†ã€‚</p>
<h2 id="çŸ©é˜µä¹˜æ³•çš„ä¼˜åŒ–">çŸ©é˜µä¹˜æ³•çš„ä¼˜åŒ–</h2>
<h3 id="matmul">Matmul</h3>
<p>é‡æ–°å›åˆ°çŸ©é˜µä¹˜æ³•ä¸Šï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçŸ©é˜µ A1 å’Œ A2ï¼Œå½¢çŠ¶åˆ†åˆ«ä¸º <span
class="math inline">\(M \times N\)</span> å’Œ <span
class="math inline">\(N \times K\)</span>ï¼Œåˆ™çŸ©é˜µä¹˜æ³•çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span></span><br><span class="line"></span><br><span class="line">A1 = torch.rand(size=(M, N))</span><br><span class="line">A2 = torch.rand(size=(N, K))</span><br><span class="line"></span><br><span class="line">output = torch.zeros(size=(M, K))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(K):</span><br><span class="line">        sum_ = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            sum_ += A1[i][k] * A2[k][j]</span><br><span class="line">        output[i][j] = sum_</span><br></pre></td></tr></table></figure>
<p>ä¸€ç§æœ´ç´ çš„ä¼˜åŒ–æ‰‹æ®µæ˜¯æŠŠæœ€åä¸€ä¸ªå¾ªç¯å¹¶è¡Œè®¡ç®—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(K):</span><br><span class="line">        output[i][j] = <span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>] * x[<span class="number">1</span>], <span class="built_in">zip</span>(A1[i], A2[:, j])))</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨å¤šçº¿ç¨‹/è¿›ç¨‹ï¼ˆä¸‹æ–‡ç»Ÿç§°ä¸ºjobï¼‰è¿›è¡Œå¹¶è¡Œè®¡ç®—å¯ä»¥æé«˜ç¨‹åºçš„è®¡ç®—é€Ÿåº¦ï¼Œä½†è¿™æ ·éœ€è¦æ¯ä¸ªjobéƒ½èƒ½è®¿é—®åˆ°
A1 å’Œ A2 çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™å°±å¼•å…¥äº†å…¨å±€å†…å­˜å’Œå…±äº«å†…å­˜çš„æ¦‚å¿µã€‚</p>
<blockquote>
<ul>
<li>å…¨å±€å†…å­˜ï¼ˆGlobal
Memoryï¼‰ï¼šå…¨å±€å†…å­˜æ˜¯ä¸€ç§åœ¨è®¡ç®—æœºç¨‹åºä¸­å¯è¢«æ‰€æœ‰çº¿ç¨‹æˆ–è¿›ç¨‹è®¿é—®çš„å†…å­˜ç©ºé—´ã€‚å®ƒé€šå¸¸ç”¨äºå­˜å‚¨å…¨å±€å˜é‡ã€é™æ€å˜é‡ä»¥åŠåŠ¨æ€åˆ†é…çš„å†…å­˜ç­‰ã€‚å…¨å±€å†…å­˜çš„ç‰¹ç‚¹æ˜¯å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œè¯»å†™æ“ä½œï¼Œä½†å®ƒçš„è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚</li>
<li>å…±äº«å†…å­˜ï¼ˆShared
Memoryï¼‰ï¼šå…±äº«å†…å­˜æ˜¯ä¸€ç§ç‰¹æ®Šçš„å†…å­˜åŒºåŸŸï¼Œè¢«å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œå…±äº«ã€‚é€šè¿‡å°†æ•°æ®å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ï¼Œä¸åŒçš„çº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»å–å’Œå†™å…¥è¿™äº›æ•°æ®ï¼Œè€Œæ— éœ€ä½¿ç”¨å…¶ä»–çš„é€šä¿¡æœºåˆ¶ã€‚å…±äº«å†…å­˜çš„ç‰¹ç‚¹æ˜¯é«˜æ•ˆçš„æ•°æ®å…±äº«å’Œè®¿é—®é€Ÿåº¦ï¼Œå› ä¸ºä¸éœ€è¦è¿›è¡Œå¤åˆ¶æˆ–ä¼ è¾“æ•°æ®ã€‚</li>
</ul>
</blockquote>
<p>CUDA ä¸­ä¾æ—§å­˜åœ¨ç±»ä¼¼çš„æ¦‚å¿µ</p>
<blockquote>
<ul>
<li>å…¨å±€å†…å­˜ï¼ˆGlobal Memoryï¼‰ï¼šåœ¨ CUDA
ä¸­ï¼Œå…¨å±€å†…å­˜æ˜¯ä¸€ä¸ªè®¾å¤‡ï¼ˆGPUï¼‰ä¸Šå¯è§çš„ä¸»æœºï¼ˆCPUï¼‰å†…å­˜ç©ºé—´ã€‚å®ƒå¯ä»¥ç”±æ‰€æœ‰çš„çº¿ç¨‹å—å’Œçº¿ç¨‹è®¿é—®ï¼Œç”¨äºå­˜å‚¨å…¨å±€å˜é‡å’ŒåŠ¨æ€åˆ†é…çš„å†…å­˜ç­‰ã€‚å…¨å±€å†…å­˜çš„è¯»å†™æ“ä½œç›¸å¯¹è¾ƒæ…¢ï¼Œå› ä¸ºæ¶‰åŠä¸»æœºä¸è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚</li>
<li>å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰ï¼šåœ¨ CUDA
ä¸­ï¼Œå…±äº«å†…å­˜æ˜¯ä½äºæ¯ä¸ªçº¿ç¨‹å—ä¸­çš„ä¸€å—é«˜é€Ÿç¼“å­˜å†…å­˜ã€‚å®ƒè¢«åŒä¸€ä¸ªçº¿ç¨‹å—å†…çš„çº¿ç¨‹å…±äº«ï¼Œå¹¶ä¸”æ¯”å…¨å±€å†…å­˜å…·æœ‰æ›´å¿«çš„è¯»å†™é€Ÿåº¦ã€‚å…±äº«å†…å­˜é€šå¸¸ç”¨äºä¼˜åŒ–ç®—æ³•çš„æ€§èƒ½ï¼Œé€šè¿‡åœ¨çº¿ç¨‹å—å†…éƒ¨å…±äº«æ•°æ®æ¥å‡å°‘å…¨å±€å†…å­˜çš„è®¿é—®ã€‚</li>
</ul>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œå…¨å±€å†…å­˜å¯ä»¥å¾ˆæ–¹ä¾¿çš„å­˜å„ç§ä¸œè¥¿ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ï¼›å…±äº«å†…å­˜æ˜¯ä¸€ä¸ªå¥½ä¸œè¥¿ï¼Œé€Ÿåº¦å—ï¼Œä½†é€šå¸¸å¤§å°å—é™ã€‚æ‰€ä»¥ï¼Œåˆ†åˆ«æœ‰ä¸¤ç§ä¼˜åŒ–ï¼š</p>
<ul>
<li>å…¨å±€å†…å­˜ä¸­ï¼Œè€ƒè™‘å¦‚ä½•åŠ é€Ÿè®¿é—®</li>
<li>å…±äº«å†…å­˜ä¸­ï¼Œè€ƒè™‘å¦‚ä½•å‡å°å ç”¨ç©ºé—´</li>
</ul>
<p>è¿™å°±å¼•å…¥äº† Tiled matmul ç®—æ³•ã€‚</p>
<h3 id="tiled-matmul">Tiled Matmul</h3>
<ul>
<li>å¯¹äºåŠ é€Ÿè®¿é—®ï¼Œåœ¨æ— æ³•æ§åˆ¶ç¡¬ä»¶çš„å‰æä¸‹ï¼Œåªèƒ½é€šè¿‡å¹¶è¡Œçš„æ–¹å¼åŒæ—¶è¯»å–æ•°æ®ã€‚</li>
<li>å¯¹äºå‡å°å ç”¨ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡æ‹†åˆ†çŸ©é˜µï¼ŒæŠŠå¤§çŸ©é˜µæ‹†åˆ†æˆè‹¥å¹²å°çŸ©é˜µï¼Œç„¶åå†è¿›è¡Œè®¡ç®—ã€‚</li>
</ul>
<p>é‡æ–°æ€è€ƒçŸ©é˜µ
<code>output</code>çš„è®¡ç®—è¿‡ç¨‹ï¼Œæ¯ä¸ªå…ƒç´ çš„è®¡ç®—å…¶å®æ˜¯ç‹¬ç«‹çš„ï¼Œå…¶æœ¬è´¨å¯ä»¥æ‹†æˆè‹¥å¹²ç‹¬ç«‹çš„å°å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/pytorch_cuda_ext/setup-2d0f22ecd2e9b7c84af56792d14ba18a.gif?raw=true" />
From https://penny-xu.github.io/blog/tiled-matrix-multiplication</p>
<p>ç”±äºçŸ©é˜µ
<code>output</code>æ¯ä¸ªå…ƒç´ æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå¯ä»¥å°†å…¶æ‹†æˆè‹¥å¹²ä¸ªå°çŸ©é˜µæ¥è®¡ç®—ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŠŠçŸ©é˜µ
<code>output</code> æ‹†æˆäº† 4 ä¸ªå°çŸ©é˜µã€‚å¯¹åº”çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/pytorch_cuda_ext/block_matrix.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span></span><br><span class="line"></span><br><span class="line">A1 = torch.rand(size=(M, N))</span><br><span class="line">A2 = torch.rand(size=(N, K))</span><br><span class="line"></span><br><span class="line">block_size = <span class="number">2</span> <span class="comment"># æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œè®¾ç½®ä¸º N,M,K çš„å…¬çº¦æ•°ã€‚åŒæ—¶ä¹Ÿæ‹†æˆäº† 2x2 çš„ block</span></span><br><span class="line">block_M, block_N, block_K = M // block_size, N // block_size, K // block_size</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matmul</span>(<span class="params">sub_A1, sub_A2</span>):</span><br><span class="line">    output = torch.zeros(size=(sub_A1.shape[<span class="number">0</span>], sub_A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(sub_A1.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">0</span>]):</span><br><span class="line">                output[i][j] += sub_A1[i][k] * sub_A2[k][j]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">output11 = matmul(A1[:block_M, :], A2[:, :block_K])</span><br><span class="line">output12 = matmul(A1[:block_M, :], A2[:, block_K:])</span><br><span class="line">output21 = matmul(A1[block_M:, :], A2[:, :block_K])</span><br><span class="line">output22 = matmul(A1[block_M:, :], A2[:, block_K:])</span><br><span class="line">output = torch.cat([torch.cat([output11, output12], dim=<span class="number">1</span>), torch.cat([output21, output22], dim=<span class="number">1</span>)], dim=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(output)</span><br><span class="line"><span class="built_in">print</span>(A1 @ A2)</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(output, A1 @ A2)</span><br></pre></td></tr></table></figure>
<p>å¯¹äºï¼Œå·¦ä¸Šè§’çŸ©é˜µ <code>output11</code>ï¼Œå®é™…ä¸Šæ˜¯ç”±
<code>block_size</code>ä¸ªçŸ©é˜µä¹˜æ³•ï¼Œå†æ±‚å’Œå¾—åˆ°çš„
<code>output11 = matmul(A1[:block_M, :block_N], A2[:block_N, :block_K]) + matmul(A1[:block_M, block_N:], A2[block_N:, :block_K])</code>ã€‚å†æŠŠå®ƒæ‰©å±•çš„çµæ´»ä¸€ç‚¹</p>
<ol type="1">
<li>ä¸å±€é™äºåªèƒ½æ‰©å±•ä¸º 2 <span class="math inline">\(\times\)</span> 2
çŸ©é˜µ</li>
<li>block_size å¯ä»¥é’ˆå¯¹ M, N, K è¿›è¡Œè°ƒæ•´</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span></span><br><span class="line"></span><br><span class="line">A1 = torch.rand(size=(M, N))</span><br><span class="line">A2 = torch.rand(size=(N, K))</span><br><span class="line"></span><br><span class="line">block_size_M, block_size_N, block_size_K = <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">block_M, block_N, block_K = M // block_size_M, N // block_size_N, K // block_size_K</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_matmul</span>(<span class="params">sub_A1, sub_A2</span>):</span><br><span class="line">    output = torch.zeros(size=(sub_A1.shape[<span class="number">0</span>], sub_A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(sub_A1.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">0</span>]):</span><br><span class="line">                output[i][j] += sub_A1[i][k] * sub_A2[k][j]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matmul</span>(<span class="params">A1, A2</span>):</span><br><span class="line">    output = torch.zeros(size=(A1.shape[<span class="number">0</span>], A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A1.shape[<span class="number">0</span>], block_M):</span><br><span class="line">        start_i, end_i = i, i + block_M</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A2.shape[<span class="number">1</span>], block_N):</span><br><span class="line">            start_j, end_j = j, j + block_N</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A2.shape[<span class="number">0</span>], block_K):</span><br><span class="line">                start_k, end_k = k, k + block_K</span><br><span class="line">                <span class="comment"># è®¡ç®—æ¯ä¸ª block çš„çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">                sub_A1 = A1[start_i:end_i, start_k:end_k]</span><br><span class="line">                sub_A2 = A2[start_k:end_k, start_j:end_j]</span><br><span class="line">                <span class="comment"># æŠŠæ¯ä¸ª block çš„ç»“æœæ”¾åˆ°å¯¹åº”çš„ä½ç½®</span></span><br><span class="line">                output[start_i:end_i, start_j:end_j] += block_matmul(sub_A1, sub_A2)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"><span class="built_in">print</span>(matmul(A1, A2))</span><br><span class="line"><span class="built_in">print</span>(A1 @ A2)</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(matmul(A1, A2), A1 @ A2)</span><br></pre></td></tr></table></figure>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/pytorch_cuda_ext/tmm-59dd890f48435e692c47919d0df4a5e6.gif" />
From https://penny-xu.github.io/blog/tiled-matrix-multiplication</p>
<p>å†æ¬¡å›é¡¾è¿™æ ·åšçš„ç›®çš„ï¼Œ<a
href="https://penny-xu.github.io/blog/tiled-matrix-multiplication">åŸä½œè€…</a>æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<ul>
<li>With or without tiling, the same number of accesses into global
memory occur. The difference is that, without tiling, each thread must
sequentially (one after the other) access global memory 8 times.</li>
<li>With tiling, we can parallelize the access to global memory so that
each thread only sequentially accesses global memory 4 times.</li>
<li>To summarize, the point is not to reduce the number of
multiplications or even the total number of global memory accesses, but
rather to reduce the number of sequential global memory accesses per
thread. In other words, we better share the heavy load of memory access
across threads.</li>
</ul>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œä½œè€…çš„è§‚ç‚¹æ˜¯é€šè¿‡æ‹†æˆ block
çš„å½¢å¼ï¼Œèƒ½å¤Ÿå¹¶è¡Œçš„è¯»å–å…¨å±€å†…å­˜æ•°æ®ã€‚ä¸ªäººè§‚ç‚¹ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‹†åˆ†åçš„
block å¯ä»¥æ°å¥½æŠŠæ•°æ®æ”¾åˆ°å…±äº«å†…å­˜ä¸­ï¼Œä»¥åŠ é€Ÿè®¡ç®—ï¼Ÿ</p>
<p>æœ€åï¼Œå¯¹äº <code>block size</code>å¤§å°çš„é€‰æ‹©ï¼š</p>
<ul>
<li>è¶Šå¤§çš„
<code>block size</code>è¡¨ç¤ºæ‹†åˆ†åçš„çŸ©é˜µä¸ªæ•°å˜å°‘ï¼Œè¿™æ ·è®¿é—®å…¨å±€å†…å­˜çš„æ¬¡æ•°ä¼šæ›´å¤šã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªçŸ©é˜µæ¯”è¾ƒå¤§ï¼Œè¿™æ ·çº¿ç¨‹çš„å¹¶è¡Œåº¦ä¼šæ›´é«˜ã€‚å³ï¼ŒIOå˜å°ï¼Œè®¡ç®—å˜å¿«ã€‚</li>
<li>è¶Šå°çš„
<code>block size</code>è¡¨ç¤ºæ‹†åˆ†åçš„çŸ©é˜µä¸ªæ•°å˜å¤šï¼Œè¿™æ ·è®¿é—®å…¨å±€å†…å­˜çš„æ¬¡æ•°ä¼šæ›´å°‘ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªçŸ©é˜µæ¯”è¾ƒå°ï¼Œè¿™æ ·çº¿ç¨‹çš„å¹¶è¡Œåº¦ä¼šæ›´ä½ã€‚å³ï¼ŒIOå˜å¤§ï¼Œè®¡ç®—å˜æ…¢ã€‚</li>
</ul>
<h2 id="ç®—å­èåˆ">ç®—å­èåˆ</h2>
<p>ç®—å­èåˆæ˜¯å°†å¤šä¸ªè®¡ç®—æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªè®¡ç®—æ“ä½œï¼Œä»¥å‡å°‘è®¡ç®—é‡å’Œå†…å­˜è®¿é—®æ¬¡æ•°ï¼Œä»è€Œæé«˜è®¡ç®—æ•ˆç‡ã€‚æ¯”å¦‚ï¼ŒçŸ©é˜µä¹˜æ³•å’Œ
softmax çš„èåˆï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡å†…å­˜è®¿é—®ã€‚</p>
<h3 id="softmax-çš„æ”¹é€ ">softmax çš„æ”¹é€ </h3>
<p>softmax çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<p><span class="math display">\[
\text{softmax}(x_i) = \frac{e^{x_i}}{\sum_{j=1}^n e^{x_j}}
\]</span></p>
<p>è€Œé€šå¸¸ä¸ºäº†æ•°å€¼ç¨³å®šæ€§ï¼ˆé¿å…æº¢å‡ºï¼‰ï¼Œä¼šå…ˆè®¡ç®—æœ€å¤§å€¼ï¼Œå†å‡å»æœ€å¤§å€¼ï¼Œæœ€åå†è®¡ç®—
softmaxã€‚å³ï¼š</p>
<p><span class="math display">\[
\text{softmax}(x_i) = \frac{e^{x_i - \max(x)}}{\sum_{j=1}^n e^{x_j -
\max(x)}}
\]</span></p>
<p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå…¶å€¼é€šå¸¸ä¸ºä¸€ä¸ªçŸ©é˜µï¼ˆä¸åªæ˜¯ä¸€ä¸ªç»´åº¦ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¯ä¸€è¡Œè¿›è¡Œ
softmaxã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">X = torch.rand(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_softmax</span>(<span class="params">X, dim=<span class="number">1</span></span>):</span><br><span class="line">    X -= torch.<span class="built_in">max</span>(X, dim=dim, keepdim=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> torch.exp(X) / torch.<span class="built_in">sum</span>(torch.exp(X), dim=dim, keepdim=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.softmax(X, dim=<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(my_softmax(X, dim=<span class="number">1</span>))</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(torch.softmax(X, dim=<span class="number">1</span>), my_softmax(X, dim=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>ä½†è¿™æ ·è·ŸçŸ©é˜µä¹˜æ³•è¿›è¡Œç®—å­èåˆæ˜¯æ²¡æœ‰ä¼˜åŠ¿çš„ï¼Œä¸¤ä¸ªå‡½æ•°è¿˜æ˜¯ç‹¬ç«‹è®¡ç®—çš„ã€‚ç®—å­èåˆæ˜¯éœ€è¦ç³…åˆä¸¤ç§è®¡ç®—æ“ä½œã€‚æ‰€ä»¥ï¼Œéœ€è¦æŠŠ
softmax
å‡½æ•°æ”¾åˆ°çŸ©é˜µä¹˜æ³•ä¸­è¿›è¡Œè®¡ç®—ã€‚å³å°†è®¡ç®—è¿‡ç¨‹å˜æˆä¸€ä¸ªå¯è¿­ä»£çš„è¿‡ç¨‹ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œéšç€å…ƒç´ çš„å¢åŠ ä¸æ–­æ›´æ–°
softmax çš„ç»“æœã€‚</p>
<p><a href="https://arxiv.org/pdf/1805.02867.pdf">Online normalizer
calculation for softmax</a>
æä¾›äº†è¿™ä¹ˆä¸€ç§æ–¹å¼ã€‚ç®€å•èµ·è§ï¼Œä»ä¸€ä¸ªå…ƒç´ å¼€å§‹ä»‹ç»ã€‚ç°åœ¨æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå…ƒç´ 
<code>[1]</code>ï¼Œå…¶ softmax è®¡ç®—è¿‡ç¨‹ä¸ºï¼š</p>
<ol type="1">
<li>exp: è®¡ç®— <span class="math inline">\(e^{1}\)</span>ï¼Œå¾—åˆ° <span
class="math inline">\([e^{1}]\)</span></li>
<li>max: è®¡ç®— <code>max(1)</code>ï¼Œå¾—åˆ° <code>1</code></li>
<li>-max: è®¡ç®— $e^{1 - 1} $ï¼Œå¾—åˆ° <span class="math inline">\([e^{1 - 1}
]\)</span></li>
<li>sum: è®¡ç®— $e^{1- 1} $ çš„å’Œï¼Œå¾—åˆ° $e^{1- 1} $</li>
<li>softmax: è®¡ç®— <span class="math inline">\([e^{1- 1} ] / (e^{1- 1}
)\)</span>ï¼Œå¾—åˆ° <span class="math inline">\([1]\)</span></li>
</ol>
<p>ç°åœ¨å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè§‚å¯Ÿæœ‰å“ªäº›å˜åŒ–ã€‚å‡è®¾å¢åŠ çš„å…ƒç´ ä¸º
2ï¼Œç°åœ¨æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå…ƒç´  <code>[1, 2]</code>ï¼Œæ–°å¢çš„ softmax
è®¡ç®—è¿‡ç¨‹ä¸ºï¼š</p>
<ol type="1">
<li>exp: è®¡ç®— <span class="math inline">\(e^{2}\)</span>ï¼Œå¾—åˆ° <span
class="math inline">\(e^{2}\)</span></li>
<li>max: ä¸åŸæ¥çš„ <code>max(1)=1</code> æ¯”è¾ƒï¼Œå¾—åˆ°
<code>max(1, 2)</code>ï¼Œå¾—åˆ° <code>2</code></li>
<li>-maxï¼šæ‰€æœ‰å…ƒç´ æ›´æ–°ä¸€éï¼Œå‡å‡å»æœ€æ–°çš„ <code>max(1, 2)=2</code>ï¼Œå¾—åˆ°
<span class="math inline">\([e^{1- 2} , e^{2- 2} ]\)</span></li>
<li>sum: é‡æ–°è®¡ç®—ä¸€éç»“æœ</li>
<li>softmax: è®¡ç®— <span class="math inline">\([e^{1- 2}, e^{2 - 2}] /
(e^{1 - 2} + e^{2 - 2})\)</span></li>
</ol>
<p>å¯¹æ¯”å‘ç°ï¼Œç¬¬ 3 æ­¥ä¼šå¯¼è‡´é‡æ–°ç¬¬ 4
æ­¥è®¡ç®—ä¸€éæ±‚å’Œç»“æœï¼Œä½†è¿™ä¸ªæ±‚å’Œç»“æœåœ¨ç¬¬ 5
æ­¥ä¸­ä½œä¸ºåˆ†æ¯æ˜¯å¯ä»¥çµæ´»è°ƒæ•´çš„ã€‚åŸæ¥æ˜¯<span
class="math inline">\(e^{1-1}\)</span>ï¼Œç°åœ¨æ›´æ–°ä¸º<span
class="math inline">\(e^{1-2}+e^{2-2}\)</span>ã€‚å‡è®¾åŸæ¥çš„æœ€å¤§å€¼ä¸º
<code>old_max</code>ï¼Œæ–°çš„æœ€å¤§å€¼ä¸º <code>new_max</code>ï¼ŒåŸæ¥çš„å…ƒç´ ä¸º
<code>old_v</code>ï¼Œåˆ™åŸæ¥å…ƒç´ çš„ <code>exp</code>ç»“æœå¯ä»¥æ›´æ–°ä¸º</p>
<p><span class="math display">\[
e^{old\_v-old\_max} \rightarrow e^{old\_v-old\_max+old\_max-new\_max} =
e^{old\_v-old\_max} \times e^{old\_max-new\_max}
\]</span></p>
<p>è€Œå¯¹äºæ–°åŠ çš„å…ƒç´ ï¼Œåˆ™å¯ä»¥åœ¨æ±‚å’Œéƒ¨åˆ†ç›´æ¥åŠ ä¸Š<span
class="math inline">\(e^{2-2}\)</span>ï¼Œæ‰€ä»¥ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">sum_, max_v = <span class="number">0.</span>, <span class="number">0.</span></span><br><span class="line">norm_v = <span class="number">0.</span></span><br><span class="line"><span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">    old_max_v = max_v</span><br><span class="line">    max_v = <span class="built_in">max</span>(max_v, num)</span><br><span class="line">    norm_v = norm_v*np.exp(old_max_v - max_v) + np.exp(num - max_v)</span><br><span class="line">softmax_nums = [np.exp(num-max_v)/ norm_v <span class="keyword">for</span> num <span class="keyword">in</span> nums] </span><br></pre></td></tr></table></figure>
<p>å¯¹äºä¸¤ä¸ªå…ƒç´ è¿™ä¸ªå…¬å¼æ˜¯é€‚ç”¨çš„ï¼Œé‚£ä¹ˆå¯¹äºå¤šä¸ªå…ƒç´ å‘¢ï¼Ÿç­”æ¡ˆè‡ªç„¶ä¹Ÿæ˜¯åŒæ ·é€‚ç”¨çš„</p>
<p><span class="math display">\[
\begin{aligned}
e^{v1-old\_max}+e^{v2-old\_max} &amp;\rightarrow
e^{v1-new\_max}+e^{v2-new\_max} \\ &amp;=
e^{v1-old\_max+old\_max-new\_max}+e^{v2-old\_max+old\_max-new\_max}
\\  \\ &amp;= e^{v1-old\_max} \times e^{old\_max-new\_max} +
e^{v2-old\_max} \times e^{old\_max-new\_max} \\ &amp;= (e^{v1-old\_max}
- e^{v2-old\_max}) \times e^{old\_max-new\_max}
\end{aligned}
\]</span></p>
<p>æ‰€ä»¥ï¼Œå°†å…¶æ›´æ–°ä¸ºäºŒç»´çŸ©é˜µçš„å½¢å¼ï¼Œå°±æœ‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">X = torch.rand(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">online_softmax</span>(<span class="params">X</span>):</span><br><span class="line">    value = torch.zeros_like(X)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(X.shape[<span class="number">0</span>]):</span><br><span class="line">        row_max = <span class="number">0.0</span></span><br><span class="line">        normalizer_term = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(X.shape[<span class="number">1</span>]):</span><br><span class="line">            val = X[row, col]</span><br><span class="line">            old_row_max = row_max</span><br><span class="line">            row_max = <span class="built_in">max</span>(old_row_max, val)</span><br><span class="line">            normalizer_term = normalizer_term * np.exp(old_row_max - row_max) + np.exp(val - row_max)</span><br><span class="line">        value[row, :] = torch.exp(X[row, :] - row_max) / normalizer_term</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.softmax(X, dim=<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(online_softmax(X))</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(torch.softmax(X, dim=<span class="number">1</span>), online_softmax(X))</span><br></pre></td></tr></table></figure>
<h3 id="softmax-çŸ©é˜µä¹˜æ³•">softmax + çŸ©é˜µä¹˜æ³•</h3>
<p>ä¸€èˆ¬çš„èåˆæ“ä½œæ˜¯éœ€è¦åœ¨çŸ©é˜µä¹˜æ³•åï¼Œè®¡ç®—ç»“æœçš„ softmaxã€‚å³</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span></span><br><span class="line">A1, A2 = torch.rand(size=(M, N)), torch.rand(size=(N, K))</span><br><span class="line">output = torch.softmax(A1 @ A2, dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨ç»“åˆä¸Šé¢çš„å†…å®¹åï¼Œå°†å…¶æ”¹é€ ä¸º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span></span><br><span class="line">A1, A2 = torch.rand(size=(M, N)), torch.rand(size=(N, K))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matmul_softmax</span>(<span class="params">A1, A2</span>):</span><br><span class="line">    output = torch.zeros(size=(A1.shape[<span class="number">0</span>], A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(A1.shape[<span class="number">0</span>]):</span><br><span class="line">        row_max = <span class="number">0.0</span></span><br><span class="line">        normalizer_term = <span class="number">0.0</span>  </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(A2.shape[<span class="number">1</span>]):</span><br><span class="line">            val = output[i, j] = <span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>] * x[<span class="number">1</span>], <span class="built_in">zip</span>(A1[i], A2[:, j])))</span><br><span class="line">          </span><br><span class="line">            old_row_max = row_max</span><br><span class="line">            row_max = <span class="built_in">max</span>(old_row_max, val)</span><br><span class="line">            normalizer_term = normalizer_term * np.exp(old_row_max - row_max) + np.exp(val - row_max)</span><br><span class="line">        output[i, :] = torch.exp(output[i, :] - row_max) / normalizer_term</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.softmax(A1 @ A2, dim=<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(matmul_softmax(A1, A2))</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(torch.softmax(A1 @ A2, dim=<span class="number">1</span>), matmul_softmax(A1, A2))</span><br></pre></td></tr></table></figure>
<p>æ›´è¿›ä¸€æ­¥ï¼Œç»“åˆ Tiled matmulï¼Œå°†å…¶æ”¹é€ ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">M, N, K = <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span></span><br><span class="line">A1, A2 = torch.rand(size=(M, N)), torch.rand(size=(N, K))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_matmul</span>(<span class="params">sub_A1, sub_A2</span>):</span><br><span class="line">    output = torch.zeros(size=(sub_A1.shape[<span class="number">0</span>], sub_A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(sub_A1.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(sub_A2.shape[<span class="number">0</span>]):</span><br><span class="line">                output[i][j] += sub_A1[i][k] * sub_A2[k][j]            </span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tiled_matmul_softmax</span>(<span class="params">A1, A2</span>):</span><br><span class="line">    block_size_M, block_size_N, block_size_K = <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">    block_M, block_N, block_K = M // block_size_M, N // block_size_N, K // block_size_K</span><br><span class="line"></span><br><span class="line">    output = torch.zeros(size=(A1.shape[<span class="number">0</span>], A2.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A1.shape[<span class="number">0</span>], block_M):</span><br><span class="line">        start_i, end_i = i, i + block_M</span><br><span class="line">        row_max = torch.tensor([[<span class="number">0.</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_N)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_M)])</span><br><span class="line">        old_row_max = torch.tensor([[<span class="number">0.</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_N)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_M)])</span><br><span class="line">        normalizer_term = torch.tensor([[<span class="number">0.</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_N)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(block_M)])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A2.shape[<span class="number">1</span>], block_N):</span><br><span class="line">            start_j, end_j = j, j + block_N</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, A2.shape[<span class="number">0</span>], block_K):</span><br><span class="line">                start_k, end_k = k, k + block_K</span><br><span class="line">                sub_A1 = A1[start_i:end_i, start_k:end_k]</span><br><span class="line">                sub_A2 = A2[start_k:end_k, start_j:end_j]</span><br><span class="line">                output[start_i:end_i, start_j:end_j] += block_matmul(sub_A1, sub_A2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¿™é‡Œç®—å®Œäº†æ¯ä¸ªblockçš„ç»“æœï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ‹†åˆ†æˆæ¯ä¸ªblockï¼Œç„¶åå†è®¡ç®—softmax</span></span><br><span class="line">            <span class="keyword">for</span> ii, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">range</span>(start_i, end_i)):            </span><br><span class="line">                <span class="keyword">for</span> jj, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">range</span>(start_j, end_j)):</span><br><span class="line">                    val = output[row][col]</span><br><span class="line">                    old_row_max[ii][jj] = row_max[ii][jj]</span><br><span class="line">                    row_max[ii][jj] = <span class="built_in">max</span>(old_row_max[ii][jj], val)</span><br><span class="line">                    normalizer_term[ii][jj] = normalizer_term[ii][jj] * np.exp(old_row_max[ii][jj] - row_max[ii][jj]) + np.exp(val - row_max[ii][jj])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ii, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">range</span>(start_i, end_i)):</span><br><span class="line">            row_max_v, _ = torch.<span class="built_in">max</span>(row_max, dim=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># é‡ç®— sum, ä»£å…¥å…¬å¼ old_v*exp(old_max - new_max)</span></span><br><span class="line">            sum_ = torch.<span class="built_in">sum</span>(normalizer_term[ii] * torch.exp(row_max[ii] - row_max_v[ii]))</span><br><span class="line">            output[row, :] = torch.exp(output[row, :] - row_max_v[ii]) / sum_</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.softmax(A1 @ A2, dim=<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(tiled_matmul_softmax(A1, A2))</span><br><span class="line"><span class="keyword">assert</span> torch.allclose(torch.softmax(A1 @ A2, dim=<span class="number">1</span>), tiled_matmul_softmax(A1, A2))</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿™é‡Œæ˜¯æ¯æ¬¡è®¡ç®—å‡ºæ¥æ˜¯ä¸€ä¸ª block ï¼Œæ‰€ä»¥è¦æŠŠ block
æ‹†åˆ†å‡ºæ¯ä¸ªå…ƒç´ ï¼Œè®¡ç®— block ä¸­æ¯è¡Œæ¯åˆ—çš„æœ€å¤§å€¼ row_max ä»¥åŠåˆ†æ¯
normalizer_termã€‚</p>
<p>æœ€ååœ¨è®¡ç®— softmax æ—¶ï¼Œè¦è®¡ç®—æ‰€æœ‰ block çš„æœ€å¤§å€¼
<code>torch.max(row_max, dim=1)</code>ï¼Œè¿˜éœ€è¦è®¡ç®—åˆ†æ¯ï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘æ‰€æœ‰çš„
blockï¼Œå¯ä»¥ç±»æ¯”äºåˆå¹¶è®¡ç®— <code>[1, 2]</code>,
<code>[3, 4]</code>ä¸¤ä¸ªåˆ—è¡¨çš„normalizer_term ã€‚å·²çŸ¥å¯¹åº”çš„
normalizer_term <span class="math inline">\(e^{1-2}+e^{2-2}\)</span> å’Œ
<span class="math inline">\(e^{3-4}+e^{3-4}\)</span>ï¼Œåˆå¹¶åçš„ç»“æœåº”å½“æ˜¯
<span
class="math inline">\(e^{1-4}+e^{2-4}+e^{3-4}+e^{3-4}\)</span>ã€‚å°†å…¶å…¬å¼åŒ–å†™ä½œï¼š</p>
<p><span class="math display">\[
\begin{aligned}
\sum_{i=1}^{m} e^{x_i-max(x)} + \sum_{i=1}^{n} e^{y_i-max(y)} &amp;
\rightarrow \sum_{i=1}^{m} e^{x_i-max(x,y)} + \sum_{i=1}^{n}
e^{y_i-max(x,y)} \\ &amp;= \sum_{i=1}^{m}
e^{x_i-max(x)}e^{max(x)-max(x,y)} + \sum_{i=1}^{n}
e^{y_i-max(x,y)}e^{max(y)-max(x,y)}
\end{aligned}
\]</span></p>
<p>å‡è®¾ <code>max(x,y)=max(x)</code>ï¼Œé‚£ä¹ˆå¯¹åº”é¡¹å°†ä¹˜
1ï¼Œè¿™å¹¶ä¸ä¼šå¯¹ç»“æœæœ‰ä»»ä½•å½±å“ã€‚å¯¹åº”çš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum_ = torch.<span class="built_in">sum</span>(normalizer_term[ii] * torch.exp(row_max[ii] - row_max_v[ii]))</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œå®Œæˆäº†çŸ©é˜µä¹˜æ³•å’Œ softmax çš„èåˆã€‚æ¥ä¸‹æ¥ï¼Œä¼šå®ç° cuda
ç‰ˆæœ¬ä»¥å¯¹æ¯”æ€§èƒ½ã€‚</p>
<h3 id="cuda-å®ç°">Cuda å®ç°</h3>
<p>é¦–å…ˆï¼Œæ¥ç€ä¹‹å‰çŸ©é˜µä¹˜æ³•çš„cudaå®ç°ï¼Œ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (row &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>) &amp;&amp; col &lt; input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="type">scalar_t</span> value = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>); ++k) &#123;</span><br><span class="line">        value += input1[row][k] * input2[k][col];</span><br><span class="line">    &#125;</span><br><span class="line">    output[row][col] = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¾ªç¯ä¹‹åï¼Œå·²ç»è®¡ç®—å®Œäº†è¾“å‡ºçŸ©é˜µä¸­çš„ä¸€é¡¹ã€‚éœ€è¦ç»§ç»­ç®—æ¯è¡Œçš„
<code>row_max</code>å’Œ <code>normalizer_term</code>ã€‚ä½†ç”±äºè¿™é‡Œæ˜¯ cuda
ä¸­çš„æŸä¸ª blockï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©å…±äº«å†…å­˜æ¥é€šä¿¡æ¯è¡Œçš„ç»“æœã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å…±äº«å†…å­˜ï¼Œè®¡ç®—æ¯ä¸ª row çš„æœ€å¤§å€¼</span></span><br><span class="line">__shared__ <span class="type">scalar_t</span> row_max[<span class="number">16</span>][<span class="number">16</span>];</span><br><span class="line">__shared__ <span class="type">scalar_t</span> normalizer_term[<span class="number">16</span>][<span class="number">16</span>];</span><br><span class="line">row_max[threadIdx.y][threadIdx.x] = value; <span class="comment">// å…ˆæŠŠè®¡ç®—ç»“æœæ”¾åˆ° row_max ä¸­ï¼Œä»¥ä¾¿äºæ¯”è¾ƒå¤§å°</span></span><br><span class="line">__syncthreads(); <span class="comment">// è¿™è¡Œä»£ç æ˜¯ä¸ºäº†ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½å·²ç»è®¡ç®—å®Œäº†ï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure>
<p>è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š1. æ‰¾åˆ°æ¯è¡Œçš„æœ€å¤§å€¼</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x / <span class="number">2</span>; i &gt; <span class="number">0</span>; i /= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (threadIdx.x &lt; i) &#123;</span><br><span class="line">        row_max[threadIdx.y][threadIdx.x] = <span class="built_in">max</span>(row_max[threadIdx.y][threadIdx.x], row_max[threadIdx.y][threadIdx.x + i]);</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>è®¡ç®—æ¯è¡Œçš„ softmax çš„åˆ†æ¯æ¯é¡¹ç»„æˆ</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">normalizer_term[threadIdx.y][threadIdx.x] = <span class="built_in">exp</span>(value - row_max[threadIdx.y][<span class="number">0</span>]);</span><br><span class="line">__syncthreads();</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>è®¡ç®—æ¯è¡Œçš„ softmax çš„æ¯é¡¹ä¹‹å</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x / <span class="number">2</span>; i &gt; <span class="number">0</span>; i /= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (threadIdx.x &lt; i) &#123;</span><br><span class="line">        normalizer_term[threadIdx.y][threadIdx.x] += normalizer_term[threadIdx.y][threadIdx.x + i];</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€åå°†å…¶æ›´æ–°åˆ°è¾“å‡ºçŸ©é˜µä¸­</span></span><br><span class="line">output[row][col] = <span class="built_in">exp</span>(value - row_max[threadIdx.y][<span class="number">0</span>]) / normalizer_term[threadIdx.y][<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼ˆè¿™é‡Œæ²¡æœ‰å®ç°å®Œæ•´çš„attentionï¼Œä»…ä»…æ˜¯ä¸€ä¸ªçŸ©é˜µä¹˜æ³• +
softmax è®¡ç®—ï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;torch/extension.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda_runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Matrix multiply kernel</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> <span class="type">scalar_t</span>&gt;</span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">matrix_multiply_kernel</span><span class="params">(<span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input1,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input2,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; output)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="type">int</span> col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>) &amp;&amp; col &lt; input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="type">scalar_t</span> value = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>); ++k) &#123;</span><br><span class="line">            value += input1[row][k] * input2[k][col];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨å…±äº«å†…å­˜ï¼Œè®¡ç®—æ¯ä¸ª row çš„æœ€å¤§å€¼</span></span><br><span class="line">        __shared__ <span class="type">scalar_t</span> row_max[<span class="number">16</span>][<span class="number">16</span>];</span><br><span class="line">        __shared__ <span class="type">scalar_t</span> normalizer_term[<span class="number">16</span>][<span class="number">16</span>];</span><br><span class="line">        row_max[threadIdx.y][threadIdx.x] = value;</span><br><span class="line">        __syncthreads();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x / <span class="number">2</span>; i &gt; <span class="number">0</span>; i /= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (threadIdx.x &lt; i) &#123;</span><br><span class="line">                row_max[threadIdx.y][threadIdx.x] = <span class="built_in">max</span>(row_max[threadIdx.y][threadIdx.x], row_max[threadIdx.y][threadIdx.x + i]);</span><br><span class="line">            &#125;</span><br><span class="line">            __syncthreads();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¡ç®—æ¯ä¸ª row çš„ softmax çš„åˆ†æ¯</span></span><br><span class="line">        normalizer_term[threadIdx.y][threadIdx.x] = <span class="built_in">exp</span>(value - row_max[threadIdx.y][<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        __syncthreads();</span><br><span class="line">        <span class="comment">// è®¡ç®—æ¯ä¸ª row  normalizer_termä¹‹å’Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x / <span class="number">2</span>; i &gt; <span class="number">0</span>; i /= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (threadIdx.x &lt; i) &#123;</span><br><span class="line">                normalizer_term[threadIdx.y][threadIdx.x] += normalizer_term[threadIdx.y][threadIdx.x + i];</span><br><span class="line">            &#125;</span><br><span class="line">            __syncthreads();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—æ¯ä¸ª row çš„ softmax</span></span><br><span class="line">        output[row][col] = <span class="built_in">exp</span>(value - row_max[threadIdx.y][<span class="number">0</span>]) / normalizer_term[threadIdx.y][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">torch::Tensor <span class="title">matrix_multiply</span><span class="params">(torch::Tensor input1, torch::Tensor input2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> rows1 = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> cols1 = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> cols2 = input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> options = torch::<span class="built_in">TensorOptions</span>().<span class="built_in">device</span>(input<span class="number">1.</span><span class="built_in">device</span>());</span><br><span class="line">    torch::Tensor output = torch::<span class="built_in">zeros</span>(&#123;rows1, cols2&#125;, options);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">threads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">blocks</span><span class="params">((cols2 + threads.x - <span class="number">1</span>) / threads.x,</span></span></span><br><span class="line"><span class="params"><span class="function">                      (rows1 + threads.y - <span class="number">1</span>) / threads.y)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AT_DISPATCH_FLOATING_TYPES</span>(input<span class="number">1.</span><span class="built_in">scalar_type</span>(), <span class="string">&quot;matrix_multiply_kernel&quot;</span>, ([&amp;] &#123;</span><br><span class="line">        matrix_multiply_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</span><br><span class="line">            input<span class="number">1.</span><span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            input<span class="number">2.</span><span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            output.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">2</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;());</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œå·æ‡’æ²¡æœ‰æ¢åå­—</span></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_cuda_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    torch::Tensor scores = <span class="built_in">matrix_multiply</span>(q, k);</span><br><span class="line">    <span class="keyword">return</span> &#123;scores&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mulsoftmax</span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">seed = <span class="number">42</span></span><br><span class="line">torch.manual_seed(seed)</span><br><span class="line">torch.cuda.manual_seed(seed)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_py_softmax</span>(<span class="params">x, dim</span>):</span><br><span class="line">    e = torch.exp(x)</span><br><span class="line">    s = torch.<span class="built_in">sum</span>(e, dim=dim, keepdim=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> e / s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">py_mulsoft</span>(<span class="params">q, k, v</span>):</span><br><span class="line">    <span class="comment"># print(q@k.T)</span></span><br><span class="line">    <span class="keyword">return</span> torch.softmax(q @ k.T, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_forward</span>(<span class="params">q, k, v</span>):</span><br><span class="line">    baseline_values = py_mulsoft(q, k, v)</span><br><span class="line">    cpp_values = mulsoftmax.forward(q, k, v)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;base o&quot;</span>, baseline_values)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cpp  o&quot;</span>, cpp_values)</span><br><span class="line">    <span class="built_in">print</span>(torch.<span class="built_in">all</span>(torch.isclose(baseline_values, cpp_values)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_time</span>(<span class="params">loop=<span class="number">100</span></span>):</span><br><span class="line">    q, k, v = torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;py&quot;</span>, timeit.timeit(<span class="keyword">lambda</span>: py_mulsoft(q, k, v), number=loop))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cpp&quot;</span>, timeit.timeit(<span class="keyword">lambda</span>: mulsoftmax.forward(q, k, v)[<span class="number">0</span>], number=loop))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    m, n = <span class="number">16</span>, <span class="number">40</span></span><br><span class="line">    device = <span class="string">&quot;cuda&quot;</span></span><br><span class="line">    q, k, v = torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device), torch.rand(size=(m, n), device=device)</span><br><span class="line">    <span class="comment"># å…ˆæ£€æŸ¥ç»“æœæ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    check_forward(q, k, v)</span><br><span class="line">    q, k, v = torch.rand(size=(m, n)), torch.rand(size=(m, n)), torch.rand(size=(m, n))</span><br><span class="line">    <span class="comment"># å¾ªç¯1wæ¬¡ï¼Œå¯¹æ¯”æ€§èƒ½å·®è·</span></span><br><span class="line">    compare_time(<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>py</th>
<th>cuda</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.5136</td>
<td>0.2909</td>
</tr>
<tr>
<td>1</td>
<td>0.6143</td>
<td>0.3322</td>
</tr>
<tr>
<td>2</td>
<td>0.7300</td>
<td>0.3608</td>
</tr>
</tbody>
</table>
<h3 id="å…¶ä»–å®ç°">å…¶ä»–å®ç°</h3>
<h4
id="äºŒç»´çŸ©é˜µè½¬ä¸€ç»´çŸ©é˜µå®ç°çŸ©é˜µä¹˜æ³•">äºŒç»´çŸ©é˜µè½¬ä¸€ç»´çŸ©é˜µï¼Œå®ç°çŸ©é˜µä¹˜æ³•</h4>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œä¼šæŠŠäºŒç»´çŸ©é˜µå±•å¼€ä¸ºä¸€ç»´çŸ©é˜µï¼Œå†è¿›è¡ŒçŸ©é˜µä¹˜æ³•ã€‚è¿™é‡Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†å®ç°äº†
softmax
çš„è®¡ç®—ã€‚å…¶æœ¬è´¨ä¸Šæ˜¯æŠŠäºŒç»´çŸ©é˜µè½¬ä¸ºä¸€ç»´çŸ©é˜µï¼Œå†è¿›è¡ŒçŸ©é˜µä¹˜æ³•ã€‚åŸæ¥çš„<code>input1[row][k]</code>
-&gt; <code>input1[row * K + k]</code>ï¼Œ<code>input2[k][col]</code>
-&gt; <code>input2[k * N + col]</code>ã€‚ä½†è¿™é‡Œæš‚æ—¶ä¸å¥½å®ç° softmax
èåˆï¼Œå› ä¸º softmax
éœ€è¦è®¡ç®—æ¯è¡Œçš„æœ€å¤§å€¼ï¼Œè¿™é‡Œçš„ä¸€ç»´çŸ©é˜µæ— æ³•ç›´æ¥è®¡ç®—æ¯è¡Œçš„æœ€å¤§å€¼ã€‚æ‰€ä»¥è¿™é‡Œå·æ‡’å…ˆä½¿ç”¨åˆ¤æ–­çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯æœ€åä¸€åˆ—ï¼Œåˆ™è®¡ç®—
softmaxã€‚å› æ­¤ï¼Œå¯¼è‡´ç®—çš„é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;torch/extension.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cuda_runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">#DEFINE BLOCK_SIZE <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> <span class="type">scalar_t</span>&gt;</span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">matrix_multiply_vector_kernel</span><span class="params">(<span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input1,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">const</span> torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; input2,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; output,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">const</span> <span class="type">int</span> M, <span class="type">const</span> <span class="type">int</span> N, <span class="type">const</span> <span class="type">int</span> K</span></span></span><br><span class="line"><span class="params"><span class="function">                                       )</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">int</span> row = index / N;</span><br><span class="line">    <span class="type">int</span> col = index % N;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &lt; M &amp;&amp; col &lt; N) &#123;</span><br><span class="line">        <span class="type">float</span> value = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; K; ++k) &#123;</span><br><span class="line">            value += input1[row * K + k] * input2[k * N + col];</span><br><span class="line">        &#125;</span><br><span class="line">        output[row * N + col] = value;</span><br><span class="line">        <span class="keyword">if</span> (col == N - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">float</span> row_max = <span class="number">0.0</span>;</span><br><span class="line">            <span class="type">float</span> normalizer_term = <span class="number">0.0</span>;        </span><br><span class="line">            <span class="type">float</span> old_row_max = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">                old_row_max = row_max;</span><br><span class="line">                row_max = <span class="built_in">max</span>(row_max, output[row * N + i]);</span><br><span class="line">                normalizer_term = normalizer_term * <span class="built_in">exp</span>(old_row_max - row_max) + <span class="built_in">exp</span>(output[row * N + i] - row_max);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">                output[row * N + i] = <span class="built_in">exp</span>(output[row * N + i] - row_max) / normalizer_term;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">matmul_vector</span><span class="params">(torch::Tensor input1, torch::Tensor input2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> M = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> K = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> N = input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> options = torch::<span class="built_in">TensorOptions</span>().<span class="built_in">device</span>(input<span class="number">1.</span><span class="built_in">device</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">threads</span><span class="params">(BLOCK_SIZE)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">blocks</span><span class="params">((M * N + threads.x - <span class="number">1</span>) / threads.x)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reshape input tensors to vectors</span></span><br><span class="line">    <span class="keyword">auto</span> input1_vector = input<span class="number">1.</span><span class="built_in">reshape</span>(&#123;<span class="number">-1</span>&#125;);</span><br><span class="line">    <span class="keyword">auto</span> input2_vector = input<span class="number">2.</span><span class="built_in">reshape</span>(&#123;<span class="number">-1</span>&#125;);    </span><br><span class="line">    torch::Tensor output_vector = torch::<span class="built_in">zeros</span>(&#123;M * N&#125;, options);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AT_DISPATCH_FLOATING_TYPES</span>(input1_vector.<span class="built_in">scalar_type</span>(), <span class="string">&quot;matrix_multiply_vector_kernel&quot;</span>, ([&amp;] &#123;</span><br><span class="line">        matrix_multiply_vector_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</span><br><span class="line">            input1_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            input2_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            output_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            M, N, K</span><br><span class="line">        );</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">return</span> &#123;output_vector.<span class="built_in">reshape</span>(&#123;M, N&#125;), output_vector.<span class="built_in">reshape</span>(&#123;M, N&#125;)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;torch::Tensor&gt; <span class="title">attention_cuda_forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor q,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor k,</span></span></span><br><span class="line"><span class="params"><span class="function">    torch::Tensor v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">matmul_vector</span>(q, k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>py</th>
<th>cuda</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.4239</td>
<td>0.4907</td>
</tr>
<tr>
<td>1</td>
<td>0.5069</td>
<td>0.4388</td>
</tr>
<tr>
<td>2</td>
<td>0.5462</td>
<td>0.5799</td>
</tr>
</tbody>
</table>
<p>å°½ç®¡ç”¨äº†ä¸€ç§æ¯”è¾ƒç¬¨çš„æ–¹æ³•ï¼Œä½†æ˜¯é€Ÿåº¦å®é™…ä¸Šä¸åŸç”Ÿçš„ pytorch
ç›¸å·®æ— å‡ ã€‚</p>
<h4 id="å•ç‹¬å®ç°-softmax">å•ç‹¬å®ç° softmax</h4>
<p>ç›¸è¾ƒäºéç®—å­èåˆçš„å†™æ³•ï¼Œè¿™é‡Œå®ç°äº†ä¸€ç»´çŸ©é˜µçš„
softmaxã€‚ç›¸å½“äºåœ¨è®¡ç®—çŸ©é˜µä¹˜æ³•åå†ç®— softmaxã€‚æ¯”è¾ƒæœ´ç´ çš„å†™æ³•ã€‚ã€‚ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> <span class="type">scalar_t</span>&gt;</span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">softmax_kernel</span><span class="params">(torch::PackedTensorAccessor&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt; output,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="type">const</span> <span class="type">int</span> M, <span class="type">const</span> <span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">int</span> row = index / N;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row &lt; M) &#123;</span><br><span class="line">        <span class="type">float</span> row_max = <span class="number">0.0</span>;</span><br><span class="line">        <span class="type">float</span> normalizer_term = <span class="number">0.0</span>;        </span><br><span class="line">        <span class="type">float</span> old_row_max = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            old_row_max = row_max;</span><br><span class="line">            row_max = <span class="built_in">max</span>(row_max, output[row * N + i]);</span><br><span class="line">            normalizer_term = normalizer_term * <span class="built_in">exp</span>(old_row_max - row_max) + <span class="built_in">exp</span>(output[row * N + i] - row_max);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            output[row * N + i] = <span class="built_in">exp</span>(output[row * N + i] - row_max) / normalizer_term;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">torch::Tensor <span class="title">matrix_softmax_vector_softmax</span><span class="params">(torch::Tensor input1, torch::Tensor input2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> M = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> K = input<span class="number">1.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> N = input<span class="number">2.</span><span class="built_in">size</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> options = torch::<span class="built_in">TensorOptions</span>().<span class="built_in">device</span>(input<span class="number">1.</span><span class="built_in">device</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">threads</span><span class="params">(BLOCK_SIZE_VECTOR)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> dim3 <span class="title">blocks</span><span class="params">((M * N + threads.x - <span class="number">1</span>) / threads.x)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reshape input tensors to vectors</span></span><br><span class="line">    <span class="keyword">auto</span> input1_vector = input<span class="number">1.</span><span class="built_in">reshape</span>(&#123;<span class="number">-1</span>&#125;);</span><br><span class="line">    <span class="keyword">auto</span> input2_vector = input<span class="number">2.</span><span class="built_in">reshape</span>(&#123;<span class="number">-1</span>&#125;);    </span><br><span class="line">    torch::Tensor output_vector = torch::<span class="built_in">zeros</span>(&#123;M * N&#125;, options);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ™®é€šä¸€ç»´çš„çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">    <span class="built_in">AT_DISPATCH_FLOATING_TYPES</span>(input1_vector.<span class="built_in">scalar_type</span>(), <span class="string">&quot;matrix_multiply_vector_softmax_kernel&quot;</span>, ([&amp;] &#123;</span><br><span class="line">        matrix_multiply_vector_softmax_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</span><br><span class="line">            input1_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            input2_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            output_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            M, N, K</span><br><span class="line">        );</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cudaDeviceSynchronize</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AT_DISPATCH_FLOATING_TYPES</span>(output_vector.<span class="built_in">scalar_type</span>(), <span class="string">&quot;softmax_kernel&quot;</span>, ([&amp;] &#123;</span><br><span class="line">        softmax_kernel&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(</span><br><span class="line">            output_vector.<span class="built_in">packed_accessor</span>&lt;<span class="type">scalar_t</span>,<span class="number">1</span>,torch::RestrictPtrTraits,<span class="type">size_t</span>&gt;(),</span><br><span class="line">            M, N</span><br><span class="line">        );</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">return</span> output_vector.<span class="built_in">reshape</span>(&#123;M, N&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>py</th>
<th>cuda</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.4239</td>
<td>1.1874</td>
</tr>
<tr>
<td>1</td>
<td>0.5069</td>
<td>1.1101</td>
</tr>
<tr>
<td>2</td>
<td>0.5462</td>
<td>1.3238</td>
</tr>
</tbody>
</table>
<p>å¯¹æ¯”å‘ç°ï¼Œè¿™é‡Œçš„cudaè¿˜æ˜¯ä¼šæ¯”pytorchçš„æ…¢ä¸€äº›ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰ç”¨è‡ªå¸¦çš„softmaxï¼Œä¸”æ²¡æœ‰ä½¿ç”¨ç®—å­èåˆã€‚æ‰€ä»¥å°±ç®—é€Ÿåº¦ä¼šæ›´æ…¢ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p>[1] <a
href="https://pytorch.org/tutorials/advanced/cpp_extension.html">https://pytorch.org/tutorials/advanced/cpp_extension.html</a>ã€‚</p>
<p>[2] <a
href="https://github.com/ELS-RD/kernl/blob/main/tutorial/1%20-%20tiled%20matmul.ipynb">Tiled
matmul</a></p>
<p>[3] <a
href="https://github.com/ELS-RD/kernl/blob/main/tutorial/3%20-%20online%20softmax.ipynb">Online
softmax</a></p>
<p>[4] <a href="https://arxiv.org/pdf/1805.02867.pdf">Online normalizer
calculation for softmax</a></p>
]]></content>
      <categories>
        <category>DeepLearning</category>
      </categories>
      <tags>
        <tag>CUDA</tag>
        <tag>PyTorch</tag>
        <tag>Cpp</tag>
      </tags>
  </entry>
  <entry>
    <title>äº¤å‰ç†µçš„åå‘ä¼ æ’­ Step by Stepï¼ˆPyTorchï¼‰</title>
    <url>/hexo_blog/2023/09/03/PyTorch/%E4%BA%A4%E5%8F%89%E7%86%B5%E7%9A%84%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%20Step%20by%20Step/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»å…¬å¼å¼€å§‹ï¼Œä¸€æ­¥æ­¥ç”¨PyTorchå®ç°è‡ªå®šä¹‰çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œæœ€åç†è§£åˆ†å¸ƒå¼æŸå¤±å‡½æ•°</p>
<span id="more"></span>
<h2 id="step-1a-simple-case">Step 1ï¼šA Simple Case</h2>
<p>ä»¥äº¤å‰ç†µä¸ºä¾‹ï¼Œæ™®é€šçš„äºŒåˆ†ç±»é—®é¢˜ <span class="math display">\[
\text {Binary Cross Entropy} = -\left (y \log (\hat {y}) + (1-y) \log
(1-\hat {y})\right)
\]</span> æ›´å¸¸è§çš„å¤šåˆ†ç±»é—®é¢˜ <span class="math display">\[
\text {Multiclass Cross Entropy} = -\sum_{c=0}^{C} y_c \log (\hat {y}_c)
\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(y\)</span>
è¡¨ç¤ºçœŸå®çš„æ ‡ç­¾å€¼ï¼ˆé€šå¸¸æ˜¯one-hotå‘é‡ï¼‰ï¼Œ<span
class="math inline">\(\hat{y}\)</span> è¡¨ç¤ºæ¨¡å‹çš„è¾“å‡ºï¼Œ<span
class="math inline">\(C\)</span> è¡¨ç¤ºæœ‰å¤šå°‘ç±»åˆ«éœ€è¦åˆ†ç±»</p>
<p>åœ¨ PyTorch ä¸­è°ƒç”¨ï¼ˆæœ¬æ–‡ä½¿ç”¨çš„torch version==2.0.0ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">criterion = torch.nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line">outputs = torch.tensor([[<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>]])   <span class="comment"># \hat&#123;y&#125; Shape: bs, C</span></span><br><span class="line">targets = torch.tensor([<span class="number">0</span>])                 <span class="comment"># y       Shape: bs</span></span><br><span class="line"></span><br><span class="line">loss = criterion(outputs, targets)</span><br><span class="line"><span class="comment"># tensor(0.9398)</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>outputs</code>æ˜¯æ¨¡å‹çš„è¾“å‡ºï¼Œ<code>targets</code>æ˜¯çœŸå®çš„æ ‡ç­¾å€¼</p>
<h2 id="step-2-æ‰‹å†™">Step 2: æ‰‹å†™</h2>
<p>å®ç°<code>CrossEntropyLoss</code>éœ€è¦ä¸¤ä¸ªæ¡ä»¶</p>
<ol type="1">
<li>ä½¿ç”¨ PyTorch å†™å‡ºæŸå¤±å‡½æ•°çš„å…¬å¼ï¼Œä»¥åŠå¯¹åº”çš„å¯¼æ•°</li>
<li>æ ¹æ®å…¬å¼è®¡ç®—lossï¼Œå¹¶è®¡ç®—æ¢¯åº¦ï¼ˆgradï¼‰è¿›è¡Œåå‘ä¼ æ’­</li>
</ol>
<h3 id="å…¬å¼">å…¬å¼</h3>
<p>ä»<span class="math inline">\(-\sum_{c=0}^{C} y_c \log (\hat
{y}_c)\)</span>å‡ºå‘</p>
<ol type="1">
<li>ç”±äºæ¨¡å‹è¾“å‡ºå¹¶ä¸æ˜¯å•çº¯çš„æ¦‚ç‡å€¼ï¼Œå› æ­¤ä¼šå¯¹æ¨¡å‹è¾“å‡ºè¿›è¡Œ<code>softmax</code>è®¡ç®—ï¼Œå¾—åˆ°<span
class="math inline">\(\hat{y}\)</span> <span
class="math display">\[\text {softmax}(x_i) = \frac
{e^{x_i}}{\sum_{j=1}^n e^{x_j}}\]</span></li>
<li>å†ä»¥ç®€å•çš„å•åˆ†ç±»ä»»åŠ¡æ¥è¯´ï¼Œ
<ol type="1">
<li><span class="math inline">\(y\)</span> = [1, 0, 0], <span
class="math inline">\(\hat{y}\)</span> = [0.5, 0.2, 0.3] -&gt; log(<span
class="math inline">\(\hat{y}\)</span>)=[-0.9398, -1.2398, -1.1398]</li>
<li>è®¡ç®—æ—¶ï¼Œåªæœ‰c=0æ—¶ï¼Œç»“æœæœ‰å€¼ï¼ˆ-0.9398ï¼‰ï¼Œå…¶ä»–ç±»åˆ«æ—¶ä¸º0ï¼Œæ— éœ€è®¡ç®—</li>
<li>å› æ­¤ï¼Œå®é™…æœ€ç»ˆç»“æœå°±æ˜¯å–å‡ºå¯¹åº”ç±»åˆ«çš„ <span
class="math inline">\(\hat{y}\)</span> çš„logå€¼</li>
</ol></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">MyCrossEntropyLoss</span>(<span class="params">outputs, targets</span>):</span><br><span class="line">    <span class="comment"># outputs.shape: bs, C</span></span><br><span class="line">    <span class="comment"># targets.shape: bs</span></span><br><span class="line">    bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">    outputs = torch.softmax(outputs, dim=<span class="number">1</span>)  <span class="comment"># å¯¹é¢„æµ‹ç»“æœè¿›è¡Œsoftmaxæ“ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨ç´¢å¼•é€‰æ‹©å¯¹åº”ç±»åˆ«çš„æ¦‚ç‡å€¼ï¼Œå¹¶ä½¿ç”¨è´Ÿå¯¹æ•°å‡½æ•°è®¡ç®—æŸå¤±</span></span><br><span class="line">    loss = -torch.log(outputs[<span class="built_in">range</span>(bs), targets]) <span class="comment"># å¯¹æ¯ä¸ªè®¡ç®—å–å¯¹åº”çš„target</span></span><br><span class="line">    <span class="keyword">return</span> loss.mean() <span class="comment"># æœ€ç»ˆè¿”å›ç»“æœçš„å¹³å‡å€¼</span></span><br><span class="line"></span><br><span class="line">outputs = torch.tensor([[<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>]])	<span class="comment"># \hat&#123;y&#125; Shape: bs, C</span></span><br><span class="line">targets = torch.tensor([<span class="number">0</span>])	</span><br><span class="line"></span><br><span class="line">loss = MyCrossEntropyLoss(outputs, targets)</span><br><span class="line"><span class="comment"># tensor(0.9398)</span></span><br></pre></td></tr></table></figure>
<h4 id="æ¢¯åº¦">æ¢¯åº¦</h4>
<ol type="1">
<li><p>ç»“åˆå‰é¢çš„è®¡ç®—ï¼Œæ¯æ¬¡è®¡ç®—lossæ—¶ï¼Œå®é™…ä¸Šåªæœ‰å¯¹åº”ç±»åˆ«çš„è®¡ç®—æ˜¯æœ‰æ•ˆçš„ï¼Œå› æ­¤å°†å…¶ç®€åŒ–ä¸º<span
class="math inline">\(-y_c\log(\hat{y}_c)\)</span>ï¼Œè€Œç”±äº<span
class="math inline">\(y_c=1\)</span>ï¼Œæ‰€ä»¥å…¶å®åªæœ‰<span
class="math inline">\(-\log(\hat{y}_c)\)</span></p></li>
<li><p>è¿™ä¸ªå…¬å¼åªéœ€è¦è®¡ç®—logçš„å¯¼æ•°ã€‚å¯¹äº<span
class="math inline">\(f(x)=\log(x)\)</span>ï¼Œå…¶å¯¼æ•°<span
class="math inline">\(f^{&#39;}(x)=\frac{1}{x}\)</span>ã€‚</p></li>
<li><p>å› æ­¤ï¼Œè¿™é‡Œçš„æ¢¯åº¦å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­ï¼Œ<span
class="math inline">\(y_c=1\)</span> <span class="math display">\[
\frac {\partial \text {CrossEntropy}(y, \hat {y})}{\partial \hat {y}_c}
= -\frac {y_c}{\hat {y}_c}=-\frac{1}{\hat{y}_c}
\]</span></p></li>
<li><p>è€Œå¯¹äºæ¨¡å‹çš„è¾“å‡ºè€Œè¨€ï¼Œè¿˜æœ‰ä¸€ä¸ªSoftMaxè®¡ç®—ã€‚SoftMaxçš„æ¢¯åº¦æœ‰</p>
<ol type="1">
<li>å½“ <span class="math inline">\(i = j\)</span> æ—¶ï¼š</li>
</ol>
<p><span class="math display">\[
\frac {\partial y_i}{\partial x_i} = \frac {e^{x_i}\left (\sum_{k=1}^n
e^{x_k}\right) - e^{x_i} e^{x_i}}{\left (\sum_{k=1}^n e^{x_k}\right)^2}
= y_i (1-y_i)
\]</span></p>
<ol start="2" type="1">
<li>å½“ <span class="math inline">\(i \neq j\)</span> æ—¶ï¼š</li>
</ol>
<p><span class="math display">\[
\frac {\partial y_i}{\partial x_j} = -\frac {e^{x_j} e^{x_i}}{\left
(\sum_{k=1}^n e^{x_k}\right)^2} = -y_i y_j
\]</span></p></li>
<li><p>ç”±äºæ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼Œå› æ­¤å°†SoftMaxçš„å¯¼æ•°ä¹˜ä»¥äº¤å‰ç†µçš„å¯¼æ•°ï¼Œå°±èƒ½å¾—åˆ°æ¨¡å‹è¾“å‡ºçš„æ¢¯åº¦ã€‚ç»¼ä¸Šï¼Œå¯¹äºæ¨¡å‹çš„è¾“å‡ºï¼Œäº¤å‰ç†µçš„æ¢¯åº¦ä»…åœ¨ç›®æ ‡æ ‡ç­¾ä¸Šæœ‰æ•ˆï¼ˆâ‰ 0ï¼‰ï¼Œæ‰€ä»¥æœ€åçš„æ¢¯åº¦è®¡ç®—ä¸ºï¼Œ</p></li>
</ol>
<p><span class="math display">\[-\frac{1}{\hat{y}_c}\times
y_c(1-y_c)=y_c-1\]</span></p>
<h3 id="autograd">autograd</h3>
<p>åœ¨PyTorchå†…éƒ¨æœ‰ä¸€å¥—å®Œå–„çš„æ±‚å¯¼æœºåˆ¶ã€‚å› æ­¤ï¼Œä»…éœ€æŒ‰ç…§å…¶è§„åˆ™è¿›è¡Œä¹¦å†™å³å¯å®ç°å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ï¼ˆé“¾å¼æ±‚å¯¼ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨forwardå¡«å†™lossçš„è®¡ç®—ï¼Œbackwardä¸­å¡«å†™gradçš„è®¡ç®—å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrossEntropyLoss</span>(torch.autograd.Function):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, outputs, targets</span>):</span><br><span class="line">        <span class="comment"># outputsï¼šæ¨¡å‹çš„è¾“å‡º</span></span><br><span class="line">        <span class="comment"># targets: çœŸå®æ ‡ç­¾</span></span><br><span class="line">        ...</span><br><span class="line">        ctx.save_for_backward(...) <span class="comment"># éœ€è¦åœ¨åå‘ä¼ æ’­ä¸­ä½¿ç”¨çš„å˜é‡</span></span><br><span class="line">        <span class="keyword">return</span> loss</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output</span>):</span><br><span class="line">        <span class="comment"># grad_output: åå‘ä¼ æ’­çš„æ¢¯åº¦</span></span><br><span class="line">        ... = ctx.saved_tensors</span><br><span class="line">        ...</span><br><span class="line">	    <span class="keyword">return</span> new_grad_output</span><br></pre></td></tr></table></figure>
<h4 id="forward">Forward</h4>
<p>è¿™é‡ŒåŸºæœ¬å°±æ˜¯æŠŠå…¬å¼ç…§æŠ„è¿‡æ¥ï¼Œä½†éœ€è¦é¢å¤–æŠŠæ¢¯åº¦è®¡ç®—æ—¶ç”¨åˆ°çš„å˜é‡å­˜ä¸€ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, outputs, targets</span>):</span><br><span class="line">    bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">    outputs = torch.softmax(outputs, dim=<span class="number">1</span>)  </span><br><span class="line"></span><br><span class="line">    loss = -torch.log(outputs[<span class="built_in">range</span>(bs), targets]) </span><br><span class="line">    ctx.save_for_backward(outputs, targets)</span><br><span class="line">    <span class="keyword">return</span> loss.mean()</span><br></pre></td></tr></table></figure>
<h4 id="backward">Backward</h4>
<p>è¿™é‡Œçš„<code>grad_output</code>
è¡¨ç¤ºæ¢¯åº¦è®¡ç®—çš„è¾“å‡ºã€‚å®ƒæ˜¯ä¸€ä¸ªä¸å‰å‘ä¼ æ’­å‡½æ•°çš„è¾“å‡ºå½¢çŠ¶ç›¸åŒçš„å¼ é‡ã€‚åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¡ç®—å½“å‰å‡½æ•°çš„å¯¼æ•°ï¼Œä¹˜ä»¥
<code>grad_output</code>
ä½œä¸ºè¾“å…¥ã€‚è¿™ä¸ªå€¼ä»£è¡¨äº†åç»­èŠ‚ç‚¹å¯¹å½“å‰èŠ‚ç‚¹çš„æ¢¯åº¦è´¡çŒ®ã€‚</p>
<p>é€šè¿‡å°† <code>grad_output</code>
ä¹˜ä»¥å¯¼æ•°ï¼ˆä¹Ÿç§°ä¸ºé›…å¯æ¯”å‘é‡ç§¯ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¼ é€’æ¢¯åº¦ä¿¡æ¯åˆ°è¾ƒæ—©çš„èŠ‚ç‚¹ï¼Œä»è€Œå®ç°è‡ªåŠ¨å¾®åˆ†ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>grad_output</code>
çš„å½¢çŠ¶å¿…é¡»ä¸å‡½æ•°çš„è¾“å‡ºå½¢çŠ¶ä¸€è‡´ï¼Œå¦åˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output</span>):</span><br><span class="line">    outputs, targets = ctx.saved_tensors</span><br><span class="line">    bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    grad_y_pred = outputs.clone()</span><br><span class="line">    grad_y_pred[<span class="built_in">range</span>(bs), targets] -= <span class="number">1</span>  <span class="comment"># è®¡ç®—å¯¹åº”ç±»åˆ«çš„æ¢¯åº¦</span></span><br><span class="line">    grad_y_pred /= bs <span class="comment"># å–å‡å€¼</span></span><br><span class="line">    </span><br><span class="line">    grad_y_pred *= grad_output.item()  <span class="comment"># ä¹˜ä»¥å…³äºlossçš„æ¢¯åº¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> grad_y_pred, <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="å®Œæ•´ç‰ˆ">å®Œæ•´ç‰ˆ</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCrossEntropyLossFunction</span>(torch.autograd.Function):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, outputs, targets</span>):</span><br><span class="line">        bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">        outputs = torch.softmax(outputs, dim=<span class="number">1</span>)  </span><br><span class="line"></span><br><span class="line">        loss = -torch.log(outputs[<span class="built_in">range</span>(bs), targets]) </span><br><span class="line">        ctx.save_for_backward(outputs, targets)</span><br><span class="line">        <span class="keyword">return</span> loss.mean()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output</span>):</span><br><span class="line">        outputs, targets = ctx.saved_tensors</span><br><span class="line">        bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        grad_y_pred = outputs.clone()</span><br><span class="line">        grad_y_pred[<span class="built_in">range</span>(bs), targets] -= <span class="number">1</span>  <span class="comment"># åªéœ€è®¡ç®—å¯¹åº”æ ‡ç­¾çš„æ¢¯åº¦</span></span><br><span class="line">        </span><br><span class="line">        grad_y_pred /= bs <span class="comment"># å–å‡å€¼</span></span><br><span class="line">        </span><br><span class="line">        grad_y_pred *= grad_output.item()  <span class="comment"># ä¹˜ä»¥å…³äºlossçš„æ¢¯åº¦</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> grad_y_pred, <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MyCrossEntropyLoss</span>(<span class="params">outputs, targets</span>):</span><br><span class="line">    <span class="keyword">return</span> MyCrossEntropyLossFunction.apply(outputs, targets)</span><br><span class="line"></span><br><span class="line">outputs = torch.tensor([[<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>]], requires_grad=<span class="literal">True</span>)</span><br><span class="line">targets = torch.tensor([<span class="number">0</span>])</span><br><span class="line">loss = MyCrossEntropyLoss(outputs, targets)</span><br><span class="line"><span class="comment"># tensor(0.9398, grad_fn=&lt;MyCrossEntropyLossFunctionBackward&gt;)</span></span><br></pre></td></tr></table></figure>
<p>ç»“åˆç®€å•çš„åŒå±‚MLP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.l1 = torch.nn.Linear(<span class="number">5</span>, <span class="number">5</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.l2 = torch.nn.Linear(<span class="number">5</span>, <span class="number">3</span>, bias=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.l2(<span class="variable language_">self</span>.l1(x))</span><br><span class="line">    </span><br><span class="line">input_ = torch.rand((<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">labels = torch.randint(<span class="number">0</span>, <span class="number">3</span>, size=(<span class="number">5</span>,))</span><br><span class="line">model1 = MLP()</span><br><span class="line">model2 = copy.deepcopy(model1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>, <span class="string">&quot;Before Train&quot;</span>, <span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(model1.l1.weight)</span><br><span class="line"><span class="built_in">print</span>(model2.l1.weight)</span><br><span class="line"></span><br><span class="line">criterion1 = torch.nn.CrossEntropyLoss()</span><br><span class="line">criterion2 = MyCrossEntropyLoss</span><br><span class="line"></span><br><span class="line">optim1 = torch.optim.Adam(model1.parameters(), lr=<span class="number">1e-2</span>)</span><br><span class="line">optim2 = torch.optim.Adam(model2.parameters(), lr=<span class="number">1e-2</span>)</span><br><span class="line"></span><br><span class="line">outputs1 = model1(copy.deepcopy(input_))</span><br><span class="line">loss1 = criterion1(outputs1, labels)</span><br><span class="line">optim1.zero_grad()</span><br><span class="line">loss1.backward()</span><br><span class="line">optim1.step()</span><br><span class="line"></span><br><span class="line">outputs2 = model2(copy.deepcopy(input_))</span><br><span class="line">loss2 = criterion2(outputs2, labels)</span><br><span class="line">optim2.zero_grad()</span><br><span class="line">loss2.backward()</span><br><span class="line">optim2.step()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>, <span class="string">&quot;After Train&quot;</span>, <span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(model1.l1.weight)</span><br><span class="line"><span class="built_in">print</span>(model2.l1.weight)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="step-3-åˆ†å¸ƒå¼">Step 3: åˆ†å¸ƒå¼</h2>
<p>æ¨¡å‹è®­ç»ƒé€Ÿåº¦æå‡+å•å¡æ”¾ä¸ä¸‹å¤§æ¨¡å‹ï¼Œç”±äºè¿™ä¸¤ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼è®¡ç®—ä¸­éœ€è¦é‡å†™æŸå¤±å‡½æ•°çš„forwardå’Œbackwardï¼Œä»¥Megatron-LMçš„è®­ç»ƒä»£ç ä¸ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ¥ä¸‹æ¥å°†é€æ­¥æ‹†è§£å®ç°è¿‡ç¨‹ï¼ˆå¿½ç•¥label_smoothingï¼Œå°†å…¶çœ‹ä½œ0.0ï¼‰ã€‚</p>
<p><a
href="https://github.com/NVIDIA/Megatron-LM/blob/main/megatron/core/tensor_parallel/cross_entropy.py">cross_entropy.py</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Copyright (c) 2022, NVIDIA CORPORATION. All rights reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> megatron.core.parallel_state <span class="keyword">import</span> (</span><br><span class="line">    get_tensor_model_parallel_group,</span><br><span class="line">    get_tensor_model_parallel_rank,</span><br><span class="line">    get_tensor_model_parallel_world_size,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .utils <span class="keyword">import</span> VocabUtility</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_VocabParallelCrossEntropy</span>(torch.autograd.Function):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, vocab_parallel_logits, target, label_smoothing=<span class="number">0.0</span></span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Maximum value along vocab dimension across all GPUs.</span></span><br><span class="line">        logits_max = torch.<span class="built_in">max</span>(vocab_parallel_logits, dim=-<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">        torch.distributed.all_reduce(</span><br><span class="line">            logits_max, op=torch.distributed.ReduceOp.MAX, group=get_tensor_model_parallel_group()</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># Subtract the maximum value.</span></span><br><span class="line">        vocab_parallel_logits = vocab_parallel_logits - logits_max.unsqueeze(dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get the partition&#x27;s vocab indecies</span></span><br><span class="line">        get_vocab_range = VocabUtility.vocab_range_from_per_partition_vocab_size</span><br><span class="line">        partition_vocab_size = vocab_parallel_logits.size()[-<span class="number">1</span>]</span><br><span class="line">        rank = get_tensor_model_parallel_rank()</span><br><span class="line">        world_size = get_tensor_model_parallel_world_size()</span><br><span class="line">        vocab_start_index, vocab_end_index = get_vocab_range(partition_vocab_size, rank, world_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a mask of valid vocab ids (1 means it needs to be masked).</span></span><br><span class="line">        target_mask = (target &lt; vocab_start_index) | (target &gt;= vocab_end_index)</span><br><span class="line">        masked_target = target.clone() - vocab_start_index</span><br><span class="line">        masked_target[target_mask] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get predicted-logits = logits[target].</span></span><br><span class="line">        <span class="comment"># For Simplicity, we convert logits to a 2-D tensor with size</span></span><br><span class="line">        <span class="comment"># [*, partition-vocab-size] and target to a 1-D tensor of size [*].</span></span><br><span class="line">        logits_2d = vocab_parallel_logits.view(-<span class="number">1</span>, partition_vocab_size)</span><br><span class="line">        masked_target_1d = masked_target.view(-<span class="number">1</span>)</span><br><span class="line">        arange_1d = torch.arange(start=<span class="number">0</span>, end=logits_2d.size()[<span class="number">0</span>], device=logits_2d.device)</span><br><span class="line">        predicted_logits_1d = logits_2d[arange_1d, masked_target_1d]</span><br><span class="line">        predicted_logits_1d = predicted_logits_1d.clone().contiguous()</span><br><span class="line">        predicted_logits = predicted_logits_1d.view_as(target)</span><br><span class="line">        predicted_logits[target_mask] = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># All reduce is needed to get the chunks from other GPUs.</span></span><br><span class="line">        torch.distributed.all_reduce(</span><br><span class="line">            predicted_logits,</span><br><span class="line">            op=torch.distributed.ReduceOp.SUM,</span><br><span class="line">            group=get_tensor_model_parallel_group(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sum of exponential of logits along vocab dimension across all GPUs.</span></span><br><span class="line">        exp_logits = vocab_parallel_logits</span><br><span class="line">        torch.exp(vocab_parallel_logits, out=exp_logits)</span><br><span class="line">        sum_exp_logits = exp_logits.<span class="built_in">sum</span>(dim=-<span class="number">1</span>)</span><br><span class="line">        torch.distributed.all_reduce(</span><br><span class="line">            sum_exp_logits,</span><br><span class="line">            op=torch.distributed.ReduceOp.SUM,</span><br><span class="line">            group=get_tensor_model_parallel_group(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Loss = log(sum(exp(logits))) - predicted-logit.</span></span><br><span class="line">        loss = torch.log(sum_exp_logits) - predicted_logits</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Normalize and optionally smooth logits</span></span><br><span class="line">        exp_logits.div_(sum_exp_logits.unsqueeze(dim=-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        vocab_size = exp_logits.size(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> label_smoothing &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            We&#x27;d like to assign 1 / (K - 1) probability mass to every index that is not the ground truth.</span></span><br><span class="line"><span class="string">            = (1 - alpha) * y_gt + alpha * mean(y_&#123;i for i != gt&#125;)</span></span><br><span class="line"><span class="string">            = (1 - alpha) * y_gt + (alpha / (K - 1)) * \sum_&#123;i != gt&#125; y_i</span></span><br><span class="line"><span class="string">            = ((K - 1) * (1 - alpha) / (K - 1)) * y_gt + (alpha / (K - 1)) * \sum_&#123;i != gt&#125; y_i</span></span><br><span class="line"><span class="string">            = (K * (1 - alpha) - 1) / (K - 1)) * y_gt  + (alpha / (K - 1)) * \sum_&#123;i&#125; y_i</span></span><br><span class="line"><span class="string">            = (1 - (alpha * K) / (K - 1)) * y_gt + ( (alpha * K) / (K - 1) ) * \sum_&#123;i&#125; y_i / K</span></span><br><span class="line"><span class="string">            From: https://github.com/NVIDIA/NeMo/blob/main/nemo/collections/common/losses/smoothed_cross_entropy.py</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">assert</span> <span class="number">1.0</span> &gt; label_smoothing &gt; <span class="number">0.0</span></span><br><span class="line">            smoothing = label_smoothing * vocab_size / (vocab_size - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Exp logits at this point are normalized probabilities. So we can just take the log to get log-probs.</span></span><br><span class="line">            log_probs = torch.log(exp_logits)</span><br><span class="line">            mean_log_probs = log_probs.mean(dim=-<span class="number">1</span>)</span><br><span class="line">            loss = (<span class="number">1.0</span> - smoothing) * loss - smoothing * mean_log_probs</span><br><span class="line"></span><br><span class="line">        ctx.label_smoothing, ctx.vocab_size = label_smoothing, vocab_size</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Store softmax, target-mask and masked-target for backward pass.</span></span><br><span class="line">        ctx.save_for_backward(exp_logits, target_mask, masked_target_1d)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Retreive tensors from the forward path.</span></span><br><span class="line">        softmax, target_mask, masked_target_1d = ctx.saved_tensors</span><br><span class="line">        label_smoothing, vocab_size = ctx.label_smoothing, ctx.vocab_size</span><br><span class="line"></span><br><span class="line">        <span class="comment"># All the inputs have softmax as thier gradient.</span></span><br><span class="line">        grad_input = softmax</span><br><span class="line">        <span class="comment"># For simplicity, work with the 2D gradient.</span></span><br><span class="line">        partition_vocab_size = softmax.size()[-<span class="number">1</span>]</span><br><span class="line">        grad_2d = grad_input.view(-<span class="number">1</span>, partition_vocab_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add the gradient from matching classes.</span></span><br><span class="line">        arange_1d = torch.arange(start=<span class="number">0</span>, end=grad_2d.size()[<span class="number">0</span>], device=grad_2d.device)</span><br><span class="line"></span><br><span class="line">        softmax_update = <span class="number">1.0</span> - target_mask.view(-<span class="number">1</span>).<span class="built_in">float</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> label_smoothing &gt; <span class="number">0</span>:</span><br><span class="line">            smoothing = label_smoothing * vocab_size / (vocab_size - <span class="number">1</span>)</span><br><span class="line">            grad_2d[arange_1d, masked_target_1d] -= (<span class="number">1.0</span> - smoothing) * softmax_update</span><br><span class="line">            average_grad = <span class="number">1</span> / vocab_size</span><br><span class="line">            grad_2d[arange_1d, :] -= smoothing * average_grad</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            grad_2d[arange_1d, masked_target_1d] -= softmax_update</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Finally elementwise multiplication with the output gradients.</span></span><br><span class="line">        grad_input.mul_(grad_output.unsqueeze(dim=-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> grad_input, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vocab_parallel_cross_entropy</span>(<span class="params">vocab_parallel_logits, target, label_smoothing=<span class="number">0.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Performs cross entropy loss when logits are split across tensor parallel ranks</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Arguments:</span></span><br><span class="line"><span class="string">        vocab_parallel_logits: logits split across tensor parallel ranks</span></span><br><span class="line"><span class="string">                               dimension is [sequence_length, batch_size, hidden_size]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        target: correct vocab ids of dimseion [sequence_length, micro_batch_size]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        lobal_smoothing: smoothing factor, must be in range [0.0, 1.0)</span></span><br><span class="line"><span class="string">                         default is no smoothing (=0.0)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> _VocabParallelCrossEntropy.apply(vocab_parallel_logits, target, label_smoothing)</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆ">ä¸ºä»€ä¹ˆ</h3>
<p>æœ¬æ–‡ä¸ä»‹ç»åˆ†å¸ƒå¼è®­ç»ƒçš„å…¶ä»–åŸç†ï¼Œä»…å…³æ³¨æ¨¡å‹æœ€åçš„è¾“å‡ºï¼Œä»¥åŠæŸå¤±å‡½æ•°çš„è®¡ç®—ã€‚</p>
<p>å‰æ–‡å·²ç»è¯¦ç»†ä»‹ç»äº†äº¤å‰ç†µçš„å®ç°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåˆ°åˆ†å¸ƒå¼è®­ç»ƒçš„æ—¶å€™ï¼Œå°±ä¸èƒ½ç›´æ¥å¤ç”¨å‘¢ï¼Ÿä¸»è¦åŸå› åœ¨äºæ¨¡å‹çš„è¾“å‡ºè¢«æ‹†æ•£äº†ã€‚å›é¡¾æ¨¡å‹çš„è¾“å‡ºï¼Œå…¶shapeä¸º[<code>bs</code>,
<code>C</code>]ï¼Œ<code>bs</code>è¡¨ç¤ºæ¯æ¬¡è®­ç»ƒçš„æ•°æ®é‡<code>batch size</code>ï¼Œ<code>C</code>è¡¨ç¤ºä»»åŠ¡çš„æ€»çš„åˆ†ç±»æ•°é‡ï¼Œåœ¨LLMä¸­ä¸»è¦æ˜¯è¯è¡¨å¤§å°<code>vocab_size</code>ï¼ˆä¸‹æ–‡ç”¨æ­¤ä»£è¡¨ç±»åˆ«æ•°é‡ï¼‰ã€‚</p>
<p>å¯¹äºæ¨¡å‹çš„è¾“å‡ºè€Œè¨€ï¼Œåˆ†å¸ƒå¼ï¼ˆå‡è®¾æœ‰<code>word_size</code>å¼ GPUï¼‰ä¸»è¦åˆ†ä¸¤ç§æƒ…å†µ
1.
æ‹†åˆ†<code>bs</code>ï¼Œæ¯å¼ å¡ä¸Šæœ‰<code>bs</code>æ•°æ®é‡ï¼Œé‚£ä¹ˆæ•´åˆæ¨¡å‹çš„æœ€åè¾“å‡ºåº”ä¸º[<code>bs</code>
* <code>word_size</code>, <code>vocab_size</code>] 2.
æ‹†åˆ†<code>vocab_size</code>ï¼Œå•ä¸ªæ¨¡å‹çš„è¾“å‡ºä¸º[<code>bs</code>,
<code>vocab_size</code> //
<code>word_size</code>]ã€‚è¿™ç§æƒ…å†µéœ€è¦ä¿è¯<code>vocab_size</code>èƒ½å¤Ÿæ•´é™¤<code>word_size</code></p>
<p>å› æ­¤ï¼Œåœ¨è¿›è¡Œlossè®¡ç®—å‰ï¼Œéœ€è¦å…ˆåŒæ­¥æ‰€æœ‰çš„æ¨¡å‹è¾“å‡ºï¼Œç„¶åå†è¿›è¡Œlossè®¡ç®—ã€‚è¿™é‡Œçš„åŒæ­¥ï¼Œå°±æ˜¯ä»æ‰€æœ‰GPUä¸­è·å–æ¨¡å‹çš„è¾“å‡ºã€‚ä½†è€ƒè™‘åˆ°é€šä¿¡å¼€é”€é—®é¢˜ï¼Œæœ‰äº›æ“ä½œæ˜¯å¯ä»¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå³æ— éœ€é€šä¿¡å…¨éƒ¨å†…å®¹å†è®¡ç®—ã€‚é‡æ–°æ€è€ƒæŸå¤±çš„è®¡ç®—è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ol type="1">
<li>SoftMaxè®¡ç®—ï¼š<span class="math inline">\(\exp(x) /
\sum(\exp(x)\)</span></li>
<li>logçš„è®¡ç®—ï¼š <span class="math inline">\(-\log[\exp(x) /
\sum(\exp(x)]\)</span></li>
<li>ç´¢å¼•ï¼šæ ¹æ®targetsç´¢å¼•çŸ©é˜µå¯¹åº”ä½ç½® <span class="math inline">\(x[...,
...]\)</span></li>
</ol>
<p>å…¶ä¸­ï¼Œå‰ä¸¤è€…è·Ÿæœ€åä¸€ä¸ªæ­¥éª¤æ˜¯å¯ä»¥ç‹¬ç«‹è¿è¡Œçš„ã€‚è€Œå‰ä¸¤è€…çš„è®¡ç®—æ˜¯è€¦åˆçš„ï¼Œä¸ºèŠ‚çº¦é€šä¿¡é‡ï¼Œå¯¹logè®¡ç®—è¿›è¡Œå˜åŒ–</p>
<ol type="1">
<li><span class="math inline">\(-\log[\exp(x) /
\sum(\exp(x)]\)</span></li>
<li><span class="math inline">\(-\log[\exp(x)] +
\log[\sum\exp(x)]\)</span></li>
<li><span class="math inline">\(\log[\sum\exp(x)] - x\)</span></li>
</ol>
<p>å› æ­¤ï¼Œå¯ä»¥ç”±åŸå§‹çš„<code>func1</code>æ¨å¯¼è‡³åˆ†å¸ƒå¼çš„<code>func2</code>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>(<span class="params">outputs, targets</span>):</span><br><span class="line">    <span class="comment"># åŸå§‹ç‰ˆæœ¬</span></span><br><span class="line">    bs = outputs.size(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># Step 0:</span></span><br><span class="line">    predicted_logits = outputs[<span class="built_in">range</span>(bs), targets]</span><br><span class="line"></span><br><span class="line">    predicted_logits = torch.softmax(predicted_logits, dim=<span class="number">1</span>)</span><br><span class="line">    loss = -torch.log(predicted_logits)</span><br><span class="line">    <span class="built_in">print</span>(loss)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">outputs, targets</span>):</span><br><span class="line">    <span class="comment"># åˆ†å¸ƒå¼çš„ç®€åŒ–ç‰ˆæœ¬</span></span><br><span class="line">    bs = outputs.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    min_c, max_c = <span class="number">0</span>, <span class="number">3</span> <span class="comment"># é¢„å…ˆè®¾å®šçš„æœ€å°å’Œæœ€å¤§å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åªé€‰æ‹©åœ¨è¯¥è®¾å¤‡ä¸Šçš„æ•°å€¼</span></span><br><span class="line">    target_mask = (targets &lt; min_c) | (targets &gt;= max_c)</span><br><span class="line">    <span class="comment"># ç”±äºåœ¨åˆ†å¸ƒå¼ä¸­min_cä¸ä¸€å®šä¸º0ï¼Œæ‰€ä»¥éœ€è¦åšä¸€ä¸ªå½’ä¸€åŒ–</span></span><br><span class="line">    masked_target = targets.clone() - min_c</span><br><span class="line">    masked_target[target_mask] = min_c</span><br><span class="line"></span><br><span class="line">    <span class="comment"># arange_1d, masked_target åˆ†åˆ«å¯¹åº” ä¸Šæ–‡çš„range(bs), targets</span></span><br><span class="line">    arange_1d = torch.arange(start=<span class="number">0</span>, end=bs)</span><br><span class="line">    predicted_logits = outputs[arange_1d, masked_target]</span><br><span class="line">    </span><br><span class="line">    predicted_logits = predicted_logits.clone().contiguous()</span><br><span class="line">    <span class="comment"># å¯¹äºéè¯¥è®¾å¤‡ä¸Šè®¡ç®—çš„å€¼ï¼Œç½®ä¸º0ã€‚åˆ™ä¸è¿›è¡Œè®¡ç®—</span></span><br><span class="line">    predicted_logits[target_mask] = <span class="number">0.0</span></span><br><span class="line">    <span class="comment"># å…ˆç®—ç¬¬äºŒé¡¹</span></span><br><span class="line">    predicted_logits = torch.<span class="built_in">sum</span>(predicted_logits, dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    loss = torch.log(torch.exp(outputs).<span class="built_in">sum</span>(dim=-<span class="number">1</span>)) - predicted_logits</span><br><span class="line">    <span class="built_in">print</span>(loss)</span><br><span class="line"></span><br><span class="line">outputs = torch.tensor([[<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>]])</span><br><span class="line">targets = torch.tensor([<span class="number">0</span>])    </span><br><span class="line"></span><br><span class="line">func1(outputs, targets)</span><br><span class="line">func2(outputs, targets)</span><br></pre></td></tr></table></figure></p>
<h3 id="forward-1">Forward</h3>
<h4 id="é¢„å¤„ç†">é¢„å¤„ç†</h4>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸ºäº†æ•°å€¼ç¨³å®šæ€§ï¼ŒSoftMaxè®¡ç®—å‰ä¼šå‡å»æœ€å¤§å€¼ï¼Œå³</p>
<p><span class="math display">\[\text {softmax}(x_i) = \frac
{e^{x_i}}{\sum_{j=1}^n e^{x_j}} = \frac {e^{x_i - \max(x)}}{\sum_{j=1}^n
e^{x_j - \max(x)}}\]</span></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¯å¼ å¡ä¸Šçš„æ¨¡å‹è¾“å‡ºä¸º vocab_parallel_logitsï¼Œshapeï¼š[bs, seq_len, vocab_size // word_size]</span></span><br><span class="line"><span class="comment"># SoftMaxçš„å‰ç½®è®¡ç®—ï¼Œå¯ä»¥æ— éœ€é€šä¿¡å…¨éƒ¨å‚æ•°ï¼Œåˆ†ä¸¤æ­¥è¿›è¡Œ</span></span><br><span class="line"><span class="comment"># 1. è®¡ç®—æ¯å¼ å¡çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment"># 2. å†è®¡ç®—æ‰€æœ‰å¡çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment"># 3. æœ€åå¯¹æ¯å¡å¼ å‡å»æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment"># è¿™æ ·å°±èƒ½é¿å…é€šä¿¡æ‰€æœ‰çš„å‚æ•°</span></span><br><span class="line">logits_max = torch.<span class="built_in">max</span>(vocab_parallel_logits, dim=-<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">torch.distributed.all_reduce(</span><br><span class="line">    logits_max, op=torch.distributed.ReduceOp.MAX, group=get_tensor_model_parallel_group()</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Subtract the maximum value.</span></span><br><span class="line">vocab_parallel_logits = vocab_parallel_logits - logits_max.unsqueeze(dim=-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>seq_len</code>æ˜¯LLMä¸­å¥å­çš„é•¿åº¦ï¼Œå¥å­çš„æ¯ä¸ªä½ç½®ï¼ˆtokenï¼‰ä¼šè®¡ç®—ä¸‹ä¸€ä¸ªtokençš„æ¦‚ç‡ï¼ˆåœ¨è¯è¡¨ä¸­é€‰ï¼‰ï¼Œå› æ­¤ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªä½ç½®éƒ½æ˜¯ä¸€ä¸ªåˆ†ç±»ä»»åŠ¡ï¼Œå› æ­¤<code>vocab_size</code>å°±æ˜¯åˆ†ç±»çš„æ•°é‡ã€‚å³ï¼Œå¯ä»¥è½¬æ¢ä¸º[<code>bs</code>*<code>seq_len</code>,
<code>vocab_size</code> // <code>word_size</code>]çš„å½¢å¼</p>
<p>ç”±äºå•å¡ä¸ä¸€å®šå­˜åœ¨æ‰€æœ‰è¯è¡¨çš„å€¼ï¼Œå› æ­¤éœ€è¦åœ¨è¿™å¼ å¡ä¸Šå°†éè¯¥å¡è¾“å‡ºä½ç½®çš„å€¼ç½®ä¸º0ã€‚
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Get the partition&#x27;s vocab indecies</span></span><br><span class="line">get_vocab_range = VocabUtility.vocab_range_from_per_partition_vocab_size</span><br><span class="line">partition_vocab_size = vocab_parallel_logits.size()[-<span class="number">1</span>]</span><br><span class="line">rank = get_tensor_model_parallel_rank()</span><br><span class="line">world_size = get_tensor_model_parallel_world_size()</span><br><span class="line">vocab_start_index, vocab_end_index = get_vocab_range(partition_vocab_size, rank, world_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a mask of valid vocab ids (1 means it needs to be masked).</span></span><br><span class="line">target_mask = (target &lt; vocab_start_index) | (target &gt;= vocab_end_index)</span><br><span class="line">masked_target = target.clone() - vocab_start_index</span><br><span class="line">masked_target[target_mask] = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h4 id="æ ¹æ®-targets-é€‰æ‹©æ¨¡å‹çœŸå®è¾“å‡ºçš„logits">æ ¹æ® targets
é€‰æ‹©æ¨¡å‹çœŸå®è¾“å‡ºçš„Logits</h4>
<p>å°†æ¨¡å‹çš„è¾“å‡ºå’Œæ ‡ç­¾ è½¬æ¢ä¸º[<code>bs</code>*<code>seq_len</code>,
<code>vocab_size</code> // <code>word_size</code>]çš„å½¢å¼ï¼Œä»¥ä¾¿äºè®¡ç®—
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logits_2d = vocab_parallel_logits.view(-<span class="number">1</span>, partition_vocab_size)</span><br><span class="line">masked_target_1d = masked_target.view(-<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©çœŸå®æ ‡ç­¾çš„logitsï¼Œç›¸å½“äºåŸæ¥çš„outputs[range(bs), targets]</span></span><br><span class="line"><span class="comment"># ç›¸å½“äºæŠŠæ­¤æ­¥éª¤ç½®å‰ï¼Œè€Œå¯¹äºåç»­è®¡ç®—æ— å½±å“ï¼Œå¹¶å‡å°‘äº†åç»­çš„é€šä¿¡æ—¶é—´</span></span><br><span class="line">arange_1d = torch.arange(start=<span class="number">0</span>, end=logits_2d.size()[<span class="number">0</span>], device=logits_2d.device)</span><br><span class="line">predicted_logits_1d = logits_2d[arange_1d, masked_target_1d]</span><br><span class="line">predicted_logits_1d = predicted_logits_1d.clone().contiguous()</span><br></pre></td></tr></table></figure></p>
<h4 id="è®¡ç®—loss">è®¡ç®—loss</h4>
<p>å°†logitsè½¬æ¢ä¸ºåŸæ¥çš„shapeï¼Œå†æ±‚å’Œï¼Œå…ˆå¾—åˆ°äº†æœ€åçš„ç¬¬ä¸€é¡¹ï¼Œä¹‹åå†å‡å»log
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">predicted_logits = predicted_logits_1d.view_as(target)</span><br><span class="line">predicted_logits[target_mask] = <span class="number">0.0</span></span><br><span class="line"><span class="comment"># All reduce is needed to get the chunks from other GPUs.</span></span><br><span class="line">torch.distributed.all_reduce(</span><br><span class="line">    predicted_logits,</span><br><span class="line">    op=torch.distributed.ReduceOp.SUM,</span><br><span class="line">    group=get_tensor_model_parallel_group(),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>è®¡ç®—SoftMax <span class="math display">\[\text {softmax}(x_i) = \frac
{e^{x_i}}{\sum_{j=1}^n e^{x_j}}\]</span></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">exp_logits = vocab_parallel_logits</span><br><span class="line"><span class="comment"># è®¡ç®—æ¯å¼ å¡çš„expï¼Œä½œä¸ºåˆ†å­</span></span><br><span class="line">torch.exp(vocab_parallel_logits, out=exp_logits)</span><br><span class="line"><span class="comment"># å†è®¡ç®—è¿™å¼ å¡ä¸Šçš„expä¹‹å’Œ</span></span><br><span class="line">sum_exp_logits = exp_logits.<span class="built_in">sum</span>(dim=-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å†è®¡ç®—æ‰€æœ‰å¡çš„expä¹‹å’Œï¼Œä½œä¸ºåˆ†æ¯</span></span><br><span class="line">torch.distributed.all_reduce(</span><br><span class="line">    sum_exp_logits,</span><br><span class="line">    op=torch.distributed.ReduceOp.SUM,</span><br><span class="line">    group=get_tensor_model_parallel_group(),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è®¡ç®—loss <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€é¡¹æ˜¯log(sum(exp(logits)))ï¼Œç¬¬äºŒé¡¹æ˜¯æœ€åçš„logits</span></span><br><span class="line">loss = torch.log(sum_exp_logits) - predicted_logits</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†Backwardï¼Œéœ€è¦ä¿å­˜ä¸€äº›å˜é‡</span></span><br><span class="line">exp_logits.div_(sum_exp_logits.unsqueeze(dim=-<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<h3 id="backward-1">Backward</h3>
<h4 id="é¢„å¤„ç†-1">é¢„å¤„ç†</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">softmax, target_mask, masked_target_1d = ctx.saved_tensors</span><br><span class="line">label_smoothing, vocab_size = ctx.label_smoothing, ctx.vocab_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®SoftMaxè®¡ç®—çš„ç»“æœï¼Œå¿½ç•¥æ— éœ€è®¡ç®—æ¢¯åº¦çš„ä½ç½®ã€‚target_maskä¸­çš„å…ƒç´ ä¸æ˜¯0å°±æ˜¯1</span></span><br><span class="line">grad_input = softmax</span><br><span class="line"><span class="comment"># For simplicity, work with the 2D gradient.</span></span><br><span class="line">partition_vocab_size = softmax.size()[-<span class="number">1</span>]</span><br><span class="line">grad_2d = grad_input.view(-<span class="number">1</span>, partition_vocab_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the gradient from matching classes.</span></span><br><span class="line">arange_1d = torch.arange(start=<span class="number">0</span>, end=grad_2d.size()[<span class="number">0</span>], device=grad_2d.device)</span><br><span class="line"></span><br><span class="line">softmax_update = <span class="number">1.0</span> - target_mask.view(-<span class="number">1</span>).<span class="built_in">float</span>()</span><br></pre></td></tr></table></figure>
<h4 id="æ¢¯åº¦è®¡ç®—">æ¢¯åº¦è®¡ç®—</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£å¸¸è®¡ç®—ä½ç½®ï¼Œå°±-1ï¼Œå¦åˆ™å°†ä¸å‡ï¼ˆå³ä¸åšè®¡ç®—ï¼‰</span></span><br><span class="line">grad_2d[arange_1d, masked_target_1d] -= softmax_update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åä¹˜ä¸Šå…³äºlossçš„æ¢¯åº¦</span></span><br><span class="line">grad_input.mul_(grad_output.unsqueeze(dim=-<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>PyTorch</tag>
        <tag>æ•°å­¦</tag>
        <tag>äº¤å‰ç†µ</tag>
      </tags>
  </entry>
  <entry>
    <title>torchä¸­çš„scheduler</title>
    <url>/hexo_blog/2021/02/03/PyTorch/torch-scheduler%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>PyTorchå­¦ä¹ ç‡è°ƒæ•´è¿‡ç¨‹ä¸­ç‰ˆæœ¬é—®é¢˜å¼•å‘çš„ä¸åŒç»“æœè§£æ</p>
<span id="more"></span>
<p>ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">optimizer1 = torch.optim.SGD([torch.randn(<span class="number">1</span>, requires_grad=<span class="literal">True</span>)], lr=<span class="number">1e-3</span>)</span><br><span class="line">exp_lr_scheduler1 = torch.optim.lr_scheduler.MultiStepLR(optimizer1,</span><br><span class="line">                                             milestones=[<span class="number">5</span>, <span class="number">10</span>], gamma=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">optimizer2 = torch.optim.SGD([torch.randn(<span class="number">1</span>, requires_grad=<span class="literal">True</span>)], lr=<span class="number">1e-3</span>)</span><br><span class="line">exp_lr_scheduler2 = torch.optim.lr_scheduler.MultiStepLR(optimizer2,</span><br><span class="line">                                             milestones=[<span class="number">5</span>, <span class="number">10</span>], gamma=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">15</span>):</span><br><span class="line">    exp_lr_scheduler1.step()</span><br><span class="line">    exp_lr_scheduler2.step(epoch)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Epoch &#123;&#125;, lr1 &#123;&#125;, lr2 &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(epoch,</span><br><span class="line">        optimizer1.param_groups[<span class="number">0</span>][<span class="string">&#x27;lr&#x27;</span>],</span><br><span class="line">        optimizer2.param_groups[<span class="number">0</span>][<span class="string">&#x27;lr&#x27;</span>]))</span><br></pre></td></tr></table></figure>
<p>å½“torchç‰ˆæœ¬ä¸º1.2.0æ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Epoch <span class="number">1</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">0.001</span></span><br><span class="line">Epoch <span class="number">2</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">0.001</span></span><br><span class="line">Epoch <span class="number">3</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">0.001</span></span><br><span class="line">Epoch <span class="number">4</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">0.001</span></span><br><span class="line">Epoch <span class="number">5</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">0.0001</span></span><br><span class="line">Epoch <span class="number">6</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">0.0001</span></span><br><span class="line">Epoch <span class="number">7</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">0.0001</span></span><br><span class="line">Epoch <span class="number">8</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">0.0001</span></span><br><span class="line">Epoch <span class="number">9</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">0.0001</span></span><br><span class="line">Epoch <span class="number">10</span>, lr1 <span class="number">1.0000000000000003e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">11</span>, lr1 <span class="number">1.0000000000000003e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">12</span>, lr1 <span class="number">1.0000000000000003e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">13</span>, lr1 <span class="number">1.0000000000000003e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">14</span>, lr1 <span class="number">1.0000000000000003e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br></pre></td></tr></table></figure>
<p>å½“torchç‰ˆæœ¬ä¸º1.4.0æ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Epoch <span class="number">1</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">2</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">3</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">4</span>, lr1 <span class="number">0.001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">5</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">6</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">7</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">8</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">9</span>, lr1 <span class="number">0.0001</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">10</span>, lr1 <span class="number">1e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">11</span>, lr1 <span class="number">1e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">12</span>, lr1 <span class="number">1e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">13</span>, lr1 <span class="number">1e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br><span class="line">Epoch <span class="number">14</span>, lr1 <span class="number">1e-05</span>, lr2 <span class="number">1.0000000000000003e-05</span></span><br></pre></td></tr></table></figure>
<p>å°ç»“ï¼š<code>scheduler.step()</code>ä¸­çš„
<code>epoch</code>å‚æ•°ç”±äºç‰ˆæœ¬é—®é¢˜ä¼šå¸¦æ¥ä¸åŒçš„ä½œç”¨æ•ˆæœã€‚1.2.0ç‰ˆæœ¬æ˜¯åˆ¤æ–­epochæ˜¯å¦åœ¨æŸä¸ªåŒºé—´å†…ï¼Œè€Œ1.4.0ç‰ˆæœ¬æ˜¯ä¼šç›´æ¥è°ƒæ•´å­¦ä¹ åˆ°è¾¾æœ€åä¸€ä¸ªåŒºé—´ã€‚</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>PyTorch</tag>
        <tag>scheduler</tag>
      </tags>
  </entry>
  <entry>
    <title>Birthday in Piï¼šæŸ¥æ‰¾æ—¥æœŸåœ¨Piä¸­çš„ä½ç½®</title>
    <url>/hexo_blog/2021/03/18/Python/Birthday_in_Pi/</url>
    <content><![CDATA[<p>æƒ³çŸ¥é“è‡ªå·±çš„ç”Ÿæ—¥åœ¨åœ†å‘¨ç‡Ï€çš„ç¬¬å‡ ä½å‡ºç°å—ï¼Ÿæœ¬æ–‡ä»‹ç»äº†ä»æ€è·¯åˆ°å®ç°æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œè¯¦ç»†åˆ†æäº†å¦‚ä½•ä½¿ç”¨è¿­ä»£å™¨ä¼˜åŒ–æ€§èƒ½ï¼Œå¹¶æ”¹ç”¨Pythonè¯­è¨€å®ç°äº†ç±»ä¼¼â€œ
é”â€å†…å­˜ç­‰æ“ä½œã€‚æœ€ç»ˆï¼Œå°†å‡½æ•°æ‰“åŒ…æˆäº†exeç¨‹åºï¼Œåœ¨å…¬ä¼—å·å†…æä¾›æŸ¥è¯¢æœåŠ¡ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªä¸æ–­æ›´æ–°çš„ç”Ÿæ—¥ä¸ä½ç½®çš„æŸ¥è¡¨ã€‚</p>
<span id="more"></span>
<p>å®Œæ•´çš„é¡¹ç›®ä»£ç å‡å¼€æº: <a
href="https://github.com/wnma3mz/birthday_in_pi">https://github.com/wnma3mz/birthday_in_pi</a></p>
<h2 id="æƒ³æ³•">æƒ³æ³•</h2>
<p>äºæˆ‘è€Œè¨€ï¼Œå¾ˆå¤šé¡¹ç›®çš„å‡ºå‘ç‚¹éƒ½æ˜¯æºäºæµè§ˆä¸œè¥¿æ—¶æ‰€æƒ³ï¼Œè§‰å¾—æœ‰æ„æ€å°±å»å®ç°ã€‚æ¯”å¦‚è¿™æ¬¡æ˜¯åœ¨å³åˆ»ä¸Šçœ‹åˆ°åŒ—å¤§æ•°é™¢å…¬ä¼—å·ï¼Œå¯ä»¥å›å¤ç”Ÿæ—¥ï¼ˆå¦‚20000101ï¼‰å°±å¯ä»¥çŸ¥é“è¿™ä¸²æ•°å­—åœ¨Piçš„ç¬¬å¤šå°‘ä½å‡ºç°ã€‚æ›´è¯¦ç»†çš„ä¾‹å­ï¼šå·²çŸ¥3.1415926...ï¼Œé‚£ä¹ˆ1415å°±æ˜¯å‡ºç°åœ¨ç¬¬1ä½ï¼ˆä»1å¼€å§‹è®¡æ•°ï¼Œå°æ•°ç‚¹åå¼€å§‹è®¡æ•°ï¼‰ã€‚ä½†è¯¥å…¬ä¼—å·ä»…åœ¨Piçš„2äº¿ä½æ•°ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰€ä»¥æœ‰å³å‹å›å¤ï¼Œæœä¸åˆ°ç»“æœã€‚æ•…æƒ³åˆ°å¯ä»¥è¯•è¯•æ›´é•¿çš„æ•°æ®é›†æ˜¯å¦èƒ½å¤Ÿæœåˆ°ã€‚</p>
<p><strong>èƒŒæ™¯çŸ¥è¯†</strong></p>
<p>ç†è®ºä¸Šï¼ŒPié‡Œé¢å¯ä»¥æŸ¥æ‰¾æ‰€æœ‰äººçš„ç”µè¯å·ç ã€ç”Ÿæ—¥ã€é“¶è¡Œå¡å¯†ç ç­‰ç­‰ã€‚</p>
<h2 id="è¡ŒåŠ¨">è¡ŒåŠ¨</h2>
<h3 id="æ•°æ®">æ•°æ®</h3>
<p>å·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œè¿™é‡Œæœ€é‡è¦çš„å°±æ˜¯Piè¿™ä¸ªæ— ç†æ•°æ•°æ®ã€‚</p>
<ol type="1">
<li>æ˜¯å¦æœ‰ç°æˆçš„æ•°æ®æ–‡æœ¬-&gt;æ²¡æœåˆ°ï¼Œæœåˆ°çš„ä½æ•°éƒ½å¾ˆå°ï¼Œä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚</li>
<li>è®¡ç®—Piï¼ˆç”Ÿæˆè¶…è¿‡2äº¿æ•°çš„æ–‡æœ¬ï¼‰
<ol type="1">
<li>è‡ªå·±æ‰‹å†™</li>
<li>æ‰¾ç¨‹åºã€‚å¯¹äºè®¡ç®—Piçš„é¡¹ç›®ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªç§‘å­¦é—®é¢˜ï¼Œæ•…ä¸€å®šæœ‰ç°æœ‰ç¨‹åºå¯ä»¥è¾…åŠ©å®Œæˆã€‚æ‰€ä»¥æ‰¾åˆ°äº†<a
href="http://www.numberworld.org/y-cruncher/">y-cruncher</a>é¡¹ç›®ã€‚å…·ä½“æ˜¯å¦ä¸ºå½“å‰æœ€å¿«çš„ç”Ÿæˆç¨‹åºï¼Œæœªæ·±ç©¶ï¼Œä¸è¿‡å®é™…æµ‹è¯•ï¼Œæ•ˆç‡å·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚ï¼ˆç”¨i5-1035G1çš„CPUï¼Œç”Ÿæˆ25äº¿æ•°ï¼Œ8ä¸ªçº¿ç¨‹è®¡ç®—ç”¨äº†10åˆ†é’Ÿä¸åˆ°ï¼Œæ–‡æœ¬å¤§å°2.4Gï¼‰</li>
</ol></li>
</ol>
<h3 id="ç¼–ç ">ç¼–ç </h3>
<p>è¯¥é—®é¢˜æœ¬èº«ç®€å•æ¥çœ‹å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æŸ¥æ‰¾é—®é¢˜ï¼Œæ‰€ä»¥ç”¨Pythonçš„è¯ï¼Œ<code>find</code>å‡½æ•°å¯ä»¥ç›´æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ä½†ä¸€æ—¦é—®é¢˜å˜"å¤§"ï¼ˆæ•°æ®é›†å˜å¤§ã€æœºå™¨å˜å¤š......ï¼‰ï¼Œå°±æ˜¯ä¸€ä¸ª"éš¾"é¢˜äº†ã€‚</p>
<p>å½“ç„¶ï¼Œå…ˆä¸ç®¡å¦‚ä½•ï¼Œè¯•è¯•æœ€ç²—æš´çš„è§£æ³•çœ‹çœ‹æ€§èƒ½å¦‚ä½•ã€‚æ ¹æ®æµ‹è¯•ç»“æœï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œæ—¶é—´è¶…è¿‡5s,
å†…å­˜å ç”¨2Gï¼ˆæ–‡æœ¬å¤§å°2Gï¼‰ã€‚å°±ç®—æ—¶é—´å¯ä»¥æ¥å—ï¼Œé‚£ä¹ˆè¿™ä¸ªç©ºé—´å ç”¨ä¹Ÿå¾ˆéš¾æ¥å—ã€‚è¯•æƒ³ï¼Œæ¯æŸ¥è¯¢ä¸€æ¬¡éƒ½éœ€è¦å ç”¨2Gå†…å­˜ï¼ŒæŸ¥è¯¢å®Œå†é‡Šæ”¾ã€‚æ‰€ä»¥ç›´æ¥æƒ³åˆ°çš„ä¼˜åŒ–ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª</p>
<ol type="1">
<li>"é”"å†…å­˜ï¼Œå³æ¯æ¬¡æŸ¥è¯¢å®Œä¸é‡Šæ”¾è¿™ä¸ªå†…å­˜ï¼Œè¿™æ ·IOæ—¶é—´å°±å¯ä»¥å¤§å¤§å‡å°</li>
<li>"åšè¡¨"ï¼ŒæŸ¥è¯¢çš„ç”Ÿæ—¥æ•°å­—æ˜¯æœ‰é™çš„ï¼Œæ— éå°±æ˜¯(19700101-20101231æœ‰é™æ•°æ®)ï¼Œå°±ç®—100å¹´ï¼Œä¹Ÿåªæ˜¯36500ä¸ªæ•°æ®ï¼ˆå®é™…ä¼šç•¥é«˜ï¼Œå› ä¸ºæœ‰é—°å¹´ï¼‰ã€‚æŸ¥è¡¨çš„æ•ˆç‡å°±éå¸¸å¿«äº†</li>
<li>ä»æ ¹æœ¬ä¸Šä¼˜åŒ–è¿™ä¸ªç¨‹åº</li>
</ol>
<h3 id="ä¼˜åŒ–">ä¼˜åŒ–</h3>
<p>é¦–å…ˆæ’é™¤2ï¼Œå› ä¸ºæœ€ç»ˆè¿˜æ˜¯æƒ³æŸ¥æ‰¾ä»»æ„æ•°å­—ï¼Œ2ä¸ä¾¿äºåç»­æ‰©å±•ï¼Œè€Œä¸”æ ¹æ®ç°æœ‰çš„æ€§èƒ½ï¼Œåšè¡¨ä¹Ÿéœ€è¦å¾ˆé•¿æ—¶é—´ã€‚</p>
<p>å…¶æ¬¡å¯¹äº1ï¼Œå¦‚æœè€ƒè™‘å¯¹å¤–å¼€æ”¾ï¼ŒæœåŠ¡å™¨å ç”¨2Gå†…å­˜ç©ºé—´ï¼Œå®åœ¨æ˜¯å¤ª"å¥¢ä¾ˆ"äº†</p>
<p>æ‰€ä»¥æœ€åå°±åªèƒ½è€ƒè™‘3ã€‚</p>
<h4 id="è¿­ä»£å™¨">è¿­ä»£å™¨</h4>
<p>Pythonæœ‰ä¸ªå…³é”®è¯æ˜¯
<code>yield</code>ï¼Œå®ƒå¯ä»¥å®ç°è¿­ä»£å™¨è¿™ä¸ªåŠŸèƒ½ã€‚è¯´äººè¯å°±æ˜¯ï¼Œå®ƒä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ•°æ®åŠ è½½å‡ºæ¥ï¼Œè€Œä¸”æ¯æ¬¡åªåŠ è½½ä¸€éƒ¨åˆ†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">yield_func</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">for_return_func</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">return_func</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="keyword">return</span> lst</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    lst = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">    <span class="built_in">print</span>(yield_func(lst))</span><br><span class="line">    <span class="built_in">print</span>(for_return_func(lst))</span><br><span class="line">    <span class="built_in">print</span>(return_func(lst))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> yield_func(lst):</span><br><span class="line">        <span class="built_in">print</span>(x, end=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¾“å‡ºå¦‚ä¸‹</span></span><br><span class="line">&lt;generator object yield_func at 0x000001644AF624F8&gt;</span><br><span class="line">0</span><br><span class="line">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">0 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è‚¯å®šæ˜¯è¦åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¸®åŠ©ä¼˜åŒ–ç¨‹åºã€‚åœ¨Pythonæ“ä½œæ–‡ä»¶çš„æ—¶å€™
<code>readline()</code>å‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸€è¡Œä¸€è¡Œçš„è¿”å›ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ¯”ç›´æ¥
<code>read()</code>æˆ–è€… <code>readlines()</code>æ›´å¿«ã€‚</p>
<p>ä½†è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¾“å‡ºçš„Piæ–‡æœ¬æ˜¯ä¸€è¡Œã€‚ã€‚ã€‚æ‰€ä»¥æ²¡æ³•ç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŠŠè¿™ä¸ªæ–‡æœ¬æŒ‰è¡Œåˆ‡å‰²åï¼Œå†ç”¨
<code>readline()</code>å‡½æ•°ã€‚</p>
<p>è¿™é‡Œæˆ‘æ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆ[1]å¯ä»¥æ›´æ–¹ä¾¿çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯¦è§åšå®¢oré¡¹ç›®æºç ã€‚</p>
<h4 id="bug">bug</h4>
<p>æŠŠç¨‹åºå†™å¥½ä¹‹åï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„bugï¼Œå°±æ˜¯æŸ¥è¯¢çš„å­—ç¬¦ä¸²å¦‚æœåœ¨ä¸¤ä¸ª
<code>chunk</code>ä¹‹é—´ï¼Œæ˜¯ä¼šç›´æ¥è·³è¿‡ã€‚æ¯”å¦‚
<code>12345678</code>ï¼Œ<code>block_size=4</code>ï¼Œé‚£ä¹ˆå°±æ˜¯
<code>1234</code>å’Œ <code>5678</code>ã€‚å¦‚æœæŸ¥æ‰¾
<code>45</code>æ˜¯æ‰¾ä¸åˆ°çš„ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œéœ€è¦åšä¸¤ä¸ªé¢å¤–çš„å¤„ç†</p>
<ol type="1">
<li>åŠ ä¸Šä¸Šä¸€ä¸ª <code>block_size</code>çš„å­—ç¬¦ä¸²
<code>old_chunk = copy.deepcopy(chunk[-len(target_str) :])</code>ã€‚è¿™é‡Œä¸ºäº†çœç©ºé—´å’Œæ—¶é—´ï¼ŒåªåŠ ä¸Šäº†éœ€è¦æŸ¥è¯¢å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå°±å¯ä»¥æ»¡è¶³éœ€æ±‚</li>
<li>è¿”å›æŸ¥æ‰¾ä½æ•°æ—¶éœ€è¦é¢å¤–
<code>-len(old_chunk)</code>ã€‚ï¼ˆæ³¨ï¼šè¿™é‡Œä¸€å¼€å§‹å¿˜äº†æ“ä½œï¼Œæ•…å‰å‡ ä½æŸ¥è¯¢çš„æ—¢æœ‰ä¼šå‘ç°ç»“æœä¸åŒ—å¤§æ•°é™¢æŸ¥è¯¢çš„ç»“æœå·®10ä½ï¼Œåœ¨è¿™é‡Œè‡´æ­‰ï¼‰</li>
</ol>
<p>æœ€åç»è¿‡æµ‹è¯•åï¼Œæ€§èƒ½åŸºæœ¬è¾¾åˆ°é¢„æœŸï¼ˆè§é¡¹ç›®READMEï¼Œæœ‰è¯´æ˜å…·ä½“ç»“æœï¼‰ã€‚</p>
<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<p>è‡³æ­¤ï¼Œæ ¸å¿ƒç¨‹åºå·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥éœ€è¦è€ƒè™‘ä¸€ç§æ–¹å¼æ¥ç»™å…¶ä»–äººæ–¹ä¾¿ä½¿ç”¨äº†ã€‚æœ€ç›´æ¥çš„å…¶å®å°±æ˜¯å†™ä¸€ä¸ªWebï¼Œå‰ç«¯å»è°ƒç”¨åç«¯è¿”å›ç»“æœã€‚ä½†åŒæ ·çš„ï¼Œè¿™é‡Œè¿˜æ˜¯è€ƒè™‘åˆ°ç½‘ç«™æµé‡ç­‰åŸå› ï¼Œè·ŸåŒ—å¤§æ•°é™¢ä¸€æ ·æ”¾åˆ°å…¬ä¼—å·ä¸Šä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå¼€å‘ä¸Šä¹Ÿåªéœ€è¦å®Œæˆåç«¯å³å¯ï¼Œæ— éœ€è€ƒè™‘å‰ç«¯UIå•¥çš„ã€‚</p>
<p>æŸ¥è¯¢å…¬ä¼—å·æ–‡æ¡£åï¼Œä¸€é€šæ“ä½œï¼Œå°±æŠŠåŠŸèƒ½å®Œæˆäº†ï¼ˆæ–‡æ¡ˆç›´æ¥"æŠ„"äº†åŒ—å¤§æ•°é™¢çš„æ–‡æ¡ˆï¼‰ã€‚ä»£ç è§<a
href="https://github.com/wnma3mz/birthday_in_pi/blob/master/flask_server.py">flask_server.py</a></p>
<p>è¿™é‡Œéœ€è¦åœ¨å¾®ä¿¡å…¬ä¼—å·åå°é…ç½®å¼€å‘è€…æ¨¡å¼ï¼Œç„¶åæŠŠtokenå¤åˆ¶è¿›ä»£ç ã€‚</p>
<h3 id="tip">Tip</h3>
<p>å…¬ä¼—å·å¼€å‘è¦æ±‚æ˜¯80ç«¯å£ï¼Œä½†è¿™é‡Œé€šè¿‡å­åŸŸåçš„æ–¹å¼+nginxåä»£å°±å¯ä»¥ç›´æ¥ç”¨åŸŸåè®¿é—®ï¼Œè€Œæ— éœ€80ç«¯å£ã€‚nginxé…ç½®è§ä¸‹</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  xxx.yyy.zzz;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">uwsgi_pass</span> <span class="number">0.0.0.0</span>:port;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://0.0.0.0:port/wx_api;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>xxx.yyy.zzz</code>å°±æ˜¯åŸŸåï¼Œportå°±æ˜¯
<code>flask</code>å¼€å¯çš„ç«¯å£</p>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="æŸ¥è¡¨">æŸ¥è¡¨</h3>
<p>å½“ç„¶ï¼ŒæŸ¥è¡¨çš„æ–¹å¼è¿˜æ˜¯æœ€å¿«çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºäº†ä¸€ä¸ªè¡¨ï¼Œå¹¶ä¸”åšäº†ä¸€ä¸ªç®€å•çš„åˆ†æã€‚åˆ†æå†…å®¹å¦‚ä¸‹</p>
<p>æœ€è¿‘åªéœ€246ä½èƒ½å¤Ÿæ‰¾åˆ°,
æœ€è¿œéœ€è¦è¿‘9äº¿ä½ã€‚åˆ—å‡ºTop10ï¼ˆå·¦ä¾§ä¸ºå¹´æœˆæ—¥ï¼Œå³ä¾§ä¸ºç¬¬xä½ï¼‰</p>
<p>æ—¥æœŸèŒƒå›´ä¸º19700101-20091231</p>
<table>
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>ä½æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>20190914</td>
<td>246</td>
</tr>
<tr>
<td>20190516</td>
<td>5364</td>
</tr>
<tr>
<td>19910403</td>
<td>8365</td>
</tr>
<tr>
<td>20141020</td>
<td>9813</td>
</tr>
<tr>
<td>19950728</td>
<td>1,3874</td>
</tr>
<tr>
<td>20121031</td>
<td>1,4538</td>
</tr>
<tr>
<td>19990814</td>
<td>2,5593</td>
</tr>
<tr>
<td>19810705</td>
<td>2,7202</td>
</tr>
<tr>
<td>19921122</td>
<td>3,0884</td>
</tr>
<tr>
<td>19930509</td>
<td>3,6615</td>
</tr>
<tr>
<td>..........</td>
<td>..........</td>
</tr>
<tr>
<td>19941227</td>
<td>7,1993,2960</td>
</tr>
<tr>
<td>20080923</td>
<td>7,2930,2729</td>
</tr>
<tr>
<td>19911201</td>
<td>7,2985,0775</td>
</tr>
<tr>
<td>20071206</td>
<td>7,3782,1997</td>
</tr>
<tr>
<td>20090220</td>
<td>7,5402,4215</td>
</tr>
<tr>
<td>19730829</td>
<td>7,7357,0338</td>
</tr>
<tr>
<td>20070526</td>
<td>7,8655,8038</td>
</tr>
<tr>
<td>19951122</td>
<td>8,2582,0139</td>
</tr>
<tr>
<td>20140407</td>
<td>8,7320,8091</td>
</tr>
<tr>
<td>19730521</td>
<td>8,8950,7619</td>
</tr>
</tbody>
</table>
<p>ä¸ºä»€ä¹ˆ4ä½åˆ†éš”ï¼Œè€Œä¸æ˜¯3ä½ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘è§‰å¾—è¿™æ ·çœ‹çš„æ›´èˆ’æœï¼Œè¯»ä¸‡ã€äº¿æ›´æ–¹ä¾¿ã€‚ã€‚ã€‚</p>
<h3 id="ç¨‹åºæ‰“åŒ…">ç¨‹åºæ‰“åŒ…</h3>
<p>ä¸ºæ–¹ä¾¿æ²¡æœ‰Pythonç¨‹åºçš„ç”¨æˆ·ï¼ŒåŒæ—¶ä¹Ÿä¸æƒ³ä½¿ç”¨å…¬ä¼—å·ã€‚åœ¨Windowsä¸Šæ‰“åŒ…äº†ä¸€ä»½exeç¨‹åºã€‚å‘½ä»¤ä¹Ÿå¾ˆç®€å•
<code>pyinstaller -F .\read_large_pi.py</code>ã€‚</p>
<p>æœ€åçš„æœ€åï¼Œè¯¥ç¨‹åºå°šå­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼Œå½“æŸ¥è¯¢æ•°å­—è¾ƒé•¿ï¼ˆè¶…è¿‡8ä½ï¼‰æ—¶ï¼Œæ—¶é—´èŠ±è´¹ä¹Ÿæ›´ä¹…ï¼ˆè¶…è¿‡1sï¼‰ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<p>[1] <a
href="https://lovemma.github.io/posts/python-%E5%A6%82%E4%BD%95%E6%B5%81%E5%BC%8F%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6/">python-å¦‚ä½•æµå¼è¯»å–å¤§æ–‡ä»¶</a></p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>å¾®ä¿¡å¼€å‘</tag>
        <tag>Steaming</tag>
      </tags>
  </entry>
  <entry>
    <title>Python3çš„Tools-scriptsæ•´ç†</title>
    <url>/hexo_blog/2020/06/14/Python/Python3%E7%9A%84Tools-scripts%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<p>Python3çš„Tools-scriptsæ•´ç†</p>
<span id="more"></span>
<p>æ–‡ä»¶è·¯å¾„ä¸º<code>Anaconda3\Tools\scripts</code></p>
<h3 id="byext.py">byext.py</h3>
<p>åˆ†ææ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pyæ–‡ä»¶</span></span><br><span class="line">ext  <span class="built_in">bytes</span>  files  lines  words</span><br><span class="line">.py   <span class="number">2655</span>      <span class="number">1</span>     <span class="number">91</span>    <span class="number">265</span></span><br><span class="line">TOTAL   <span class="number">2655</span>      <span class="number">1</span>     <span class="number">91</span>    <span class="number">265</span></span><br><span class="line">ext  <span class="built_in">bytes</span>  files  lines  words</span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">   ext binary  <span class="built_in">bytes</span>  files</span><br><span class="line">&lt;none&gt;      <span class="number">1</span>  <span class="number">10382</span>      <span class="number">1</span></span><br><span class="line"> TOTAL      <span class="number">1</span>  <span class="number">10382</span>      <span class="number">1</span></span><br><span class="line">   ext binary  <span class="built_in">bytes</span>  files</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶å¤¹</span></span><br><span class="line">  ext binary  <span class="built_in">bytes</span>   dirs  files  lines  words</span><br><span class="line"> .png      <span class="number">2</span>   <span class="number">2823</span>             <span class="number">2</span></span><br><span class="line">  .py         <span class="number">10471</span>             <span class="number">5</span>    <span class="number">224</span>    <span class="number">647</span></span><br><span class="line"> .txt         <span class="number">17404</span>             <span class="number">3</span>    <span class="number">554</span>    <span class="number">960</span></span><br><span class="line">&lt;<span class="built_in">dir</span>&gt;                    <span class="number">1</span></span><br><span class="line">TOTAL      <span class="number">2</span>  <span class="number">30698</span>      <span class="number">1</span>     <span class="number">10</span>    <span class="number">778</span>   <span class="number">1607</span></span><br><span class="line">  ext binary  <span class="built_in">bytes</span>   dirs  files  lines  words</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>è¾“å‡º</th>
<th>ä¸»è¦è¯­æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ext</td>
<td><code>os.path.normcase(os.path.splitext[1])</code></td>
</tr>
<tr>
<td>files</td>
<td><code>os.path.isfile</code></td>
</tr>
<tr>
<td>bytes</td>
<td>ä»¥äºŒè¿›åˆ¶(<code>rb</code>)è¯»æ–‡ä»¶ï¼Œ<code>len</code>çš„è¾“å‡º</td>
</tr>
<tr>
<td>lines</td>
<td><code>str(data, 'latin-1').splitlines()</code></td>
</tr>
<tr>
<td>words</td>
<td><code>len(data.split())</code>çš„è¾“å‡º</td>
</tr>
<tr>
<td>binary</td>
<td><code>if *b*'\0' in data</code></td>
</tr>
<tr>
<td>dirs</td>
<td>os.path.isdir</td>
</tr>
<tr>
<td>lnk</td>
<td>os.path.islink</td>
</tr>
</tbody>
</table>
<h3 id="checkpip.py">checkpip.py</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">The latest version of setuptools on PyPI <span class="keyword">is</span> <span class="number">46.2</span><span class="number">.0</span>, but ensurepip has <span class="number">40.8</span><span class="number">.0</span></span><br><span class="line">The latest version of pip on PyPI <span class="keyword">is</span> <span class="number">20.1</span>, but ensurepip has <span class="number">19.0</span><span class="number">.3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸»è¦æ˜¯æ£€æŸ¥ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">import</span> ensurepip</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ensurepip._PROJECTS)</span><br><span class="line"><span class="comment"># [(&#x27;setuptools&#x27;, &#x27;40.8.0&#x27;), (&#x27;pip&#x27;, &#x27;19.0.3&#x27;)]</span></span><br></pre></td></tr></table></figure>
<h3 id="checkpyc.py">checkpyc.py</h3>
<p>æ£€æŸ¥pycæ–‡ä»¶æ˜¯å¦æœ€æ–°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(importlib.util.MAGIC_NUMBER)</span><br><span class="line"><span class="comment"># b&#x27;B\r\r\n&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="cleanfuture.py">cleanfuture.py</h3>
<p>ä¿®æ”¹pyæ–‡ä»¶çš„futureè¯­æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">errprint</span>(<span class="params">*args</span>):</span><br><span class="line">    strings = <span class="built_in">map</span>(<span class="built_in">str</span>, args)</span><br><span class="line">    msg = <span class="string">&#x27; &#x27;</span>.join(strings)</span><br><span class="line">    <span class="keyword">if</span> msg[-<span class="number">1</span>:] != <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">        msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    sys.stderr.write(msg)</span><br><span class="line">    </span><br><span class="line">errprint(<span class="string">&quot;Usage:&quot;</span>, __doc__)</span><br></pre></td></tr></table></figure>
<h3 id="crlf.py">crlf.py</h3>
<p>æ–‡ä»¶ä¸­CRLFç”¨LFæ›¿æ¢</p>
<h3 id="lfcr.py">lfcr.py</h3>
<p>æ–‡ä»¶ä¸­LFç”¨CRLFæ›¿æ¢</p>
<p>è¿­ä»£ï¼š<code>itertools.count()</code></p>
<h3 id="reindent.py">reindent.py</h3>
<p>pyæ–‡ä»¶æ”¹ä¸º4ç©ºæ ¼ç¼©è¿›</p>
<h3 id="untabify.py">untabify.py</h3>
<p>åŒä¸Š</p>
<h3 id="texi2html.py">texi2html.py</h3>
<p>texi to html</p>
<p><code>import keyword</code></p>
<p><code>import webbrowser</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Scripts</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ‚è°ˆ</title>
    <url>/hexo_blog/2018/03/14/Python/Python%E6%9D%82%E8%B0%88/</url>
    <content><![CDATA[<p>ç†è§£Pythonä¸­çš„GIL(Global Interpreter
Lock)ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ï¼Œä»¥åŠå¼±å¼•ç”¨ã€‚</p>
<span id="more"></span>
<h2 id="gil">GIL</h2>
<p>å»ºè®®é˜…è¯»æ–‡ç« </p>
<p><a
href="http://zhuoqiang.me/python-thread-gil-and-ctypes.html">python
çº¿ç¨‹ï¼ŒGIL å’Œ ctypes</a></p>
<p><a
href="https://zhuanlan.zhihu.com/p/20953544">è°ˆè°ˆpythonçš„GILã€å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹</a></p>
<p>GIL, <code>Global Interpreter Lock</code>ï¼Œå…¨å±€è§£é‡Šå™¨é”</p>
<p>äº§ç”ŸåŸå› : é˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œæœºå™¨ç çš„Mutexã€‚</p>
<p>å¥½å¤„:
ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹æ›´å¿«(ç›¸å¯¹è€Œè¨€)ï¼Œå’ŒCåº“ç»“åˆæ—¶æ›´åŠ æ–¹ä¾¿</p>
<p>å½¢è±¡çš„æ¯”æ–¹:</p>
<blockquote>
<p>æˆ‘ä»¬æŠŠæ•´ä¸ªè¿›ç¨‹ç©ºé—´çœ‹åšä¸€ä¸ªè½¦é—´ï¼ŒæŠŠçº¿ç¨‹çœ‹æˆæ˜¯å¤šæ¡ä¸ç›¸äº¤çš„æµæ°´çº¿ï¼ŒæŠŠçº¿ç¨‹æ§åˆ¶æµä¸­çš„å­—èŠ‚ç çœ‹ä½œæ˜¯æµæ°´çº¿ä¸Šå¾…å¤„ç†çš„ç‰©å“ã€‚Python
è§£é‡Šå™¨æ˜¯å·¥äººï¼Œæ•´ä¸ªè½¦é—´ä»…æ­¤ä¸€åã€‚æ“ä½œç³»ç»Ÿæ˜¯ä¸€åªä¸Šå¸ä¹‹æ‰‹ï¼Œä¼šéšæ—¶æŠŠå·¥äººä»ä¸€æ¡æµæ°´çº¿è°ƒåˆ°å¦ä¸€æ¡â€”â€”è¿™ç§â€œéšæ—¶â€æ˜¯ä¸ç”±åˆ†è¯´çš„ï¼Œå³ä¸ç®¡å¤„ç†å®Œå½“å‰ç‰©å“ä¸å¦ã€‚</p>
</blockquote>
<blockquote>
<p>è‹¥æ²¡æœ‰ GILã€‚å‡è®¾å·¥äººæ­£åœ¨æµæ°´çº¿ A å¤„ç† A1 ç‰©å“ï¼Œæ ¹æ® A1
çš„éœ€è¦å°†æˆ¿é—´æ¸©åº¦ï¼ˆä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼‰è°ƒåˆ°äº† 20
åº¦ã€‚è¿™æ—¶ä¸Šå¸ä¹‹æ‰‹å‘åŠ¨äº†ï¼Œå·¥äººè¢«è°ƒåˆ°æµæ°´çº¿ B å¤„ç† B1 ç‰©å“ï¼Œæ ¹æ® B1
çš„éœ€è¦åˆå°†æˆ¿é—´æ¸©åº¦è°ƒåˆ°äº† 50 åº¦ã€‚è¿™æ—¶ä¸Šå¸ä¹‹æ‰‹åˆå‘åŠ¨äº†ï¼Œå·¥äººåˆè°ƒå› A
ç»§ç»­å¤„ç† A1ã€‚ä½†æ­¤æ—¶ A1 æš´éœ²åœ¨äº† 50 åº¦çš„ç¯å¢ƒä¸­ï¼Œå®‰å…¨é—®é¢˜å°±æ­¤äº§ç”Ÿäº†ã€‚</p>
</blockquote>
<blockquote>
<p>è€Œ GIL ç›¸å½“äºä¸€æ¡é”é“¾ï¼Œä¸€æ—¦å·¥äººå¼€å§‹å¤„ç†æŸæ¡æµæ°´çº¿ä¸Šçš„ç‰©å“ï¼ŒGIL
ä¾¿ä¼šå°†å·¥äººå’Œè¯¥æµæ°´çº¿é”åœ¨ä¸€èµ·ã€‚è€Œè¢«é”ä½çš„å·¥äººåªä¼šå¤„ç†è¯¥æµæ°´çº¿ä¸Šçš„ç‰©å“ã€‚å°±ç®—çªç„¶è¢«è°ƒåˆ°å¦ä¸€æ¡æµæ°´çº¿ï¼Œä»–ä¹Ÿä¸ä¼šå¹²æ´»ï¼Œè€Œæ˜¯å¹²ç­‰è‡³é‡æ–°è°ƒå›åŸæ¥çš„æµæ°´çº¿ã€‚è¿™æ ·æ¯ä¸ªç‰©å“åœ¨è¢«å¤„ç†çš„è¿‡ç¨‹ä¸­ä¾¿æ€»æ˜¯èƒ½ä¿è¯å…¨å±€ç¯å¢ƒä¸ä¼šçªå˜ã€‚</p>
</blockquote>
<p>åœ¨è§£é‡Šå™¨è§£é‡Špythonä»£ç æ—¶ï¼Œé¦–å…ˆä¼šè·å¾—è¿™æŠŠé”ï¼Œéœ€è¦I/Oæ“ä½œå°±æ˜¯é‡Šæ”¾è¿™æŠŠé”ã€‚å¦‚æœæ˜¯çº¯è®¡ç®—ç¨‹åºï¼Œæ²¡æœ‰I/Oæ“ä½œï¼Œè§£é‡Šå™¨ä¼šæ¯éš”100æ¬¡æ“ä½œé‡Šæ”¾ä¸€æ¬¡é”ï¼ˆPython3.2ä¹‹åä½¿ç”¨å›ºå®šæ—¶é—´(5ms)æ¥é‡Šæ”¾ï¼‰ã€‚</p>
<p>GILåªä¼šå½±å“ä¸¥é‡ä¾èµ–CPUçš„ç¨‹åºï¼ˆè®¡ç®—å‹ï¼‰,
æ‰€ä»¥è¿è¡ŒPythonçš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹(å•æ ¸CPUä¸‹çš„å¤šçº¿ç¨‹éƒ½åªæ˜¯å¹¶å‘)ã€‚è¿è¡ŒPythonç¨‹åºå°±åªèƒ½å ç”¨ä¸€ä¸ªæ ¸çš„CPUèµ„æºï¼Œå“ªæ€•ä½¿ç”¨äº†
<code>threading</code>å¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>
<p>CPUå¯†é›†æ€§ä»£ç (å¾ªç¯)ï¼šä¸é€‚ç”¨å¤šçº¿ç¨‹ã€‚ä¸æ–­è§¦å‘GILï¼Œçº¿ç¨‹æ¥å›åˆ‡æ¢ï¼Œæ¶ˆè€—èµ„æº</p>
<p>IOå¯†é›†å‹ä»£ç (æ–‡ä»¶å¤„ç†ï¼Œç½‘è·¯çˆ¬è™«)ï¼šå¤šçº¿ç¨‹èƒ½å¤Ÿæé«˜æ•ˆç‡ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…çš„åŒæ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸æµªè´¹CPUèµ„æºä»è€Œæå‡æ•ˆç‡ã€‚</p>
<p>å¤šæ ¸å¤šçº¿ç¨‹æ¯”å•æ ¸å¤šçº¿ç¨‹æ›´å·®ï¼Œå•æ ¸ä¸‹å¤šçº¿ç¨‹æ¯æ¬¡é‡Šæ”¾GILï¼Œå”¤é†’çš„çº¿ç¨‹éƒ½èƒ½è·å–GILé”ï¼Œå¯ä»¥æ— ç¼æ‰§è¡Œã€‚ä½†æ˜¯å¤šæ ¸ä¸‹ï¼Œä¸€ä¸ªCPUé‡Šæ”¾å®ŒGILä¹‹åï¼Œæ‰€æœ‰CPUçš„çº¿ç¨‹åˆå¼€å§‹ç«äº‰ï¼Œå¯èƒ½ä¼šè¢«åŸæ¥çš„CPUè·å–ï¼Œå¯¼è‡´å…¶ä»–CPUçº¿ç¨‹å”¤é†’ä¹‹åå¿…é¡»ç­‰å¾…åˆ°ä¸‹ä¸€æ¬¡é‡Šæ”¾ã€‚è¿™æ ·é€ æˆçš„ç»“æœç§°ä¸ºçº¿ç¨‹é¢ ç°¸(thrashing),
æ•ˆç‡ä¼šæ›´ä½ä¸‹ã€‚</p>
<p>ä»¥ä¸Šï¼Œå¦‚æœPythonéœ€è¦åˆ©ç”¨å¤šæ ¸CPUï¼Œå°±ä½¿ç”¨å¤šè¿›ç¨‹(<code>multiprocessing</code>)ï¼Œå„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„GILï¼Œäº’ä¸å¹²æ‰°ï¼Œä»è€Œè¾¾åˆ°å¹¶è¡Œæ‰§è¡Œã€‚è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨Cè¿›è¡Œæ‹“å±•ï¼Œæ‰‹åŠ¨é‡Šæ”¾GILï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚</p>
<p>å‚è€ƒä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-   </span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spawn_n_threads</span>(<span class="params">n, target</span>):</span><br><span class="line">    threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        thread = Thread(target=target)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spawn_n_processes</span>(<span class="params">n, target</span>):</span><br><span class="line">    threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        thread = Process(target=target)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">target, number=<span class="number">10</span>, spawner=spawn_n_threads</span>):</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        start_time = time()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(number):</span><br><span class="line">            spawner(n, target)</span><br><span class="line">        end_time = time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Time elapsed with &#123;&#125; branch(es): &#123;:.6f&#125; sec(s)&quot;</span>.<span class="built_in">format</span>(n, end_time - start_time))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>():</span><br><span class="line">    a = b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">        a, b = b, a + b</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;threads:&quot;</span>)</span><br><span class="line">    test(fib)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;processes:&quot;</span>)</span><br><span class="line">    test(fib, spawner=spawn_n_processes)</span><br></pre></td></tr></table></figure>
<p>P.S.</p>
<ul>
<li>å¹¶è¡Œï¼šåŒæ—¶å¤„ç†ä¸¤ä¸ªåŠä»¥ä¸Šçš„äº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿ</li>
<li>å¹¶å‘ï¼šåŒæ—¶å¤„ç†ä¸¤ä¸ªåŠä»¥ä¸Šçš„äº‹ä»¶åœ¨åŒä¸€äº‹ä»¶é—´éš”å†…å‘ç”Ÿ</li>
</ul>
<h2 id="å¼±å¼•ç”¨">å¼±å¼•ç”¨</h2>
<p>æ¨èé˜…è¯»</p>
<p><a
href="http://blog.soliloquize.org/2016/01/21/Python%E5%BC%B1%E5%BC%95%E7%94%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">Pythonå¼±å¼•ç”¨çš„ä½¿ç”¨ä¸æ³¨æ„äº‹é¡¹</a></p>
<p>å¼±å¼•ç”¨ä¸å¼ºå¼•ç”¨ç›¸å¯¹ï¼Œæ˜¯æŒ‡ä¸èƒ½ç¡®ä¿å…¶å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¼•ç”¨ã€‚è‹¥ä¸€ä¸ªå¯¹è±¡è‹¥åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ä¸å¯è®¿é—®ï¼ˆæˆ–å¼±å¯è®¿é—®ï¼‰çš„ï¼Œç—…å› æ­¤å¯èƒ½åœ¨ä»»ä½•æ—¶åˆ»è¢«å›æ”¶ã€‚ä¸»è¦ä½œç”¨å°±æ˜¯å‡å°‘å¾ªç¯å¼•ç”¨ï¼Œå‡å°‘å†…å­˜ä¸­ä¸å¿…è¦çš„å¯¹è±¡å­˜åœ¨çš„æ•°é‡ã€‚</p>
<p>Pythonç”¨
<code>weakref</code>æ¨¡å—åˆ›å»ºå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º0æˆ–åªå­˜åœ¨å¯¹è±¡çš„å¼±å¼•ç”¨æ—¶å°†å›æ”¶è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p>å†…å­˜ç®¡ç†æ—¶ä½¿ç”¨ï¼Œcacheç¼–ç¨‹ï¼Œåƒåœ¾å›æ”¶(GC)</p>
<h2 id="while-1ä¸while-true">while 1ä¸while True</h2>
<p><a
href="http://www.pythoner.com/356.html">Pythonå¤©å‘ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šwhile
1æ¯”while Trueæ›´å¿«ï¼Ÿ</a></p>
<p>åœ¨python2ä¸­while 1ä¼šæ¯”while Trueæ›´å¿«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">while_one</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">10000000</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">while_true</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">10000000</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    w1_time, wt_time = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        w1 = timeit.timeit(while_one, <span class="string">&quot;from __main__ import while_one&quot;</span>, number=<span class="number">3</span>)</span><br><span class="line">        w1_time += w1</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        wt = timeit.timeit(while_true, <span class="string">&quot;from __main__ import while_true&quot;</span>, number=<span class="number">3</span>)</span><br><span class="line">        wt_time += wt</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;while one: %s\nwhile_true: %s&quot;</span> % (w1_time, wt_time))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">while</span> one: 9.27971386909</span><br><span class="line">while_true: 13.5762348175</span><br><span class="line"><span class="comment"># python3çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">while</span> one: 14.19957690299998</span><br><span class="line">while_true: 13.785004297995329</span><br></pre></td></tr></table></figure>
<p>åŸå› ï¼špython2ä¸­True/Falseä¸æ˜¯å…³é”®å­—ï¼Œpython3æ·»åŠ äº†True/Falseåšä¸ºå…³é”®å­—ã€‚æ¯æ¬¡åœ¨å¾ªç¯çš„æ—¶å€™ï¼ŒTrue/Falseéœ€è¦è¢«æ£€æŸ¥ï¼Œæ‰€ä»¥while
1ä¼šæ›´å¿«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Python <span class="number">2.7</span><span class="number">.14</span> (default, Sep <span class="number">23</span> <span class="number">2017</span>, <span class="number">22</span>:06:<span class="number">14</span>)</span><br><span class="line">[GCC <span class="number">7.2</span><span class="number">.0</span>] on linux2</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> keyword</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>keyword.kwlist</span><br><span class="line">[<span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;as&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;continue&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;del&#x27;</span>, <span class="string">&#x27;elif&#x27;</span>, <span class="string">&#x27;else&#x27;</span>, <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;finally&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;lambda&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;print&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>, <span class="string">&#x27;return&#x27;</span>, <span class="string">&#x27;try&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;yield&#x27;</span>]</span><br><span class="line"></span><br><span class="line">Python <span class="number">3.6</span><span class="number">.3</span> (default, Oct  <span class="number">3</span> <span class="number">2017</span>, <span class="number">21</span>:<span class="number">45</span>:<span class="number">48</span>)</span><br><span class="line">[GCC <span class="number">7.2</span><span class="number">.0</span>] on linux</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> keyword</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>keyword.kwlist</span><br><span class="line">[<span class="string">&#x27;False&#x27;</span>, <span class="string">&#x27;None&#x27;</span>, <span class="string">&#x27;True&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;as&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;continue&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;del&#x27;</span>, <span class="string">&#x27;elif&#x27;</span>, <span class="string">&#x27;else&#x27;</span>, <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;finally&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;lambda&#x27;</span>, <span class="string">&#x27;nonlocal&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>, <span class="string">&#x27;return&#x27;</span>, <span class="string">&#x27;try&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;yield&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="if-x-true-ä¸-if-x">if x == True ä¸ if x</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">if_x_eq_true</span>():</span><br><span class="line">    x = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">if_x</span>():</span><br><span class="line">    x = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    if1 = timeit.timeit(if_x_eq_true, <span class="string">&quot;from __main__ import if_x_eq_true&quot;</span>, number = <span class="number">1000000</span>)</span><br><span class="line">    if2 = timeit.timeit(if_x, <span class="string">&quot;from __main__ import if_x&quot;</span>, number = <span class="number">1000000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;if_x_eq_true: %s\nif_x: %s&quot;</span> % (if1, if2))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line">if_x_eq_true: 0.118808984756</span><br><span class="line">if_x: 0.0920550823212</span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line">if_x_eq_true: 0.0951261969985353</span><br><span class="line">if_x: 0.07899275699855934</span><br></pre></td></tr></table></figure>
<p>ä¸ç®¡python2è¿˜æ˜¯python3, <code>if x:</code>ä»å„æ–¹é¢æ¥è¯´éƒ½ä¼šä¼˜äº
<code>if x == True</code>ã€‚åè€…ä¼šæ¯”å‰è€…å¤šå‡ºä¸€ä¸ªæ£€æŸ¥Trueå€¼å’Œæ¯”è¾ƒçš„æ“ä½œã€‚</p>
<h2 id="typeä¸object">typeä¸object</h2>
<p><a href="https://www.zhihu.com/question/38791962">Python çš„ type å’Œ
object ä¹‹é—´æ˜¯æ€ä¹ˆä¸€ç§å…³ç³»ï¼Ÿ</a></p>
<h2
id="æ·±åˆ»ç†è§£pythonä¸­çš„å…ƒç±»metaclass">æ·±åˆ»ç†è§£Pythonä¸­çš„å…ƒç±»(metaclass)</h2>
<p><a
href="http://blog.jobbole.com/21351/">æ·±åˆ»ç†è§£Pythonä¸­çš„å…ƒç±»(metaclass)</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>GIL</tag>
        <tag>å…ƒç±»</tag>
      </tags>
  </entry>
  <entry>
    <title>Python è‡ªåŠ¨å¯¼å…¥åŒ…</title>
    <url>/hexo_blog/2023/12/03/Python/Python%E8%87%AA%E5%8A%A8%E5%AF%BC%E5%85%A5%E5%8C%85/</url>
    <content><![CDATA[<p>åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ª Python
æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‹¥å¹²é‡åå‡½æ•°ï¼Œéœ€è¦ä¸€ä¸€å¯¼å…¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥ç”¨ Python
çš„è‡ªåŠ¨å¯¼å…¥åŒ…æ¥å®ç°ã€‚</p>
<span id="more"></span>
<h2 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">func/</span><br><span class="line">â”œâ”€â”€ __init__.py</span><br><span class="line">â”œâ”€â”€ func1.py</span><br><span class="line">â”œâ”€â”€ func2.py</span><br><span class="line">â”œâ”€â”€ func3.py</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªé‡åå‡½æ•°ï¼Œæ¯”å¦‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># func1.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;foo&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ä»…å¯¼è‡´ <code>import</code> ä»£ç ä¸å¤Ÿç®€æ´ï¼Œä¸”åœ¨æ–°å¢æ–‡ä»¶æ—¶ï¼Œè¿˜å¾—åœ¨
<code>__init__.py</code> ä¸­æ·»åŠ  <code>import</code>
è¯­å¥ã€‚ç”šè‡³åœ¨è°ƒç”¨å¤„ä¹Ÿå¾—å¢åŠ ä»£ç æ¥å¤„ç†ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<p>Python çš„è‡ªåŠ¨å¯¼å…¥åŒ…å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„ .py æ–‡ä»¶</span></span><br><span class="line">files = glob.glob(os.path.join(os.path.dirname(__file__), <span class="string">&quot;*.py&quot;</span>))</span><br><span class="line">func_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> file_ <span class="keyword">in</span> files:</span><br><span class="line">    func_name = os.path.basename(file_)[:-<span class="number">3</span>]</span><br><span class="line">    load_module = importlib.import_module(<span class="string">f&quot;func.<span class="subst">&#123;func_name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">globals</span>()[load_module.__name__] = <span class="built_in">getattr</span>(load_module, <span class="string">&quot;foo&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†å…¶æ”¾åˆ°ä¸€ä¸ªå­—å…¸ä¸­ï¼Œä»¥æŒ‰éœ€å¤„ç†ï¼Œ</span></span><br><span class="line">    func_dict[func_name] = <span class="built_in">globals</span>()[load_module.__name__]</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œä¸ä»…ä¸éœ€è¦åœ¨ <code>func/__init__.py</code> ä¸­æ·»åŠ 
<code>import</code>
è¯­å¥ï¼Œä¹Ÿä¸éœ€è¦åœ¨è°ƒç”¨å¤„æ·»åŠ é¢å¤–çš„ä»£ç ã€‚ç”šè‡³ï¼Œè¿˜è¦æ ¹æ®éœ€æ±‚ï¼Œä»å­—å…¸ä¸­è°ƒç”¨å¯¹åº”å‡½æ•°ã€‚å½“ç„¶ï¼Œè¿™éœ€è¦æå‰è¿›è¡Œçº¦å®šï¼Œæ¯”å¦‚å…¨éƒ¨æ”¾åˆ°<code>func</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œä¸”éƒ½ç”¨<code>foo</code>è¿™ä¸ªåå­—ä½œä¸ºå‡½æ•°åã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>importlib</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonè£…é¥°å™¨</title>
    <url>/hexo_blog/2018/01/30/Python/Python%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Pythonçš„è£…é¥°å™¨æ˜¯ä»€ä¹ˆå’Œä¸€äº›Pythonå†…ç½®è£…é¥°å™¨çš„ä½¿ç”¨</p>
<span id="more"></span>
<p>å‚è€ƒæ–‡ç« :</p>
<p><a
href="https://www.zhihu.com/question/26930016">å¦‚ä½•ç†è§£Pythonè£…é¥°å™¨ï¼Ÿ</a></p>
<p><a
href="https://www.cnblogs.com/cicaday/p/python-decorator.html">è¯¦è§£Pythonçš„è£…é¥°å™¨</a></p>
<h2 id="è£…é¥°å™¨æ˜¯ä»€ä¹ˆ">è£…é¥°å™¨æ˜¯ä»€ä¹ˆ</h2>
<p>pythonçš„è£…é¥°å™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹ç®€åŒ–pythonä»£ç ï¼Œå¢åŠ ä¸€äº›é¢å¤–åŠŸèƒ½ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œpythonè£…é¥°å™¨å¯ä»¥å¸®åŠ©åŒæ—¶å¤šä¸ªå‡½æ•°åšä¸€æ ·çš„äº‹æƒ…ï¼ˆæ¯”å¦‚æ‰“å°æ—¥å¿—ï¼‰ï¼Œè€Œé¿å…äº†æ¯ä¸ªå‡½æ•°éƒ½éœ€è¦é¢å¤–åŠ ä¸Šä¸€æ ·çš„ä»£ç ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_one</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_one&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_two</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    func_one()</span><br><span class="line">    func_two()</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä¸€æ®µä»£ç ç‰‡æ®µå¾ˆå®¹æ˜“ç†è§£ï¼Œè¿è¡Œç»“æœå°±æ˜¯ä¸¤è¡Œè¾“å‡ºã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘éœ€è¦åœ¨æ¯ä¸ªå‡½æ•°é‡Œé¢åŠ ä¸Šä¸€ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚<code>print("this is func")</code>ã€‚å¾ˆç®€å•ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŒæ—¶åœ¨ä¸¤ä¸ªå‡½æ•°é‡Œé¢åŠ ä¸Šè¿™ä¹ˆä¸€è¡Œã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¾ˆå¤šä¸ªå‡½æ•°åœ¨ä¸Šå¾ˆå¤šä¸ªè¿™ç§é‡å¤ä»£ç ï¼Œæˆ‘ä»¬è¿™ä¹ˆåšå°±å¾ˆæµªè´¹æ—¶é—´äº†ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æƒ³åˆ°äº†ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆã€‚å®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨æ¯æ¬¡ä½¿ç”¨å‡½æ•°ä¹‹å‰ï¼Œå…ˆè°ƒç”¨æ–°å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_one</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_one&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_two</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_print</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func&quot;</span>)</span><br><span class="line">    func()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    func_print(func_one)</span><br><span class="line">    func_print(func_two)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ„Ÿè§‰ä¸é”™ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·æ— ç–‘æ”¹å˜äº†åŸæ¥çš„é€»è¾‘ç»“æ„ï¼Œä¸”æ¯æ¬¡éœ€è¦ä¼ é€’å‡½æ•°ç»™<code>func_print</code>ã€‚ä¸‹é¢å°±è½®åˆ°æˆ‘ä»¬çš„ä¸»è§’ç™»åœºäº†â€”â€”è£…é¥°å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_print</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;this is func&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_one</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_one&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_two</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    func_one = func_print(func_one)</span><br><span class="line">    func_two = func_print(func_two)</span><br><span class="line">    func_one()</span><br><span class="line">    func_two()</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¹Ÿèƒ½è¾¾åˆ°æˆ‘ä»¬çš„æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯æ¯”ä¹‹å‰çš„å®ç°æ–¹å¼æ›´éš¾çœ‹æ‡‚ã€‚è€Œä¸”è°ƒç”¨èµ·æ¥ä¼¼ä¹æ›´å¤æ‚äº†ã€‚</p>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šæ›´éš¾çœ‹æ‡‚</p>
<p>å¯èƒ½æ˜¯å¯¹<code>*args</code>ã€<code>**kwargs</code>çš„å‚æ•°ç†è§£ä¸æ˜¯å¾ˆå¥½ã€‚ç®€å•è§£é‡Šä¸€ä¸‹å°±æ˜¯è¯´,<code>*args</code>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª<code>list</code>ï¼Œæ¥æ”¶å¤šä¸ªå‚æ•°ã€‚<code>**kwargs</code>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª<code>dict</code>ï¼Œæ¥æ”¶å¤šä¸ª<code>key</code>å’Œ<code>value</code>ã€‚æ¥æ”¶çš„å‚æ•°æ•°é‡ä¸å®šï¼Œå¯ä»¥æ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥å¾ˆå¤šä¸ªã€‚å†å…·ä½“ä¸€ç‚¹å¯ä»¥ç™¾åº¦çœ‹çœ‹ã€‚</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼šè°ƒç”¨æ›´å¤æ‚</p>
<p>å…¶å®ä¸Šé¢çš„ä¾‹å­å…¶å®è°ƒç”¨è£…é¥°å™¨çš„ä¸€ç§æ–¹å¼ï¼Œ<code>python</code>æœ‰<code>@</code>çš„è¿™ä¸ªè¯­æ³•ç³–ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åƒä¸‹é¢ä¸€æ ·è°ƒç”¨çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_print</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;this is func&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@func_print</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_one</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_one&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@func_print</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_two</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    func_one()</span><br><span class="line">    func_two()</span><br></pre></td></tr></table></figure>
<p>å¥½çš„ï¼Œç®€å•çš„è£…é¥°å™¨è°ƒç”¨åŸºæœ¬å°±æ˜¯è¿™æ ·ï¼Œéš¾åº¦è¿›é˜¶ï¼Œå¦‚ä½•ä½¿ç”¨å¸¦å‚æ•°çš„è£…é¥°å™¨ã€‚æ¢å¥è¯å°±è¯´ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ®æ¯ä¸ªå‡½æ•°è‡ªå®šä¹‰ä¸€äº›ä¸œè¥¿ï¼Œå¦‚ä½•ä¼ é€’å‚æ•°ç»™è£…é¥°å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_print</span>(<span class="params">func_name</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;this is %s&quot;</span> % func_name)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@func_print(<span class="params"><span class="string">&quot;one&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_one</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_one&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@func_print(<span class="params">func_name=<span class="string">&quot;two&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_two</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is func_two&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    func_one()</span><br><span class="line">    func_two()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿ<code>func_print</code>éƒ¨åˆ†ä»£ç ï¼Œä¸ä¹‹å‰çš„ä¸åŒåœ¨äºå¤šåŠ äº†ä¸€ä¸ª<code>decorator</code>å‡½æ•°å°è£…äº†<code>wrapper</code>å‡½æ•°ã€‚æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š<code>func_print</code>ä½œç”¨æ˜¯è£…é¥°å™¨çš„åå­—å’Œæ¥æ”¶å¤–éƒ¨çš„å‚æ•°ï¼Œ<code>decorator</code>æ¥æ”¶å¤–éƒ¨çš„å‡½æ•°ï¼Œ<code>wrapper</code>è¿”å›ç»“æœç»™å‡½æ•°ã€‚<code>decorator</code>ç¿»è¯‘ä¸ºä¸­æ–‡æ˜¯<strong>è£…é¥°</strong>ã€‚<code>wrapper</code>ç¿»è¯‘è¿‡æ¥æ˜¯<strong>åŒ…è£…</strong>ã€‚<code>decorator</code>è£…é¥°å‡½æ•°ï¼Œ<code>wrapper</code>åŒ…è£…å‡½æ•°ã€‚</p>
<p>å½“ç„¶ï¼Œ<code>decorator</code>å’Œ<code>wrapper</code>è¿™ä¸¤ä¸ªå‡½æ•°åå­—å¯ä»¥è‡ªå®šä¹‰ï¼Œåœ¨è¿™é‡Œä¸ºäº†å¥½ç†è§£æ‰€ä»¥ç”¨äº†è¿™ä¸¤ä¸ªåå­—</p>
<h2 id="å†…ç½®è£…é¥°å™¨">å†…ç½®è£…é¥°å™¨</h2>
<h3 id="property"><code>@property</code></h3>
<p>å¦‚æœè¦äº†è§£ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨ï¼Œå°±éœ€è¦çŸ¥é“åœ¨ä¸ç”¨è£…é¥°å™¨çš„æƒ…å†µä¸‹ï¼Œå†™ä¸€ä¸ªå±æ€§ã€‚è¿™é‡Œä½¿ç”¨pythonè‡ªå¸¦çš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getx</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span>._x</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setx</span>(<span class="params">self, value</span>): <span class="variable language_">self</span>._x = value</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delx</span>(<span class="params">self</span>): <span class="keyword">del</span> <span class="variable language_">self</span>._x</span><br><span class="line">    x = <span class="built_in">property</span>(getx, setx, delx, <span class="string">&quot;I&#x27;m the &#x27;x&#x27; property.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å°±æ˜¯å®šä¹‰ä¸€ä¸ªpythonå±æ€§çš„æ ‡å‡†å†™æ³•ï¼Œä¸‹é¢ä½¿ç”¨<code>@property</code>æ¥å®šä¹‰å±æ€§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;I am the &#x27;x&#x27; property.&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._x</span><br><span class="line"><span class="meta">    @x.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>._x = value</span><br><span class="line"><span class="meta">    @x.deleter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>._x</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼ŒåŸæ¥çš„å®šä¹‰ï¼Œå±æ€§è®¿é—®å¹¶æ²¡æœ‰åšé™åˆ¶ã€‚ä½¿ç”¨<code>@property</code>å¯ä»¥ä½¿<code>x</code>è¿™ä¸ªå±æ€§æ›´åŠ å®‰å…¨ï¼Œä»è·å–ã€è®¾ç½®å¿…é¡»ä¸å±æ€§åä¸€è‡´ã€‚</p>
<p>Emmmm.....æˆ‘çš„ç†è§£å°±æ˜¯åŠ ä¸Š<code>@property</code>çš„è¯ï¼Œå®šä¹‰å±æ€§ä¼šæ›´åŠ å®‰å…¨æ›´åŠ ä¼˜é›…ã€‚æ¯•ç«Ÿæ˜¯é¢å‘å¯¹è±¡äº†ï¼Œå¤©çŸ¥é“ä½ çš„ç”¨æˆ·ä¼šå¯¹ä½ çš„å±æ€§åšä¸€äº›ä»€ä¹ˆå¥‡å¥‡æ€ªæ€ªçš„äº‹æƒ…ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Decorators</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šè¿›ç¨‹åµŒå¥—å†…å­˜æ³„æ¼é—®é¢˜è®°å½•</title>
    <url>/hexo_blog/2023/11/01/Python/%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>è®°ä¸€æ¬¡å¤šè¿›ç¨‹åµŒå¥—å‘ç°çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œä»¥åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<span id="more"></span>
<h3 id="é—®é¢˜ä»£ç ">é—®é¢˜ä»£ç </h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.executor = ProcessPoolExecutor(max_workers=<span class="number">10</span>, mp_context=multiprocessing.get_context(<span class="string">&quot;spawn&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">arg</span>):</span><br><span class="line">        <span class="keyword">raise</span> concurrent.futures.process._RemoteTraceback(<span class="string">&quot;error&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, i</span>):</span><br><span class="line">        x = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            future = <span class="variable language_">self</span>.executor.submit(<span class="variable language_">self</span>.fun, i)</span><br><span class="line">            res = future.result(timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span>*<span class="number">20</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>():</span><br><span class="line">    f = Foo()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        f.call(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">with</span> ProcessPoolExecutor(max_workers=<span class="number">2</span>, mp_context=multiprocessing.get_context(<span class="string">&quot;spawn&quot;</span>)) <span class="keyword">as</span> e:</span><br><span class="line">        futures = e.submit(predict)</span><br><span class="line">        futures.result()</span><br></pre></td></tr></table></figure>
<p>è‚‰çœ¼è§‚å¯Ÿ ä¹ä¸€çœ‹è¿™æ®µä»£ç æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œåœ¨ submit ä¹‹åï¼Œè·å– result
ï¼Œå¹¶ä¸”ç”¨ try ... except ... æ¥æ•è·å¯èƒ½å‡ºç°çš„ä»»ä½•æƒ…å†µã€‚å°¤å…¶æ˜¯ï¼Œå½“ä¸ä½¿ç”¨
main å‡½æ•°ä¸­çš„è¿›ç¨‹æ± æ—¶ï¼Œç›´æ¥æ™®é€šçš„ä½¿ç”¨ predict
å‡½æ•°ï¼Œè¿™æ®µä»£ç ä¸ä¼šå¼•å‘ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥æ­£å¸¸çš„é€€å‡ºã€‚</p>
<p>ä½†ä¸ºä»€ä¹ˆæ”¹æˆå¤šè¿›ç¨‹æ—¶ï¼Œè¿™æ®µä»£ç å°±æ— æ³•æ­£å¸¸é€€å‡ºäº†å‘¢ï¼Ÿç¨‹åºæ— æ³•æ­£å¸¸é€€å‡ºå¾€å¾€æ˜¯å› ä¸ºç¨‹åºæŸäº›å¯¹è±¡æ²¡æœ‰å®Œå…¨è¢«é‡Šæ”¾å¹²å‡€ï¼Œä½†è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ç‰¹æ®Šçš„å‡½æ•°å´ä¾æ—§å¼•å‘äº†è¯¥é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©å·¥å…·æ¥è¿›è¡Œç®€å•çš„åˆ†æã€‚</p>
<h3 id="åˆ†æ">åˆ†æ</h3>
<p>garbage collector python çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸»è¦ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼ˆreference
countingï¼‰æ¥è·Ÿè¸ªå’Œå›æ”¶åƒåœ¾ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒPython
èƒ½å¤Ÿåœ¨å¯¹è±¡ç»“æŸæ‰§è¡Œåï¼Œå¼•ç”¨è®¡æ•°ä¼šå˜ä¸º
0ï¼Œä½¿å¾—æœ€åèƒ½å¤Ÿè¢«å›æ”¶ã€‚è¿™é‡Œç¨‹åºé€€å‡ºä¸äº†çš„åŸå› æ˜¯æŸäº›å¯¹è±¡æ²¡å‘è‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥åœ¨
predict å‡½æ•°ä¸­ï¼Œè§‚å¯Ÿå˜é‡ f å’Œ f.executor çš„å¼•ç”¨è®¡æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>():</span><br><span class="line">    f = Foo()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        f.call(i)</span><br><span class="line">    <span class="built_in">print</span>(sys.getrefcount(f))</span><br><span class="line">    <span class="built_in">print</span>(sys.getrefcount(f.executor))</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºçš„è¾“å‡ºï¼Œå¯¹è±¡ f çš„è®¡æ•°ä¸º 5ï¼Œè€Œ f.executor çš„è®¡æ•°ä¸º 2ã€‚ä¸ºä»€ä¹ˆæ˜¯
2ï¼Œå› æ­¤åœ¨æœ€å¤–å±‚è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹æ•°é‡ä¸º 2 çš„è¿›ç¨‹æ± æ²¡æœ‰æ‰§è¡Œå®Œã€‚è€Œ f ç­‰äº 4
è€Œä¸ç­‰äº f.executor è¿™å°±ä¸ç¬¦åˆé¢„æœŸï¼Œæ¯”æ­£å¸¸æ•°å€¼å¤š 3ã€‚è¿™ä¸ª 3 æ˜¯å› ä¸ºå¾ªç¯äº†
3 æ¬¡ï¼Œæ¯æ¬¡éƒ½å¼•å‘äº†å¼‚å¸¸ã€‚</p>
<p>è¿›ä¸€æ­¥åœ°ï¼Œè§‚å¯Ÿ f ä¸­ä»€ä¹ˆå¯¹è±¡æ²¡æœ‰è¢«æ¸…ç†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>():</span><br><span class="line">    f = Foo()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        f.call(i)</span><br><span class="line">    <span class="built_in">print</span>(gc.get_referrers(f))</span><br><span class="line">    <span class="built_in">print</span>(sys.getrefcount(f))</span><br><span class="line">    <span class="built_in">print</span>(sys.getrefcount(f.executor))</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶è¾“å‡ºä¼šå¤šä¸€è¡Œï¼Œå½¢å¦‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[&lt;frame at 0x10c266240, file <span class="string">&#x27;XXX&#x27;</span>, line 24, code call&gt;, &lt;frame at 0x10c6b0240, file <span class="string">&#x27;XXX&#x27;</span>, line 24, code call&gt;, &lt;frame at 0x10c6b0440, file <span class="string">&#x27;XXX&#x27;</span>, line 24, code call&gt;]</span><br></pre></td></tr></table></figure>
<p>è¿™è¡¨æ˜ç¨‹åºåœ¨ä½•å¤„çš„å¯¹è±¡æ²¡æœ‰è¢«å¤„ç†ï¼Œå¯ä»¥å®šä½åˆ°å‡½æ•° call çš„ return
ä½ç½®ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿ åœ¨è·å– result æ—¶ï¼Œå¦‚æœé‡åˆ°å¼‚å¸¸ï¼Œåˆ™ä¸­é—´å˜é‡ future
æ— æ³•è¢«å›æ”¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">result</span>(<span class="params">self, timeout=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return the result of the call that the future represents.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        timeout: The number of seconds to wait for the result if the future</span></span><br><span class="line"><span class="string">            isn&#x27;t done. If None, then there is no limit on the wait time.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        The result of the call that the future represents.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">        CancelledError: If the future was cancelled.</span></span><br><span class="line"><span class="string">        TimeoutError: If the future didn&#x27;t finish executing before the given</span></span><br><span class="line"><span class="string">            timeout.</span></span><br><span class="line"><span class="string">        Exception: If the call raised then that exception will be raised.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>._condition:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>._state <span class="keyword">in</span> [CANCELLED, CANCELLED_AND_NOTIFIED]:</span><br><span class="line">                <span class="keyword">raise</span> CancelledError()</span><br><span class="line">            <span class="keyword">elif</span> <span class="variable language_">self</span>._state == FINISHED:</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.__get_result()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>._condition.wait(timeout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>._state <span class="keyword">in</span> [CANCELLED, CANCELLED_AND_NOTIFIED]:</span><br><span class="line">                <span class="keyword">raise</span> CancelledError()</span><br><span class="line">            <span class="keyword">elif</span> <span class="variable language_">self</span>._state == FINISHED:</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.__get_result()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> TimeoutError()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># Break a reference cycle with the exception in self._exception</span></span><br><span class="line">        <span class="variable language_">self</span> = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="æ¶ˆé™¤ä¸­é—´å˜é‡-future">æ¶ˆé™¤ä¸­é—´å˜é‡ future</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">future = <span class="variable language_">self</span>.executor.submit(<span class="variable language_">self</span>.fun, i)</span><br><span class="line">res = future.result(timeout=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ”¹ä¸º</span></span><br><span class="line">res = <span class="variable language_">self</span>.executor.submit(<span class="variable language_">self</span>.fun, i).result(timeout=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="æ‰‹åŠ¨-gc">æ‰‹åŠ¨ GC</h4>
<p>åœ¨è°ƒç”¨å®Œ Foo ä¹‹åï¼Œä½¿ç”¨ gc.collect()</p>
<h4 id="ä¸»åŠ¨å…³é—­è¿›ç¨‹æ± ">ä¸»åŠ¨å…³é—­è¿›ç¨‹æ± </h4>
<p>åœ¨è°ƒç”¨å®Œ Foo ä¹‹åï¼Œä½¿ç”¨ f.executor.shutdown()</p>
<h4 id="åœ¨-return-å‰-ä¸»åŠ¨åˆ é™¤æœªé‡Šæ”¾çš„å¯¹è±¡">åœ¨ return å‰
ä¸»åŠ¨åˆ é™¤æœªé‡Šæ”¾çš„å¯¹è±¡</h4>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œä½¿ç”¨ future = None ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸ä¼¼æ•ˆæœï¼ˆè®© Python
è‡ªåŠ¨è°ƒç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, i</span>):</span><br><span class="line">   x = []</span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">       future = <span class="variable language_">self</span>.executor.submit(<span class="variable language_">self</span>.fun, i)</span><br><span class="line">       res = future.result(timeout=<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span>*<span class="number">20</span>)</span><br><span class="line">       <span class="keyword">del</span> future</span><br><span class="line">   <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="q-a">Q &amp; A</h3>
<p>Q: èƒ½ä¸èƒ½åœ¨ Foo ä¸­æ·»åŠ  <strong>del</strong> å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ A: åœ¨
Python 3.8.16 å¯ä»¥ï¼ŒPython 3.9.6 ä¸è¡Œã€‚å¯ä»¥æ‰‹åŠ¨å¢åŠ  <strong>del</strong>
å‡½æ•°æ·»åŠ  print å‡½æ•°ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å¯¹åº”çš„è¾“å‡ºã€‚</p>
<p>Q: gc æ˜¾ç¤ºä¸ºä»€ä¹ˆæ˜¯åœ¨ return è¿™ï¼Œè€Œä¸æ˜¯å…¶ä»–åœ°æ–¹ï¼Ÿ A: frame
å¯¹è±¡æœ‰ä¸€ä¸ªå±æ€§å«ä½œ f_linenoï¼Œå®ƒè¡¨ç¤ºå½“å‰æ‰§è¡Œçš„ä»£ç è¡Œã€‚å½“å‡½æ•°æ‰§è¡Œåˆ° return
è¯­å¥æ—¶ï¼Œf_lineno ä¼šæ›´æ–°ä¸º return è¯­å¥æ‰€åœ¨çš„è¡Œå·ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºåœ¨å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œæ§åˆ¶æƒä¼šè¿”å›åˆ°è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç ã€‚æ­¤æ—¶å‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼ˆåŒ…æ‹¬å®ƒçš„å±€éƒ¨å˜é‡ã€æ‰§è¡ŒçŠ¶æ€ç­‰ï¼‰ä¼šè¢«ä¸¢å¼ƒï¼Œæ ˆå¸§ä¹Ÿä¼šè¢«å¼¹å‡ºè°ƒç”¨æ ˆã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå‡½æ•°çš„é€€å‡ºæˆ–è¿”å›ã€‚æ‰€ä»¥ï¼Œreturn
è¯­å¥æ‰€åœ¨çš„è¡Œæ˜¯å‡½æ•°æ‰§è¡Œçš„æœ€åä¸€è¡Œã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>å†…å­˜æ³„æ¼</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ·é‡æ•°æ®å¤„ç†é—®é¢˜ï¼ˆHashMap+åˆ†æ²»æ³•ã€ä½å›¾æ³•ï¼‰</title>
    <url>/hexo_blog/2018/04/05/%E4%BC%A0%E7%BB%9F%E7%AE%97%E6%B3%95/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98%EF%BC%88HashMap+%E5%88%86%E6%B2%BB%E6%B3%95%E3%80%81%E4%BD%8D%E5%9B%BE%E6%B3%95%EF%BC%89/</url>
    <content><![CDATA[<p>ä»æµ·é‡æ•°æ®ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•°å’Œå‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°çš„è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«é‡‡ç”¨äº†åˆ†æ²»æ³•+HashMapå’Œä½å›¾æ³•Bitmapä¸¤ç§æ–¹æ³•ã€‚å…¶ä¸­ï¼Œä½å›¾æ³•åœ¨å¤§æ•°æ®é‡ä¸‹å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´å°ã€‚è€Œå¯¹äºå…¶ä»–ç±»ä¼¼é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨åˆ†æ²»æ³•åŠ æœ€å°å †/æœ€å¤§å †çš„æ–¹å¼å¤„ç†ã€‚</p>
<span id="more"></span>
<p>åŸæ–‡é“¾æ¥ï¼š<a
href="https://juejin.im/post/5aa0ee9f518825557c010bc0">ç»å…¸é¢è¯•é—®é¢˜: Top
K ä¹‹ ---- æµ·é‡æ•°æ®æ‰¾å‡ºç°æ¬¡æ•°æœ€å¤šæˆ–ï¼Œä¸é‡å¤çš„ã€‚</a></p>
<p>åœ¨æ•°æ®å¤„ç†ä¸­ï¼Œè¾ƒä¸ºæ£˜æ‰‹çš„æœ‰è¿™ä¹ˆä¸€ç§é—®é¢˜ï¼Œæµ·é‡æ•°æ®å¦‚ä½•è¿›è¡Œå¤„ç†ã€‚ä¸€æ—¦æ•°æ®çš„æ•°é‡è¶³å¤Ÿå¤§ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨å¸¸è§„çš„æ€è·¯æ¥è§£å†³ã€‚å…¸å‹ä¾‹å­å°±æ˜¯æ’åºç®—æ³•ï¼Œåœ¨æ•°æ®ä¸å¤§ï¼ˆä¸è¶…è¿‡å†…å­˜ï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ’åºç®—æ³•ï¼Œä½†æ˜¯å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨å¦‚å¤šè·¯å½’å¹¶æ­¤ç±»çš„ç®—æ³•ã€‚</p>
<p>æ€»ç»“é—®é¢˜ï¼š</p>
<ol type="1">
<li>å†…å­˜ä¸€æ¬¡æ€§ä¸èƒ½æ”¾ä¸‹æ‰€æœ‰çš„æ•°</li>
<li>æœºå™¨CPUæ ¸æ•°ä¸å¤Ÿ</li>
<li>â€¦â€¦</li>
</ol>
<h2 id="ä¸é‡å¤æ•°">ä¸é‡å¤æ•°</h2>
<p>åœ¨2.5äº¿ä¸ªæ­£æ•´æ•°ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•°ã€‚</p>
<h3 id="åˆ†æ²»æ³•hashmap">åˆ†æ²»æ³•+HashMap</h3>
<h4 id="è¯´æ˜">è¯´æ˜</h4>
<p>æ¯”å¦‚å°†è¿™äº›æ•°æ®å¹³å‡åˆ†ä¸º100ä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡å°±æœ‰250ä¸‡æ•°ã€‚æ¯ä¸ªæ‰¹æ¬¡ç”¨å¾ªç¯è¿›è¡Œéå†ï¼Œå­˜å…¥
<code>HashMap&lt;a, b&gt;</code>ï¼Œ<code>a</code>è¡¨ç¤ºæ¯ä¸ªæ•°ï¼Œ<code>b</code>è¡¨ç¤ºå¯¹åº”æ•°å‡ºç°æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚æ¯éå†å®Œä¸€æ‰¹ï¼Œå°±å¯¹å½“å‰
<code>HashMap</code>è¿›è¡Œå»é‡ï¼Œå¦‚æœ
<code>b &gt; 1</code>ï¼Œå°±æ’é™¤æ­¤æ•°ã€‚å…¨éƒ¨æ‰¹æ¬¡è¿›è¡Œå®Œç­›é€‰ä¹‹åï¼Œå‰©ä¸‹çš„æ•°æœ€åå¯ä»¥ç›´æ¥è¿›è¡Œç»Ÿè®¡ï¼Œå¾—å‡ºä¸é‡å¤çš„æ•°ã€‚</p>
<h4 id="åŒé—´å¤æ‚åº¦">åŒé—´å¤æ‚åº¦</h4>
<p>æ—¶é—´å¤æ‚åº¦ï¼š250W * 100è½® + å…¶ä»–æ‰¹æ¬¡ã€‚
è¿™é‡Œå¯ä»¥ä½¿ç”¨å¤šæ ¸æœºå™¨åŠ é€Ÿè¿ç®—ã€‚</p>
<p>ç©ºé—´å¤æ‚åº¦ï¼šintä¿å­˜æ•°ï¼Œ<code>Key + Valueï¼ˆ250W * 4Byteï¼‰/ (1024 * 1024)</code>çº¦ä¸º
<code>(Key + 9.5M)</code>å†…å­˜</p>
<h3 id="ä½å›¾æ³•-bitmap">ä½å›¾æ³• Bitmap</h3>
<h4 id="è¯´æ˜-1">è¯´æ˜</h4>
<p>è®¾è®¡æ¯ä¸¤ä¸ª
<code>bit</code>ä½ï¼Œæ ‡è¯†ä¸€ä¸ªæ•°çš„å‡ºç°æƒ…å†µã€‚å¦‚ï¼š00è¡¨ç¤ºæ²¡æœ‰å‡ºç°ï¼Œ01è¡¨ç¤ºå‡ºç°ä¸€æ¬¡ï¼Œ10è¡¨è¿°å‡ºç°å¤šæ¬¡ã€‚æ­¤é¢˜ç»™å‡ºçš„æ˜¯æ­£æ•´æ•°ï¼Œæ‰€ä»¥å°±æ˜¯æ— ç¬¦å·çš„æ•´å‹æ•°ï¼Œå å››ä¸ªå­—èŠ‚ã€‚</p>
<p>å†…å­˜çš„è®¡ç®—ã€‚1B=8b, 4B=32b, å®ƒå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°æ˜¯<span
class="math inline">\(2^{32}-1\)</span>, å³éœ€è¦$2^{32}-1 $çº¦ä½<span
class="math inline">\(2^{32}\)</span>ä¸ª<strong>ä½</strong>æ¥è¡¨ç¤ºè¿™2.5äº¿ä¸ªæ•°ï¼Œæ¯ä¸ªçŠ¶æ€æ˜¯ä¸¤ä¸ªæ•°ï¼Œæ€»å…±å°±æ˜¯<span
class="math inline">\(2^{32}\times 2\)</span>ä¸ªä½ã€‚</p>
<p>ä¸€æ¬¡æ€§ç”³è¯·çš„ä½å›¾å†…å­˜æ˜¯: $2^{32} $ bit, å³<span
class="math inline">\(\frac{2^{32}\times2}{(1024\times1024 \times
8)}=1\)</span> GBã€‚å¦‚æœåŠ ä¸Šåˆ†æ²»æ³•ï¼Œç”šè‡³éƒ½ä¸éœ€è¦1Gå†…å­˜ã€‚</p>
<p>å‡è®¾ä¸€ä¸ªæ•°æ˜¯64, åˆ™å¯¹åº”çš„bitä½æ˜¯ <span class="math inline">\(64\times
2=128\)</span>ï¼Œå³127å’Œ128å…±åŒæ ‡è¯†è¿™ä¸ªæ•°çš„å‡ºç°çŠ¶æ€ï¼ˆæ²¡æœ‰å‡ºç°ã€å‡ºç°ä¸€æ¬¡ã€å‡ºç°å¤šæ¬¡ï¼‰ã€‚æ‰€ä»¥ï¼Œæ¯å½“è¯»å…¥äº†ä¸€ä¸ªæ•°ï¼Œå…ˆæ‰¾å¯¹åº”çš„bitä½ï¼Œå¦‚æœæ˜¯00å°±æ”¹ä¸º01ï¼Œå¦‚æœæ˜¯01å°±æ”¹ä¸º10ï¼Œå¦‚æœæ˜¯10å°±ä¸éœ€è¦ä¿®æ”¹ã€‚æœ€åæ‰«ææ•´ä¸ªä½å›¾ï¼Œå¦‚æœæ˜¯10ï¼Œå°±å°†ä¸‹æ ‡/2å¾—å‡ºå‡ºç°æ¬¡æ•°ä¸º1çš„è¿™ä¸ªæ•°ã€‚</p>
<h2 id="å‡ºç°æ¬¡æ•°æœ€å¤šçš„">å‡ºç°æ¬¡æ•°æœ€å¤šçš„</h2>
<ol type="1">
<li>æ‰¾å‡ºä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå‡ºç°æ¬¡æ•°æœ€å¤šçš„å•è¯</li>
<li>10äº¿ä¸ªæ­£æ•´æ•°æ‰¾å‡ºé‡å¤æ¬¡æ•°æœ€å¤šçš„100ä¸ªæ•´æ•°</li>
</ol>
<p>è¿™ç±»é—®é¢˜è¢«å«åšTop Ké—®é¢˜</p>
<h3 id="åˆ†æ²»æ³•hashmap-1">åˆ†æ²»æ³•+HashMap</h3>
<p>å¯¹äºæ–‡ç« æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦è§„å®šæ¯æ‰¹æ¬¡çš„å­—æ•°é™åˆ¶ã€‚è¿™é‡Œå‡è®¾100ä¸ºä¸€æ‰¹çš„å¤„ç†æé™ï¼Œæ¯æ¬¡å¤„ç†100ä¸ªï¼Œå¦‚æœæœ€åä¸€æ‰¹å°‘äº100ä¸ªå°±ç›´æ¥å½“ä½œ100æ¥å¤„ç†ã€‚ä¹‹åæ¯æ‰¹æ–‡å­—è¿›è¡Œåˆ‡åˆ†(<code>split</code>)ï¼Œæ¯”å¦‚è‹±æ–‡çš„åˆ‡å‰²æ–¹æ³•å¯ä»¥æ˜¯ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ä»€ä¹ˆçš„ï¼Œä¸­æ–‡çš„åˆ‡å‰²æ–¹å¼å¯ä»¥æ˜¯ç©ºæ ¼æˆ–è€…æœ‰é¢„å…ˆå‡†å¤‡å¥½çš„è¯åº“ã€‚</p>
<p>ä¹‹åå°±è·Ÿä¸Šé¢ä¸é‡å¤æ•°å­—çš„æ€è·¯ç±»ä¼¼äº†ï¼Œéå†æ¯æ‰¹æ•°æ®ï¼Œå­˜å…¥
<code>HashMap&lt;String, Integer&gt;</code>ï¼ŒStringè¡¨ç¤ºå­—ç¬¦ä¸²ï¼ŒIntegerå¯¹åº”å‡ºç°çš„æ¬¡æ•°ï¼Œæœ€å¤§çš„Integerå°±æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„ã€‚</p>
<p>å¯¹æ•°å­—æ¥è¯´ï¼Œå°±æ˜¯è·Ÿä¸é‡å¤æ•°å­—æ€è·¯ç±»ä¼¼ï¼Œå°†åäº¿ä¸ªæ•°åˆ†ä¹˜å¾ˆå¤šä»½ï¼Œåˆ©ç”¨
<code>HashMap&lt;int, int&gt;</code>æ¥ç»Ÿè®¡ï¼Œæœ€åæ‰¾åˆ°ç¬¬äºŒä¸ªintæœ€å¤§çš„é‚£ä¸ªã€‚æ¯æ‰¹ç­›é€‰å®Œä¹‹åï¼Œå°±è¿›è¡Œæ’åºï¼Œé€‰å‡ºåäº¿ä¸ªæ•°ä¸­æœ€å¤§çš„ã€‚</p>
<h3 id="ä½å›¾æ³•-bitmap-1">ä½å›¾æ³• Bitmap</h3>
<p>å¯¹äºæ–‡ç« ï¼ˆå­—ç¬¦ä¸²ï¼‰æ¥è¯´ï¼Œä¸å»ºè®®é‡‡ç”¨</p>
<p>å¯¹äºæ•°å­—æ¥è¯´ï¼Œæ­¤é¢˜çš„èƒŒæ™¯ä¸éœ€è¦ä¹˜2ï¼Œå°†æ¯ä¸ªæ•°å­˜è¿›ä½å›¾ã€‚å‡ºç°äº†ä¸€æ¬¡ï¼Œbitä½=1ï¼Œæ²¡æœ‰å‡ºç°å°±æ˜¯0ã€‚ä½†æ˜¯æ²¡æœ‰åŠæ³•ç»Ÿè®¡å‡ºç°æ¬¡æ•°ï¼Œæ‰€ä»¥æ­¤é¢˜ä¹Ÿä¸é€‚åˆé‡‡ç”¨ä½å›¾æ³•ã€‚</p>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<p>åœ¨XXXä¸­æ‰¾å‡ºæœ€å¤§ã€æœ€å°ã€æœ€å¤§çš„å‡ ä¸ªã€æœ€å°çš„å‡ ä¸ªã€‚éƒ½å¯ä»¥ä½¿ç”¨åˆ†æ²»æ³•+æœ€å°å †/æœ€å¤§å †ã€‚</p>
]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>HashMap</tag>
        <tag>ä½å›¾æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Mongodbä»å®‰è£…åˆ°åŸºæœ¬æ“ä½œ</title>
    <url>/hexo_blog/2017/11/24/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»é›¶å¼€å§‹ä»‹ç»å¦‚ä½•åœ¨Centos7ä¸‹å®‰è£…Mongodb,
ç”¨Python3è¿æ¥Mongodb, ç”¨å¯è§†åŒ–å·¥å…·Robo 3Tè¿æ¥Mongodb,
ä¹‹åä»‹ç»äº†ä¸€äº›åŸºæœ¬çš„mongoæ“ä½œæ–¹æ³•, å…¶ä¸­å«æœ‰ä¸€äº›è¿›é˜¶æ“ä½œ</p>
<span id="more"></span>
<h2 id="å®‰è£…mongodbcentos7">å®‰è£…Mongodb(Centos7)</h2>
<ol type="1">
<li>å®˜ç½‘ä¸Šæ‰¾åˆ°éœ€è¦ä¸‹è½½çš„ç‰ˆæœ¬å‹ç¼©åŒ…è¿›è¡Œä¸‹è½½ï¼Œ<a
href="https://fastdl.mongodb.org/linux/">å®˜ç½‘é“¾æ¥</a>ã€‚æˆ–è€…åœ¨å‘½ä»¤è¡Œä¸‹ä½¿ç”¨<code>wget</code>å‘½ä»¤è¿›è¡Œä¸‹è½½</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œä¸‹è½½çš„æ˜¯3.4.10ç‰ˆæœ¬</span></span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-3.4.10.tgz</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>è¿›è¡Œè§£å‹ç¼©</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹ç¼©</span></span><br><span class="line">tar -zxvf mongodb-linux-x86_64*.tgz</span><br><span class="line"><span class="comment"># é‡å‘½å</span></span><br><span class="line"><span class="built_in">mv</span> mongodb-linux-x86_64* mongodb</span><br><span class="line"><span class="comment"># ç§»åŠ¨åˆ°ä½ æƒ³æ”¾ç½®çš„ç›®å½•ä¸‹ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨/optç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mv</span> mongodb /opt/</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>è¿›è¡Œç›¸åº”çš„é…ç½®ï¼Œmongodbé»˜è®¤æ²¡æœ‰ä»»ä½•é…ç½®</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œmongodbä¸»ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/</span><br><span class="line"><span class="comment"># å»ºç«‹å­˜æ”¾æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p data/test/logs</span><br><span class="line"><span class="built_in">mkdir</span> -p data/test/db</span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹é…ç½®</span></span><br><span class="line">vim bin/mongodb.conf</span><br><span class="line">  `</span><br><span class="line">    <span class="comment"># è®¾ç½®æ•°æ®æ–‡ä»¶çš„å­˜æ”¾ç›®å½•</span></span><br><span class="line">    dbpath = /opt/mongodb/data/test/db</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾ç›®å½•åŠå…¶æ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line">    logpath = /opt/mongodb/data/test/logs/mongodb.log</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®ç«¯å£å·ï¼ˆé»˜è®¤çš„ç«¯å£å·æ˜¯27017ï¼Œå¯ä»¥æ ¹æ®ä¸ªäººéœ€æ±‚è¿›è¡Œæ›´æ”¹ï¼‰</span></span><br><span class="line">    port = 27017</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®ä¸ºä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå³åœ¨åå°è¿è¡Œ</span></span><br><span class="line">    fork = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ˜¯å¦ä¸å…è®¸è¡¨æ‰«æ</span></span><br><span class="line">    nohttpinterface = <span class="literal">true</span></span><br><span class="line">  `</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>å¯åŠ¨mongodb</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨</span></span><br><span class="line">./bin/mongod --config mongodb.conf</span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™ä¸€ï¼š
<code>ERROR: child process failed, exited with error number 1</code>
æ£€æŸ¥mongodb.confçš„æ–‡ä»¶è·¯å¾„æ˜¯å¦é…ç½®é”™è¯¯</p>
<p>æŠ¥é”™äºŒï¼š<code>ERROR: child process failed, exited with error number 100</code>
å¾ˆå¯èƒ½æ˜¯æ²¡æœ‰æ­£å¸¸å…³é—­å¯¼è‡´çš„ï¼Œé‚£ä¹ˆå¯ä»¥åˆ é™¤
<code>mongod.lock</code>æ–‡ä»¶ï¼Œè¿™é‡Œå¯¹åº”æˆ‘çš„é…ç½®è·¯å¾„åœ¨<code>data/</code>é‡Œé¢</p>
<ol start="5" type="1">
<li>å…¶ä»–</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é“¾æ¥å‘½ä»¤ï¼Œæ–¹ä¾¿è°ƒç”¨mongoå‘½ä»¤</span></span><br><span class="line"><span class="built_in">ln</span> -s /opt/mongodb/bin/mongo /usr/bin</span><br><span class="line"><span class="comment"># æŸ¥çœ‹mongodbè¿›ç¨‹</span></span><br><span class="line">ps -aux |grep mongodb</span><br><span class="line"><span class="comment"># æ£€æŸ¥ç«¯å£è¿è¡Œæƒ…å†µ</span></span><br><span class="line">netstat -lanp | grep 27017</span><br><span class="line"><span class="comment"># ç»ˆæ­¢mongodbæœåŠ¡ï¼ŒPIDä»pså‘½ä»¤è·å–</span></span><br><span class="line"><span class="built_in">kill</span> -15 PID</span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå¯åŠ¨å‘½ä»¤</span></span><br><span class="line">vim /etc/rc.local</span><br><span class="line"><span class="comment"># æœ«å°¾è¿½åŠ ä¸€è¡Œ</span></span><br><span class="line">`/opt/mongodb/bin/mongod --config mongodb.conf`</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>
<ol start="6" type="1">
<li>è®¾ç½®å¯†ç æƒé™ï¼Œé»˜è®¤æ— å¯†ç </li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œmongodbçš„äº¤äº’ç¯å¢ƒ</span></span><br><span class="line">./mongo</span><br><span class="line"><span class="comment"># å¦‚æœè¿›å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†è½¯é“¾æ¥å’Œæ˜¯å¦å¯åŠ¨äº†mongodbæœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œadminæ•°æ®åº“ï¼Œåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·rootï¼Œå¯†ç ä¸ºpasswordï¼Œæƒé™æ˜¯è¶…çº§ç”¨æˆ·ï¼ˆæœ€é«˜ï¼‰</span></span><br><span class="line">&gt;use admin</span><br><span class="line">&gt;db.createUser(&#123;user:<span class="string">&quot;root&quot;</span>,<span class="built_in">pwd</span>:<span class="string">&quot;password&quot;</span>,roles:[<span class="string">&quot;root&quot;</span>]&#125;)</span><br><span class="line"><span class="comment"># éªŒè¯æ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œè¿”å›1è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">&gt;db.auth(&#123;<span class="string">&quot;root&quot;</span>, <span class="string">&quot;password&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># é€€å‡ºäº¤äº’ç¯å¢ƒ</span></span><br><span class="line">&gt;<span class="built_in">exit</span></span><br><span class="line"><span class="comment"># é‡å¯mongodbæœåŠ¡</span></span><br><span class="line"><span class="comment"># æ€æ­»mongodbè¿›ç¨‹ï¼Œå‚ç…§ä¸Šé¢çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"># ä»¥å¯†ç æƒé™éªŒè¯å¯åŠ¨æœåŠ¡</span></span><br><span class="line">opt/mongodb/mongod --config mongodb.conf --auth</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨pythonè¿æ¥mongodb">ä½¿ç”¨Pythonè¿æ¥Mongodb</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…</span></span><br><span class="line">pip3 install pymongo</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="comment"># hostä¸»æœºåï¼Œ27017è¿æ¥ç«¯å£</span></span><br><span class="line">client = MongoClient(host, <span class="number">27017</span>)</span><br><span class="line">db_auth = client.admin</span><br><span class="line"><span class="comment"># ç™»é™†çš„ç”¨æˆ·å(username)å’Œå¯†ç (password)</span></span><br><span class="line">db_auth.authenticate(username, password)</span><br><span class="line"><span class="comment"># è¿æ¥æŒ‡å®šæ•°æ®åº“ï¼Œæ•°æ®åº“åä¸ºdb_name</span></span><br><span class="line">db_name = client[<span class="string">&quot;db_name&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·å(username)ã€å¯†ç (password)ã€ä¸»æœºå(host)ã€ç«¯å£(port)ã€‚æ³¨ï¼šè¿™é‡Œçš„passwordä¸èƒ½å‡ºç°@ç¬¦å·ï¼Œå¦‚æœç”¨@ç¬¦å·å°±éœ€è¦ä½¿ç”¨æ–¹æ³•ä¸€</span></span><br><span class="line">client = MongoClient(<span class="string">&quot;mongodb://username:password@host:port&quot;</span>)</span><br><span class="line"><span class="comment"># è¿æ¥æŒ‡å®šæ•°æ®åº“ï¼Œæ•°æ®åº“åä¸ºdb_name</span></span><br><span class="line">db_name = client[<span class="string">&quot;db_name&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ“ä½œæ•°æ®åº“ï¼Œdb_name[&quot;db_set&quot;]=db_name.db_set</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æŸ¥æ‰¾æ•°æ®</span></span><br><span class="line"><span class="string">åœ¨db_nameæ•°æ®åº“ä¸­çš„db_seté›†åˆé‡Œé¢æ‰¾åˆ°nameæ˜¯a_nameçš„json</span></span><br><span class="line"><span class="string">findæ˜¯è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼ˆå¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹å¼æ¥è¯»å–ï¼‰ï¼Œfind_oneè¿”å›ä¸€ä¸ªdict</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">db_name[<span class="string">&quot;db_set&quot;</span>].find_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;a_name&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment"># æ’å…¥ä¸€ä¸ªjsonåˆ°set1é›†åˆä¸­ï¼Œa_dictæ˜¯ä¸€ä¸ªå­—å…¸ï¼ˆå¦‚æœset1ä¸å­˜åœ¨åˆ™ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼‰</span></span><br><span class="line">db_name.set1.insert_one(a_dict)</span><br><span class="line"><span class="comment"># æ’å…¥å¤šä¸ªjsonåˆ°set1é›†åˆä¸­ï¼Œa_dict_lstæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯ç”±å­—å…¸ç»„æˆçš„</span></span><br><span class="line">db_name.set1.insert_many(a_dict_lst)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°æ•°æ®</span></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾åˆ°ä¸€ä¸ªæ•°æ®ä¹‹åï¼Œå¯¹é‡Œé¢çš„æŸä¸ªæ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œå†ä½¿ç”¨saveæ–¹æ³•ä¿å­˜</span></span><br><span class="line">data_one = db_name[<span class="string">&quot;db_set&quot;</span>].find_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;a_name&quot;</span>&#125;)</span><br><span class="line">data_one[<span class="string">&#x27;age&#x27;</span>] += <span class="number">3</span></span><br><span class="line">db_name.db_set.save(data_one)</span><br><span class="line"><span class="comment"># æ›´æ–°å¤šæ¡è®°å½•ï¼Œæ‰¾åˆ°db_seté›†åˆä¸­æ»¡è¶³age=20ï¼Œsex=0çš„æ•°æ®ï¼Œå°†nameæ”¹ä¸ºuser1</span></span><br><span class="line">db_name.db_set.update(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>&#125;, &#123;<span class="string">&quot;$set&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;sex&quot;</span>: <span class="number">0</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="built_in">id</span> = db_name.db_set.find_one(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>&#125;)[<span class="string">&quot;_id&quot;</span>]</span><br><span class="line"><span class="comment"># æ ¹æ® id åˆ é™¤ä¸€æ¡è®°å½•</span></span><br><span class="line">db_name.db_set.remove(<span class="built_in">id</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤é›†åˆé‡Œçš„æ‰€æœ‰è®°å½•</span></span><br><span class="line">db_name.db_set.remove()</span><br><span class="line"><span class="comment"># åˆ é™¤name=user1çš„è®°å½•</span></span><br><span class="line">db_name.db_set.remove(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨robo-3tè¿æ¥mongodb">ä½¿ç”¨Robo 3tè¿æ¥Mongodb</h2>
<p>å¼ºçƒˆæ¨èRobo 3tï¼Œ<a href="https://robomongo.org/">å®˜ç½‘åœ°å€</a></p>
<ol type="1">
<li><p>åˆ°å®˜ç½‘æ‰¾åˆ°å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œä¸‹è½½</p></li>
<li><p>å®‰è£…</p>
<ul>
<li><p>Windowsçš„å®‰è£…ååˆ†ç®€å•å°±ä¸èµ˜è¿°äº†</p></li>
<li><p>Ubuntuçš„å®‰è£… <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹ç¼©</span></span><br><span class="line">tar -zxzf robomongo*.tar.gz</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="built_in">mv</span> robomongo* robo3t</span><br><span class="line"><span class="comment"># ç§»åŠ¨åˆ°/optç›®å½•ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="built_in">mv</span> robo3t /opt</span><br><span class="line"><span class="comment"># å»ºç«‹è½¯é“¾æ¥</span></span><br><span class="line"><span class="built_in">ln</span> -s /opt/robo3t/robomongo /usr/bin</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">robomongo</span><br></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯</span></span><br><span class="line">`</span><br><span class="line">This application failed to start because it could not find or load the Qt platform plugin <span class="string">&quot;xcb&quot;</span> <span class="keyword">in</span> <span class="string">&quot;&quot;</span>.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"></span><br><span class="line">Reinstalling the application may fix this problem.</span><br><span class="line">Aborted (core dumped)</span><br><span class="line">`</span><br><span class="line"><span class="comment"># è§£å†³åŠæ³•</span></span><br><span class="line"><span class="built_in">mkdir</span> ~/robo-backup</span><br><span class="line"><span class="built_in">mv</span> /opt/robo3t/lib/libstdc++* ~/robo-backup/</span><br><span class="line"><span class="comment"># ä¹‹åä¾¿å¯ä»¥é‡æ–°å¯åŠ¨mongoè¯•è¯•çœ‹äº†</span></span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>ä½¿ç”¨</p>
<ol type="1">
<li>é¦–å…ˆåˆ›å»ºæ–°çš„è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨<code>Connectionä¸­ï¼Œ``Name</code>ä¸ºè‡ªå®šä¹‰è¿æ¥åï¼Œ<code>Address</code>å¡«å…¥å¯¹åº”çš„<code>host</code>å’Œ<code>port</code>ï¼›
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/mongodb/20171124171027733.png" /></li>
<li>åœ¨<code>Authentication</code>ä¸­ï¼Œå‹¾é€‰<code>Perform authentication</code>ï¼Œå¡«ä¸Šå¯¹åº”çš„<code>User Name</code>å’Œ<code>Password</code>ã€‚å¡«å†™å®Œæˆä¹‹åå¯ä»¥ç‚¹å‡»<code>Test</code>éªŒè¯æ˜¯å¦èƒ½å¤Ÿè¿æ¥æˆåŠŸï¼Œå¦‚æœæ— è¯¯çš„è¯ï¼Œå¯ä»¥ç‚¹å‡»<code>Save</code>ä¿å­˜é€€å‡ºã€‚</li>
</ol>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/mongodb/20171124171111807.png" /></p>
<ol start="3" type="1">
<li>è¿æ¥Mongodbã€‚ç‚¹å‡»<code>Connect</code>ï¼Œä¹‹åå°±å¯ä»¥å¯è§†åŒ–æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨é¼ æ ‡ç®€å•çš„è¿›è¡Œåˆ›å»º/åˆ é™¤æ•°æ®åº“ï¼Œæ–°å»º/ä¿®æ”¹ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥æ‰¾æ•°æ®ã€‚</li>
</ol></li>
</ol>
<h2 id="curdæ“ä½œä¸»è¦æ˜¯æŸ¥æ‰¾æ•°æ®">CURDæ“ä½œï¼ˆä¸»è¦æ˜¯æŸ¥æ‰¾æ•°æ®ï¼‰</h2>
<p><strong>CRUD</strong></p>
<ul>
<li>C: Create Operations, åˆ›å»º</li>
<li>R: Read Operations, è¯»å–</li>
<li>U: Update Operations, æ›´æ–°</li>
<li>D: Delete Operations, åˆ é™¤</li>
</ul>
<p>mongoæ•°æ®åº“è‡³ä¸Šè€Œä¸‹æ˜¯ï¼š<code>Database</code>--&gt;<code>Collections</code>--&gt;<code>Documents</code>ã€‚æˆ‘åœ¨è¿™é‡Œåˆ†åˆ«ç†è§£æˆæ•°æ®åº“ã€é›†åˆã€è®°å½•ã€‚</p>
<p>è¿™é‡Œç›´æ¥ç”¨å®˜æ–¹ç»™çš„æ•°æ®æ¥æ“ä½œã€‚å‡è®¾ä»¥ä¸‹æ•°æ®æ”¾åœ¨äº†<code>fruits</code>é›†åˆä¸­ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apples&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">-1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;Uin&quot;</span><span class="punctuation">:</span> <span class="number">124</span><span class="punctuation">,</span> <span class="attr">&quot;NickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bananas&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;oranges&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;in stock&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span> <span class="attr">&quot;ordered&quot;</span><span class="punctuation">:</span> <span class="number">12</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>  <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;avocados&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fourteen&quot;</span> <span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h3>
<p><code>json</code>æ•°æ®çš„åµŒå¥—æŸ¥æ‰¾ï¼Œå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰å­—æ®µåŒ…å«jsonï¼Œå¯ä»¥ç›´æ¥ç”¨<code>.</code>è¿›è¡Œè¿æ¥ã€‚</p>
<p>æŸ¥æ‰¾<code>qty</code>ä¸­çš„<code>ordered</code>ä¸º12çš„å­—æ®µ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty.ordered&quot;: <span class="number">12</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>å¤šé‡ç­›é€‰ï¼ŒåŒæ—¶æ»¡è¶³å¤šä¸ªè¦æ±‚çš„è®°å½•</p>
<p>æŸ¥æ‰¾<code>qty</code>ä¸º5ï¼Œä¸”<code>_id</code>ä¸º"apples"çš„è®°å½•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty&quot;: <span class="number">5</span>, &quot;_id&quot;: &quot;apples&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå¤§æ‹¬å·å†…å®¹è¡¨ç¤ºç­›é€‰æ¡ä»¶ï¼Œç¬¬äºŒä¸ªå¤§æ‹¬å·è¡¨ç¤ºæ˜¾ç¤ºå†…å®¹</p>
<p>ç­›é€‰æ¡ä»¶å°±ä¸è¯´æ˜äº†ï¼Œç¬¬äºŒä¸ªå¤§æ‹¬å·è¡¨ç¤ºæ‰“å°<code>_id</code>å­—æ®µå’Œ<code>score</code>å­—æ®µï¼Œä¸æ‰“å°å…¶ä»–å­—æ®µï¼Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty&quot;: <span class="number">5</span>&#125;, &#123; &quot;_id&quot;: <span class="number">1</span> , &quot;score&quot;: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h3>
<p>ä¸‹é¢è‡³ä¸Šè€Œä¸‹åˆ†åˆ«è¡¨ç¤ºï¼Œåœ¨<code>fruits</code>é›†åˆä¸­æŸ¥æ‰¾å­—æ®µ<code>qty</code>ä¸4çš„å¤§å°å…³ç³»æ‰€æœ‰è®°å½•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty&quot;: <span class="number">4</span>&#125;)          # ç­‰äº</span><br><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$gt&quot;: <span class="number">4</span>&#125;&#125;)   # å¤§äº</span><br><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$lt&quot;: <span class="number">4</span>&#125;&#125;)   # å°äº</span><br><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$gte&quot;: <span class="number">4</span>&#125;&#125;)  # å¤§äºç­‰äº</span><br><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$lte&quot;: <span class="number">4</span>&#125;&#125;)  # å°äºç­‰äº</span><br><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$ne&quot;: <span class="number">4</span>&#125;&#125;)   # ä¸ç­‰äº</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªæ¯”è¾ƒç¬¦ä¸€èµ·æ“ä½œï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty&quot;: &#123;&quot;$gt&quot;: <span class="number">3</span>, &quot;$lt&quot;: <span class="number">5</span>&#125;&#125;)  # å¤§äº<span class="number">3</span>å°äº<span class="number">5</span>ã€‚</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¯¹<code>score</code>è¿™ä¸ªå­—æ®µä½¿ç”¨æ¯”è¾ƒï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;score&quot;: &#123;&quot;$gt&quot;: <span class="number">2</span>, &quot;$lt&quot;: <span class="number">5</span>&#125;&#125;)  # å¤§äº<span class="number">3</span>å°äº<span class="number">5</span>ã€‚</span><br></pre></td></tr></table></figure>
<p>å°†ä¼šè¿”å›ä¸‹é¢ä¸¤æ¡è®°å½•ã€‚ç†ç”±æ˜¯ï¼Œå­—æ®µé‡Œçš„æ•°ç»„é‡Œæœ‰å«æœ‰å¤§äº2å°äº5çš„æ•°å­—ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;apples&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;qty&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">-1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;links&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Uin&quot;</span> <span class="punctuation">:</span> <span class="number">124</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NickName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2 */</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bananas&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;qty&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">5</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="å…³ç³»">å…³ç³»</h3>
<h4 id="in">$in</h4>
<p>æŸ¥æ‰¾<code>_id</code>å­—æ®µä¸­åŒ…å«<code>5</code>æˆ–è€…<code>ObjectId("507c35dd8fada716c89d0013")</code>çš„è®°å½•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;_id&quot;: &#123;&quot;$in&quot;:[<span class="number">5</span>, ObjectId(&quot;507c35dd8fada716c89d0013&quot;)] &#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="elemmatch">$elemMatch</h4>
<p>ç”¨äºå­—æ®µä¸­å«æœ‰æ•°ç»„ï¼Œä¸”æ•°ç»„ä¸­å«æœ‰<code>json</code>æ•°æ®çš„çš„æŸ¥æ‰¾ã€‚</p>
<p>æŸ¥æ‰¾<code>links</code>è¿™ä¸ªå«æœ‰æ•°ç»„çš„å­—æ®µï¼Œæ‰¾å‡ºæ•°ç»„ä¸­<code>Uin</code>ç­‰äº124çš„è®°å½•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;links&quot;: &#123;&quot;$elemMatch&quot;: &#123;&quot;Uin&quot;: <span class="number">124</span>&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="slice">$slice</h4>
<p>åˆ‡ç‰‡ï¼Œåªæ‰“å°å­—æ®µä¸­æ•°ç»„å‰nä¸ªæ•°æ®</p>
<p>ç­›é€‰å‡ºè®°å½•ä¹‹åï¼Œåªæ‰“å°è®°å½•<code>score</code>å­—æ®µçš„å‰1æ¡æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;qty&quot;: <span class="number">5</span>&#125;, &#123;&quot;_id&quot;: <span class="number">1</span>, &quot;score&quot;: &#123;&quot;$slice&quot;: <span class="number">1</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;apples&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">-1</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="regex">$regex</h4>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´å¤šæ“ä½œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£: <a
href="https://docs.mongodb.com/manual/reference/operator/query/regex/index.html">$regex</a></p>
<p>æ‰¾å‡º<code>_id</code>å­—æ®µä¸­æ‰€æœ‰ä»¥aå¼€å¤´çš„è®°å½•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find(&#123;&quot;_id&quot;: &#123;&quot;$regex&quot;: &quot;^a&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åç¼€">åç¼€</h3>
<h4 id="sortæ’åº">sortâ€”â€”æ’åº</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find().sort(&#123;&quot;qty&quot;: <span class="number">1</span>&#125;) # å‡åº</span><br><span class="line">db.fruits.find().sort(&#123;&quot;qty&quot;: <span class="number">-1</span>&#125;) # é™åº</span><br></pre></td></tr></table></figure>
<h4 id="limité™åˆ¶">limitâ€”â€”é™åˆ¶</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find().limit(<span class="number">3</span>) # å¯¹æŸ¥è¯¢ç»“æœåªè¾“å‡ºå‰<span class="number">3</span>ä¸ªï¼Œå¯ä»¥åŠ åœ¨sortåé¢ç»“åˆä½¿ç”¨</span><br></pre></td></tr></table></figure>
<h4 id="skipè·³è¿‡">skipâ€”â€”è·³è¿‡</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find().<span class="keyword">skip</span>(<span class="number">3</span>) # å¯¹æŸ¥è¯¢ç»“æœè·³è¿‡è¾“å‡ºå‰<span class="number">3</span>ä¸ªï¼Œå³ä¸è¾“å‡ºå‰<span class="number">3</span>ä¸ªï¼Œå¯ä»¥åŠ åœ¨sortåé¢ç»“åˆä½¿ç”¨</span><br></pre></td></tr></table></figure>
<h4 id="countè®¡æ•°">countâ€”â€”è®¡æ•°</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find().<span class="built_in">count</span>()  # è¿”å›æŸ¥è¯¢ç»“æœæ€»æ•°</span><br></pre></td></tr></table></figure>
<h4
id="collationåŸºäºç‰¹å®šè¯­è¨€è¿›è¡Œæ“ä½œ">collationâ€”â€”åŸºäºç‰¹å®šè¯­è¨€è¿›è¡Œæ“ä½œ</h4>
<p>æ²¡æœ‰æ€ä¹ˆçœ‹æ‡‚ï¼Œæˆ‘ç†è§£çš„å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼Œè¿è¡Œæ ¹æ®ç‰¹å®šè¯­è¨€æ¥è¿›è¡ŒæŸ¥æ‰¾ã€‚æ„Ÿè§‰ç”¨çš„ä¸å¤šï¼Œè¿™é‡Œè´´ä¸Šå®˜æ–¹ç»™çš„ä¾‹å­</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.fruits.find().<span class="keyword">collation</span>( &#123; locale: &quot;en_US&quot;, strength: <span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ªäººå¸¸ç”¨æ“ä½œ">ä¸ªäººå¸¸ç”¨æ“ä½œ</h3>
<p>ä¾‹å­ï¼š <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// test_db</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;56063f17ade2f21f36b03133&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;MongoDB æ•™ç¨‹&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;MongoDB æ˜¯ä¸€ä¸ª Nosql æ•°æ®åº“&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;by&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;èœé¸Ÿæ•™ç¨‹&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;url&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;http://www.runoob.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">           <span class="string">&quot;mongodb&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="string">&quot;database&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="string">&quot;NoSQL&quot;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;links&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;UserName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;@a1bf7a55ad8478017b95124774687769&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;Uin&quot;</span> <span class="punctuation">:</span> <span class="number">12266535</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;NickName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ä¸€äºŒä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;UserName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;@5571e120b5d8f54f93338c76f62b9c419b818c29373dca9f331c2911a203bfbe&quot;</span><span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;Uin&quot;</span> <span class="punctuation">:</span> NumberLong(<span class="number">3379331828</span>)<span class="punctuation">,</span></span><br><span class="line">           <span class="attr">&quot;NickName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;çµçµå…«&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="è¿”å›æŸ¥æ‰¾ç»“æœçš„æ•°ç›®">è¿”å›æŸ¥æ‰¾ç»“æœçš„æ•°ç›®</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.test_db.find(&#123;&quot;title&quot;: &quot;MongoDB æ•™ç¨‹&quot;&#125;).<span class="built_in">count</span>()</span><br></pre></td></tr></table></figure>
<h4
id="æŸ¥æ‰¾æŸä¸ªkeyä¸­çš„æ•°ç»„æ˜¯å¦æŸåŒ…å«æŸå†…å®¹">æŸ¥æ‰¾æŸä¸ªkeyä¸­çš„æ•°ç»„æ˜¯å¦æŸåŒ…å«æŸå†…å®¹</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.test_db.find(&#123;&quot;tags&quot;: &#123;&quot;$in&quot;: [&quot;mongodb&quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨æ­£åˆ™è¿›è¡ŒæŸ¥æ‰¾">ä½¿ç”¨æ­£åˆ™è¿›è¡ŒæŸ¥æ‰¾</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.test_db.find(&#123;&quot;url&quot;: &#123;&quot;$regex&quot;: &quot;^http&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥æ‰¾æŸä¸ªç”±æ•°ç»„æ„æˆçš„keyæ–¹æ³•">æŸ¥æ‰¾æŸä¸ªç”±æ•°ç»„æ„æˆçš„keyæ–¹æ³•</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.test_db.find(&#123;&quot;links&quot;:&#123;&quot;$elemMatch&quot;:&#123;&quot;Uin&quot;:<span class="number">12266535</span>,&quot;NickName&quot;:&quot;ä¸€äºŒä¸‰&quot;&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="é™„å½•">é™„å½•</h2>
<h3 id="æ•°æ®åº“æƒé™è¯´æ˜è¡¨">æ•°æ®åº“æƒé™è¯´æ˜è¡¨</h3>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr>
<th>åç§°</th>
<th style="text-align: left;">æƒé™</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°æ®åº“ç”¨æˆ·è§’è‰²</td>
<td style="text-align: left;">readã€readWrite</td>
</tr>
<tr>
<td>æ•°æ®åº“ç®¡ç†è§’è‰²</td>
<td style="text-align: left;">dbAdminã€dbOwnerã€userAdmin</td>
</tr>
<tr>
<td>é›†ç¾¤ç®¡ç†è§’è‰²</td>
<td
style="text-align: left;">clusterAdminã€clusterManagerã€clusterMonitorã€hostManager</td>
</tr>
<tr>
<td>å¤‡ä»½æ¢å¤è§’è‰²</td>
<td style="text-align: left;">backupã€restore</td>
</tr>
<tr>
<td>æ‰€æœ‰æ•°æ®åº“è§’è‰²</td>
<td
style="text-align: left;">readAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase</td>
</tr>
<tr>
<td>è¶…çº§ç”¨æˆ·è§’è‰²</td>
<td style="text-align: left;">root</td>
</tr>
<tr>
<td>æä¾›äº†ç³»ç»Ÿè¶…çº§ç”¨æˆ·çš„è®¿é—®</td>
<td style="text-align: left;">dbOwner
ã€userAdminã€userAdminAnyDatabase</td>
</tr>
<tr>
<td>å†…éƒ¨è§’è‰²</td>
<td style="text-align: left;">__system</td>
</tr>
</tbody>
</table>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/hexo_blog/2021/07/21/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb%E4%BA%8C/" title="Mongodbï¼šå‰¯æœ¬é›†é…ç½®">Mongodbï¼šå‰¯æœ¬é›†é…ç½®</a></p>
]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>mongodb</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode å­—ç¬¦ä¸²åˆ·é¢˜è®°å½•</title>
    <url>/hexo_blog/2023/08/28/%E4%BC%A0%E7%BB%9F%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<p>å­—ç¬¦ä¸²åˆ·é¢˜åˆ†ç±»</p>
<span id="more"></span>
<h2 id="æ»‘åŠ¨çª—å£">æ»‘åŠ¨çª—å£</h2>
<p><a
href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">3.
æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></p>
<p>ä»å·¦å‘å³æ»‘ï¼Œéœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆAï¼‰è®°å½•å·²ç»éå†çš„å­—ç¬¦ï¼Œè¿˜æœ‰ä¸€ä¸ªå˜é‡ï¼ˆBï¼‰è®°å½•æœ€å¤§é•¿åº¦</p>
<p>æ³¨ï¼šæ¯æ¬¡ä¸éœ€è¦ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯å¯ä»¥ä»é‡å¤é‚£ä¸ªå­—ç¬¦çš„åä¸€ä¸ªå¼€å§‹ï¼Œæ‰€ä»¥Aéœ€è¦è®°å½•ä¸€ä¸‹ç´¢å¼•</p>
<h2 id="kmp">KMP</h2>
<h2 id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</h2>
<p><a
href="https://leetcode.cn/problems/longest-palindromic-substring/">5.
æœ€é•¿å›æ–‡å­ä¸²</a></p>
<p>ä¸¤ä¸ªæŒ‡é’ˆä»ä¸¤å¤´å¼€å§‹ï¼Œæ‰€ä»¥éœ€è¦äºŒç»´DPï¼Œå…ƒç´ æ˜¯boolåˆ¤æ–­</p>
<p><a href="https://leetcode.cn/problems/interleaving-string/">97.
äº¤é”™å­—ç¬¦ä¸²</a></p>
<p>ä¸¤ä¸ªå­—ç¬¦ä¸²ç»„æˆæ–°çš„å­—ç¬¦ä¸²ï¼ŒäºŒç»´DPï¼Œå…ƒç´ æ˜¯boolåˆ¤æ–­</p>
<p><a href="https://leetcode.cn/problems/word-break/">139.
å•è¯æ‹†åˆ†</a></p>
<p>å•è¯æ•°ç»„ï¼Œä¸€ä¸ªä¸€ä¸ªå•è¯æ‹¼æ¥ï¼Œç»„æˆæœ€åå•è¯ï¼Œä¸€ç»´DPï¼Œå…ƒç´ æ˜¯boolåˆ¤æ–­</p>
<p><a
href="https://leetcode.cn/problems/longest-palindromic-subsequence/">516.
æœ€é•¿å›æ–‡å­åºåˆ—</a></p>
<p>å›æ–‡ï¼Œéœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼ŒäºŒç»´DPï¼Œä»iåˆ°jç»„æˆå›æ–‡çš„é•¿åº¦ï¼Œå…ƒç´ æ˜¯é•¿åº¦ï¼Œæœ€å°é•¿åº¦ä¸º1ï¼Œç›¸ç­‰+2</p>
<p><a href="https://leetcode.cn/problems/ones-and-zeroes/">474.
ä¸€å’Œé›¶</a></p>
<p>å­—ç¬¦ä¸²æ•°ç»„ï¼Œç»„æˆæ•°é‡é™åˆ¶ï¼ˆä¸¤ä¸ªé™åˆ¶ï¼‰ï¼Œæ‰€ä»¥é™åˆ¶éœ€è¦äºŒä¸ªç»´åº¦ï¼Œæ•°ç»„ä½œä¸ºæœ€å¤–å±‚é‚£ä¸ªç»´åº¦ï¼Œå…ƒç´ æ˜¯ä¸ªæ•°ï¼Œæœ€å°ä¸º0</p>
<p><a
href="https://leetcode.cn/problems/delete-operation-for-two-strings/">583.
ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ</a></p>
<p>ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä¸¤ä¸ªç»´åº¦ï¼Œåˆ é™¤æ¬¡æ•°ï¼Œåˆå§‹æƒ…å†µï¼Œåˆ é™¤ä¸ªæ•°ä¸ºå­—ç¬¦ä¸²é•¿åº¦ã€‚</p>
<p><a href="https://leetcode.cn/problems/palindromic-substrings/">647.
å›æ–‡å­ä¸²</a></p>
<p>å›æ–‡ï¼ŒäºŒç»´DPï¼Œå…ƒç´ æ˜¯boolåˆ¤æ–­ï¼Œç»Ÿè®¡Trueä¸ªæ•°</p>
<p><a
href="https://leetcode.cn/problems/longest-common-subsequence/">1143.
æœ€é•¿å…¬å…±å­åºåˆ—</a></p>
<p>ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ŒäºŒç»´DPï¼Œé•¿åº¦</p>
<p><a href="https://leetcode.cn/problems/jump-game-vii/">1871. è·³è·ƒæ¸¸æˆ
VII</a></p>
<p>èƒ½å¦åˆ°è¾¾ç»ˆç‚¹ï¼Œä¸€ç»´DPï¼Œåå‘æ€è€ƒï¼Œèƒ½å¦åˆ°è¾¾è¯¥ç‚¹ï¼Œæ‰€ä»¥å…ƒç´ ä¸ºboolã€‚+å‰ç¼€å’Œä¼˜åŒ–æ—¶é—´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å›æ–‡ä¸²</span></span><br><span class="line">dp = [[<span class="literal">False</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    dp[i][i] = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># ä»iåˆ°jæ˜¯å¦ç»„æˆå›æ–‡ä¸²</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>)[::-<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, n):</span><br><span class="line">            <span class="keyword">if</span> s[i] == s[j] <span class="keyword">and</span> (j - i &lt;= <span class="number">2</span> <span class="keyword">or</span> dp[i+<span class="number">1</span>][j-<span class="number">1</span>]):</span><br><span class="line">                dp[i][j] = <span class="literal">True</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="åŒæŒ‡é’ˆ">åŒæŒ‡é’ˆ</h2>
<p><a
href="https://leetcode.cn/problems/longest-repeating-character-replacement/">424.
æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦</a></p>
<p>æšä¸¾å³ç«¯ç‚¹ï¼Œå¦‚æœæ²¡è¶…è¿‡é™åˆ¶å°±ç»§ç»­ç§»åŠ¨å³æŒ‡é’ˆï¼Œå¦åˆ™ç§»åŠ¨å·¦æŒ‡é’ˆ</p>
<h2 id="æ ˆ">æ ˆ</h2>
<p>PASS</p>
<h2 id="å­—å…¸æ ‘">å­—å…¸æ ‘</h2>
<p>PASS</p>
<h2 id="æ¨¡æ‹Ÿæ·±æœ">æ¨¡æ‹Ÿ/æ·±æœ</h2>
<p>PASS</p>
]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>Mongodbï¼šå‰¯æœ¬é›†é…ç½®</title>
    <url>/hexo_blog/2021/07/21/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb%E4%BA%8C/</url>
    <content><![CDATA[<p>Mongodb4.2.xæ•°æ®åº“é…ç½®çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œå‰¯æœ¬é›†æ¶æ„çš„é…ç½®</p>
<span id="more"></span>
<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<p>æ¥
<a href="/hexo_blog/2017/11/24/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" title="Mongodbä»å®‰è£…åˆ°åŸºæœ¬æ“ä½œ">Mongodbä»å®‰è£…åˆ°åŸºæœ¬æ“ä½œ</a>ï¼ŒåŸºæœ¬åŒåŸæ–‡ï¼Œç”±äºæ˜¯å‰¯æœ¬é›†é…ç½®ï¼Œæ‰€ä»¥åœ¨éœ€è¦é…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç›¸åŒçš„é…ç½®</p>
<p>é€‰æ‹©ï¼š</p>
<ol type="1">
<li>å•æœºä¸Šï¼Œé…ç½®ä¸åŒportçš„mongoæœåŠ¡</li>
<li>ä¸åŒæœºå™¨ä¸Šï¼Œé…ç½®mongoæœåŠ¡</li>
<li>è¦æ±‚åŒç½‘æ®µï¼Œæ‰€ä»¥é…ç½®çš„ipä¸­ä¸èƒ½å†™127.0.0.1</li>
<li>å¯ä»¥ <code>vim /etc/hosts</code>ï¼Œæ–¹ä¾¿ç®¡ç†</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½å‹ç¼©åŒ…</span></span><br><span class="line">wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-4.2.15.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹ç¼©</span></span><br><span class="line">tar -zxvf mongodb-linux-x86_64*.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å‘½å</span></span><br><span class="line"><span class="built_in">mv</span> mongodb-linux-x86_64* mongodb</span><br><span class="line"><span class="comment"># ç§»åŠ¨åˆ°ä½ æƒ³æ”¾ç½®çš„ç›®å½•ä¸‹ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨/optç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mv</span> mongodb /opt/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œmongodbä¸»ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/</span><br><span class="line"><span class="comment"># å»ºç«‹å­˜æ”¾æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p data/test/logs</span><br><span class="line"><span class="built_in">mkdir</span> -p data/test/db</span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹é…ç½®</span></span><br><span class="line">vim bin/mongodb.conf</span><br></pre></td></tr></table></figure>
<p>æ›´æ–°éƒ¨åˆ†ï¼Œé…ç½®æ–‡ä»¶ç”¨yamlæ ¼å¼</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">systemLog:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&quot;/opt/mongodb/data/test/logs/mongodb.log&quot;</span></span><br><span class="line">  <span class="attr">logAppend:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">dbPath:</span> <span class="string">&quot;/opt/mongodb/data/test/db&quot;</span></span><br><span class="line">  <span class="attr">journal:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">net:</span></span><br><span class="line">  <span class="comment"># å…è®¸æ‰€æœ‰IPè®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”¨é€—å·éš”å¼€ï¼Œæ§åˆ¶IPè®¿é—®</span></span><br><span class="line">  <span class="attr">bindIp:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> </span><br><span class="line">  <span class="comment"># è®¾ç½®ç«¯å£å·ï¼ˆé»˜è®¤çš„ç«¯å£å·æ˜¯27017ï¼Œå¯ä»¥æ ¹æ®ä¸ªäººéœ€æ±‚è¿›è¡Œæ›´æ”¹ï¼‰</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line"><span class="attr">processManagement:</span></span><br><span class="line">  <span class="comment"># è®¾ç½®ä¸ºä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå³åœ¨åå°è¿è¡Œ</span></span><br><span class="line">  <span class="attr">fork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">replication:</span></span><br><span class="line">  <span class="comment"># å‰¯æœ¬é›†åå­—</span></span><br><span class="line">  <span class="attr">replSetName:</span> <span class="string">&quot;rs0&quot;</span> </span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨">å¯åŠ¨</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨æ‰€æœ‰æœºå™¨ä¸Šå¯åŠ¨mongoï¼Œæ­¤æ—¶æ— è´¦å·å¯†ç </span></span><br><span class="line"><span class="comment"># ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨</span></span><br><span class="line">bin/mongod --config mongodb.conf</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®å‰¯æœ¬é›†">é…ç½®å‰¯æœ¬é›†</h3>
<p>åœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨Aä¸Šï¼Œè¿›è¡Œé…ç½®å‰¯æœ¬é›†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†å‰¯æœ¬é›†çš„åˆå§‹åŒ–é…ç½®å†™å…¥js</span></span><br><span class="line">vim init_replica.js</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¶ä¸­rs0ä¸€å®šè¦è·Ÿä¸Šé¢çš„replSetNameä¸€æ ·</span></span><br><span class="line">config = &#123; _id:<span class="string">&quot;rs0&quot;</span>, members:[&#123;_id:0,host:<span class="string">&quot;ip0:port0&quot;</span>&#125;,&#123;_id:1,host:<span class="string">&quot;ip1:port1&quot;</span>&#125;]&#125;</span><br><span class="line">rs.initiate(config) </span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/mongod --port 27017 &lt; init_replica.js</span><br></pre></td></tr></table></figure>
<h3 id="éªŒè¯">éªŒè¯</h3>
<p>åœ¨AæœåŠ¡å™¨ä¸Šè¿›è¡Œæ“ä½œï¼Œæ·»åŠ è´¦å·å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œmongodbçš„äº¤äº’ç¯å¢ƒ</span></span><br><span class="line">bin/mongod --port 27017</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œadminæ•°æ®åº“ï¼Œåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·rootï¼Œå¯†ç ä¸ºpasswordï¼Œæƒé™æ˜¯è¶…çº§ç”¨æˆ·ï¼ˆæœ€é«˜ï¼‰</span></span><br><span class="line">&gt;use admin</span><br><span class="line">&gt;db.createUser(&#123; user: <span class="string">&quot;admin&quot;</span>, <span class="built_in">pwd</span>: <span class="string">&quot;password&quot;</span>, roles: [&#123; role: <span class="string">&quot;userAdminAnyDatabase&quot;</span>, db: <span class="string">&quot;admin&quot;</span> &#125;] &#125;)</span><br><span class="line">&gt;db.createUser(&#123;user:<span class="string">&quot;root&quot;</span>,<span class="built_in">pwd</span>:<span class="string">&quot;password&quot;</span>,roles:[<span class="string">&quot;root&quot;</span>]&#125;)</span><br><span class="line"><span class="comment"># éªŒè¯æ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œè¿”å›1è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">&gt;db.auth(&#123;<span class="string">&quot;root&quot;</span>, <span class="string">&quot;password&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># é€€å‡ºäº¤äº’ç¯å¢ƒ</span></span><br><span class="line">&gt;<span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ°mongoçš„æœåŠ¡è¿›ç¨‹pid</span></span><br><span class="line">ps ux | grep mongod</span><br><span class="line"><span class="comment"># æ€æ­»è¿›ç¨‹ï¼Œå¡«å†™å¯¹åº”çš„pid</span></span><br><span class="line"><span class="built_in">kill</span> PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥å¯†ç æƒé™éªŒè¯å¯åŠ¨æœåŠ¡</span></span><br><span class="line">bin/mongod --config mongodb.conf --auth</span><br></pre></td></tr></table></figure>
<h3 id="opensslè¯ä¹¦æ–‡ä»¶">OpenSSLè¯ä¹¦æ–‡ä»¶</h3>
<h3 id="è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</h3>
<h3 id="ä¸»èŠ‚ç‚¹é€‰ä¸¾é…ç½®">ä¸»èŠ‚ç‚¹é€‰ä¸¾é…ç½®</h3>
]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>mongodb</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné­”æœ¯æ–¹æ³•</title>
    <url>/hexo_blog/2018/03/14/Python/Python%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Pythonçš„é­”æœ¯æ–¹æ³•</p>
<span id="more"></span>
<p>å‚è€ƒæ–‡ç« :</p>
<p><a
href="http://pycoders-weekly-chinese.readthedocs.io/en/latest/issue6/a-guide-to-pythons-magic-methods.html">Python
é­”æœ¯æ–¹æ³•æŒ‡å—</a></p>
<p>é­”æœ¯æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ç§å¯ä»¥ç»™å¯¹è±¡(ç±»)å¢åŠ é­”æ³•çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå®ƒä»¬çš„è¡¨ç¤ºæ–¹æ³•ä¸€èˆ¬æ˜¯ç”¨åŒä¸‹åˆ’çº¿åŒ…å›´(å¦‚<code>__init__</code>)</p>
<h2 id="å¯¹è±¡å®ä¾‹åŒ–">å¯¹è±¡å®ä¾‹åŒ–</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileObject</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;ç»™æ–‡ä»¶å¯¹è±¡è¿›è¡ŒåŒ…è£…ä»è€Œç¡®è®¤åœ¨åˆ é™¤æ—¶æ–‡ä»¶æµå…³é—­&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filepath=<span class="string">&#x27;~&#x27;</span>, filename=<span class="string">&#x27;sample.txt&#x27;</span></span>):</span><br><span class="line">        <span class="comment">#è¯»å†™æ¨¡å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">        <span class="variable language_">self</span>.file = <span class="built_in">open</span>(join(filepath, filename), <span class="string">&#x27;r+&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.file.close()</span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>.file</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>__new__(cls, [...])</code>:
åœ¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹åŒ–è°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»ï¼Œå‰©ä¸‹çš„å‚æ•°ä¼ é€’ç»™<code>__init__</code></p></li>
<li><p><code>__init__(self, [...])</code>:
ç±»çš„åˆå§‹åŒ–æ–¹æ³•ã€‚å½“æ„é€ å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™çš„ä»»ä½•å‚æ•°å¤Ÿä¼šä¼ ç»™å®ƒ</p></li>
<li><p><code>__del__(self)</code>:
<code>__new__</code>å’Œ<code>__init__</code>ä¸ºå¯¹è±¡çš„æ„é€ å™¨ï¼Œ<code>__del__</code>ä¸ºå¯¹è±¡çš„ææ„å™¨ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè¿‡åƒåœ¾å›æ”¶æ—¶å€™çš„è¡Œä¸ºå°±æ˜¯è¿™ä¸ªæ–¹æ³•ã€‚å½“ä¸€ä¸ªå¯¹è±¡åœ¨åˆ é™¤çš„æ—¶å€™éœ€è¦æ›´å¤šçš„æ¸…æ´å·¥ä½œï¼Œå°±éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</p></li>
</ul>
<h2 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Word</span>(<span class="title class_ inherited__">str</span>):</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;å­˜å‚¨å•è¯çš„ç±»ï¼Œå®šä¹‰æ¯”è¾ƒå•è¯çš„å‡ ç§æ–¹æ³•&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, word</span>):</span><br><span class="line">        <span class="comment"># æ³¨æ„æˆ‘ä»¬å¿…é¡»è¦ç”¨åˆ°__new__æ–¹æ³•ï¼Œå› ä¸ºstræ˜¯ä¸å¯å˜ç±»å‹</span></span><br><span class="line">        <span class="comment"># æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨åˆ›å»ºçš„æ—¶å€™å°†å®ƒåˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27; &#x27;</span> <span class="keyword">in</span> word:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Value contains spaces. Truncating to first space.&quot;</span>)</span><br><span class="line">            word = word[:word.index(<span class="string">&#x27; &#x27;</span>)] <span class="comment">#å•è¯æ˜¯ç¬¬ä¸€ä¸ªç©ºæ ¼ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>.__new__(cls, word)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__gt__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>) &gt; <span class="built_in">len</span>(other)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lt__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>) &lt; <span class="built_in">len</span>(other)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ge__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>) &gt;= <span class="built_in">len</span>(other)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__le__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>) &lt;= <span class="built_in">len</span>(other)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>__cmp__(self, other)</code>:
ç”¨äºæ¯”è¾ƒçš„é­”æœ¯æ–¹æ³•ï¼Œå®ç°äº†æ‰€æœ‰çš„æ¯”è¾ƒç¬¦å·ã€‚å¦‚æœ<code>self</code> &lt;
<code>other</code>è¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼›å¦‚æœ<code>self</code> ==
<code>other</code>è¿”å›ï¼ï¼›å¦‚æœ<code>self</code> &gt;
<code>other</code>è¿”å›æ­£æ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åˆ†åˆ«å®šä¹‰æ¯ä¸€ä¸ªæ¯”è¾ƒç¬¦å·ã€‚å¦‚æœæƒ³å®ç°æ‰€æœ‰çš„æ¯”è¾ƒç¬¦å·ï¼Œå°±éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p></li>
<li><p><code>__eq__(self, other)</code>: ç­‰å·</p></li>
<li><p><code>__ne__(self, other)</code>:ã€€ä¸ç­‰å·</p></li>
<li><p><code>__lt__(self, other)</code>:ã€€å°äº</p></li>
<li><p><code>__gt__(self, other)</code>:ã€€å¤§äº</p></li>
<li><p><code>__le__(self, other)</code>:ã€€å°äºç­‰äº</p></li>
<li><p><code>__ge__(self, other)</code>:ã€€å¤§äºç­‰äº</p></li>
</ul>
<h2 id="ä¸€å…ƒæ“ä½œç¬¦å’Œå‡½æ•°">ä¸€å…ƒæ“ä½œç¬¦å’Œå‡½æ•°</h2>
<ul>
<li><code>__pos__(self)</code>ï¼šå®ç°æ­£å·çš„ç‰¹æ€§</li>
<li><code>__neg__(self)</code>ï¼šå®ç°è´Ÿå·çš„ç‰¹æ€§</li>
<li><code>__abs__(self)</code>ï¼šabs, ç»å¯¹å€¼</li>
<li><code>__invert__(self)</code>ï¼šå®ç°~çš„ç‰¹æ€§</li>
</ul>
<h2 id="æ™®é€šç®—æ•°æ“ä½œç¬¦">æ™®é€šç®—æ•°æ“ä½œç¬¦</h2>
<ul>
<li><code>__add__(self, other)</code>: å®ç°åŠ æ³•</li>
<li><code>__sub__(self, other)</code>: å®ç°å‡æ³•</li>
<li><code>__mul__(self, other)</code>: å®ç°ä¹˜æ³•</li>
<li><code>__floordiv__(self, other)</code>: å®ç°æ•´é™¤æ³•</li>
<li><code>__div__(self, other)</code>: å®ç°é™¤æ³•</li>
<li><code>__mod__(self, other)</code>: å®ç°å–æ¨¡</li>
<li><code>__pow__(self, other)</code>: å®ç°æŒ‡æ•°</li>
<li><code>__lshift__(self, other)</code>: å®ç°&lt;&lt;</li>
<li><code>__rshift__(self, other)</code>: å®ç°&gt;&gt;</li>
<li><code>__and__(self, other)</code>: å®ç°&amp;</li>
<li><code>__or__(self, other)</code>: å®ç°|</li>
<li><code>__xor__(self, other)</code>: å®ç°^</li>
</ul>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__setattr__</span>(<span class="params">self, name, value</span>):</span><br><span class="line">    <span class="variable language_">self</span>.name = value</span><br><span class="line">    <span class="comment">#æ¯å½“å±æ€§è¢«èµ‹å€¼çš„æ—¶å€™ï¼Œ ``__setattr__()`` ä¼šè¢«è°ƒç”¨ï¼Œè¿™æ ·å°±é€ æˆäº†é€’å½’è°ƒç”¨ã€‚</span></span><br><span class="line">    <span class="comment">#è¿™æ„å‘³è¿™ä¼šè°ƒç”¨ ``self.__setattr__(&#x27;name&#x27;, value)`` ï¼Œæ¯æ¬¡æ–¹æ³•ä¼šè°ƒç”¨è‡ªå·±ã€‚è¿™æ ·ä¼šé€ æˆç¨‹åºå´©æºƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__setattr__</span>(<span class="params">self, name, value</span>):</span><br><span class="line">    <span class="variable language_">self</span>.__dict__[name] = value  <span class="comment">#ç»™ç±»ä¸­çš„å±æ€§ååˆ†é…å€¼</span></span><br><span class="line">    <span class="comment">#å®šåˆ¶ç‰¹æœ‰å±æ€§</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccessCounter</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;ä¸€ä¸ªåŒ…å«è®¡æ•°å™¨çš„æ§åˆ¶æƒé™çš„ç±»æ¯å½“å€¼è¢«æ”¹å˜æ—¶è®¡æ•°å™¨ä¼šåŠ ä¸€&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__setattr__(<span class="string">&#x27;counter&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__setattr__(<span class="string">&#x27;value&#x27;</span>, val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setattr__</span>(<span class="params">self, name, value</span>):</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">&#x27;value&#x27;</span>:</span><br><span class="line">            <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__setattr__(<span class="string">&#x27;counter&#x27;</span>, <span class="variable language_">self</span>.counter + <span class="number">1</span>)</span><br><span class="line">    <span class="comment">#å¦‚æœä½ ä¸æƒ³è®©å…¶ä»–å±æ€§è¢«è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æŠ›å‡º AttributeError(name) å¼‚å¸¸</span></span><br><span class="line">        <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__setattr__(name, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delattr__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">&#x27;value&#x27;</span>:</span><br><span class="line">            <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__setattr__(<span class="string">&#x27;counter&#x27;</span>, <span class="variable language_">self</span>.counter + <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">super</span>(AccessCounter, <span class="variable language_">self</span>).__delattr__(name)]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>__str__(self)</code>: è¿”å›å€¼ï¼Œäººç±»å¯è¯»</p></li>
<li><p><code>__repr__(self)</code>: è¿”å›å€¼ï¼Œæœºå™¨å¯è¯»</p></li>
<li><p><code>__unicode__(self)</code>: è¿”å›unicode()</p></li>
<li><p><code>__hash__(self)</code>: hash()è¿”å›ä¸€ä¸ªæ•´å½¢</p></li>
<li><p><code>__nonzero__(self)</code>: bool()è¿”å›çš„å€¼</p></li>
<li><p><code>__getattr__(self, name)</code>:
å½“ç”¨æˆ·è¯•å›¾è·å–ä¸€ä¸ªä¸å­˜åœ¨ï¼ˆæˆ–ä¸å»ºè®®çš„å±æ€§ï¼‰çš„å±æ€§æ—¶ï¼Œç»™å‡ºä¸€äº›è­¦å‘Š</p></li>
<li><p><code>__setattr__(self, name, value)</code>:
æ— è®ºå±æ€§æ˜¯å¦å­˜åœ¨ï¼Œéƒ½å…è®¸ä½ å®šä¹‰å¯¹å±æ€§çš„èµ‹å€¼è¡Œä¸º</p></li>
<li><p><code>__delattr__(self, name)</code>ï¼š åˆ é™¤ä¸€ä¸ªå±æ€§</p></li>
</ul>
<h2 id="å°è£…é™„åŠ é­”æœ¯æ–¹æ³•">å°è£…é™„åŠ é­”æœ¯æ–¹æ³•</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FunctionalList</span>:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;ä¸€ä¸ªå°è£…äº†ä¸€äº›é™„åŠ é­”æœ¯æ–¹æ³•æ¯”å¦‚ head, tail, init, last, drop, å’Œtakeçš„åˆ—è¡¨ç±»ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, values=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> values <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="variable language_">self</span>.values = []</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.values = values</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.values)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="comment">#å¦‚æœé”®çš„ç±»å‹æˆ–è€…å€¼æ— æ•ˆï¼Œåˆ—è¡¨å€¼å°†ä¼šæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, key, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.values[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>.values[key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(<span class="variable language_">self</span>.values)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reversed__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">reversed</span>(<span class="variable language_">self</span>.values)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">append</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.values.append(value)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">head</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tail</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#è¿”å›ä¸€ç›´åˆ°æœ«å°¾çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">last</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#è¿”å›æœ«å°¾å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">drop</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="comment">#è¿”å›é™¤å‰nä¸ªå¤–çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[n:]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">take</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="comment">#è¿”å›å‰nä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.values[:n]</span><br></pre></td></tr></table></figure>
<h2 id="åå°„">åå°„</h2>
<ul>
<li><code>__instancecheck__(self, instance)</code>:
æ£€æŸ¥ä¸€ä¸ªå®ä¾‹æ˜¯å¦ä¸ºå®šä¹‰ç±»çš„å®ä¾‹</li>
<li><code>__subclasscheck__(self, subclass)</code>:
æ£€æŸ¥ä¸€ä¸ªç±»æ˜¯å¦ä¸ºå®šä¹‰ç±»çš„å­ç±»</li>
</ul>
<h2 id="æ›´æ”¹çŠ¶æ€">æ›´æ”¹çŠ¶æ€</h2>
<ul>
<li><code>__call__(self, [...])</code>:
ç»å¸¸æ”¹å˜çŠ¶æ€çš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ç§ç›´æ¥å’Œä¼˜é›…çš„æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Entity</span>:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;è°ƒç”¨å®ä½“æ¥æ”¹å˜å®ä½“çš„ä½ç½®ã€‚&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, size, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y = x, y</span><br><span class="line">        <span class="variable language_">self</span>.size = size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;æ”¹å˜å®ä½“çš„ä½ç½®&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y = x, y</span><br></pre></td></tr></table></figure>
<h2 id="ä¼šè¯ç®¡ç†">ä¼šè¯ç®¡ç†</h2>
<p>ä½¿ç”¨withè¯­å¥æ¥è°ƒç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Closer</span>:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;é€šè¿‡withè¯­å¥å’Œä¸€ä¸ªcloseæ–¹æ³•æ¥å…³é—­ä¸€ä¸ªå¯¹è±¡çš„ä¼šè¯ç®¡ç†å™¨&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="variable language_">self</span>.obj = obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.obj <span class="comment"># bound to target</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exception_type, exception_val, trace</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.obj.close()</span><br><span class="line">        <span class="keyword">except</span> AttributeError: <span class="comment"># obj isn&#x27;t closable</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Not closable.&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> <span class="comment"># exception handled successfully</span></span><br></pre></td></tr></table></figure>
<h2 id="slots__"><code>__slots__</code></h2>
<p>é™åˆ¶classçš„å±æ€§ï¼Œä½†ä¸é™åˆ¶classçš„å­ç±»çš„å±æ€§ï¼Œé™¤éå­ç±»ä¹Ÿä½¿ç”¨<code>__slots__</code></p>
<p>ä¾‹å­ï¼š</p>
<p>ä½¿ç”¨<code>__slots__</code>ä¼šæ¯”ä¸ä½¿ç”¨ï¼Œå‡å°‘40%~50%çš„å†…å­˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ä½¿ç”¨__slots__</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, identifier</span>):</span><br><span class="line">      <span class="variable language_">self</span>.name = name</span><br><span class="line">      <span class="variable language_">self</span>.identifier = identifier</span><br><span class="line">      <span class="variable language_">self</span>.set_up()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨__slots__</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  __slots__ = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;identifier&#x27;</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, identifier</span>):</span><br><span class="line">      <span class="variable language_">self</span>.name = name</span><br><span class="line">      <span class="variable language_">self</span>.identifier = identifier</span><br><span class="line">      <span class="variable language_">self</span>.set_up()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Magic Methods</tag>
      </tags>
  </entry>
  <entry>
    <title>crontabå‘½ä»¤</title>
    <url>/hexo_blog/2017/08/24/%E8%BF%90%E7%BB%B4/crontab%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>å­¦ä¼šä½¿ç”¨crontabå®šæ—¶ä»»åŠ¡ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚è¯¦è§£äº†crontabçš„åŸºæœ¬æ ¼å¼å’Œä¾‹å­ï¼Œä»¥åŠç›¸å…³ç›®å½•ä»‹ç»å’Œæ—¥å¿—æ–‡ä»¶çš„è®¾ç½®ã€‚</p>
<span id="more"></span>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨crontab -uroot -læŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">crontab -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘crontabå®šæ—¶ä»»åŠ¡ï¼Œè²Œä¼¼æ˜¯ä½¿ç”¨vimçš„ç¼–è¾‘å‘½ä»¤</span></span><br><span class="line">crontab -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶å®åŸºæœ¬ä¸ŠçŸ¥é“è¿™ä¸¤ä¸ªå°±å¯ä»¥å¤„ç†å®šæ—¶ä»»åŠ¡äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§è®¾å®šï¼ˆæ‰‹è´±æŒ‰ä¸‹è¿‡ä¸€æ¬¡ï¼Œæ¢å¤èµ·æ¥çœŸçš„æƒ¨ï¼‰</span></span><br><span class="line">crontab -r</span><br><span class="line"><span class="comment"># å¦‚æœæŒ‰åˆ°äº†ï¼Œå°±å»æ—¥å¿—æ–‡ä»¶é‡Œé¢æ‰¾è®°å½•ï¼Œå°½å¯èƒ½æ¢å¤å‘½ä»¤å§</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è®²è®²ç¼–è¾‘ä»»åŠ¡çš„æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºæœ¬æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">  *  *  *  *  * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ† æ—¶ æ—¥ æœˆ å‘¨ éœ€è¦æ‰§è¡Œçš„å‘½ä»¤</span></span><br></pre></td></tr></table></figure>
<p>å¯è§†åŒ–æµ‹è¯•åœ¨çº¿ç½‘ç«™ï¼Œhttps://crontab.guru/</p>
<p>å‡ ä¸ªæ —å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡commandå‘½ä»¤ï¼Œç©ºæ ¼è¡¨ç¤ºé—´éš”</span></span><br><span class="line">* * * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œâ€˜/â€™è¡¨ç¤ºé¢‘ç‡</span></span><br><span class="line">0 */1 * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯å°æ—¶çš„10åˆ†å’Œ40åˆ†å„æ‰§è¡Œä¸€æ¬¡ï¼Œâ€˜,â€™è¡¨ç¤ºå¹¶åˆ—</span></span><br><span class="line">10,40 * * * * <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªæ˜ŸæœŸä¸€çš„10-14ç‚¹çš„10ï¼Œ40æ‰§è¡Œï¼Œâ€˜-â€™è¡¨è¿°åŒºé—´</span></span><br><span class="line">10,40 10-14 * * 1 <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯å¤©çš„8ï¼Œ13ï¼Œ20ç‚¹æ‰§è¡Œï¼Œæ³¨æ„æ­¤æ—¶è¡¨ç¤ºåˆ†çš„é‚£ä¸ª*è¦æ›¿æ¢ä¸º0</span></span><br><span class="line">0 8,13,20 * * * <span class="built_in">command</span></span><br></pre></td></tr></table></figure>
<p>æ—¥å¿—æ–‡ä»¶ä¸€èˆ¬å­˜æ”¾åœ¨
<code>/var/log/cron*</code>ä¸­ï¼Œä¸è¿‡æˆ‘çš„Ubuntuå¥½åƒæ²¡æœ‰å¼€å¯cronæ—¥å¿—ï¼Œå¯ä»¥åœ¨
<code>/etc/rsyslog.d/50-default.conf</code>ä¸­è¿›è¡Œè®¾ç½®ï¼ˆCentosåœ¨
<code>/etc/rsyslog.conf</code>ä¸­è®¾ç½®ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">sudo</span> vim /etc/rsyslog.d/50-default.conf</span><br><span class="line"><span class="comment"># æ‰¾åˆ°cron*, å»æ‰å‰é¢çš„#æ³¨é‡Šå³å¯</span></span><br><span class="line"><span class="comment"># é‡å¯rsyslog</span></span><br><span class="line">&gt; <span class="built_in">sudo</span> service rsyslog  restart</span><br></pre></td></tr></table></figure>
<p>crontabç›¸å…³ç›®å½•ä»‹ç»</p>
<p><code>/etc/anacrontab</code>:
è¿™ä¸ªæ–‡ä»¶å­˜ç€ç³»ç»Ÿçº§çš„ä»»åŠ¡ã€‚å®ƒä¸»è¦ç”¨æ¥è¿è¡Œæ¯æ—¥çš„(daily)ï¼Œæ¯å‘¨çš„(weekly),æ¯æœˆçš„(monthly)çš„ä»»åŠ¡ã€‚ä¸€èˆ¬ä¸åœ¨æ­¤æ–‡ä»¶å®‰è£…è‡ªå·±çš„ä»»åŠ¡</p>
<p><code>/etc/cron.d/</code>: æ­¤ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ç³»ç»Ÿçº§ä»»åŠ¡çš„ä»»åŠ¡æ–‡ä»¶ã€‚</p>
<p><code>/var/spool/cron/</code>:
æ­¤ç›®å½•ä¸‹å­˜æ”¾å„ä¸ªç”¨æˆ·çš„ä»»åŠ¡æ–‡ä»¶ã€‚å„ä¸ªç”¨æˆ·çš„ä»»åŠ¡å­˜æ”¾åœ¨ä»¥è‡ªå·²ç”¨æˆ·åä¸ºæ–‡ä»¶åçš„ä»»åŠ¡æ–‡ä»¶ä¸­ã€‚æ­¤æ–‡ä»¶ä¸­çš„æŒ‡ä»¤è¡Œæ²¡æœ‰ç”¨æˆ·åŸŸã€‚</p>
<p><code>/etc/crontab</code>:
crontabçš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œäº†æ¯å°æ—¶ã€æ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆçš„è„šæœ¬æ–‡ä»¶</p>
<p><code>/etc/cron.hourly</code>ã€<code>/etc/cron.daily</code>ã€<code>/etc/cron.weekly</code>ã€<code>/etc/cron.monthly</code>ï¼šè¿™å››ä¸ªç›®å½•ä¸‹åˆ†åˆ«å¯¹åº”ç€æ¯éš”ä¸€æ®µæ—¶é—´éœ€è¦æ‰§è¡Œçš„è„šæœ¬ä»»åŠ¡ï¼Œè„šæœ¬ä½¿ç”¨shellå‘½ä»¤ç¼–å†™</p>
<p><a href="https://segmentfault.com/a/1190000002628040"></a></p>
<p><a
href="http://www.cnblogs.com/peida/archive/2013/01/08/2850483.html">æ¯å¤©ä¸€ä¸ªlinuxå‘½ä»¤ï¼ˆ50ï¼‰ï¼šcrontabå‘½ä»¤</a></p>
<p><a href="https://segmentfault.com/a/1190000002628040">Linux
ä¸‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ crontab å‘½ä»¤è¯¦è§£</a></p>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>crontab</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLè¯­å¥çš„ä¼˜åŒ–</title>
    <url>/hexo_blog/2018/04/07/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å…³äºSQLè¯­å¥ï¼ˆä¸»è¦æ˜¯Oracleæ•°æ®åº“ï¼‰çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚
<span id="more"></span></p>
<p><a
href="https://juejin.im/post/5ab0f39df265da23866fba55">æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ä¹‹SQLè¯­å¥ä¼˜åŒ–</a></p>
<h2 id="æ“ä½œç¬¦ä¼˜åŒ–">æ“ä½œç¬¦ä¼˜åŒ–</h2>
<h3 id="in-æ“ä½œç¬¦">IN æ“ä½œç¬¦</h3>
<p>ä¼˜ç‚¹ï¼šç¼–å†™å®¹æ˜“ï¼Œæ¸…æ™°æ˜“æ‡‚</p>
<p>ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒä½ã€‚</p>
<p>Oracleæ‰§è¡Œæ­¥éª¤ï¼š</p>
<ol type="1">
<li>å°†å…¶è½¬æ¢å¤šè¡¨è¿æ¥</li>
<li>å¦‚æœè½¬æ¢ä¸æˆåŠŸåˆ™å…ˆæ‰§è¡ŒINé‡Œé¢çš„å­æŸ¥è¯¢ï¼Œå†æ‰§è¡Œå¤–å±‚è¡¨è®°å½•</li>
<li>å¦‚æœè½¬æ¢æˆåŠŸåˆ™ç›´æ¥é‡‡ç”¨å¤šè¡¨è¿æ¥æŸ¥è¯¢</li>
</ol>
<p>æ‰€ä»¥ç”¨INçš„SQLè‡³å°‘ä¼šå¤šä¸€ä¸ªè½¬æ¢è¿‡ç¨‹ã€‚</p>
<p>æ›¿ä»£æ–¹æ¡ˆï¼šåœ¨ä¸šåŠ¡å¯†é›†çš„SQLç”¨EXISTSæ›¿ä»£</p>
<h3 id="not-inæ“ä½œç¬¦">NOT INæ“ä½œç¬¦</h3>
<p>ä¸èƒ½åº”ç”¨è¡¨çš„ç´¢å¼•ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<p>æ›¿ä»£æ–¹æ¡ˆï¼šç”¨NOT EXISTSæ–¹æ¡ˆ</p>
<h3 id="is-nullæˆ–is-not-nullæ“ä½œ">IS NULLæˆ–IS NOT NULLæ“ä½œ</h3>
<p>åˆ¤æ–­å­—æ®µä¸ºç©ºä¸€èˆ¬æ˜¯ä¸ä¼šç”¨ç´¢å¼•çš„ï¼ˆç´¢å¼•ä¸ç´¢å¼•ç©ºå€¼ï¼‰ã€‚å¦‚æœæŸåˆ—å­˜åœ¨ç©ºå€¼ï¼Œå³ä½¿å¯¹è¯¥åˆ—å»ºç´¢å¼•ä¹Ÿä¸ä¼šæé«˜æ€§èƒ½ã€‚</p>
<p>æ›¿ä»£æ–¹æ¡ˆï¼šå°†<code>a is not null</code>æ”¹ä¸º<code>a&gt;0</code>æˆ–<code>a&gt;' '</code>ç­‰ã€‚ä¸å…è®¸å­—æ®µä¸ºç©ºï¼Œè€Œç”¨ä¸€ä¸ªç¼ºçœå€¼ä»£æ›¿ç©ºå€¼ã€‚</p>
<h3 id="åŠ-æ“ä½œç¬¦">&lt; åŠ &gt; æ“ä½œç¬¦</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦è°ƒæ•´çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>å¦‚ï¼šä¸€ä¸ªè¡¨æœ‰100ä¸‡è®°å½•ï¼Œä¸€ä¸ªæ•°å€¼å‹å­—æ®µAï¼Œæœ‰30ä¸‡çš„A=0ï¼Œ39ä¸‡A=2ï¼Œ
1ä¸‡A=3ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹æ‰§è¡ŒA&gt;2ä¸A&gt;=3æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œ<code>A&gt;2</code>åœ¨Oracleä¸­ä¼šå…ˆæ‰¾å‡ºä¸º2çš„è®°å½•ç´¢å¼•å†è¿›è¡Œæ¯”è¾ƒï¼Œä½†æ˜¯<code>A&gt;=3</code>ä¼šç›´æ¥æ‰¾åˆ°ç­‰äº3çš„è®°å½•ç´¢å¼•ã€‚</p>
<h3 id="likeæ“ä½œç¬¦">LIKEæ“ä½œç¬¦</h3>
<p>LIKEåŒ»ç”¨é€šé…ç¬¦æŸ¥è¯¢ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¾¾åˆ°ä»»ä¸€æŸ¥è¯¢ã€‚ä½†æ˜¯ä¸åŒè¯­å¥å¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„å¾ˆå¤§å·®å¼‚ã€‚å¦‚<code>LIKE '%5400%'</code>è¿™ç§æƒ…å†µä¸‹ä¸ä¼šå¼•ç”¨ç´¢å¼•ï¼Œ<code>LIKE 'X5400%'</code>ä¼šå¼•ç”¨èŒƒå›´ç´¢å¼•ã€‚å³å‰è€…ä¼šäº§ç”Ÿå…¨è¡¨æ‰«æï¼Œåè€…ä¼šè¿›è¡ŒèŒƒå›´å†…çš„æŸ¥è¯¢ï¼Œåè€…ç›¸å¯¹äºå‰è€…çš„æ€§èƒ½å¤§å¤§æé«˜äº†ã€‚</p>
<h3 id="unionæ“ä½œç¬¦">UNIONæ“ä½œç¬¦</h3>
<p>UNIONåœ¨è¿›è¡Œè¡¨è¿æ¥ä¹‹åä¼šç­›é€‰æ‰é‡å¤çš„è®°å½•ï¼Œæ‰€ä»¥åœ¨è¡¨è¿æ¥ä¹‹åä¼šå¯¹äº§ç”Ÿçš„ç»“æœé›†è¿›è¡Œæ’åºè¿ç®—ï¼Œåˆ é™¤é‡å¤è®°å½•å†è¿”å›ç»“æœã€‚ä½†æ˜¯å®é™…ä¸Šå¤§éƒ¨åˆ†åº”ç”¨ä¸­æ˜¯ä¸ä¼šäº§ç”Ÿé‡å¤çš„è®°å½•ï¼Œæœ€å¸¸è§çš„æ˜¯è¿‡ç¨‹è¡¨äºå†å²è¡¨UNIONã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›¿ä»£æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨UNION
ALLä»£æ›¿UNIONã€‚UNION ALLæ“ä½œåªæ˜¯ç®€å•çš„å°†ä¸¤ä¸ªç»“æœåˆå¹¶åå°±è¿”å›</p>
<h3 id="è”æ¥åˆ—">è”æ¥åˆ—</h3>
<p>å¯¹äºæœ‰è”æ¥çš„åˆ—ï¼Œä¼˜åŒ–å™¨æ˜¯ä¸ä¼šä½¿ç”¨ç´¢å¼•çš„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># ä½¿ç”¨è”æ¥æŸ¥è¯¢</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employss <span class="keyword">where</span> first_name<span class="operator">||</span><span class="string">&#x27;&#x27;</span><span class="operator">||</span>last_name <span class="operator">=</span><span class="string">&#x27;Beill Cliton&#x27;</span>;</span><br><span class="line"># ä¸ä½¿ç”¨è”æ¥æŸ¥è¯¢ï¼ŒåŸºäºlast_nameåˆ›å»ºç´¢å¼•</span><br><span class="line"><span class="keyword">where</span> first_name <span class="operator">=</span><span class="string">&#x27;Beill&#x27;</span> <span class="keyword">and</span> last_name <span class="operator">=</span><span class="string">&#x27;Cliton&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="order-byè¯­å¥">Order Byè¯­å¥</h3>
<p>å°†è¿”å›çš„æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºã€‚ä»»ä½•åœ¨Order
byè¯­å¥çš„éç´¢å¼•é¡¹æˆ–è€…æœ‰è®¡ç®—è¡¨è¾¾å¼éƒ½å°†é™ä½æŸ¥è¯¢é€Ÿåº¦ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ºæ‰€ä½¿ç”¨çš„åˆ—å»ºç«‹å¦ä¸€ä¸ªç´¢å¼•ï¼ŒåŒæ—¶ä¹Ÿç»å¯¹é¿å…åœ¨order
byå­å¥ä¸­ä½¿ç”¨è¡¨è¾¾å¼ã€‚</p>
<h3 id="not-è¯­å¥">NOT è¯­å¥</h3>
<p>NOTå¯ç”¨æ¥å¯¹ä»»ä½•é€»è¾‘è¿ç®—ç¬¦å·å–åã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># å¦‚æœè¦ä½¿ç”¨<span class="keyword">NOT</span>ï¼Œåˆ™åº”åœ¨å–åçš„çŸ­è¯­å‰é¢æœºä¸Šæ‹¬å·ï¼Œå¹¶åœ¨çŸ­è¯­å‰é¢æœºä¸Š<span class="keyword">NOT</span>è¿ç®—ç¬¦ã€‚</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> (status <span class="operator">=</span> <span class="string">&#x27;VALID&#x27;</span>)</span><br><span class="line"># <span class="keyword">NOT</span>è¿ç®—ç¬¦åŒ…å«åœ¨å¦å¤–ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦<span class="operator">&lt;&gt;</span>è¿ç®—ç¬¦ä¸­ã€‚å³ä½¿ä¸åœ¨æŸ¥è¯¢çš„<span class="keyword">where</span>å­å¥ä¸­æ˜¾å¼åœ°åŠ å…¥<span class="keyword">NOT</span>è¯ï¼Œ<span class="keyword">NOT</span>ä»åœ¨è¿ç®—ç¬¦ä¸­</span><br><span class="line"><span class="keyword">where</span> status <span class="operator">&lt;&gt;</span> <span class="string">&#x27;INVALID&#x27;</span>;</span><br><span class="line"># è¿™ç§æƒ…å†µè¿è¡Œå»ºç«‹salaryçš„ç´¢å¼•ï¼Œåœ¨é€Ÿåº¦ä¸Šä¼šä¼˜äºä¸Šé¢çš„æ–¹æ¡ˆ</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee <span class="keyword">where</span> salary <span class="operator">&lt;</span> <span class="number">3000</span> <span class="keyword">or</span> salary <span class="operator">&gt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="ä¹¦å†™çš„å½±å“">ä¹¦å†™çš„å½±å“</h2>
<h3
id="åŒä¸€åŠŸèƒ½åŒä¸€æ€§èƒ½ä¸åŒå†™æ³•sqlçš„å½±å“">åŒä¸€åŠŸèƒ½åŒä¸€æ€§èƒ½ä¸åŒå†™æ³•SQLçš„å½±å“</h3>
<p>å°½å¯èƒ½é¿å…ä¸åŒå†™æ³•çš„å‡ºç°ï¼Œæ ¹æ®Oracleå…±äº«å†…å­˜SGAåŸç†ï¼Œå¦‚æœè¯­å¥ä¸åŒåˆ™è¿›è¡Œåˆ†æï¼Œå ç”¨å…±äº«å†…å­˜ã€‚å¦‚æœSQLå­—ç¬¦ä¸²åŠæ ¼å¼å®Œå…¨ç›¸åŒï¼Œåˆ™Oracleåªä¼šåˆ†æä¸€æ¬¡ï¼Œå…±äº«å†…å­˜ä¹Ÿåªä¼šç•™ä¸‹ä¸€æ¬¡çš„åˆ†æç»“æœ</p>
<h3 id="whereåé¢çš„æ¡ä»¶é¡ºåºå½±å“">WHEREåé¢çš„æ¡ä»¶é¡ºåºå½±å“</h3>
<p>ä¸‹é¢ä¸¤ä¸ªè¯­å¥ï¼Œåœ¨æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œéƒ½æ˜¯å…¨è¡¨æ‰«æã€‚</p>
<p><code>dy_dj = '1KVä»¥ä¸‹'</code>è¿™ä¸ªæ¡ä»¶åœ¨è®°å½•é›†å†…æ¯”ç‡ä¸º99%,
<code>xh_bz=1</code>è€Œè¿™ä¸ªæ¡ä»¶åªæœ‰0.5%ã€‚æ‰€ä»¥ç¬¬äºŒæ¡SQLçš„CPUå ç”¨ç‡æ˜æ˜¾ä½äºç¬¬ä¸€æ¡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> zl_yhjbqk <span class="keyword">where</span> dy_dj <span class="operator">=</span> <span class="string">&#x27;1KVä»¥ä¸‹&#x27;</span> <span class="keyword">and</span> xh_bz<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> zl_yhjbqk <span class="keyword">where</span> xh_bz<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> dy_dj <span class="operator">=</span> <span class="string">&#x27;1KVä»¥ä¸‹&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥è¯¢è¡¨é¡ºåºçš„å½±å“">æŸ¥è¯¢è¡¨é¡ºåºçš„å½±å“</h3>
<p>åœ¨FROMåé¢çš„è¡¨ä¸­çš„åˆ—è¡¨é¡ºåºä¼šå¯¹SQLæ‰§è¡Œæ€§èƒ½å½±å“ï¼Œåœ¨æ²¡æœ‰ç´¢å¼•åŠORACLEæ²¡æœ‰å¯¹è¡¨è¿›è¡Œç»Ÿè®¡åˆ†æçš„æƒ…å†µä¸‹ï¼ŒORACLEä¼šæŒ‰<strong>è¡¨å‡ºç°çš„é¡ºåº</strong>è¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥å¦‚æœè¡¨çš„é¡ºåºä¸å¯¹æ—¶ä¼šäº§ç”Ÿååˆ†æ¶ˆè€—æœåŠ¡å™¨èµ„æºçš„æ•°æ®äº¤å‰ï¼ˆå¦‚æœå¯¹è¡¨è¿›è¡Œäº†ç»Ÿè®¡åˆ†æï¼ŒOracleè‡ªåŠ¨å…ˆè¿›å°è¡¨çš„è¿æ¥ï¼Œå†è¿›è¡Œå¤§è¡¨çš„è¿æ¥ï¼‰</p>
<h2 id="sqlè¯­å¥ç´¢å¼•çš„åˆ©ç”¨">SQLè¯­å¥ç´¢å¼•çš„åˆ©ç”¨</h2>
<h3 id="æ¡ä»¶å­—æ®µçš„ä¼˜åŒ–">æ¡ä»¶å­—æ®µçš„ä¼˜åŒ–</h3>
<p>å‡½æ•°å¤„ç†çš„å­—æ®µä¸èƒ½åˆ©ç”¨ç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">åŸè¯­å¥ï¼šsubstr(hbs_bh,<span class="number">1</span>,<span class="number">4</span>)<span class="operator">=</span><span class="string">&#x27;5400&#x27;</span></span><br><span class="line">ä¼˜åŒ–å¤„ç†ï¼šhbs_bh <span class="keyword">like</span> <span class="string">&#x27;5400%&#x27;</span></span><br><span class="line"></span><br><span class="line">åŸè¯­å¥ï¼štrunc(sk_rq)<span class="operator">=</span>trunc(sysdate)</span><br><span class="line">ä¼˜åŒ–å¤„ç†ï¼šsk_rq<span class="operator">&gt;=</span>trunc(sysdate) <span class="keyword">and</span> sk_rq<span class="operator">&lt;</span>trunc(sysdate<span class="operator">+</span><span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œäº†æ˜¾ç¤ºæˆ–éšå¼çš„è¿ç®—çš„å­—æ®µä¸èƒ½è¿›è¡Œç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">åŸè¯­å¥ï¼š<span class="string">&#x27;X&#x27;</span> <span class="operator">||</span> hbs_bh<span class="operator">&gt;</span><span class="string">&#x27;X5400021452&#x27;</span></span><br><span class="line">ä¼˜åŒ–å¤„ç†ï¼šhbs_bh<span class="operator">&gt;</span><span class="string">&#x27;5400021542&#x27;</span></span><br><span class="line"></span><br><span class="line">åŸè¯­å¥ï¼šsk_rq<span class="operator">+</span><span class="number">5</span><span class="operator">=</span>sysdate</span><br><span class="line">ä¼˜åŒ–å¤„ç†ï¼šsk_rq<span class="operator">=</span>sysdate<span class="number">-5</span></span><br></pre></td></tr></table></figure>
<p>æ¡ä»¶å†…åŒ…æ‹¬çš„å¤šä¸ªæœ¬è¡¨çš„å­—æ®µè¿ç®—æ—¶ä¸èƒ½è¿›è¡Œç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">åŸè¯­å¥ï¼šys_df<span class="operator">&gt;</span>cx_df</span><br><span class="line">æ— æ³•è¿›è¡Œä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">åŸè¯­å¥ï¼šqc_bh <span class="operator">||</span> kh_bh<span class="operator">=</span><span class="string">&#x27;5400250000&#x27;</span></span><br><span class="line">ä¼˜åŒ–å¤„ç†ï¼šqc_bh<span class="operator">=</span><span class="string">&#x27;5400&#x27;</span> <span class="keyword">and</span> kh_bh<span class="operator">=</span><span class="string">&#x27;250000&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä»–ä¼˜åŒ–æ–¹æ³•">å…¶ä»–ä¼˜åŒ–æ–¹æ³•</h2>
<ol type="1">
<li><p>é€‰æ‹©æœ€æœ‰æ•ˆç‡çš„è¡¨åé¡ºåºï¼ˆåªåœ¨åŸºäºè§„åˆ™çš„ä¼˜åŒ–å™¨ä¸­æœ‰æ•ˆï¼‰</p>
<p><code>ORACLE</code>
çš„è§£æå™¨æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºå¤„ç†FROMå­å¥ä¸­çš„è¡¨åï¼ŒFROMå­å¥ä¸­å†™åœ¨æœ€åçš„è¡¨(åŸºç¡€è¡¨
driving
table)å°†è¢«æœ€å…ˆå¤„ç†ï¼Œåœ¨FROMå­å¥ä¸­åŒ…å«å¤šä¸ªè¡¨çš„æƒ…å†µä¸‹,ä½ å¿…é¡»é€‰æ‹©è®°å½•æ¡æ•°æœ€å°‘çš„è¡¨ä½œä¸ºåŸºç¡€è¡¨ã€‚å¦‚æœæœ‰3ä¸ªä»¥ä¸Šçš„è¡¨è¿æ¥æŸ¥è¯¢,
é‚£å°±éœ€è¦é€‰æ‹©äº¤å‰è¡¨(intersection table)ä½œä¸ºåŸºç¡€è¡¨,
äº¤å‰è¡¨æ˜¯æŒ‡é‚£ä¸ªè¢«å…¶ä»–è¡¨æ‰€å¼•ç”¨çš„è¡¨</p></li>
<li><p><code>WHERE</code>å­å¥ä¸­çš„è¿æ¥é¡ºåº</p>
<p><code>ORACLE</code>é‡‡ç”¨è‡ªä¸‹è€Œä¸Šçš„é¡ºåºè§£æWHEREå­å¥,æ ¹æ®è¿™ä¸ªåŸç†,è¡¨ä¹‹é—´çš„è¿æ¥å¿…é¡»å†™åœ¨å…¶ä»–<code>WHERE</code>æ¡ä»¶ä¹‹å‰,
é‚£äº›å¯ä»¥è¿‡æ»¤æ‰æœ€å¤§æ•°é‡è®°å½•çš„æ¡ä»¶å¿…é¡»å†™åœ¨WHEREå­å¥çš„æœ«å°¾.</p></li>
<li><p><code>SELECT</code>å­å¥ä¸­é¿å…ä½¿ç”¨ '*'</p>
<p><code>ORACLE</code>åœ¨è§£æçš„è¿‡ç¨‹ä¸­, ä¼šå°†'*'ä¾æ¬¡è½¬æ¢æˆæ‰€æœ‰çš„åˆ—å,
è¿™ä¸ªå·¥ä½œæ˜¯é€šè¿‡æŸ¥è¯¢æ•°æ®å­—å…¸å®Œæˆçš„, è¿™æ„å‘³ç€å°†è€—è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p></li>
<li><p>å‡å°‘è®¿é—®æ•°æ®åº“çš„æ¬¡æ•°</p>
<p><code>ORACLE</code>åœ¨å†…éƒ¨æ‰§è¡Œäº†è®¸å¤šå·¥ä½œ: è§£æSQLè¯­å¥,
ä¼°ç®—ç´¢å¼•çš„åˆ©ç”¨ç‡, ç»‘å®šå˜é‡ , è¯»æ•°æ®å—ç­‰ã€‚</p></li>
<li><p>åœ¨<code>SQL*Plus</code> ,
<code>SQL*Forms</code>å’Œ<code>Pro*C</code>ä¸­é‡æ–°è®¾ç½®<code>ARRAYSIZE</code>å‚æ•°,
å¯ä»¥å¢åŠ æ¯æ¬¡æ•°æ®åº“è®¿é—®çš„æ£€ç´¢æ•°æ®é‡ ,å»ºè®®å€¼ä¸º200</p></li>
<li><p>ä½¿ç”¨<code>DECODE</code>å‡½æ•°æ¥å‡å°‘å¤„ç†æ—¶é—´</p>
<p>ä½¿ç”¨<code>DECODE</code>å‡½æ•°å¯ä»¥é¿å…é‡å¤æ‰«æç›¸åŒè®°å½•æˆ–é‡å¤è¿æ¥ç›¸åŒçš„è¡¨.</p></li>
<li><p>æ•´åˆç®€å•,æ— å…³è”çš„æ•°æ®åº“è®¿é—®</p></li>
</ol>
<p>å¦‚æœä½ æœ‰å‡ ä¸ªç®€å•çš„æ•°æ®åº“æŸ¥è¯¢è¯­å¥,ä½ å¯ä»¥æŠŠå®ƒä»¬æ•´åˆåˆ°ä¸€ä¸ªæŸ¥è¯¢ä¸­(å³ä½¿å®ƒä»¬ä¹‹é—´æ²¡æœ‰å…³ç³»)
ã€‚</p>
<ol start="8" type="1">
<li>åˆ é™¤é‡å¤è®°å½•ï¼š</li>
</ol>
<blockquote>
<p>æœ€é«˜æ•ˆçš„åˆ é™¤é‡å¤è®°å½•æ–¹æ³•(å› ä¸ºä½¿ç”¨äº†<code>ROWID</code>)</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> EMP E <span class="keyword">WHERE</span> E.ROWID <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(X.ROWID) <span class="keyword">FROM</span> EMP X <span class="keyword">WHERE</span> X.EMP_NO <span class="operator">=</span> E.EMP_NO)</span><br></pre></td></tr></table></figure>
<ol start="9" type="1">
<li><p>ç”¨<code>TRUNCATE</code>æ›¿ä»£<code>DELETE</code></p>
<p>å½“åˆ é™¤è¡¨ä¸­çš„è®°å½•æ—¶,åœ¨é€šå¸¸æƒ…å†µä¸‹, å›æ»šæ®µ(rollback segments )
ç”¨æ¥å­˜æ”¾å¯ä»¥è¢«æ¢å¤çš„ä¿¡æ¯.
å¦‚æœä½ æ²¡æœ‰<code>COMMIT</code>äº‹åŠ¡,<code>ORACLE</code>ä¼šå°†æ•°æ®æ¢å¤åˆ°åˆ é™¤ä¹‹å‰çš„çŠ¶æ€(å‡†ç¡®åœ°è¯´æ˜¯æ¢å¤åˆ°æ‰§è¡Œåˆ é™¤å‘½ä»¤ä¹‹å‰çš„çŠ¶å†µ)
è€Œå½“è¿ç”¨<code>TRUNCATE</code>æ—¶,
å›æ»šæ®µä¸å†å­˜æ”¾ä»»ä½•å¯è¢«æ¢å¤çš„ä¿¡æ¯.å½“å‘½ä»¤è¿è¡Œå,æ•°æ®ä¸èƒ½è¢«æ¢å¤.å› æ­¤å¾ˆå°‘çš„èµ„æºè¢«è°ƒç”¨,æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå¾ˆçŸ­.
(è¯‘è€…æŒ‰:
<code>TRUNCATE</code>åªåœ¨åˆ é™¤å…¨è¡¨é€‚ç”¨,<code>TRUNCATE</code>æ˜¯DDLä¸æ˜¯DML)
ã€‚</p></li>
<li><p>å°½é‡å¤šä½¿ç”¨<code>COMMIT</code></p>
<p>åªè¦æœ‰å¯èƒ½,åœ¨ç¨‹åºä¸­å°½é‡å¤šä½¿ç”¨<code>COMMIT</code>,
è¿™æ ·ç¨‹åºçš„æ€§èƒ½å¾—åˆ°æé«˜,éœ€æ±‚ä¹Ÿä¼šå› ä¸º<code>COMMIT</code>æ‰€é‡Šæ”¾çš„èµ„æºè€Œå‡å°‘ï¼Œ<code>COMMIT</code>æ‰€é‡Šæ”¾çš„èµ„æº:</p>
<ol type="a">
<li><p>å›æ»šæ®µä¸Šç”¨äºæ¢å¤æ•°æ®çš„ä¿¡æ¯.</p></li>
<li><p>è¢«ç¨‹åºè¯­å¥è·å¾—çš„é”</p></li>
<li><p>redo log buffer ä¸­çš„ç©ºé—´</p></li>
<li><p><code>ORACLE</code>ä¸ºç®¡ç†ä¸Šè¿°3ç§èµ„æºä¸­çš„å†…éƒ¨èŠ±è´¹</p></li>
</ol></li>
<li><p>ç”¨<code>Where</code>å­å¥æ›¿æ¢<code>HAVING</code>å­å¥</p></li>
</ol>
<pre><code>é¿å…ä½¿ç”¨`HAVING`å­å¥, `HAVING` åªä¼šåœ¨æ£€ç´¢å‡ºæ‰€æœ‰è®°å½•ä¹‹åæ‰å¯¹ç»“æœé›†è¿›è¡Œè¿‡æ»¤. è¿™ä¸ªå¤„ç†éœ€è¦æ’åº,æ€»è®¡ç­‰æ“ä½œ. å¦‚æœèƒ½é€šè¿‡`WHERE`å­å¥é™åˆ¶è®°å½•çš„æ•°ç›®,é‚£å°±èƒ½å‡å°‘è¿™æ–¹é¢çš„å¼€é”€. (é`oracle`ä¸­)`on`ã€`where`ã€`having`è¿™ä¸‰ä¸ªéƒ½å¯ä»¥åŠ æ¡ä»¶çš„å­å¥ä¸­ï¼Œ`on`æ˜¯æœ€å…ˆæ‰§è¡Œï¼Œ`where`æ¬¡ä¹‹ï¼Œ`having`æœ€åï¼Œå› ä¸º`on`æ˜¯å…ˆæŠŠä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•è¿‡æ»¤åæ‰è¿›è¡Œç»Ÿè®¡ï¼Œå®ƒå°±å¯ä»¥å‡å°‘ä¸­é—´è¿ç®—è¦å¤„ç†çš„æ•°æ®ï¼ŒæŒ‰ç†è¯´åº”è¯¥é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œ`where`ä¹Ÿåº”è¯¥æ¯”`having`å¿«ç‚¹çš„ï¼Œå› ä¸ºå®ƒè¿‡æ»¤æ•°æ®åæ‰è¿›è¡Œ`sum`ï¼Œåœ¨ä¸¤ä¸ªè¡¨è”æ¥æ—¶æ‰ç”¨`on`çš„ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªè¡¨çš„æ—¶å€™ï¼Œå°±å‰©ä¸‹`where`è·Ÿ`having`æ¯”è¾ƒäº†ã€‚åœ¨è¿™å•è¡¨æŸ¥è¯¢ç»Ÿè®¡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¦è¿‡æ»¤çš„æ¡ä»¶æ²¡æœ‰æ¶‰åŠåˆ°è¦è®¡ç®—å­—æ®µï¼Œé‚£å®ƒä»¬çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯`where`å¯ä»¥ä½¿ç”¨`rushmore`æŠ€æœ¯ï¼Œè€Œ`having`å°±ä¸èƒ½ï¼Œåœ¨é€Ÿåº¦ä¸Šåè€…è¦æ…¢å¦‚æœè¦æ¶‰åŠåˆ°è®¡ç®—çš„å­— æ®µï¼Œå°±è¡¨ç¤ºåœ¨æ²¡è®¡ç®—ä¹‹å‰ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œæ ¹æ®ä¸Šç¯‡å†™çš„å·¥ä½œæµç¨‹ï¼Œ`where`çš„ä½œç”¨æ—¶é—´æ˜¯åœ¨è®¡ç®—ä¹‹å‰å°±å®Œæˆçš„ï¼Œè€Œ`having`å°±æ˜¯åœ¨è®¡ç®—åæ‰èµ·ä½œ ç”¨çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤è€…çš„ç»“æœä¼šä¸åŒã€‚åœ¨å¤šè¡¨è”æ¥æŸ¥è¯¢æ—¶ï¼Œ`on`æ¯”`where`æ›´æ—©èµ·ä½œç”¨ã€‚ç³»ç»Ÿé¦–å…ˆæ ¹æ®å„ä¸ªè¡¨ä¹‹é—´çš„è”æ¥æ¡ä»¶ï¼ŒæŠŠå¤šä¸ªè¡¨åˆæˆä¸€ä¸ªä¸´æ—¶è¡¨ åï¼Œå†ç”±`where`è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå†è®¡ç®—ï¼Œè®¡ç®—å®Œåå†ç”±`having`è¿›è¡Œè¿‡æ»¤ã€‚ç”±æ­¤å¯è§ï¼Œè¦æƒ³è¿‡æ»¤æ¡ä»¶èµ·åˆ°æ­£ç¡®çš„ä½œç”¨ï¼Œé¦–å…ˆè¦æ˜ç™½è¿™ä¸ªæ¡ä»¶åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™èµ·ä½œç”¨ï¼Œç„¶åå†å†³å®šæ”¾åœ¨é‚£é‡Œã€‚</code></pre>
<ol start="12" type="1">
<li>å‡å°‘å¯¹è¡¨çš„æŸ¥è¯¢</li>
</ol>
<blockquote>
<p>åœ¨å«æœ‰å­æŸ¥è¯¢çš„SQLè¯­å¥ä¸­,è¦ç‰¹åˆ«æ³¨æ„å‡å°‘å¯¹è¡¨çš„æŸ¥è¯¢</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TAB_NAME <span class="keyword">FROM</span> TABLES <span class="keyword">WHERE</span> (TAB_NAME,DB_VER) <span class="operator">=</span> ( <span class="keyword">SELECT</span> TAB_NAME,DB_VER <span class="keyword">FROM</span> TAB_COLUMNS <span class="keyword">WHERE</span> VERSION <span class="operator">=</span> <span class="number">604</span>)</span><br></pre></td></tr></table></figure>
<ol start="13" type="1">
<li><p>é€šè¿‡å†…éƒ¨å‡½æ•°æé«˜SQLæ•ˆç‡</p>
<p>å¤æ‚çš„SQLå¾€å¾€ç‰ºç‰²äº†æ‰§è¡Œæ•ˆç‡.
èƒ½å¤ŸæŒæ¡ä¸Šé¢çš„è¿ç”¨å‡½æ•°è§£å†³é—®é¢˜çš„æ–¹æ³•åœ¨å®é™…å·¥ä½œä¸­æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚</p></li>
<li><p>ä½¿ç”¨è¡¨çš„åˆ«å(<code>Alias</code>)ï¼š</p></li>
</ol>
<pre><code>å½“åœ¨SQLè¯­å¥ä¸­è¿æ¥å¤šä¸ªè¡¨æ—¶, è¯·ä½¿ç”¨è¡¨çš„åˆ«åå¹¶æŠŠåˆ«åå‰ç¼€äºæ¯ä¸ªColumnä¸Š.è¿™æ ·ä¸€æ¥,å°±å¯ä»¥å‡å°‘è§£æçš„æ—¶é—´å¹¶å‡å°‘é‚£äº›ç”±Columnæ­§ä¹‰å¼•èµ·çš„è¯­æ³•é”™è¯¯ã€‚</code></pre>
<ol start="15" type="1">
<li>è¯†åˆ«â€™ä½æ•ˆæ‰§è¡Œâ€™çš„SQLè¯­å¥</li>
</ol>
<pre><code>è™½ç„¶ç›®å‰å„ç§å…³äºSQLä¼˜åŒ–çš„å›¾å½¢åŒ–å·¥å…·å±‚å‡ºä¸ç©·,ä½†æ˜¯å†™å‡ºè‡ªå·±çš„SQLå·¥å…·æ¥è§£å†³é—®é¢˜å§‹ç»ˆæ˜¯ä¸€ä¸ªæœ€å¥½çš„æ–¹æ³•ã€‚</code></pre>
<p>â€‹<code>sql SELECT EXECUTIONS, DISK_READS, BUFFER_GETS, ROUND((BUFFER_GETS-DISK_READS)/BUFFER_GETS,2) Hit_radio, ROUND(DISK_READS/EXECUTIONS,2) Reads_per_run, SQL_TEXT FROM V$SQLAREA WHERE EXECUTIONS&gt;0 AND BUFFER_GETS &gt; 0 AND (BUFFER_GETS-DISK_READS)/BUFFER_GETS &lt; 0.8 ORDER BY 4 DESC; â€‹</code></p>
<ol start="16" type="1">
<li><p>ç”¨ç´¢å¼•æé«˜æ•ˆç‡</p>
<p>ç´¢å¼•æ˜¯è¡¨çš„ä¸€ä¸ªæ¦‚å¿µéƒ¨åˆ†,ç”¨æ¥æé«˜æ£€ç´¢æ•°æ®çš„æ•ˆç‡ï¼ŒORACLEä½¿ç”¨äº†ä¸€ä¸ªå¤æ‚çš„è‡ªå¹³è¡¡B-treeç»“æ„.
é€šå¸¸,é€šè¿‡ç´¢å¼•æŸ¥è¯¢æ•°æ®æ¯”å…¨è¡¨æ‰«æè¦å¿«.
å½“ORACLEæ‰¾å‡ºæ‰§è¡ŒæŸ¥è¯¢å’ŒUpdateè¯­å¥çš„æœ€ä½³è·¯å¾„æ—¶, ORACLEä¼˜åŒ–å™¨å°†ä½¿ç”¨ç´¢å¼•.
åŒæ ·åœ¨è”ç»“å¤šä¸ªè¡¨æ—¶ä½¿ç”¨ç´¢å¼•ä¹Ÿå¯ä»¥æé«˜æ•ˆç‡.
å¦ä¸€ä¸ªä½¿ç”¨ç´¢å¼•çš„å¥½å¤„æ˜¯,å®ƒæä¾›äº†ä¸»é”®(primary
key)çš„å”¯ä¸€æ€§éªŒè¯.ã€‚é‚£äº›LONGæˆ–LONG RAWæ•°æ®ç±»å‹, ä½ å¯ä»¥ç´¢å¼•å‡ ä¹æ‰€æœ‰çš„åˆ—.
é€šå¸¸, åœ¨å¤§å‹è¡¨ä¸­ä½¿ç”¨ç´¢å¼•ç‰¹åˆ«æœ‰æ•ˆ. å½“ç„¶,ä½ ä¹Ÿä¼šå‘ç°,
åœ¨æ‰«æå°è¡¨æ—¶,ä½¿ç”¨ç´¢å¼•åŒæ ·èƒ½æé«˜æ•ˆç‡.
è™½ç„¶ä½¿ç”¨ç´¢å¼•èƒ½å¾—åˆ°æŸ¥è¯¢æ•ˆç‡çš„æé«˜,ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¿…é¡»æ³¨æ„åˆ°å®ƒçš„ä»£ä»·.
ç´¢å¼•éœ€è¦ç©ºé—´æ¥å­˜å‚¨,ä¹Ÿéœ€è¦å®šæœŸç»´æŠ¤, æ¯å½“æœ‰è®°å½•åœ¨è¡¨ä¸­å¢å‡æˆ–ç´¢å¼•åˆ—è¢«ä¿®æ”¹æ—¶,
ç´¢å¼•æœ¬èº«ä¹Ÿä¼šè¢«ä¿®æ”¹. è¿™æ„å‘³ç€æ¯æ¡è®°å½•çš„INSERT , DELETE ,
UPDATEå°†ä¸ºæ­¤å¤šä»˜å‡º4 , 5 æ¬¡çš„ç£ç›˜I/O .
å› ä¸ºç´¢å¼•éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´å’Œå¤„ç†,é‚£äº›ä¸å¿…è¦çš„ç´¢å¼•åè€Œä¼šä½¿æŸ¥è¯¢ååº”æ—¶é—´å˜æ…¢.ã€‚å®šæœŸçš„é‡æ„ç´¢å¼•æ˜¯æœ‰å¿…è¦çš„</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> INDEX <span class="operator">&lt;</span>INDEXNAME<span class="operator">&gt;</span> REBUILD <span class="operator">&lt;</span>TABLESPACENAME<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="17" type="1">
<li><p>ç”¨<code>EXISTS</code>æ›¿æ¢<code>DISTINCT</code></p>
<p>å½“æäº¤ä¸€ä¸ªåŒ…å«ä¸€å¯¹å¤šè¡¨ä¿¡æ¯(æ¯”å¦‚éƒ¨é—¨è¡¨å’Œé›‡å‘˜è¡¨)çš„æŸ¥è¯¢æ—¶,é¿å…åœ¨<code>SELECT</code>å­å¥ä¸­ä½¿ç”¨<code>DISTINCT</code>.
ä¸€èˆ¬å¯ä»¥è€ƒè™‘ç”¨<code>EXIST</code>æ›¿æ¢, <code>EXISTS</code>
ä½¿æŸ¥è¯¢æ›´ä¸ºè¿…é€Ÿ,å› ä¸ºRDBMSæ ¸å¿ƒæ¨¡å—å°†åœ¨å­æŸ¥è¯¢çš„æ¡ä»¶ä¸€æ—¦æ»¡è¶³å,ç«‹åˆ»è¿”å›ç»“æœ.
ä¾‹å­ï¼š</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">(ä½æ•ˆ):</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> DEPT_NO, DEPT_NAME <span class="keyword">FROM</span> DEPT D, EMP E <span class="keyword">WHERE</span> D.DEPT_NO <span class="operator">=</span> E.DEPT_NO</span><br><span class="line">(é«˜æ•ˆ):</span><br><span class="line"><span class="keyword">SELECT</span> DEPT_NO, DEPT_NAME <span class="keyword">FROM</span> DEPT D <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> ( <span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span> <span class="keyword">FROM</span> EMP E <span class="keyword">WHERE</span> E.DEPT_NO <span class="operator">=</span> D.DEPT_NO);</span><br></pre></td></tr></table></figure>
<ol start="18" type="1">
<li><p>sqlè¯­å¥ç”¨å¤§å†™çš„</p>
<p>å› ä¸ºoracleæ€»æ˜¯å…ˆè§£æsqlè¯­å¥ï¼ŒæŠŠå°å†™çš„å­—æ¯è½¬æ¢æˆå¤§å†™çš„å†æ‰§è¡Œ</p></li>
<li><p>åœ¨javaä»£ç ä¸­å°½é‡å°‘ç”¨è¿æ¥ç¬¦â€œï¼‹â€è¿æ¥å­—ç¬¦ä¸²ï¼</p></li>
<li><p>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOTï¼Œé€šå¸¸æˆ‘ä»¬è¦é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOT,
NOTä¼šäº§ç”Ÿåœ¨å’Œåœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°ç›¸åŒçš„å½±å“.
å½“ORACLEâ€é‡åˆ°â€NOT,ä»–å°±ä¼šåœæ­¢ä½¿ç”¨ç´¢å¼•è½¬è€Œæ‰§è¡Œå…¨è¡¨æ‰«æã€‚</p></li>
<li><p>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨è®¡ç®—</p>
<p>WHEREå­å¥ä¸­ï¼Œå¦‚æœç´¢å¼•åˆ—æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼ä¼˜åŒ–å™¨å°†ä¸ä½¿ç”¨ç´¢å¼•è€Œä½¿ç”¨å…¨è¡¨æ‰«æï¼</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆï¼š</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> DEPT <span class="keyword">WHERE</span> SAL <span class="operator">*</span> <span class="number">12</span> <span class="operator">&gt;</span> <span class="number">25000</span>;</span><br><span class="line">é«˜æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> DEPT <span class="keyword">WHERE</span> SAL <span class="operator">&gt;</span> <span class="number">25000</span><span class="operator">/</span><span class="number">12</span>;</span><br></pre></td></tr></table></figure>
<ol start="22" type="1">
<li>ç”¨&gt;=æ›¿ä»£&gt;</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">é«˜æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> DEPTNO <span class="operator">&gt;=</span> <span class="number">4</span></span><br><span class="line">ä½æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> DEPTNO <span class="operator">&gt;</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<ol start="23" type="1">
<li><p>ç”¨UNIONæ›¿æ¢OR (é€‚ç”¨äºç´¢å¼•åˆ—)</p>
<p>é€šå¸¸æƒ…å†µä¸‹, ç”¨UNIONæ›¿æ¢WHEREå­å¥ä¸­çš„ORå°†ä¼šèµ·åˆ°è¾ƒå¥½çš„æ•ˆæœ.
å¯¹ç´¢å¼•åˆ—ä½¿ç”¨ORå°†é€ æˆå…¨è¡¨æ‰«æ. æ³¨æ„, ä»¥ä¸Šè§„åˆ™åªé’ˆå¯¹å¤šä¸ªç´¢å¼•åˆ—æœ‰æ•ˆ.
å¦‚æœæœ‰columnæ²¡æœ‰è¢«ç´¢å¼•, æŸ¥è¯¢æ•ˆç‡å¯èƒ½ä¼šå› ä¸ºä½ æ²¡æœ‰é€‰æ‹©ORè€Œé™ä½.
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, LOC_ID å’ŒREGIONä¸Šéƒ½å»ºæœ‰ç´¢å¼•.</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">é«˜æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> LOC_ID , LOC_DESC , REGION</span><br><span class="line"><span class="keyword">FROM</span> LOCATION</span><br><span class="line"><span class="keyword">WHERE</span> LOC_ID <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> LOC_ID , LOC_DESC , REGION</span><br><span class="line"><span class="keyword">FROM</span> LOCATION</span><br><span class="line"><span class="keyword">WHERE</span> REGION <span class="operator">=</span> &quot;MELBOURNE&quot;</span><br><span class="line">ä½æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> LOC_ID , LOC_DESC , REGION</span><br><span class="line"><span class="keyword">FROM</span> LOCATION</span><br><span class="line"><span class="keyword">WHERE</span> LOC_ID <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> REGION <span class="operator">=</span> &quot;MELBOURNE&quot;</span><br></pre></td></tr></table></figure>
<ol start="24" type="1">
<li><p>ç”¨INæ¥æ›¿æ¢OR</p>
<p>è¿™æ˜¯ä¸€æ¡ç®€å•æ˜“è®°çš„è§„åˆ™ï¼Œä½†æ˜¯å®é™…çš„æ‰§è¡Œæ•ˆæœè¿˜é¡»æ£€éªŒï¼Œåœ¨ORACLE8ä¸‹ï¼Œä¸¤è€…çš„æ‰§è¡Œè·¯å¾„ä¼¼ä¹æ˜¯ç›¸åŒçš„ï¼</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span>â€¦. <span class="keyword">FROM</span> LOCATION <span class="keyword">WHERE</span> LOC_ID <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> LOC_ID <span class="operator">=</span> <span class="number">20</span> <span class="keyword">OR</span> LOC_ID <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">é«˜æ•ˆ</span><br><span class="line"><span class="keyword">SELECT</span>â€¦ <span class="keyword">FROM</span> LOCATION <span class="keyword">WHERE</span> LOC_IN <span class="keyword">IN</span> (<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<ol start="25" type="1">
<li><p>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨IS NULLå’ŒIS NOT NULL</p>
<p>é¿å…åœ¨ç´¢å¼•ä¸­ä½¿ç”¨ä»»ä½•å¯ä»¥ä¸ºç©ºçš„åˆ—ï¼ŒORACLEå°†æ— æ³•ä½¿ç”¨è¯¥ç´¢å¼•ï¼å¯¹äºå•åˆ—ç´¢å¼•ï¼Œå¦‚æœåˆ—åŒ…å«ç©ºå€¼ï¼Œç´¢å¼•ä¸­å°†ä¸å­˜åœ¨æ­¤è®°å½•.
å¯¹äºå¤åˆç´¢å¼•ï¼Œå¦‚æœæ¯ä¸ªåˆ—éƒ½ä¸ºç©ºï¼Œç´¢å¼•ä¸­åŒæ ·ä¸å­˜åœ¨æ­¤è®°å½•.
å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªåˆ—ä¸ä¸ºç©ºï¼Œåˆ™è®°å½•å­˜åœ¨äºç´¢å¼•ä¸­ï¼ä¸¾ä¾‹:
å¦‚æœå”¯ä¸€æ€§ç´¢å¼•å»ºç«‹åœ¨è¡¨çš„Aåˆ—å’ŒBåˆ—ä¸Š,
å¹¶ä¸”è¡¨ä¸­å­˜åœ¨ä¸€æ¡è®°å½•çš„A,Bå€¼ä¸º(123,null) ,
ORACLEå°†ä¸æ¥å—ä¸‹ä¸€æ¡å…·æœ‰ç›¸åŒA,Bå€¼ï¼ˆ123,nullï¼‰çš„è®°å½•(æ’å…¥).
ç„¶è€Œå¦‚æœæ‰€æœ‰çš„ç´¢å¼•åˆ—éƒ½ä¸ºç©ºï¼ŒORACLEå°†è®¤ä¸ºæ•´ä¸ªé”®å€¼ä¸ºç©ºè€Œç©ºä¸ç­‰äºç©º.
å› æ­¤ä½ å¯ä»¥æ’å…¥1000 æ¡å…·æœ‰ç›¸åŒé”®å€¼çš„è®°å½•,å½“ç„¶å®ƒä»¬éƒ½æ˜¯ç©º!
å› ä¸ºç©ºå€¼ä¸å­˜åœ¨äºç´¢å¼•åˆ—ä¸­,æ‰€ä»¥WHEREå­å¥ä¸­å¯¹ç´¢å¼•åˆ—è¿›è¡Œç©ºå€¼æ¯”è¾ƒå°†ä½¿ORACLEåœç”¨è¯¥ç´¢å¼•.</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆ: (ç´¢å¼•å¤±æ•ˆ)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> DEPARTMENT <span class="keyword">WHERE</span> DEPT_CODE <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">é«˜æ•ˆ: (ç´¢å¼•æœ‰æ•ˆ)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> DEPARTMENT <span class="keyword">WHERE</span> DEPT_CODE <span class="operator">&gt;=</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<ol start="26" type="1">
<li><p>æ€»æ˜¯ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—</p>
<p>å¦‚æœç´¢å¼•æ˜¯å»ºç«‹åœ¨å¤šä¸ªåˆ—ä¸Š, åªæœ‰åœ¨å®ƒçš„ç¬¬ä¸€ä¸ªåˆ—(leading
column)è¢«whereå­å¥å¼•ç”¨æ—¶,ä¼˜åŒ–å™¨æ‰ä¼šé€‰æ‹©ä½¿ç”¨è¯¥ç´¢å¼•.
è¿™ä¹Ÿæ˜¯ä¸€æ¡ç®€å•è€Œé‡è¦çš„è§„åˆ™ï¼Œå½“ä»…å¼•ç”¨ç´¢å¼•çš„ç¬¬äºŒä¸ªåˆ—æ—¶,ä¼˜åŒ–å™¨ä½¿ç”¨äº†å…¨è¡¨æ‰«æè€Œå¿½ç•¥äº†ç´¢å¼•ã€‚</p></li>
<li><p>ç”¨UNION-ALL æ›¿æ¢UNION ( å¦‚æœæœ‰å¯èƒ½çš„è¯)</p>
<p>å½“SQL
è¯­å¥éœ€è¦UNIONä¸¤ä¸ªæŸ¥è¯¢ç»“æœé›†åˆæ—¶,è¿™ä¸¤ä¸ªç»“æœé›†åˆä¼šä»¥UNION-ALLçš„æ–¹å¼è¢«åˆå¹¶,
ç„¶ååœ¨è¾“å‡ºæœ€ç»ˆç»“æœå‰è¿›è¡Œæ’åº. å¦‚æœç”¨UNION ALLæ›¿ä»£UNION,
è¿™æ ·æ’åºå°±ä¸æ˜¯å¿…è¦äº†. æ•ˆç‡å°±ä¼šå› æ­¤å¾—åˆ°æé«˜. éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUNION ALL
å°†é‡å¤è¾“å‡ºä¸¤ä¸ªç»“æœé›†åˆä¸­ç›¸åŒè®°å½•. å› æ­¤å„ä½è¿˜æ˜¯è¦ä»ä¸šåŠ¡éœ€æ±‚åˆ†æä½¿ç”¨UNION
ALLçš„å¯è¡Œæ€§. UNION
å°†å¯¹ç»“æœé›†åˆæ’åº,è¿™ä¸ªæ“ä½œä¼šä½¿ç”¨åˆ°SORT_AREA_SIZEè¿™å—å†…å­˜.
å¯¹äºè¿™å—å†…å­˜çš„ä¼˜åŒ–ä¹Ÿæ˜¯ç›¸å½“é‡è¦çš„.
ä¸‹é¢çš„SQLå¯ä»¥ç”¨æ¥æŸ¥è¯¢æ’åºçš„æ¶ˆè€—é‡</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆï¼š</span><br><span class="line"><span class="keyword">SELECT</span> ACCT_NUM, BALANCE_AMT</span><br><span class="line"><span class="keyword">FROM</span> DEBIT_TRANSACTIONS</span><br><span class="line"><span class="keyword">WHERE</span> TRAN_DATE <span class="operator">=</span> <span class="string">&#x27;31-DEC-95&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> ACCT_NUM, BALANCE_AMT</span><br><span class="line"><span class="keyword">FROM</span> DEBIT_TRANSACTIONS</span><br><span class="line"><span class="keyword">WHERE</span> TRAN_DATE <span class="operator">=</span> <span class="string">&#x27;31-DEC-95&#x27;</span></span><br><span class="line">é«˜æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> ACCT_NUM, BALANCE_AMT</span><br><span class="line"><span class="keyword">FROM</span> DEBIT_TRANSACTIONS</span><br><span class="line"><span class="keyword">WHERE</span> TRAN_DATE <span class="operator">=</span> <span class="string">&#x27;31-DEC-95&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> ACCT_NUM, BALANCE_AMT</span><br><span class="line"><span class="keyword">FROM</span> DEBIT_TRANSACTIONS</span><br><span class="line"><span class="keyword">WHERE</span> TRAN_DATE <span class="operator">=</span> <span class="string">&#x27;31-DEC-95&#x27;</span></span><br></pre></td></tr></table></figure>
<ol start="28" type="1">
<li><p>ç”¨WHEREæ›¿ä»£ORDER BY</p>
<p>ORDER BY å­å¥åªåœ¨ä¸¤ç§ä¸¥æ ¼çš„æ¡ä»¶ä¸‹ä½¿ç”¨ç´¢å¼•.</p>
<p>ORDER BYä¸­æ‰€æœ‰çš„åˆ—å¿…é¡»åŒ…å«åœ¨ç›¸åŒçš„ç´¢å¼•ä¸­å¹¶ä¿æŒåœ¨ç´¢å¼•ä¸­çš„æ’åˆ—é¡ºåº.</p>
<p>ORDER BYä¸­æ‰€æœ‰çš„åˆ—å¿…é¡»å®šä¹‰ä¸ºéç©º.</p>
<p>WHEREå­å¥ä½¿ç”¨çš„ç´¢å¼•å’ŒORDER BYå­å¥ä¸­æ‰€ä½¿ç”¨çš„ç´¢å¼•ä¸èƒ½å¹¶åˆ—.</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆ: (ç´¢å¼•ä¸è¢«ä½¿ç”¨)</span><br><span class="line"><span class="keyword">SELECT</span> DEPT_CODE <span class="keyword">FROM</span> DEPT <span class="keyword">ORDER</span> <span class="keyword">BY</span> DEPT_TYPE</span><br><span class="line">é«˜æ•ˆ: (ä½¿ç”¨ç´¢å¼•)</span><br><span class="line"><span class="keyword">SELECT</span> DEPT_CODE <span class="keyword">FROM</span> DEPT <span class="keyword">WHERE</span> DEPT_TYPE <span class="operator">&gt;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<ol start="29" type="1">
<li><p>é¿å…æ”¹å˜ç´¢å¼•åˆ—çš„ç±»å‹</p>
<p>å½“æ¯”è¾ƒä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®æ—¶,
ORACLEè‡ªåŠ¨å¯¹åˆ—è¿›è¡Œç®€å•çš„ç±»å‹è½¬æ¢.</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># å‡è®¾ EMPNOæ˜¯ä¸€ä¸ªæ•°å€¼ç±»å‹çš„ç´¢å¼•åˆ—.</span><br><span class="line"># ä½æ•ˆ</span><br><span class="line"><span class="keyword">SELECT</span> â€¦ <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> EMPNO <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span></span><br><span class="line"># é«˜æ•ˆ</span><br><span class="line"><span class="keyword">SELECT</span> â€¦ <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> EMPNO <span class="operator">=</span> <span class="number">123</span></span><br></pre></td></tr></table></figure>
<ol start="30" type="1">
<li><p>éœ€è¦å½“å¿ƒçš„WHEREå­å¥</p>
<p>æŸäº›SELECT è¯­å¥ä¸­çš„WHEREå­å¥ä¸ä½¿ç”¨ç´¢å¼•. è¿™é‡Œæœ‰ä¸€äº›ä¾‹å­.</p>
<ol type="1">
<li><code>!=</code> å°†ä¸ä½¿ç”¨ç´¢å¼•. è®°ä½, ç´¢å¼•åªèƒ½å‘Šè¯‰ä½ ä»€ä¹ˆå­˜åœ¨äºè¡¨ä¸­,
è€Œä¸èƒ½å‘Šè¯‰ä½ ä»€ä¹ˆä¸å­˜åœ¨äºè¡¨ä¸­.</li>
<li><code>Â¦ Â¦</code>æ˜¯å­—ç¬¦è¿æ¥å‡½æ•°. å°±è±¡å…¶ä»–å‡½æ•°é‚£æ ·, åœç”¨äº†ç´¢å¼•.</li>
<li><code>+</code>æ˜¯æ•°å­¦å‡½æ•°. å°±è±¡å…¶ä»–æ•°å­¦å‡½æ•°é‚£æ ·, åœç”¨äº†ç´¢å¼•.</li>
<li>ç›¸åŒçš„ç´¢å¼•åˆ—ä¸èƒ½äº’ç›¸æ¯”è¾ƒ,è¿™å°†ä¼šå¯ç”¨å…¨è¡¨æ‰«æ.</li>
</ol></li>
<li><ol type="a">
<li><p>å¦‚æœæ£€ç´¢æ•°æ®é‡è¶…è¿‡30%çš„è¡¨ä¸­è®°å½•æ•°.ä½¿ç”¨ç´¢å¼•å°†æ²¡æœ‰æ˜¾è‘—çš„æ•ˆç‡æé«˜.</p></li>
<li><p>åœ¨ç‰¹å®šæƒ…å†µä¸‹, ä½¿ç”¨ç´¢å¼•ä¹Ÿè®¸ä¼šæ¯”å…¨è¡¨æ‰«ææ…¢,
ä½†è¿™æ˜¯åŒä¸€ä¸ªæ•°é‡çº§ä¸Šçš„åŒºåˆ«.
è€Œé€šå¸¸æƒ…å†µä¸‹,ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å—å‡ å€ä¹ƒè‡³å‡ åƒå€!</p></li>
</ol></li>
<li><p>é¿å…ä½¿ç”¨è€—è´¹èµ„æºçš„æ“ä½œ</p>
<p>å¸¦æœ‰DISTINCT,UNION,MINUS,INTERSECT,ORDER
BYçš„SQLè¯­å¥ä¼šå¯åŠ¨SQLå¼•æ“æ‰§è¡Œè€—è´¹èµ„æºçš„æ’åº(SORT)åŠŸèƒ½.
DISTINCTéœ€è¦ä¸€æ¬¡æ’åºæ“ä½œ, è€Œå…¶ä»–çš„è‡³å°‘éœ€è¦æ‰§è¡Œä¸¤æ¬¡æ’åº. é€šå¸¸, å¸¦æœ‰UNION,
MINUS , INTERSECTçš„SQLè¯­å¥éƒ½å¯ä»¥ç”¨å…¶ä»–æ–¹å¼é‡å†™.
å¦‚æœä½ çš„æ•°æ®åº“çš„SORT_AREA_SIZEè°ƒé…å¾—å¥½, ä½¿ç”¨UNION , MINUS,
INTERSECTä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘çš„, æ¯•ç«Ÿå®ƒä»¬çš„å¯è¯»æ€§å¾ˆå¼ºã€‚</p></li>
<li><p>ä¼˜åŒ–GROUP BY</p>
<p>æé«˜GROUP BY è¯­å¥çš„æ•ˆç‡, å¯ä»¥é€šè¿‡å°†ä¸éœ€è¦çš„è®°å½•åœ¨GROUP BY
ä¹‹å‰è¿‡æ»¤æ‰.ä¸‹é¢ä¸¤ä¸ªæŸ¥è¯¢è¿”å›ç›¸åŒç»“æœä½†ç¬¬äºŒä¸ªæ˜æ˜¾å°±å¿«äº†è®¸å¤š.</p></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä½æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> JOB, <span class="built_in">AVG</span>(SAL)</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">by</span> JOB</span><br><span class="line"><span class="keyword">HAVING</span> JOB <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span></span><br><span class="line"><span class="keyword">OR</span> JOB <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line">é«˜æ•ˆ:</span><br><span class="line"><span class="keyword">SELECT</span> JOB, <span class="built_in">AVG</span>(SAL)</span><br><span class="line"><span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> JOB <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span></span><br><span class="line"><span class="keyword">OR</span> JOB <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">by</span> JOB</span><br></pre></td></tr></table></figure>
<pre><code>â€‹</code></pre>
]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç«¯å£è½¬å‘å·¥å…·ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</title>
    <url>/hexo_blog/2020/08/08/%E8%BF%90%E7%BB%B4/firewall%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/</url>
    <content><![CDATA[<p>å¦‚ä½•é€šè¿‡é˜²ç«å¢™æœ¬æœºç«¯å£è½¬å‘æ¥å®ç°SSHè·³æ¿ç™»å½•ã€‚ç»§
<a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a>ï¼Œæ ¹æ®æ–°çš„éœ€æ±‚è¡ç”Ÿå‡ºæ–°æŠ€å·§</p>
<span id="more"></span>
<p>ç»§ <a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a>ï¼Œæ ¹æ®æ–°çš„éœ€æ±‚è¡ç”Ÿå‡ºæ–°æŠ€å·§</p>
<h3 id="éœ€æ±‚">éœ€æ±‚</h3>
<ol type="1">
<li>ç»§è·³æ¿æœºä¸­è½¬ç™»å½•åï¼Œè§‰å¾—éœ€è¦ä¸­è½¬ç™»å½•è¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿè·Ÿæ™®é€šsshä¸€æ ·ç™»å½•</li>
</ol>
<h3 id="å·¥å…·">å·¥å…·</h3>
<ol type="1">
<li>é˜²ç«å¢™é…ç½®ï¼ˆiptables/ufw/firewallï¼‰</li>
<li>ssh</li>
</ol>
<h3 id="å…ˆéªŒçŸ¥è¯†">å…ˆéªŒçŸ¥è¯†</h3>
<ol type="1">
<li><a href="/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/" title="ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰">ssh ç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</a></li>
<li>é˜²ç«å¢™é…ç½®
<ol type="1">
<li>iptablesï¼ˆCentos7ä¹‹å‰è‡ªå¸¦ï¼‰</li>
<li>firewallï¼ˆCentos7ä¹‹åè‡ªå¸¦ï¼‰</li>
<li>ufwï¼ˆUbuntuè‡ªå¸¦ï¼‰</li>
<li>netshï¼ˆWindowsè‡ªå¸¦ï¼‰</li>
</ol></li>
</ol>
<h3 id="å®éªŒ">å®éªŒ</h3>
<ol type="1">
<li>å‡è®¾å†…ç½‘æœºå™¨Aï¼Œå†…ç½‘æœºå™¨Cï¼Œå…¬ç½‘æœºå™¨Bã€‚Aé€šè¿‡å°†22ç«¯å£è½¬å‘è‡³Bçš„3000ç«¯å£æ¥è¿›è¡Œè·³æ¿ç™»å½•ã€‚æ‰€ä»¥Céœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥ç™»å½•A</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Cç™»å½•B</span></span><br><span class="line">ssh userB@ip_B</span><br><span class="line"><span class="comment"># Bç™»å½•A</span></span><br><span class="line">ssh userA@127.0.0.1 -p 3000</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>é€šè¿‡é˜²ç«å¢™æœ¬æœºç«¯å£è½¬å‘ï¼Œå°†æœ¬æœºçš„3000ç«¯å£è½¬å‘è‡³3000ç«¯å£</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸¤è€…çš„å‰æéœ€è¦åœ¨/etc/sysctl.confä¸­ï¼Œä»¤net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="comment"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># iptables</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp -i eth0 -d 127.0.0.1 --dport 3000 -j DNAT --to 127.0.0.1:3000</span><br><span class="line"></span><br><span class="line"><span class="comment"># firewall</span></span><br><span class="line"><span class="comment"># æ·»åŠ ç«¯å£</span></span><br><span class="line">firewall-cmd --add-port=3000/tcp --permanent</span><br><span class="line"><span class="comment"># ç«¯å£è½¬å‘</span></span><br><span class="line">firewall-cmd --permanent --add-forward-port=port=3000:proto=tcp:toport=3000 --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># --permanent æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment"># firewallæ·»åŠ åï¼Œéœ€è¦é‡å¯</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># netsh</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenaddress=127.0.0.1 listenport=2121 connectaddress=ip_B connectport=222</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>ä»¥ä¸Šï¼Œå³å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç›´æ¥ç™»å½•A</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh userA@ip_B -p 3000</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ç«¯å£è½¬å‘</tag>
        <tag>ssh</tag>
        <tag>iptables</tag>
        <tag>firewall</tag>
        <tag>ufw</tag>
        <tag>netsh</tag>
      </tags>
  </entry>
  <entry>
    <title>sshç¬”è®°ï¼ˆç«¯å£è½¬å‘ï¼‰</title>
    <url>/hexo_blog/2018/02/11/%E8%BF%90%E7%BB%B4/ssh/</url>
    <content><![CDATA[<p>ä½¿ç”¨SSHå®ç°æœ¬åœ°å’Œè¿œç¨‹ä¸»æœºä¹‹é—´çš„ç«¯å£è½¬å‘ã€‚æœ¬æ–‡ä»‹ç»äº†SSHç«¯å£è½¬å‘çš„åŸºç¡€æ“ä½œï¼Œå‚æ•°è¯¦è§£å’Œç”¨é€”ä»‹ç»ï¼Œå¹¶æä¾›äº†ä¸€é”®å‘½ä»¤å’Œæ³¨æ„äº‹é¡¹ã€‚SSHç«¯å£è½¬å‘å¯ä»¥ç”¨äºå†…å¤–ç½‘ç©¿é€ï¼Œå®ç°æœåŠ¡å™¨ä»£ç†ï¼ŒåŠ¨æ€è½¬å‘ç«¯å£ï¼Œå®ç°è¿œç«¯æ“ä½œç­‰åŠŸèƒ½ã€‚</p>
<span id="more"></span>
<p>è¯´æ˜ï¼šlocalhostè¡¨ç¤ºæœ¬åœ°ä¸»æœºï¼Œ<code>localuser</code>è¡¨ç¤ºæœ¬åœ°ç”¨æˆ·ï¼ˆå†…ç½‘ç”¨æˆ·ï¼‰ï¼Œuserè¡¨ç¤ºè¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·åï¼Œhostè¡¨ç¤ºè¿œç¨‹æœåŠ¡å™¨ip.</p>
<p>æ³¨æ„ï¼šå†…ç½‘ç”µè„‘ä¹Ÿå¿…é¡»è¦å¼€å¯sshæœåŠ¡ï¼Œå³å®‰è£…openssh-serveræœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨sshè¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œ-p 22è¡¨ç¤º22ç«¯å£è¿æ¥ï¼Œè¿™é‡Œä¸åŠ ä¹Ÿè¡Œï¼Œsshé»˜è®¤æ˜¯22ç«¯å£è¿æ¥</span></span><br><span class="line">ssh -p 22 user@remotehost</span><br></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ã€€æœ¬åœ°ç«¯å£è½¬å‘ï¼Œå°†æœ¬åœ°çš„2222ç«¯å£è½¬å‘è‡³æœ¬æœºçš„22ç«¯å£</span></span><br><span class="line">ssh -L 2222:localhost:22 user@remotehost</span><br><span class="line"><span class="comment"># åœ¨æœ¬åœ°ï¼ˆlocalhostï¼‰æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè¾“å…¥å¯†ç ã€‚é¦–å…ˆä¼šè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Š</span></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°ï¼ˆlocalhostï¼‰å¦å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„ä½œç”¨</span></span><br><span class="line"><span class="comment"># useråŒä¸Šé¢å‘½ä»¤çš„userï¼Œlocalhostæ˜¯æœ¬åœ°ï¼ˆç…§æŠ„å³å¯ï¼‰</span></span><br><span class="line">ssh -p 2222 user@localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿œç¨‹ç«¯å£è½¬å‘ï¼Œå°†æœ¬åœ°çš„22ç«¯å£è½¬å‘è‡³è¿œç¨‹çš„2222ç«¯å£</span></span><br><span class="line">ssh -R 2222:localhost:22 user@remotehost</span><br><span class="line"><span class="comment"># åœ¨æœ¬åœ°ï¼ˆlocalhostï¼‰æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè¾“å…¥å¯†ç ã€‚é¦–å…ˆä¼šè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Š</span></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå¯ä»¥è¿æ¥åˆ°æœ¬åœ°ï¼ˆlocalhostï¼‰</span></span><br><span class="line"><span class="comment"># localuserè¡¨ç¤ºçš„æ˜¯localhostçš„ç”¨æˆ·åï¼Œlocalhostè¡¨ç¤ºæœ¬åœ°ï¼ˆè¿œç¨‹æœåŠ¡å™¨çš„æœ¬åœ°ï¼Œç…§æŠ„å³å¯ï¼‰</span></span><br><span class="line">ssh -p 2222 localuser@localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ¨æ€ç«¯å£è½¬å‘ï¼Œæœ¬æœºçš„2222ç«¯å£ç»‘å®šè¿œç¨‹çš„æŸä¸ªç«¯å£(socks5æµé‡)</span></span><br><span class="line">ssh -D 2222 user@remotehost</span><br><span class="line"><span class="comment"># åœ¨æœ¬åœ°ï¼ˆlocalhostï¼‰æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè¾“å…¥å¯†ç ã€‚é¦–å…ˆä¼šè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Š</span></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œä¸å…³é—­ç»ˆç«¯ï¼Œæ›´æ”¹æœ¬åœ°æµè§ˆå™¨çš„ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼Œæµé‡ä¾¿é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè½¬å‘</span></span><br></pre></td></tr></table></figure>
<h2 id="å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-L [bind_address:]port:host:hostport</span><br></pre></td></tr></table></figure>
<p>Specifies that connections to the given TCP port or Unix socket on
the local (client) host are to be forwarded to the given host and port,
or Unix socket, on the remote side. This works by allocating a socket to
listen to either a TCP port on the local side, optionally bound to the
specified bind_address, or to a Unix socket. Whenever a connection is
made to the local port or socket, the connection is forwarded over the
secure channel, and a connection is made to either host port hostport,
or the Unix socket remote_socket, from the remote machine.</p>
<p>Port forwardings can also be specified in the configuration file.
Only the superuser can forward privileged ports. IPv6 addresses can be
specified by enclosing the address in square brackets.</p>
<p>By default, the local port is bound in accordance with the
GatewayPorts setting. However, an explicit bind_address may be used to
bind the connection to a specific address. The bind_address of
â€œlocalhostâ€ indicates that the listening port be bound for local use
only, while an empty address or â€˜*â€™ indicates that the port should be
available from all interfaces.</p>
<p>å°†æœ¬åœ°ä¸»æœºè½¬å‘åˆ°è¿œç¨‹ä¸»æœºå’Œç«¯å£ã€‚ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚é»˜è®¤æœ¬åœ°ç«¯å£æ˜¯æ ¹æ®GatewayPortsè®¾ç½®ç»‘å®šçš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨bind_addresså°†è¿æ¥ç»‘å®šåˆ°æŒ‡å®šåœ°å€ã€‚å¦‚æœbind_addressä¸ºlocalhostè¡¨ç¤ºç›‘å¬ç«¯å£åªåœ¨æœ¬åœ°ä½¿ç”¨ï¼Œå¦‚æœä¸å¡«æˆ–*è¡¨ç¤ºåº”ç”¨æ‰€æœ‰ç«¯å£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-R [bind_address:]port:host:hostport</span><br></pre></td></tr></table></figure>
<p>Specifies that connections to the given TCP port or Unix socket on
the remote (server) host are to be forwarded to the given host and port,
or Unix socket, on the local side. This works by allocating a socket to
listen to either a TCP port or to a Unix socket on the remote side.
Whenever a connection is made to this port or Unix socket, the
connection is forwarded over the secure channel, and a connection is
made to either host port hostport, or local_socket, from the local
machine.</p>
<p>Port forwardings can also be specified in the configuration file.
Privileged ports can be forwarded only when logging in as root on the
remote machine. IPv6 addresses can be specified by enclosing the address
in square brackets.</p>
<p>By default, TCP listening sockets on the server will be bound to the
loopback interface only. This may be overridden by specifying a
bind_address. An empty bind_address, or the address â€˜*â€™, indicates that
the remote socket should listen on all interfaces. Specifying a remote
bind_address will only succeed if the server's GatewayPorts option is
enabled (see sshd_config(5)).</p>
<p>If the port argument is â€˜0â€™, the listen port will be dynamically
allocated on the server and reported to the client at run time. When
used together with -O forward the allocated port will be printed to the
standard output.</p>
<p>åŸºæœ¬åŒ-Lå‚æ•°å‘½ä»¤ï¼Œå¦‚æœportä¸º0ï¼Œç›‘å¬ç«¯å£å°†ä¼šåŠ¨æ€è¿›è¡Œåˆ†é…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-D [bind_address:]port</span><br></pre></td></tr></table></figure>
<p>Specifies a local â€œdynamicâ€ application-level port forwarding. This
works by allocating a socket to listen to port on the local side,
optionally bound to the specified bind_address. Whenever a connection is
made to this port, the connection is forwarded over the secure channel,
and the application protocol is then used to determine where to connect
to from the remote machine. Currently the SOCKS4 and SOCKS5 protocols
are supported, and ssh will act as a SOCKS server. Only root can forward
privileged ports. Dynamic port forwardings can also be specified in the
configuration file.</p>
<p>IPv6 addresses can be specified by enclosing the address in square
brackets. Only the superuser can forward privileged ports. By default,
the local port is bound in accordance with the GatewayPorts setting.
However, an explicit bind_address may be used to bind the connection to
a specific address. The bind_address of â€œlocalhostâ€ indicates that the
listening port be bound for local use only, while an empty address or
â€˜*â€™ indicates that the port should be available from all interfaces.</p>
<p>æŒ‡å®šæœ¬åœ°åŠ¨æ€ç«¯å£è½¬å‘ã€‚é€šè¿‡åˆ†é…ä¸€ä¸ªsocketæ¥ç›‘å¬æœ¬åœ°ç«¯å£ã€‚æ”¯æŒSOCKS4å’ŒSOCKS5åè®®ï¼Œç›¸å½“äºsshå……å½“SOCKSæœåŠ¡å™¨ã€‚é…ç½®æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥æŒ‡å®šã€‚bind_addressä¸ºlocalhostè¡¨ç¤ºç›‘å¬ç«¯å£ä»…é™æœ¬åœ°ä½¿ç”¨ï¼Œå¦‚æœä¸ºç©ºæˆ–è€…*è¡¨ç¤ºè¯¥ç«¯å£å¯é€šè¿‡æ‰€æœ‰æ¥å£</p>
<p>sshéƒ¨åˆ†å‚æ•°ä»‹ç»</p>
<p>å¯ä»¥ç”¨åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­</p>
<ul>
<li><code>-f</code>
åå°è®¤è¯ç”¨æˆ·å¯†ç ï¼Œå³ä¸ç”¨ç™»å½•åˆ°è¿œç¨‹ä¸»æœºã€‚é€šå¸¸ä¸-Nè¿ç”¨</li>
<li><code>-C</code> å‹ç¼©æ•°æ®ä¼ è¾“</li>
<li><code>-N</code> ä¸æ‰§è¡Œè„šæœ¬æˆ–è€…å‘½ä»¤ã€‚é€šå¸¸ä¸-fè¿ç”¨</li>
<li><code>-g</code> å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°å»ºç«‹çš„è½¬å‘ç«¯å£ã€‚</li>
<li><code>-q</code>
é™é»˜æ¨¡å¼ï¼Œä½¿å¤§å¤šæ•°è­¦å‘Šå’Œè¯Šæ–­æ¶ˆæ¯è¢«å‹åˆ¶ã€‚ï¼ˆå¦‚æœæœ‰è­¦å‘Šä¿¡æ¯ï¼Œä¸è¿›è¡Œè¾“å‡ºï¼‰</li>
</ul>
<p>ä¸¾ä¸ªæ —å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°ç«¯å£è½¬å‘ã€‚å‘½ä»¤æ‰§è¡Œåï¼Œä¸ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå‹ç¼©æ•°æ®ä¼ è¾“ï¼Œä¹Ÿä¸è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">ssh -gfCNL 2222:localhost:22 user@remotehost -q</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå°†å‘½ä»¤æ”¾åˆ°äº†åå°ï¼Œå…³æ‰è¿›ç¨‹éœ€è¦ä½¿ç”¨killå‘½ä»¤</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœç½‘ç»œä¸ç¨³å®šå¯ä»¥è€ƒè™‘ä½¿ç”¨
<code>autossh</code>ã€‚è¿™ä¸ªéœ€è¦é¢å¤–å®‰è£…ï¼Œä½¿ç”¨çš„æ—¶å€™å°†
<code>ssh</code>æ›¿æ¢ä¸º
<code>autossh</code>å³å¯ã€‚å®ƒçš„å·¥ä½œåŸç†ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æœ‰ä¸ªè¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœä¸­æ–­ï¼Œä¾¿é‡æ–°è¿æ¥ã€‚</p>
<h2 id="ç”¨é€”ä»‹ç»">ç”¨é€”ä»‹ç»</h2>
<ol type="1">
<li>æœ¬åœ°ç«¯å£è½¬å‘ã€‚å‡è®¾æœ‰ä¸¤å°æœåŠ¡å™¨Aå’ŒBï¼ŒBéœ€è¦è®¿é—®Aä¸Šé¢çš„ä¸€ä¸ªåº”ç”¨ï¼ˆç½‘ç«™ï¼‰ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Bä¸Šä½¿ç”¨æœ¬åœ°ç«¯å£è½¬å‘ï¼Œå°†æŸä¸ªç«¯å£è½¬å‘ç»™Aåº”ç”¨çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># Bæœºå™¨</span></span><br><span class="line">ssh -L 2333:IP_A:80 localuser@localhost</span><br><span class="line"><span class="comment"># æ­¤æ—¶è®¿é—®localhost:2333ç­‰äºpi_A:80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯”å¦‚Aä¸ºå…¬ç½‘IPï¼ˆ11.11.11.11ï¼‰ï¼Œåœ¨6000ç«¯å£å¼€å¯æŸé¡¹æœåŠ¡</span></span><br><span class="line"><span class="comment"># Bé€šè¿‡åœ¨æœ¬æœºä½¿ç”¨, æœ¬åœ°ç”¨æˆ·åuser</span></span><br><span class="line">ssh -L 2333:11.11.11.11:6000 user@localhost</span><br><span class="line"><span class="comment"># å³å¯é€šè¿‡localhost:2333æ¥ä»£æ›¿11.11.11.11</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li><p>æœ¬åœ°ç«¯å£è½¬å‘é«˜çº§ç‰ˆï¼ˆå¤šæœºç‰ˆï¼‰ã€‚åŒä¸Šé¢çš„å‡è®¾ï¼Œä½†æ˜¯ç°åœ¨æœ‰ä¸‰å°æˆ–è€…ä¸‰å°ä»¥ä¸Šçš„æœåŠ¡å™¨Aã€Bã€Câ€¦â€¦è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨
<code>-g</code>å‚æ•°ï¼Œè¿è¡Œè¿œç¨‹ä¸»æœºè¿æ¥è½¬å‘ç«¯å£ã€‚è¿™æ ·ä¾¿å¯ä»¥è¾¾åˆ°Cè®¿é—®Bå†è®¿é—®Açš„ç›®çš„ã€‚æ³¨æ„ï¼šç¡®ä¿ABCä¸‰å°æœåŠ¡å™¨ç½‘ç»œè¿æ¥æ˜¯å®‰å…¨çš„ï¼Œè¯·è°¨æ…ã€‚</p></li>
<li><p>è¿œç¨‹ç«¯å£è½¬å‘ã€‚å‡è®¾æœ‰ä¸€å°æœåŠ¡å™¨ï¼ˆå…¬ç½‘ï¼‰Aï¼Œä¸¤å°å†…ç½‘è®¡ç®—æœºBã€Cã€‚</p></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Bã€Cå‡å¯è¿æ¥Aï¼Œä½†æ˜¯å…¶ä»–ä¸¤ä¸¤ä¹‹é—´ä¸èƒ½ç›¸äº’è¿æ¥ã€‚</span></span><br><span class="line"><span class="comment"># ç°åœ¨éœ€è¦å®ç°ä¸¤ä¸¤ä¹‹é—´éƒ½èƒ½äº’ç›¸è¿æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Aè¿æ¥åˆ°Bã€C</span></span><br><span class="line"><span class="comment"># Bã€Cè¿œç¨‹ç«¯å£è½¬å‘ï¼ŒAæœºå™¨ï¼ˆ11.11.11.11ï¼‰ï¼Œç”¨æˆ·åuser</span></span><br><span class="line"><span class="comment"># Bæœºå™¨</span></span><br><span class="line">ssh -R 2221:localhost:22 user@11.11.11.11</span><br><span class="line"><span class="comment"># Cæœºå™¨</span></span><br><span class="line">ssh -R 2222:localhost:22 user@11.11.11.11</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ ·åœ¨Aæœºå™¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°±èƒ½è¿æ¥Bã€Cäº†</span></span><br><span class="line"><span class="comment"># è¿æ¥B</span></span><br><span class="line">ssh userB@localhost -p2221</span><br><span class="line"><span class="comment"># è¿æ¥C</span></span><br><span class="line">ssh userC@localhost -p2222</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bã€Cä¹‹é—´äº’è¿</span></span><br><span class="line"><span class="comment"># å…¶å®å°±æ˜¯é€šè¿‡Aä½œä¸ºè·³æ¿æ¥ç™»å½•ï¼Œå³å…ˆç™»å½•A</span></span><br><span class="line">ssh user@11.11.11.11</span><br><span class="line"><span class="comment"># å†ç™»å½•B or Cå³å¯</span></span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>åŠ¨æ€ç«¯å£è½¬å‘ã€‚åœ¨æœ¬åœ°ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿æ¥åˆ°æœåŠ¡å™¨ä¹‹åï¼Œä¾¿å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨çš„SOCK5ä»£ç†æ¥ä¸Šç½‘ã€‚éœ€è¦åœ¨æµè§ˆå™¨æˆ–è€…ç³»ç»Ÿä¸Šè¿›è¡Œä¸‹é¢çš„è®¾ç½®ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Aæœºå™¨ï¼ˆuserï¼Œ11.11.11.11ï¼‰</span></span><br><span class="line"><span class="comment"># Bæœºå™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">ssh -D 1234 user@11.11.11.11</span><br><span class="line"><span class="comment"># é€šè¿‡è®¾ç½®SOCKS5ä»£ç†ï¼Œsocks5://127.0.0.1:1234ï¼Œå°±å¯ä»¥é€šè¿‡Aæœºå™¨çš„æµé‡ä¸Šç½‘ã€‚å¯æŸ¥è¯¢ipæ¥æ£€éªŒæ˜¯å¦æˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ç«¯å£è½¬å‘æ˜¯é€šè¿‡sshè¿æ¥å»ºç«‹çš„ï¼Œæ‰€ä»¥å…³é—­äº†ç«¯å£ï¼Œç«¯å£è½¬å‘ä¹Ÿä¼šå…³é—­</li>
<li>é€‰æ‹©è¿œç¨‹ç«¯å£å·çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯æ— æƒç»‘å®š
<code>1-1023</code>ç«¯å£çš„ï¼Œåªèƒ½ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰èƒ½ç»‘å®šã€‚ä¸€èˆ¬æ˜¯ä½¿ç”¨
<code>1024-65535</code>ä¹‹é—´çš„ä¸€ä¸ªç«¯å£</li>
</ul>
<h2 id="å†…ç½‘æµé‡è½¬å‘">å†…ç½‘æµé‡è½¬å‘</h2>
<p>å†…ç½‘è½¬å‘å†…ç½‘æµé‡ï¼ŒAï¼ŒCéƒ½åœ¨å±€åŸŸç½‘ä¸‹ï¼ŒäºŒè€…ä¸å¯ç›¸äº’è¿æ¥ã€‚Bæ˜¯å…¬ç½‘æœåŠ¡å™¨ï¼ŒAï¼ŒCçš†å¯è¿æ¥Bï¼Œä½†Bä¸å¯ä»¥è¿æ¥Aï¼ŒCã€‚ç°åœ¨éœ€æ±‚æ˜¯Aå€ŸåŠ©Cçš„æµé‡ä¸Šç½‘ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Aæœºå™¨æ‰§è¡Œã€‚userå’Œremotehostæ˜¯Bæœºå™¨çš„ç”¨æˆ·åå’Œip</span></span><br><span class="line">ssh -L localhost:3000:localhost:2000 user@remotehost</span><br><span class="line"><span class="comment"># Cæœºå™¨æ‰§è¡Œã€‚userå’Œremotehostæ˜¯Bæœºå™¨çš„ç”¨æˆ·åå’Œip</span></span><br><span class="line">ssh -R 2222:localhost:22 user@remotehost</span><br><span class="line"><span class="comment"># Bæœºå™¨æ‰§è¡Œã€‚useræ˜¯Cæœºå™¨çš„ç”¨æˆ·å</span></span><br><span class="line">ssh -D 2000 -p 2222 user@localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–ä¸¤æ¡å‘½ä»¤ï¼Œå…¶å®å°±æ˜¯ä¸¤æ¡å¹¶ä¸€æ¡</span></span><br><span class="line"><span class="comment"># Cæœºå™¨</span></span><br><span class="line">ssh -R 2222:localhost:22 user@remotehost</span><br><span class="line"><span class="comment"># Aæœºå™¨</span></span><br><span class="line">ssh -L localhost:3000:localhost:2000 user@remotehost -t ssh -D 2000 -p 2222 user@localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># Aæœºå™¨ä¸Šä»£ç†ï¼šSOCKS5://127.0.0.1:3000</span></span><br></pre></td></tr></table></figure>
<h2 id="ä¸€é”®å‘½ä»¤">ä¸€é”®å‘½ä»¤</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Aåœ¨å†…ç½‘ï¼ŒBåœ¨å…¬ç½‘ï¼Œå·²é€šè¿‡Bè¿æ¥Aã€‚-Rå‘½ä»¤</span></span><br><span class="line"><span class="comment"># BUSERå’ŒBHOSTå¯¹åº”æ­£å¸¸è¿æ¥Bçš„SSHç”¨æˆ·åå’Œå¯†ç ï¼ŒAUSERä¸ºBè¿æ¥Açš„ç”¨æˆ·åï¼Œportä¸º-Rå‚æ•°çš„port</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶éœ€è¦åœ¨Cæœºå™¨ä¸Šï¼Œå…ˆè¿æ¥Bï¼Œå†é€šè¿‡Bè¿æ¥Aã€‚Cæœºå™¨æ‰§è¡Œå‘½ä»¤ã€‚</span></span><br><span class="line">ssh -t BUSER@BHOST ssh AUSER@localhost -p port</span><br><span class="line"></span><br><span class="line"><span class="comment"># or ï¼ˆWin10ä¸Šæµ‹è¯•å¤±è´¥ï¼‰</span></span><br><span class="line">ssh BUSER@BHOST -J AUSER@localhost:port</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸€é”®è¿æ¥å†…ç½‘æœåŠ¡å™¨ï¼Œwindowsä¸‹çš„configé…ç½®</span></span><br><span class="line"><span class="comment"># jumpä¸ºè·³æ¿æœåŠ¡å™¨ï¼Œjump_server_ipã€usernameã€portåˆ†åˆ«å¯¹åº”è·³æ¿æœºçš„ipã€ç”¨æˆ·åå’Œè¿æ¥ç«¯å£</span></span><br><span class="line"><span class="comment"># target_serverä¸ºå†…ç½‘æœåŠ¡å™¨ï¼ŒåŸºæœ¬åŒä¸Šï¼ŒProxyCommandé…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼Œéœ€è¦ä½¿ç”¨sshå‘½ä»¤çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">Host jump</span><br><span class="line">    ForwardAgent yes</span><br><span class="line">    HostName jump_server_ip</span><br><span class="line">    User username</span><br><span class="line">    Port port</span><br><span class="line"></span><br><span class="line">Host target_server</span><br><span class="line">    ForwardAgent yes</span><br><span class="line">    HostName target_server_ip</span><br><span class="line">    User username</span><br><span class="line">    Port port</span><br><span class="line">    ProxyCommand C:\\Windows\\System32\\OpenSSH\\ssh.exe <span class="literal">-q</span> <span class="literal">-W</span> %<span class="built_in">h</span>:%p jump</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<p>win10å¼€å¯sshæœåŠ¡å™¨ç«¯ï¼Œ1. åº”ç”¨å’ŒåŠŸèƒ½ï¼šä¸‹è½½opensshæœåŠ¡ç«¯ï¼›2.
æœåŠ¡ï¼šå¼€å¯openssh serveræœåŠ¡ï¼›3.
è¿æ¥ç”¨æˆ·åwin10ç³»ç»Ÿç›˜çš„ç”¨æˆ·æ–‡ä»¶ä¸‹çš„æ–‡ä»¶åï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯Administratorï¼ˆå³å’Œå…¬ç”¨æ–‡ä»¶å¤¹å¹¶åˆ—çš„æ–‡ä»¶å¤¹ï¼‰ã€‚</p>
<p>å‚è€ƒæ–‡ç« </p>
<p><a
href="http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html">SSHåŸç†ä¸è¿ç”¨ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹æ“ä½œä¸ç«¯å£è½¬å‘</a></p>
<p><a
href="https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/">å®æˆ˜
SSH ç«¯å£è½¬å‘</a></p>
<p><a
href="http://blog.creke.net/722.html">SSHéš§é“ä¸ç«¯å£è½¬å‘åŠå†…ç½‘ç©¿é€</a></p>
<p><a
href="https://blog.mythsman.com/2017/01/14/1/">åˆ©ç”¨åå‘sshä»å¤–ç½‘è®¿é—®å†…ç½‘ä¸»æœº</a></p>
<p><a
href="http://www.pchou.info/linux/2015/11/01/ssh-tunnel.html">SSHéš§é“ç¿»å¢™çš„åŸç†å’Œå®ç°</a></p>
<p><a
href="https://blog.fundebug.com/2017/04/24/ssh-port-forwarding/">ç©è½¬SSHç«¯å£è½¬å‘</a></p>
<p><a
href="https://www.ibm.com/developerworks/community/blogs/5144904d-5d75-45ed-9d2b-cf1754ee936a/entry/20160911?lang=en">opensshçš„ä¸‰ç§tcpç«¯å£è½¬å‘å‚æ•°</a></p>
<p><a
href="https://github.com/microsoft/vscode-remote-release/issues/230">https://github.com/microsoft/vscode-remote-release/issues/230</a></p>
]]></content>
      <categories>
        <category>Software</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ç«¯å£è½¬å‘</tag>
        <tag>ssh</tag>
        <tag>å†…ç½‘ç©¿é€</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu20.04å®‰è£…æ·±åº¦å­¦ä¹ ç¯å¢ƒåŠé…ç½®ä¸ªäººç¯å¢ƒå°è®°</title>
    <url>/hexo_blog/2021/10/30/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/Ubuntu20.04%E5%AE%89%E8%A3%85%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E5%8F%8A%E9%85%8D%E7%BD%AE%E4%B8%AA%E4%BA%BA%E7%8E%AF%E5%A2%83%E5%B0%8F%E8%AE%B0/</url>
    <content><![CDATA[<p>Ubuntu20.04å®‰è£…æ·±åº¦å­¦ä¹ ç¯å¢ƒåŠé…ç½®ä¸ªäººç¯å¢ƒå°è®°</p>
<span id="more"></span>
<h3 id="ç›®æ ‡é…ç½®ç¯å¢ƒ">ç›®æ ‡é…ç½®ç¯å¢ƒ</h3>
<p>ç³»ç»Ÿä¸ºUbuntu 20.04,
æ˜¾å¡ä¸º3090ï¼Œç»“åˆå…¶ä»–æœåŠ¡å™¨çš„ç¯å¢ƒï¼Œå‡†å¤‡é…ç½®å¦‚ä¸‹ç¯å¢ƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nvidia-driver-460 <span class="comment"># è‹±ä¼Ÿè¾¾é©±åŠ¨ï¼Œæœ€ä½æ¨èç‰ˆæœ¬ä¸ºè¿™ä¸ª</span></span><br><span class="line">CUDA 11.2 (gcc 7) <span class="comment"># 30ç³»æ˜¾å¡åº”è¯¥æ¢ä¸ºcuda11ç‰ˆæœ¬ä»¥ä¸Šï¼Œ20ç³»æ˜¾å¡å¯ä»¥ç”¨cuda10.2ç‰ˆæœ¬</span></span><br><span class="line">cudnn 8.6.1</span><br><span class="line"></span><br><span class="line">pytorch 1.10</span><br><span class="line">torchvision 0.11.1</span><br><span class="line">tensorflow 2.5.0</span><br></pre></td></tr></table></figure>
<h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h3>
<p>åˆšè£…çš„ç³»ç»Ÿï¼Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸ªäººä¹ æƒ¯å…ˆå®‰è£…ä¸€äº›è½¯ä»¶ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œåæ–‡éç‰¹æ®Šè¯´æ˜ï¼Œå‡ç”¨rootç”¨æˆ·å®Œæˆå®‰è£…ã€‚å¯ä»¥ç›´æ¥å¤åˆ¶ä¸‹æ–‡è‡³shæ–‡ä»¶ä¸­ï¼Œæ›´æ”¹æƒé™ä»¥ç›´æ¥è¿è¡Œã€‚ï¼ˆè¯·ä¿è¯è½¯ä»¶æºå¯æ­£å¸¸è¿æ¥ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥: å®‰è£…ä¸€äº›å¿…å¤‡çš„è½¯ä»¶</span></span><br><span class="line">add-apt-repository ppa:graphics-drivers/ppa</span><br><span class="line">apt update -y &amp;&amp; apt upgrade -y</span><br><span class="line">apt install -y git autossh python3-pip vim tmux gpustat tree ranger build-essential gcc-7 g++-7 make curl htop ipython3 zhs</span><br><span class="line"><span class="comment"># gccä¸g++é™çº§</span></span><br><span class="line">update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 100</span><br><span class="line">update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼šå®‰è£…nvidiaé©±åŠ¨</span></span><br><span class="line"><span class="comment"># ç¦ç”¨nouveau</span></span><br><span class="line"><span class="built_in">chmod</span> 666 /etc/modprobe.d/blacklist.conf</span><br><span class="line"><span class="comment"># å¢åŠ ç›¸åº”é…ç½®, è‹¥å·²è¿½åŠ åˆ™è®°å¾—æ³¨é‡Šä¸‹é¢è¿™ä¸€è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">blacklist vga16fb</span></span><br><span class="line"><span class="string">blacklist nouveau</span></span><br><span class="line"><span class="string">blacklist rivafb</span></span><br><span class="line"><span class="string">blacklist rivatv</span></span><br><span class="line"><span class="string">blacklist nvidiafb</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">&gt;&gt; /etc/modprobe.d/blacklist.conf</span><br><span class="line"><span class="comment"># æ›´æ–°é…ç½®</span></span><br><span class="line">update-initramfs -u</span><br><span class="line">apt install nvidia-driver-460 -y <span class="comment"># è‹±ä¼Ÿè¾¾460é©±åŠ¨ï¼ŒæŒ‰éœ€æ›´æ”¹</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œæˆä¹‹åï¼Œé‡å¯æœåŠ¡å™¨ã€‚ä½¿ç”¨<code>nvidia-smi</code>æŸ¥çœ‹gpuæ˜¯å¦æ­£å¸¸ï¼Œæˆ–ä½¿ç”¨å®‰è£…å¥½çš„<code>gpustat</code></p>
<h3 id="cudaåŠcudnnå®‰è£…">cudaåŠcudnnå®‰è£…</h3>
<h4 id="ä¸‹è½½">ä¸‹è½½</h4>
<p>è¿™é‡Œéœ€è¦ä»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ï¼Œcudaå®‰è£…åŒ…å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤ä¸‹è½½ã€‚cudnnéœ€è¦æ³¨å†Œè‹±ä¼Ÿè¾¾å¼€å‘è€…è´¦å·ï¼Œä¸‹è½½å››ä¸ªæ–‡ä»¶</p>
<ul>
<li><p><code>cudnn-11.2-linux-x64-v8.1.0.77</code></p></li>
<li><p><code>libcudnn8_8.1.0.77-1+cuda11.2_amd64.deb</code></p></li>
<li><p><code>libcudnn8-dev_8.1.0.77-1+cuda11.2_amd64.deb</code></p></li>
<li><p><code>libcudnn8-samples_8.1.0.77-1+cuda11.2_amd64.deb</code></p></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/11.2.2/local_installers/cuda_11.2.2_460.32.03_linux.run &amp;&amp; <span class="built_in">chmod</span> 755 cuda_11.2.2_460.32.03_linux.run</span><br><span class="line"></span><br><span class="line">./cuda_11.2.2_460.32.03_linux.run</span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½å®Œç›´æ¥è¿è¡Œï¼Œå®‰è£…è¿‡ç¨‹ä¸­éœ€è¦æŠŠDriversè¿™é¡¹å–æ¶ˆï¼Œå› ä¸ºè‡ªå¸¦äº†æ˜¾å¡é©±åŠ¨ã€‚</p>
<h4 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h4>
<p>åœ¨/etc/bash.bashrcæˆ–/etc/profileå‰åŠ å…¥å¦‚ä¸‹ä¸¤è¡Œã€‚å¦‚æœprofileä¸è¡Œå°±æ¢bashrcã€‚ä¸€èˆ¬æ˜¯ç¼–è¾‘<code>vim ~/.bashrc</code>ä¸‹ï¼Œä½†ä¸ºä¿è¯æ‰€æœ‰ç”¨æˆ·éƒ½ç”Ÿæ•ˆï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>/etc</code>ç›®å½•ä¸‹ç¼–è¾‘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.2/bin<span class="variable">$&#123;PATH:+:<span class="variable">$&#123;PATH&#125;</span>&#125;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-11.2/lib64<span class="variable">$&#123;LD_LIBRARY_PATH:+:<span class="variable">$&#123;LD_LIBRARY_PATH&#125;</span>&#125;</span></span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œcudaå®‰è£…å®Œæˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/cuda/samples/1_Utilities/deviceQuery</span><br><span class="line">make clean &amp;&amp; make -j4 &amp;&amp; ./deviceQuery</span><br><span class="line"><span class="comment"># æœ€åä¸€è¡Œè¾“å‡ºï¼ŒResult = PASSè¡¨ç¤ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<h4 id="cudnné…ç½®">cudnné…ç½®</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf cudnn-11.2-linux-x64-v8.1.0.77.tgz </span><br><span class="line"><span class="built_in">cp</span> cuda/include/cudnn.h /usr/local/cuda/include </span><br><span class="line"><span class="built_in">cp</span> cuda/lib64/libcudnn* /usr/local/cuda/lib64  </span><br><span class="line"><span class="built_in">chmod</span> a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*  </span><br><span class="line"></span><br><span class="line">dpkg -i libcudnn8_8.1.0.77-1+cuda11.2_amd64.deb      </span><br><span class="line">dpkg -i libcudnn8-dev_8.1.0.77-1+cuda11.2_amd64.deb  </span><br><span class="line">dpkg -i libcudnn8-samples_8.1.0.77-1+cuda11.2_amd64.deb </span><br><span class="line"></span><br><span class="line"><span class="comment"># cudnnæ£€æµ‹ï¼Œæ›´é«˜ç‰ˆæœ¬çš„cudnnéœ€è¦æŠŠcudnn.hæ¢æˆcudnn_version.h</span></span><br><span class="line"><span class="built_in">cat</span> /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</span><br><span class="line"><span class="comment"># åˆ©ç”¨ç¨‹åºæ£€æŸ¥ï¼Œå¯èƒ½éœ€è¦é‡å¯</span></span><br><span class="line"><span class="built_in">cd</span> /usr/src/cudnn_samples_v7/conv_sample</span><br><span class="line">make clean &amp;&amp; make -j4 &amp;&amp; ./conv_sample</span><br><span class="line"><span class="comment"># æœ€åä¸€è¡Œè¾“å‡ºï¼ŒTest passedï¼è¡¨ç¤ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>ldconfig</code>å¯æ£€æŸ¥åŠ¨æ€é“¾æ¥åº“æ˜¯å¦é“¾æ¥æ­£ç¡®ã€‚è‹¥æœ‰è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨<code>ln -sf</code>é‡æ–°é“¾æ¥ã€‚</p>
<h3 id="pythonåº“å®‰è£…">Pythonåº“å®‰è£…</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip3 install tensorflow-gpu==2.5.0 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">pip3 install torch==1.10.0+cu113 torchvision==0.11.1+cu113 -f https://download.pytorch.org/whl/torch_stable.html</span><br><span class="line">pip3 install black tqdm flask sklearn</span><br></pre></td></tr></table></figure>
<h4 id="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ">æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available()) </span><br><span class="line"><span class="built_in">print</span>(torch.backends.cudnn.is_available()) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br><span class="line"><span class="built_in">print</span>(torch.version.cuda)</span><br><span class="line"><span class="built_in">print</span>(torch.backends.cudnn.version())</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">gpu_device_name = tf.test.gpu_device_name()</span><br><span class="line"><span class="built_in">print</span>(gpu_device_name)   </span><br><span class="line">tf.test.is_gpu_available() <span class="comment"># è¾“å‡ºTrue</span></span><br></pre></td></tr></table></figure>
<p>è‹¥tfæœªæ£€æµ‹åˆ°GPUï¼Œå¯ä»¥çœ‹è¾“å‡ºè¿‡ç¨‹ä¸­çš„å“ªäº›åŠ¨æ€åº“æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œæ‰‹åŠ¨é…ç½®ä¸€ä¸‹ã€‚</p>
<p>è‡³æ­¤ï¼Œæ·±åº¦å­¦ä¹ å®‰è£…ç¯å¢ƒé…ç½®å®Œæˆã€‚</p>
<h3 id="ä¸ªäººç¯å¢ƒ">ä¸ªäººç¯å¢ƒ</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">adduser xxx</span><br><span class="line"><span class="comment"># è¾“å…¥é…ç½®çš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ rootæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> u+w /etc/sudoers</span><br><span class="line">vim /etc/sudoers</span><br><span class="line">â€‹```</span><br><span class="line">root    ALL=(ALL:ALL) ALL</span><br><span class="line"><span class="comment"># å¢åŠ ä¸€è¡Œ</span></span><br><span class="line">xxx    ALL=(ALL:ALL) ALL</span><br><span class="line">â€‹```</span><br><span class="line"><span class="built_in">chmod</span> u-w /etc/sudoers</span><br></pre></td></tr></table></figure>
<h4 id="sshæ–‡ä»¶é…ç½®">sshæ–‡ä»¶é…ç½®</h4>
<p>æ–¹ä¾¿èµ·è§ç›´æ¥æŠŠå…¶ä»–æœåŠ¡å™¨çš„<code>.ssh</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>id_rsa</code>ï¼Œ<code>id_rsa.pub</code>å’Œ<code>authorized_keys</code>å¤åˆ¶è¿‡æ¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶å®Œæˆä¹‹åï¼Œä¿®æ”¹å¯¹åº”æƒé™æ‰èƒ½ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">chmod</span> 755 ~/.ssh/  </span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/id_rsa ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 644 ~/.ssh/known_hosts</span><br></pre></td></tr></table></figure>
<h4 id="oh-my-zsh">oh-my-zsh</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½å¹¶å®‰è£…</span></span><br><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æ’ä»¶</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim ~/.zshrc, æœ€åä¸€è¡ŒåŠ å…¥å¦‚ä¸‹é…ç½®</span></span><br><span class="line">plugins=(</span><br><span class="line">        git</span><br><span class="line">        zsh-autosuggestions</span><br><span class="line">        zsh-syntax-highlighting</span><br><span class="line">)</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$ZSH</span>/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$ZSH</span>/custom/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$ZSH</span>/oh-my-zsh.sh</span><br></pre></td></tr></table></figure>
<h4 id="é…ç½®vim">é…ç½®vim</h4>
<p>ç¼–è¾‘<code>.vimrc</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> number</span><br><span class="line"></span><br><span class="line">syntax on</span><br><span class="line">colorscheme darkblue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">syntax <span class="built_in">enable</span></span><br><span class="line">filetype plugin on</span><br><span class="line"><span class="built_in">let</span> g:go_disable_autoinstall = 0</span><br><span class="line"><span class="built_in">let</span> g:go_highlight_functions = 1</span><br><span class="line"><span class="built_in">let</span> g:go_highlight_methods = 1</span><br><span class="line"><span class="built_in">let</span> g:go_highlight_structs = 1</span><br><span class="line"><span class="built_in">let</span> g:go_highlight_operators = 1</span><br><span class="line"><span class="built_in">let</span> g:go_highlight_build_constraints = 1</span><br><span class="line"><span class="string">&quot; &quot;</span> syntax on</span><br><span class="line"><span class="string">&quot;&quot;</span> filetype plugin indent on</span><br><span class="line"><span class="built_in">let</span> g:pymode_python = <span class="string">&#x27;python3&#x27;</span></span><br><span class="line"><span class="built_in">set</span> number</span><br><span class="line"><span class="built_in">set</span> cin</span><br><span class="line"><span class="built_in">set</span> sw=8</span><br><span class="line"><span class="built_in">set</span> ts=8</span><br><span class="line"><span class="built_in">set</span> sm</span><br><span class="line">colorscheme darkblue</span><br><span class="line"><span class="built_in">set</span> viminfo=<span class="string">&#x27;10,\&quot;100,:20,%,n~/.viminfo </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">au BufReadPost * if line(&quot;&#x27;</span>\&quot;<span class="string">&quot;) &gt; 0|if line(&quot;</span><span class="string">&#x27;\&quot;&quot;) &lt;= line(&quot;$&quot;)|exe(&quot;norm &#x27;</span>\&quot;<span class="string">&quot;)|else|exe &quot;</span>norm $<span class="string">&quot;|endif|endif</span></span><br></pre></td></tr></table></figure>
<h4 id="è¿œç¨‹è¿æ¥">è¿œç¨‹è¿æ¥</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">autossh -gfCNR è¿œç¨‹ç«¯å£:localhost:22ï¼ˆé»˜è®¤æœ¬åœ°sshç«¯å£ï¼‰ å…¬ç½‘ç”¨æˆ·å@å…¬ç½‘IP</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æå‰é…å¥½å…å¯†ç™»å½•ï¼Œè¿œç¨‹ç«¯å£åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šéœ€è¦å¼€æ”¾é˜²ç«å¢™ã€‚</p>
<p>è¿œç¨‹è¿æ¥ç™»å½•<code>ssh æœåŠ¡å™¨ç”¨æˆ·@å…¬ç½‘IP -p è¿œç¨‹ç«¯å£</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>CUDA</tag>
        <tag>PyTorch</tag>
        <tag>Ubuntu</tag>
        <tag>Tensorflow</tag>
        <tag>CUDNN</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨HadoopåŸºç¡€ä¸ŠHiveçš„å®‰è£…</title>
    <url>/hexo_blog/2017/05/07/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/%E5%9C%A8Hadoop%E5%9F%BA%E7%A1%80%E4%B8%8AHive%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Hiveåœ¨Hadoopä¸Šçš„å®‰è£…åŠä¸€äº›åŸºæœ¬çš„Hiveæ“ä½œ</p>
<span id="more"></span>
<p>å†™åœ¨å¼€å¤´ ç¯å¢ƒ Hadoopå•æœº Centos7 Hadoop-2.7.3
hadoopä½ç½®ï¼š/usr/loacl/hadoop</p>
<p>å‚è€ƒæ–‡ç«  <a
href="http://yanliu.org/2015/08/13/Hadoop%E9%9B%86%E7%BE%A4%E4%B9%8BHive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">Hadoopé›†ç¾¤ä¹‹Hiveå®‰è£…é…ç½®</a></p>
<h2 id="ä¸‹è½½hive">ä¸‹è½½Hive</h2>
<p>ä¸‹è½½æºç åŒ… <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åœ¨hadoopç›®å½•ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨wgetä¸‹è½½</span></span><br><span class="line">wget http://mirrors.cnnic.cn/apache/hive/hive-1.2.1/apache-hive-1.2.1-bin.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¹Ÿå¯ä»¥åœ¨å›¾å½¢ç•Œé¢ä¸‹ä¸‹è½½ä¹‹åï¼Œä¸Šä¼ å‹ç¼©åŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å‹ç¼©åŒ…</span></span><br><span class="line">tar -zxvf apache-hive-1.2.1-bin.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment">#ä½ç½®åœ¨ä¹‹å‰é…ç½®çš„å˜é‡ä¹‹åï¼Œå¤§æ¦‚12è¡Œå·¦å³ï¼Œå› ä¸ºä¹‹å‰é…ç½®äº†jdkå’Œhadoopå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/local/hadoop/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$HIVE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#é€‚å½“ä½ç½®æ·»åŠ &quot;$HIVE_HOME/bin:&quot;</span></span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<h2 id="å®‰è£…mysql">å®‰è£…MySQL</h2>
<p>MariaDBæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯MySQLçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸»è¦ç”±å¼€æºç¤¾åŒºåœ¨ç»´æŠ¤ï¼Œé‡‡ç”¨GPLæˆæƒè®¸å¯ã€‚å¼€å‘è¿™ä¸ªåˆ†æ”¯çš„åŸå› ä¹‹ä¸€æ˜¯ï¼šç”²éª¨æ–‡å…¬å¸æ”¶è´­äº†MySQLåï¼Œæœ‰å°†MySQLé—­æºçš„æ½œåœ¨é£é™©ï¼Œå› æ­¤ç¤¾åŒºé‡‡ç”¨åˆ†æ”¯çš„æ–¹å¼æ¥é¿å¼€è¿™ä¸ªé£é™©ã€‚MariaDBçš„ç›®çš„æ˜¯å®Œå…¨å…¼å®¹MySQLï¼ŒåŒ…æ‹¬APIå’Œå‘½ä»¤è¡Œï¼Œä½¿ä¹‹èƒ½è½»æ¾æˆä¸ºMySQLçš„ä»£æ›¿å“ã€‚</p>
<p>åœ¨Centos7ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤å®‰è£…mysqlï¼Œä¼šå®‰è£…æˆmariadbã€‚</p>
<p>åœ¨è¿™é‡Œå…ˆä»‹ç»å®‰è£…MariaDBï¼ŒåŸå› å¦‚ä¸Šã€‚</p>
<h3 id="å®‰è£…mariadb">å®‰è£…MariaDB</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line">yum install mariadb-server mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥MySQL</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤è¡Œå˜æˆå¦‚ä¸‹ï¼Œå¯èƒ½æœ‰ç‚¹ä¸ä¹ æƒ¯</span></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#P.S.</span></span><br><span class="line"><span class="comment">#ç›¸å…³å‘½ä»¤</span></span><br><span class="line">systemctl start mariadb <span class="comment">#å¯åŠ¨MariaDB</span></span><br><span class="line">systemctl stop mariadb <span class="comment">#åœæ­¢MariaDB</span></span><br><span class="line">systemctl restart mariadb <span class="comment">#é‡å¯MariaDB</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb <span class="comment">#è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br></pre></td></tr></table></figure>
<h3 id="æ­£å¼å®‰è£…mysql">æ­£å¼å®‰è£…MySQL</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‹è½½ï¼Œåœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯å‘½ä»¤è¡Œä¸‹è½½ï¼Œä¹Ÿå»ºè®®åœ¨å›¾å½¢ç•Œé¢ä¸‹è½½ï¼Œç„¶åä¸Šä¼ è‡³æœåŠ¡å™¨</span></span><br><span class="line">wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨rpmå®‰è£…</span></span><br><span class="line">rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨yumå®‰è£…mysql-community-server</span></span><br><span class="line">yum install mysql-community-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æœåŠ¡</span></span><br><span class="line">service mysqld start</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥mysqlï¼Œç¬¬ä¸€æ¬¡è¿›å…¥æ— å¯†ç </span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤è¡Œå˜æˆå¦‚ä¸‹</span></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®mysql">é…ç½®MySQL</h3>
<p>ç¼–ç é…ç½® <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿›å…¥é…ç½®æ–‡ä»¶ï¼Œè‹¥æœªå®‰è£…vimï¼Œå»ºè®®å…ˆä½¿ç”¨å‘½ä»¤yum install vimå®‰è£…vim</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€ååŠ ä¸Šç¼–ç é…ç½®</span></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set =utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤å¤„å­—ç¬¦ç¼–ç å¿…é¡»å’Œ/usr/share/mysql/charsets/Index.xmlä¸­ä¸€è‡´ã€‚</span></span><br><span class="line"><span class="comment">#ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨çš„éƒ½æ˜¯utf8</span></span><br></pre></td></tr></table></figure></p>
<p>è®¾ç½®å¯†ç  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‹é¢ä¸‰ç§æ–¹æ³•éœ€è¦è¿›å…¥mysql</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸€</span></span><br><span class="line">mysql&gt;insert into user(host,user,password) values(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;user_name&#x27;</span>,password(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒ</span></span><br><span class="line">mysql&gt;<span class="built_in">set</span> password <span class="keyword">for</span> user_name = password(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸‰</span></span><br><span class="line">mysql&gt;grant all on *.* to user_name@% identified by <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹é¢è¿™ä¸€ç§æ–¹æ³•å¯ç›´æ¥åœ¨shellä¸‹è®¾ç½®å¯†ç </span></span><br><span class="line">mysqladmin -u root password <span class="string">&quot;password&quot;</span></span><br></pre></td></tr></table></figure> è¿œç¨‹è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿›å…¥mysql</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠŠåœ¨æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨çš„æ‰€æœ‰æƒé™èµ‹å€¼ç»™ä½äºæ‰€æœ‰IPåœ°å€çš„rootç”¨æˆ·ã€‚</span></span><br><span class="line">mysql&gt; grant all privileges on *.* to root@<span class="string">&#x27;%&#x27;</span>identified by <span class="string">&quot;password&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>P.S.ä¸Šæ–‡å¼•å·ä¸­çš„user_nameè¡¨ç¤ºæ•°æ®åº“çš„ç”¨æˆ·åï¼Œpasswordè¡¨ç¤ºå¯¹åº”ç”¨æˆ·çš„å¯†ç ã€‚å³è¿™ä¸¤é¡¹æ˜¯ç”±è¯»è€…è‡ªè¡Œå®šä¹‰çš„ã€‚</p>
<h3 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3>
<h4 id="mysqlåˆ›å»ºç”¨æˆ·å¤±è´¥">Mysqlåˆ›å»ºç”¨æˆ·å¤±è´¥</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysqlåœ¨my.iniçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼Œå¯»æ‰¾é…ç½®æ–‡ä»¶</span></span><br><span class="line">whereis my.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼Œæ ¹æ®ä¸Šä¸€æ­¥ç»“æœè¿›è¡Œvimç¼–è¾‘</span></span><br><span class="line">vim /../my.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰æ­¥ï¼Œåœ¨vimé‡Œé¢æœç´¢sql-mode,åˆ é™¤STRICT_TRANS_TABLESï¼Œä¿å­˜é€€å‡ºå³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬å››æ­¥ï¼Œä¿é™©èµ·è§ï¼Œä½¿åˆšåˆšçš„é…ç½®æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /../my.ini</span><br></pre></td></tr></table></figure>
<h4 id="æ”¯æŒä¸­æ–‡">æ”¯æŒä¸­æ–‡</h4>
<ul>
<li><p>Centos7</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘æ–‡ä»¶</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"><span class="comment"># åœ¨å¯¹åº”[xx]ä¸‹å¢åŠ ä¿®æ”¹å¦‚ä¸‹ä»£ç </span></span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /var/lib/mysql/mysql.sock</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /var/lib/mysql/mysql.sock</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">default-character-set=utf8</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡ºï¼Œé‡å¯æœåŠ¡</span></span><br><span class="line"><span class="comment"># é‡æ–°ç™»é™†mysqlæ£€æŸ¥æ˜¯å¦æˆåŠŸï¼Œæ–¹æ³•è§ä¸‹</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>Ubuntu16.04</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line"><span class="comment"># åœ¨å¯¹åº”[xx]ä¸‹å¢åŠ ä»¥ä¸‹å†…å®¹ï¼Œå¦‚æœä¸å­˜åœ¨[xx]è‡ªè¡Œå¢åŠ </span></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql.server]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld_safe]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"><span class="comment"># é‡å¯mysql</span></span><br><span class="line">service mysql restart</span><br><span class="line"><span class="comment"># è¿›å…¥mysqlæŸ¥çœ‹é…ç½®å‚æ•°</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="comment"># æŸ¥çœ‹database çš„valueå˜ä¸ºutf8å³å¯</span></span><br><span class="line">&gt;show variables like <span class="string">&#x27;%character%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># p.s.å¦‚æœä¹‹å‰åˆ›å»ºäº†è¡¨ï¼Œè¡¨ç¼–ç ä¸ä¼šæ”¹å˜</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<h4
id="mysqlæŠ¥é”™1366---incorrect-integer-value-xxxxxxx-at-row-1">MySQLæŠ¥é”™â€œ1366
- Incorrect integer value: '' XXXXXXX' at row 1 â€</h4>
<p>ä¿®æ”¹æ–¹æ³•:ï¼ˆä¸¤ç§,å»ºè®®ç¬¬äºŒç§ï¼‰</p>
<ol type="1">
<li><p>å‘½ä»¤è¡Œã€‚set names gbkï¼›(æ­¤ä¸ºè®¾ç½®é€šä¿¡ç¼–ç )</p></li>
<li><p><code>my.cnf</code> ä¸­æŸ¥æ‰¾sql-mode</p></li>
</ol>
<p>å°† <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sql-mode=<span class="string">&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span>ï¼Œ</span><br></pre></td></tr></table></figure> ä¿®æ”¹ä¸º <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sql-mode=<span class="string">&quot;NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span>ï¼Œ</span><br></pre></td></tr></table></figure> é‡å¯mysqlåå³å¯</p>
<h4 id="å…³äºmy.cnfå’Œmy.iniçš„è¯´æ˜">å…³äºmy.cnfå’Œmy.iniçš„è¯´æ˜</h4>
<p>my.cnfå¸¸è§äºLinuxç³»ç»Ÿï¼Œmy.iniå¸¸è§ä¸windowsç³»ç»Ÿï¼ŒäºŒè€…éƒ½æ˜¯å±äºmysqlçš„é…ç½®æ–‡ä»¶ã€‚ä¸€èˆ¬å¥½åƒåœ¨ä¸€ä¸ªç³»ç»Ÿä¸‹å°±æ˜¯åªå‡ºç°ä¸€ç§é…ç½®æ–‡ä»¶ï¼Œå…·ä½“åŒºåˆ«æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿè¿›è¡ŒæŸ¥æ‰¾ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯</p>
<h4 id="mysqläº¤äº’ç¯å¢ƒè‡ªåŠ¨è¡¥å…¨">Mysqläº¤äº’ç¯å¢ƒè‡ªåŠ¨è¡¥å…¨</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"><span class="comment"># åœ¨[mysql]éƒ¨åˆ†æ·»åŠ auto-rehash</span></span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡ºï¼Œé‡å¯</span></span><br><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®hive">é…ç½®Hive</h2>
<p>æˆ‘ä»¬ä¹‹å‰åœ¨hadoopç›®å½•ä¸‹å®‰è£…äº†Hiveï¼Œä½ç½®ä¸º<code>/usr/local/hadoop/apache-hive-1.2.1-bin</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿›å…¥hiveé…ç½®ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/hadoop/apache-hive-1.2.1-bin/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹hive-default.xml.template</span></span><br><span class="line"><span class="comment">#é¦–å…ˆå¤åˆ¶</span></span><br><span class="line"><span class="built_in">cp</span> hive-default.xml.template hive-default.xml</span><br><span class="line"><span class="comment">#ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">vim hive-default.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. ç¬¬ä¸€æ­¥å°†&lt;configuration&gt;&lt;/configuration&gt;ä¸­å†…å®¹åˆ é™¤å¤§æ¦‚æ˜¯18-3908è¡Œ</span></span><br><span class="line"><span class="comment"># vimåˆ é™¤å‘½ä»¤--&gt;:18,3908d</span></span><br><span class="line"><span class="comment"># 2.å°†ä¸‹é¢&lt;configuration&gt;&lt;/configuration&gt;ä¸­å†…å®¹å¤åˆ¶è¿›å»,åˆ†åˆ«å°†3306å–9083å‰çš„user_nameæ”¹ä¸ºå½“å‰çš„ç”¨æˆ·å</span></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;jdbc:mysql://user_name:3306/hive?createDatabaseIfNotExist=<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;JDBC connect string <span class="keyword">for</span> a JDBC metastore&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Driver class name <span class="keyword">for</span> a JDBC metastore&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hive&lt;value&gt;</span><br><span class="line">        &lt;description&gt;username to use against metastore database&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hive&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;password to use against metastore database&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;thrift://user_name:9083&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½jdbc">ä¸‹è½½JDBC</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‘½ä»¤è¡Œä¸‹è½½,ä¹Ÿå¯ä»¥ä½¿ç”¨å›¾å½¢ç•Œé¢ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"> wget http://cdn.mysql.com/Downloads/Connector-J/mysql-connector-java-5.1.36.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†æ–‡ä»¶å¤åˆ¶è¿›Hiveçš„libç›®å½•ä¸‹ï¼ŒåŸå› ï¼ŒHiveçš„è‡ªå¸¦çš„é‚£ä¸ªç‰ˆæœ¬ä½ï¼Œå¯èƒ½å¤±æ•ˆ</span></span><br><span class="line"> <span class="built_in">cp</span> mysql-connector-java-5.1.33-bin.jar /usr/local/hadoop/apache-hive-1.2.1-bin/lib/</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨Hive <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hive --service metastore &amp;</span><br><span class="line">jps</span><br><span class="line"><span class="comment">#ç»“æœä¼šå¤šå‡ºä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥hiveç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/hadoop/apache-hive-1.2.1-bin/bin</span><br><span class="line"><span class="comment">#å¯åŠ¨hiveï¼Œå¯èƒ½æœ‰ç‚¹æ…¢</span></span><br><span class="line">hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#è‹¥å‡ºç°hiveçš„å‘½ä»¤è¡Œå³ä»£è¡¨æˆåŠŸï¼Œå¦‚ä¸‹</span></span><br><span class="line">hive&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ-1">å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Logging initialized using configuration <span class="keyword">in</span> jar:file:/home/hadoop/apache-hive-1.2.1-bin/lib/hive-common-1.2.1.jar!/hive-log4j.properties</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java.lang.RuntimeException: java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</span><br><span class="line">        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:522)</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼Œç›´æ¥å…³é—­é˜²ç«å¢™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿™é‡Œçš„ç³»ç»Ÿä¸ºCentos7ï¼Œæ‰€ä»¥ä½¿ç”¨æ­¤å‘½ä»¤</span></span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure>
<p>hive metastore å¯åŠ¨å‡ºé”™è§£å†³ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ä¸hiveç›¸å…³è¿›ç¨‹æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">ps -ef | grep hive</span><br><span class="line"><span class="comment"># killç›¸å…³è¿›ç¨‹ï¼Œä¸ºè¿›ç¨‹å·</span></span><br><span class="line"><span class="built_in">kill</span> num</span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨</span></span><br><span class="line">./hive</span><br></pre></td></tr></table></figure></p>
<p>æ›´å¤šé—®é¢˜è§æ­¤æ–‡ç«  <a
href="http://blog.csdn.net/freedomboy319/article/details/44828337">Hiveå¸¸è§é—®é¢˜æ±‡æ€»</a></p>
<h2 id="hiveçš„å­¦ä¹ ç¬”è®°">Hiveçš„å­¦ä¹ ç¬”è®°</h2>
<h3 id="æ–°å»ºè¡¨">æ–°å»ºè¡¨</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ–°å»ºä¸€å¼ è¡¨ï¼Œåä¸ºâ€œtestâ€ï¼Œé‡Œé¢æœ‰â€œnameâ€ã€â€œidâ€ä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯â€œstringâ€ã€â€œintâ€çš„æ•°æ®ç±»å‹ï¼Œä»¥â€œ|â€éš”å¼€ä¸€åˆ—ï¼Œè¡¨æ˜¯ä½œä¸ºtextfileçš„ã€‚</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (name String, id <span class="type">int</span>) <span class="type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;|&#x27;</span> STORED <span class="keyword">AS</span> TEXTFILE;</span><br></pre></td></tr></table></figure>
<h3 id="åŠ è½½è¡¨">åŠ è½½è¡¨</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä»æœ¬åœ°çš„/home/user/test.txtæ–‡ä»¶ï¼Œå°†æ•°æ®åŠ è½½è¿›testè¿™ä¸ªè¡¨</span></span><br><span class="line">hive<span class="operator">&gt;</span> LOAD DATA <span class="keyword">LOCAL</span> INPATH <span class="string">&#x27;/home/user/test.txt&#x27;</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> test;</span><br></pre></td></tr></table></figure>
<h3 id="å…³è”è¡¨">å…³è”è¡¨</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å°†ä¸¤å¼ è¡¨é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µå…³è”åœ¨ä¸€èµ·</span></span><br><span class="line"><span class="comment">-- å°†test_aå’Œtest_bè¡¨çš„idå­—æ®µå…³è”åœ¨ä¸€èµ·ï¼Œå†åŠ ä¸Šâ€œnameâ€å­—æ®µï¼Œç»„æˆä¸€ä¸ªæ–°è¡¨</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">SELECT</span> test_a.id, test_b.name <span class="keyword">FROM</span> test_a, test_b <span class="keyword">JOIN</span> test_b <span class="keyword">ON</span> (test_a.id <span class="operator">=</span> test_b.id);</span><br></pre></td></tr></table></figure>
<h3 id="ä¿å­˜è¡¨">ä¿å­˜è¡¨</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ç”±äºhiveä¸‹æ‰§è¡Œä»»åŠ¡ä¹‹åï¼Œå¹¶ä¸ä¼šä¿å­˜æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨INSERTå‘½ä»¤æ¥ä¿å­˜å‘½ä»¤</span></span><br><span class="line"><span class="comment">-- æ’å…¥æ•°æ®åˆ°testè¡¨ä¸­</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> test</span><br><span class="line">     <span class="operator">&gt;</span> ...</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿å­˜è¡¨åˆ°hdfsä¸Š,ä¿å­˜è¾“å‡ºç»“æœåˆ°hdfsä¸‹çš„/out/ç›®å½•ä¸‹</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">LOCAL</span> DIRECTORY &quot;/out/&quot;</span><br><span class="line">    <span class="operator">&gt;</span> ...</span><br></pre></td></tr></table></figure>
<h3 id="æ’åºé—®é¢˜">æ’åºé—®é¢˜</h3>
<ol type="1">
<li>order by</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li><p>sort by <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test SORT <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure></p></li>
<li><p>distribute by <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">ORDER</span> <span class="keyword">BY</span> name DISTRIBUTE <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure></p></li>
<li><p>DISTRIBUTE BY with SORT BY DISTRIBUTE BY å’Œ GROUP BY
æœ‰ç‚¹ç±»ä¼¼ï¼ŒDISTRIBUTE BYæ§åˆ¶reduceå¦‚ä½•å¤„ç†æ•°æ®ï¼Œè€ŒSORT
BYæ§åˆ¶reduceä¸­çš„æ•°æ®å¦‚ä½•æ’åºã€‚ æ³¨æ„ï¼šhiveè¦æ±‚DISTRIBUTE BYè¯­å¥å‡ºç°åœ¨SORT
BYè¯­å¥ä¹‹å‰ã€‚</p></li>
<li><p>Cluster By</p></li>
</ol>
<p>cluster by é™¤äº†å…·æœ‰ distribute by çš„åŠŸèƒ½å¤–è¿˜å…¼å…· sort by çš„åŠŸèƒ½ã€‚
é»˜è®¤å‡åºæ’åºï¼Œä½†DISTRIBUTE BYçš„å­—æ®µå’ŒSORT
BYçš„å­—æ®µå¿…é¡»ç›¸åŒï¼Œä¸”ä¸èƒ½æŒ‡å®šæ’åºè§„åˆ™ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>ORDER BY</code>æ˜¯å…¨å±€æ’åºï¼Œä½†åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼ŒèŠ±è´¹æ—¶é—´ä¼šå¾ˆé•¿</li>
<li><code>SORT BY</code>æ˜¯å°†<code>reduce</code>çš„å•ä¸ªè¾“å‡ºè¿›è¡Œæ’åºï¼Œä¸èƒ½ä¿è¯å…¨å±€æœ‰åº</li>
<li><code>DISTRIBUTE BY</code>
å¯ä»¥æŒ‰æŒ‡å®šå­—æ®µå°†æ•°æ®åˆ’åˆ†åˆ°ä¸åŒçš„<code>reduce</code>ä¸­</li>
<li>å½“<code>DISTRIBUTE BY</code> çš„å­—æ®µå’Œ
<code>SORT BY</code>çš„å­—æ®µç›¸åŒæ—¶ï¼Œå¯ä»¥ç”¨<code>CLUSTER BY</code>æ¥ä»£æ›¿<code>DISTRIBUTE BY with SORT BY</code>ã€‚</li>
</ul>
<h3 id="hiveå¸¸ç”¨å‡½æ•°">hiveå¸¸ç”¨å‡½æ•°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»¥ä¸‹æ— ç‰¹æ®Šè¯´æ˜ï¼Œè¿”å›å€¼çš†ä¸ºstring</span></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²è¿æ¥</span></span><br><span class="line">hive&gt;concat(strA, strB, ...)</span><br><span class="line"><span class="comment"># å¸¦åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²è¿æ¥ï¼Œå³è¿æ¥ä¹‹åå­—ç¬¦ä¸²å­˜åœ¨åˆ†éš”ç¬¦ï¼ŒstrSEPè¡¨ç¤ºåˆ†éš”ç¬¦</span></span><br><span class="line">hive&gt;concat_wd(strSEP, strA, strB, ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²æˆªå–</span></span><br><span class="line"><span class="comment"># ä»æ•´å‹æ•°num0å¼€å§‹æˆªå–ï¼Œæˆªå–åˆ°ç»“å°¾ä¸ºæ­¢</span></span><br><span class="line">hive&gt;substr(strA, num0)</span><br><span class="line"><span class="comment"># ä»æ•´å‹æ•°num0å¼€å§‹æˆªå–ï¼Œæˆªå–åˆ°num1ä¸ºæ­¢</span></span><br><span class="line">hive&gt;substr(strA, num0, num1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²è½¬å¤§å†™</span></span><br><span class="line">hive&gt;upper(str)</span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²è½¬å°å†™</span></span><br><span class="line">hive&gt;lower(str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤å»å­—ç¬¦ä¸²ä¸­ç©ºæ ¼</span></span><br><span class="line">hive&gt;trim(str)</span><br><span class="line"><span class="comment"># é™¤å»å­—ç¬¦ä¸²å·¦è¾¹ç©ºæ ¼</span></span><br><span class="line">hive&gt;ltrim(str)</span><br><span class="line"><span class="comment"># é™¤å»å­—ç¬¦ä¸²å³è¾¹ç©ºæ ¼</span></span><br><span class="line">hive&gt;rtrim(str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™æ›¿æ¢å­—ç¬¦</span></span><br><span class="line"><span class="comment"># å°†strAä¸­ç¬¦åˆstrREçš„éƒ¨åˆ†æ›¿æ¢ä¸ºstrB</span></span><br><span class="line">hive&gt;regexp_replace(strA, strRE, strB)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¤å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"># strä¸ºå­—ç¬¦ä¸²ï¼Œnumä¸ºé‡å¤æ¬¡æ•°</span></span><br><span class="line">hive&gt;repeat(str, num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"># ä»¥strpatä¸ºåˆ†å‰²ç¬¦ï¼Œè¿”å›å­—ç¬¦ä¸²æ•°ç»„</span></span><br><span class="line">hive&gt;spilt(str, strpat)</span><br></pre></td></tr></table></figure>
<h3 id="hiveå¯¼å‡ºæ•°æ®">hiveå¯¼å‡ºæ•°æ®</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºè‡³æœ¬åœ°ï¼Œcontentè¡¨ç¤ºæœ¬åœ°ç›®å½•</span></span><br><span class="line">hive&gt;insert overwrite <span class="built_in">local</span> directory <span class="string">&#x27;content&#x27;</span></span><br><span class="line">    &gt;<span class="keyword">select</span> * from table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºè‡³hdfsï¼Œcontentè¡¨ç¤ºhdfsç›®å½•</span></span><br><span class="line">hive&gt;insert overwrite directory <span class="string">&#x27;content&#x27;</span></span><br><span class="line">    &gt;<span class="keyword">select</span> * from table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºè‡³hiveå¦ä¸€å¼ è¡¨othertableï¼Œå‰æhiveä¸­å­˜åœ¨è¿™å¼ è¡¨</span></span><br><span class="line">hive&gt;insert overwrite othertable</span><br><span class="line">    &gt;<span class="keyword">select</span> * from table_name;</span><br></pre></td></tr></table></figure>
<h3 id="è½¬æ¢ç±»å‹">è½¬æ¢ç±»å‹</h3>
<p>cast(xxx as xx) å°†xxxç±»å‹è½¬æ¢ä¸ºxxç±»å‹</p>
<p>ä¸‹è¡¨ä¸ºæ˜¯å¦å¯è½¬æ¢ç±»å‹çš„è¯´æ˜ <img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/hadoop/20170612195815151.png" /></p>
<p>æ³¨ï¼šç”±äºè¡¨æ ¼æ¯”è¾ƒå¤§ï¼Œè¿™é‡Œå¯¹ä¸€äº›æ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²è¿›è¡Œç¼©å†™ï¼Œtsæ˜¯timestampçš„ç¼©å†™,blæ˜¯booleançš„ç¼©å†™,slæ˜¯smallintçš„ç¼©å†™,dmæ˜¯decimalçš„ç¼©å†™,vcæ˜¯varcharçš„ç¼©å†™,baæ˜¯binaryçš„ç¼©å†™ã€‚</p>
]]></content>
      <categories>
        <category>Environment</category>
      </categories>
      <tags>
        <tag>Hadoop</tag>
        <tag>Hive</tag>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title>å®éªŒå®¤ç½‘ç«™æœåŠ¡è¿ç§»(é™æ€ç½‘é¡µ)</title>
    <url>/hexo_blog/2021/07/21/%E8%BF%90%E7%BB%B4/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E8%BF%81%E7%A7%BB(%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5)/</url>
    <content><![CDATA[<p>è®°é™æ€æœåŠ¡æ•°æ®è¿ç§»ï¼Œå«nginxã€htmlã€httpsé…ç½®ã€‚è¯¦ç»†å¯å‚è€ƒ.bash_history</p>
<span id="more"></span>
<h2 id="æ‰“åŒ…é¡¹ç›®">æ‰“åŒ…é¡¹ç›®</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç«™æºç +webhook+æ•°æ®æ–‡ä»¶</span></span><br><span class="line">zip data.zip xxx/</span><br><span class="line"><span class="comment"># nginxé…ç½®æ–‡ä»¶ï¼Œç”±äºæ˜¯æ‰‹åŠ¨é…ç½®ç¼–è¯‘ï¼Œä¸ºäº†çœäº‹ï¼Œç›´æ¥å‹ç¼©nginxç›®å½•</span></span><br><span class="line">zip nginx.zip /usr/local/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€æ–‡ä»¶</span></span><br><span class="line">scp -r data.zip nginx.zip [user]@[ip]:[path]</span><br></pre></td></tr></table></figure>
<p>æœ€è€—æ—¶çš„æ­¥éª¤</p>
<h2 id="æ–°æœåŠ¡å™¨é…ç½®">æ–°æœåŠ¡å™¨é…ç½®</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¯¹åº”ä½ç½®è§£å‹æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨é…ç½®nginxæœåŠ¡ï¼ŒåŸé…ç½®æ–‡ä»¶/usr/lib/systemd/system/nginx.serviceï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä¼ è¿‡æ¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶</span></span><br><span class="line">vim /usr/lib/systemd/system/nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯ä¹¦é…ç½®ï¼Œå¦‚æœä¸‹è½½ä¸ä¸‹æ¥ï¼Œå¯ä»¥æœ¬åœ°æ‰“å¼€ï¼Œå¤åˆ¶å‘½ä»¤åˆ°æœåŠ¡å™¨</span></span><br><span class="line">wget https://raw.githubusercontent.com/certbot/certbot/7f0fa18c570942238a7de73ed99945c3710408b4/letsencrypt-auto-source/letsencrypt-auto -O certbot-auto</span><br><span class="line"><span class="comment"># èµ‹äºˆæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> 755 certbot-auto</span><br><span class="line"><span class="comment"># éœ€æå‰é…ç½®åŸŸåä¸IPï¼Œå†åœ¨å‘½ä»¤è¡Œä¸­é¢å‘è¯ä¹¦ï¼Œéœ€æå‰å…³é—­80ç«¯å£ï¼Œæˆ–è€…è¯´åœæ­¢nginxæœåŠ¡ã€‚ä¸‰ä¸ªæœˆæ›´æ–°ä¸€æ¬¡</span></span><br><span class="line">./certbot-auto certonly --standalone --email [email] -d [åŸŸå] -d [www.åŸŸå]</span><br><span class="line"><span class="comment"># æŒ‰ç…§å‘½ä»¤è¡Œæ“ä½œï¼Œç”Ÿæˆçš„è¯ä¹¦åœ¨/etc/letsencrypt/live/ç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶ä¿æŒä¸åŠ¨ï¼Œç›´æ¥å¯åŠ¨nginxæœåŠ¡</span></span><br><span class="line">systemctl start nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨github hookæœåŠ¡ï¼Œæ¥æ”¶githubæ¨é€æ›´æ–°ï¼Œä½¿ç”¨nohup or tmuxï¼Œå®‰è£…pip3 install flask</span></span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œé¡¹ç›®å·²å…¨éƒ¨è¿ç§»æˆåŠŸï¼Œè¯¦ç»†è¿‡ç¨‹å¯å‚è€ƒ<code>~/.bash_history</code>æ–‡ä»¶</p>
<h2 id="nginxé…ç½®è¯´æ˜">Nginxé…ç½®è¯´æ˜</h2>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> https://[åŸŸå] <span class="literal">permanent</span>; <span class="comment"># å¼ºåˆ¶https</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é™æ€æ–‡ä»¶ç¼“å­˜åŠ é€Ÿ</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* ^.+\.(webp|jpg|jpeg|gif|png|ico|css|js|pdf|txt)</span>&#123;</span><br><span class="line">        <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">gzip_buffers</span> <span class="number">16</span> <span class="number">8k</span>;</span><br><span class="line">        <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">        <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">        <span class="attribute">gzip_types</span> image/webp application/pdf text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line">        <span class="attribute">gzip_proxied</span> any;</span><br><span class="line">        <span class="attribute">root</span> path; <span class="comment"># é™æ€æ–‡ä»¶ç›®å½•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="github-hooké…ç½®">Github Hooké…ç½®</h2>
<p>Githubé…ç½®ä½ç½®ï¼Œé¡¹ç›®çš„<code>Settings-&gt;Webhooks-&gt;Add webhook</code>ã€‚å¡«å†™å¯¹åº”çš„ä¿¡æ¯</p>
<ul>
<li>Payload URL: åŸŸå+ç«¯å£ï¼ˆflaskæœåŠ¡é…ç½®ï¼‰</li>
<li>Content typeï¼šjson</li>
<li>Secretï¼šè‡ªå®šä¹‰å¯†é’¥ï¼Œåœ¨è„šæœ¬ä¸­é…ç½®</li>
<li><strong>Which events would you like to trigger this
webhook?</strong>ï¼šä»…åœ¨æ¨é€æ—¶è¿›è¡Œæ“ä½œ</li>
</ul>
<p>æœåŠ¡å™¨ä¸Šçš„pythonè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">repo_path = <span class="string">&#x27;&#x27;</span> <span class="comment"># gitä»“åº“åœ°å€</span></span><br><span class="line">secret = <span class="string">&#x27;&#x27;</span>	   <span class="comment"># githubé…ç½®çš„å¯†é’¥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encryption</span>(<span class="params">data</span>):</span><br><span class="line">    key = secret.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    obj = hmac.new(key, msg=data, digestmod=<span class="string">&#x27;sha1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> obj.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    post_data = request.data</span><br><span class="line">    token = encryption(post_data)</span><br><span class="line">    <span class="comment"># è®¤è¯ç­¾åæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    signature = request.headers.get(<span class="string">&#x27;X-Hub-Signature&#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;=&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> signature != token:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;failed&#x27;</span></span><br><span class="line"></span><br><span class="line">    os.system(<span class="string">&#x27;cd &#123;&#125; &amp;&amp; git pull&#x27;</span>.<span class="built_in">format</span>(repo_path))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=port) <span class="comment"># å¼€å¯çš„portï¼Œè®°å¾—æ‰“å¼€å¯¹åº”ç«¯å£çš„é˜²ç«å¢™</span></span><br></pre></td></tr></table></figure>
<p>è‹¥æ¨é€å¤±è´¥ï¼Œå¯åœ¨æœåŠ¡å™¨æ‰‹åŠ¨<code>git pull</code>ï¼Œæˆ–è€…åœ¨<code>webhook</code>åœ°å€ï¼Œ<code>[Recent Deliveries]</code>ä¸­è¿›è¡Œ<code>Redeliver</code></p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
        <tag>Github</tag>
        <tag>Webhook</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title>Hadoopä¼ªåˆ†å¸ƒå¼å®‰è£…ï¼ˆCentos7ï¼‰</title>
    <url>/hexo_blog/2017/04/09/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/Hadoop%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%88Centos7%EF%BC%89/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Hadoopçš„ä¼ªåˆ†å¸ƒå¼å®‰è£…å’Œä¸€äº›åŸºç¡€æ“ä½œ</p>
<span id="more"></span>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/hadoop/wKiom1SFSNnAeaEUAADD3ZcjTjw828.jpg" /></p>
<h2 id="æ–‡ç« å¼€å¤´">æ–‡ç« å¼€å¤´</h2>
<p>ç¯å¢ƒé…ç½®ï¼šCentos7</p>
<p>Hadoopç‰ˆæœ¬ï¼šhadoopï¼š2.7.3</p>
<p>JDKç‰ˆæœ¬ï¼šjdk-8u111-linux-x64.tar.gz</p>
<h2 id="å®‰è£…ä¹‹å‰">å®‰è£…ä¹‹å‰</h2>
<ol type="1">
<li><p>ä¸‹è½½hadoopå®‰è£…åŒ…, <a
href="http://hadoop.apache.org/releases.html">ä¸‹è½½ç½‘å€</a>ã€‚è¿›å…¥å®˜ç½‘ä¹‹åï¼Œç‚¹å‡»å¯¹åº”ç‰ˆæœ¬çš„â€œbinaryâ€ï¼Œä¹‹åç‚¹å‡»é“¾æ¥ä¸‹è½½å³å¯ã€‚</p></li>
<li><p>jdkã€‚é€šè¿‡å®˜ç½‘ä¸‹è½½jdk</p></li>
<li><p>é€šè¿‡Xshellï¼Œä¸Šä¼ ä¸¤ä¸ªå®‰è£…åŒ…è‡³/usr/local/ã€‚æœåŠ¡å™¨ä¸æœ¬åœ°ä¸‹è½½å’Œä¸Šä¼ éœ€è¦lrzszè¿™ä¸ªè½¯ä»¶</p></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install lrzsz</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå¯æ‰‹åŠ¨æ‹–åŠ¨æ–‡ä»¶è‡³æœåŠ¡å™¨å½“å‰ç›®å½•ä¸‹ï¼Œä¹Ÿå¯é€šè¿‡å‘½ä»¤
â€œrzâ€æ¥æ‰“å¼€çª—å£ï¼Œä»è€Œè¿›è¡Œä¸Šä¼ ã€‚ ï¼ˆä¸‹è½½å‘½ä»¤â€œszâ€ï¼‰</p>
<h2 id="è§£å‹ç¼©åŠé…ç½®">è§£å‹ç¼©åŠé…ç½®</h2>
<p>åœ¨<code>/usr/local/</code>ç›®å½•ä¸‹è¿›è¡Œè§£å‹ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¯·æ ¹æ®ä¸‹è½½ç‰ˆæœ¬ï¼Œè¿›è¡Œè§£å‹ç¼©</span></span><br><span class="line">tar -zxvf jdk-8u111-linux-x64.tar.gz</span><br><span class="line">tar -zxvf hadoop-2.7.3.tar.gz</span><br></pre></td></tr></table></figure></p>
<h3
id="é…ç½®javaç¯å¢ƒå˜é‡å¯ä¸é…ç½®hadoopç¯å¢ƒå˜é‡é…ç½®ä¸€èµ·è¿›è¡Œ">é…ç½®Javaç¯å¢ƒå˜é‡ï¼ˆå¯ä¸é…ç½®Hadoopç¯å¢ƒå˜é‡é…ç½®ä¸€èµ·è¿›è¡Œï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment">#ç¬¬åè¡Œå·¦å³è¾“å…¥å‘½ä»¤ï¼Œæ³¨æ„ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0_111</span><br><span class="line"><span class="built_in">export</span> PATH=.:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®hadoopç¯å¢ƒå˜é‡">é…ç½®Hadoopç¯å¢ƒå˜é‡</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment">#åœ¨åˆšåˆšJAVA_HOMEä¹‹ä¸‹ä¸€è¡Œï¼Œæ³¨æ„ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤å¤„çš„PATHæ‰¿æ¥ä¸Šé¢Javaç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œå³æ˜¯åœ¨åŸæ¥åŸºç¡€ä¸Šè¿›è¡Œå¢åŠ è€Œä¸æ˜¯å¦èµ·ä¸€è¡Œ</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/local/hadoop-2.7.3</span><br><span class="line"><span class="built_in">export</span> PATH=.:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°è®¾ç½®</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®å¯åŠ¨hadoop">é…ç½®å¯åŠ¨Hadoop</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿›å…¥é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/hadoop-2.7.3/etc/hadoop/</span><br><span class="line"><span class="comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim hadoop-env.sh</span><br><span class="line"><span class="comment">#ç¬¬äºŒåäº”è¡Œ</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0_111</span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line">vim core-site.xml</span><br><span class="line"><span class="comment">#æ·»åŠ &lt;configuration&gt;&lt;/configuration&gt;ä¸­é—´çš„é…ç½®</span></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- æŒ‡å®šHDFSè€å¤§ï¼ˆnamenodeï¼‰çš„é€šä¿¡åœ°å€ --&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">	    &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">	    &lt;value&gt;hdfs://hadoopbonc1:9000&lt;/value&gt;</span><br><span class="line">    &lt;!-- æŒ‡å®šhadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ --&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="comment">#æ­¤å¤„fs.defaultFSçš„vauleå†™æœ¬æœºä¸»æœºåï¼Œå³ç¬¬ä¸€ä¸ªvalueçš„hadoopbonc1æ¢æˆä¸»æœºå</span></span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line">vim hdfs-site.xml</span><br><span class="line"><span class="comment">#æ·»åŠ å¦‚ä¸Šé…ç½®</span></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- è®¾ç½®hdfså‰¯æœ¬æ•°é‡ --&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">         &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">         &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®sshå…å¯†ç ç™»é™†å¯†ç äº’é€š">é…ç½®SSHå…å¯†ç ç™»é™†ï¼ˆå¯†ç äº’é€šï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é…ç½®å‰</span></span><br><span class="line">ssh localhost</span><br><span class="line"><span class="comment">#å›è½¦åï¼Œè¦æ±‚è¾“å…¥æœ¬æœºç™»é™†å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®ä¸»æœºå</span></span><br><span class="line">vim /etc/sysconfig/network</span><br><span class="line"><span class="built_in">source</span> /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®hosts</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠŠå…¬é’¥å’Œç§é’¥å¤åˆ¶åˆ°ç›¸åº”çš„èŠ‚ç‚¹ï¼ˆå› ä¸ºæœ¬æœºæ˜¯å•èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¤åˆ¶åˆ°æœ¬æœºï¼‰</span></span><br><span class="line"><span class="comment">#æ­¤å¤„çš„hadoopbonc1æ¢æˆä¸»æœºå</span></span><br><span class="line">ssh-copy-id hadoopbonc1</span><br></pre></td></tr></table></figure>
<h3 id="hdfså¯åŠ¨ä¸åœæ­¢">hdfså¯åŠ¨ä¸åœæ­¢</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦æ ¼å¼åŒ–ï¼Œç†ç”±è·Ÿç£ç›˜ç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦æ ¼å¼åŒ–ä¸€æ ·</span></span><br><span class="line"><span class="comment">#ä»¥åå¯åŠ¨å°±ä¸éœ€è¦æ ¼å¼åŒ–</span></span><br><span class="line">hdfs namenode -format</span><br><span class="line"><span class="comment">#å¯åŠ¨hdfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨hadoopç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/locate/hadoop-2.7.3/</span><br><span class="line"><span class="comment">#å¯åŠ¨</span></span><br><span class="line">./sbin/start-dfs.sh</span><br><span class="line"><span class="comment">#è¾“å…¥jpsæ£€æŸ¥æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">jps</span><br><span class="line"><span class="comment">#å‡ºç°å››è¡Œé¡ºåºä¸å®šï¼Œåˆ†åˆ«ä¸ºSecondaryNameNodeã€DataNodeã€NameNodeã€Jpsï¼Œå³è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line"><span class="comment">#æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼šæœåŠ¡å™¨ip:50070</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è‹¥æ— å“åº”åˆ™éœ€è¦å¼€æ”¾50070ç«¯å£ï¼Œåˆ™éœ€å¼€æ”¾50070ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=50070/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#hdfsçš„åœæ­¢</span></span><br><span class="line"><span class="comment">#åŒæ ·åœ¨hadoopç›®å½•ä¸‹</span></span><br><span class="line">./sbin/stop-dfs.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®å’Œå¯åŠ¨yarn">é…ç½®å’Œå¯åŠ¨YARN</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ‡æ¢é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/hadoop-2.7.3/etc/hadoop/</span><br><span class="line"><span class="built_in">mv</span> mapred-site.xml.template mapred-site.xml</span><br><span class="line">vim mapred-site.xml</span><br><span class="line"><span class="comment">#æ·»åŠ &lt;configuration&gt;&lt;/configuration&gt;ä¸­é—´çš„é…ç½®</span></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- é€šçŸ¥æ¡†æ¶MRä½¿ç”¨YARN --&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line">vim yarn-site.xml</span><br><span class="line"><span class="comment">#æ·»åŠ å¦‚ä¸Šé…ç½®</span></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;!-- reducerå–æ•°æ®çš„æ–¹å¼æ˜¯mapreduce_shuffle --&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">         &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">         &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨YARN</span></span><br><span class="line">start-yarn.sh</span><br><span class="line"><span class="comment">#è¾“å…¥jpsæ£€æŸ¥æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">jps</span><br><span class="line"><span class="comment">#å‡ºç°å…­è¡Œé¡ºåºä¸å®šï¼Œåˆ†åˆ«ä¸ºSecondaryNameNodeã€DataNodeã€NameNodeã€Jpsã€ResourceManagerã€NodeManagerï¼Œå³è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line"><span class="comment">#æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼šæœåŠ¡å™¨ip:8088</span></span><br><span class="line"><span class="comment">#è‹¥æ— å“åº”ï¼Œå¯å‚ç…§ä¸Šæ–‡ä¸­çš„å¼€æ”¾50070ç«¯å£ï¼Œå¼€æ”¾8088ç«¯å£ï¼Œåªéœ€å°†50070æ¢ä¸º8088å³å¯</span></span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•">æµ‹è¯•</h2>
<p>åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚åœ¨<code>/home/user/</code>ä¸‹æ–°å»º<code>words.txt</code>ï¼Œå†…å®¹å¦‚ä¸‹
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hello world</span><br><span class="line">hello hadoop</span><br><span class="line">hello csdn</span><br><span class="line">hello</span><br></pre></td></tr></table></figure></p>
<p>æ­£å¼è¿›è¡Œæµ‹è¯•ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åœ¨hdfsæ ¹ç›®å½•ä¸‹æ–°å»ºtestç›®å½•</span></span><br><span class="line">bin/hdfs dfs -<span class="built_in">mkdir</span> /test</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹hdfsæ ¹ç›®å½•ä¸‹çš„ç›®å½•ç»“æ„</span></span><br><span class="line">bin/hdfs dfs -<span class="built_in">ls</span> /</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ è‡³/test/ç›®å½•ä¸‹</span></span><br><span class="line">bin/hdfs dfs -put /home/user/words.txt /test/</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordcount</span></span><br><span class="line">bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.1.jar wordcount /test/words.txt /test/out</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨/test/ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªåä¸ºoutçš„æ–‡ä»¶ç›®å½•ï¼ŒæŸ¥çœ‹ä¸€ä¸‹/out/ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line">bin/hdfs dfs -<span class="built_in">ls</span> /test/out</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»“æœä¿å­˜åœ¨part-r-00000ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœ</span></span><br><span class="line">bin/hdfs fs -<span class="built_in">cat</span> /test/out/part-r-00000</span><br></pre></td></tr></table></figure></p>
<h2 id="hdfsçš„å¸¸ç”¨æ“ä½œå‘½ä»¤">HDFSçš„å¸¸ç”¨æ“ä½œå‘½ä»¤</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¸¸ç”¨æ“ä½œï¼š</span></span><br><span class="line"><span class="comment">#HDFS shell</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">hadoop fs -<span class="built_in">help</span> &lt;cmd&gt;</span><br><span class="line"><span class="comment">#ä¸Šä¼ </span></span><br><span class="line">hadoop fs -<span class="built_in">cat</span> &lt;hdfsä¸Šçš„è·¯å¾„&gt;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">hadoop fs -<span class="built_in">ls</span> /</span><br><span class="line"><span class="comment">#ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">hadoop fs -get &lt;hdfsä¸Šçš„è·¯å¾„&gt; &lt;linuxä¸Šæ–‡ä»¶&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/hexo_blog/2017/05/07/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/%E5%9C%A8Hadoop%E5%9F%BA%E7%A1%80%E4%B8%8AHive%E7%9A%84%E5%AE%89%E8%A3%85/" title="åœ¨HadoopåŸºç¡€ä¸ŠHiveçš„å®‰è£…">åœ¨HadoopåŸºç¡€ä¸ŠHiveçš„å®‰è£…</a></p>
]]></content>
      <categories>
        <category>Environment</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Hadoop</tag>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title>é£æ ¼è¿ç§»è½¬æ¢çš„ä¸¤ç§å®ç°</title>
    <url>/hexo_blog/2017/08/14/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/%E9%A3%8E%E6%A0%BC%E8%BF%81%E7%A7%BB%E8%BD%AC%E6%8D%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨Ubuntu16.04ç¯å¢ƒä¸‹æ­å»ºcaffeå’Œtensorflowï¼Œå¹¶åˆ©ç”¨caffeå’Œtensorflowå®ç°äº†é£æ ¼è½¬æ¢ã€‚åŒæ—¶ï¼Œä»‹ç»äº†å¦‚ä½•è®­ç»ƒæ–°çš„é£æ ¼æ¨¡å‹ã€‚</p>
<span id="more"></span>
<p><strong>style-transfer</strong></p>
<p>è¿™ä¸ªä¸»è¦æ˜¯åˆ©ç”¨caffe+model+codeç›´æ¥å®ç°ä»»æ„é£æ ¼çš„è½¬æ¢ã€‚</p>
<p>æœ€åå®ç°éœ€å€ŸåŠ©</p>
<ul>
<li>ä¸€å¼ é£æ ¼å›¾ç‰‡</li>
<li>å¾…è½¬æ¢é£æ ¼çš„ç›®æ ‡å›¾ç‰‡</li>
<li>è®­ç»ƒæ¨¡å‹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python style.py -s &lt;style_image&gt; -c &lt;content_image&gt; -m &lt;model_name&gt; -g 0</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¯ä»¥å®ç°ä»»æ„é£æ ¼çš„è½¬æ¢</li>
<li>å¯æ‹“å±•æ€§å¼º ç¼ºç‚¹ï¼š</li>
<li>è€—æ—¶é•¿ï¼ˆçœŸçš„å¾ˆé•¿ï¼Œå¦‚æœç”¨CPUçš„è¯ï¼‰</li>
</ul>
<p><strong>fast-neural-style-tensorflow</strong></p>
<p>é£æ ¼å¿«é€Ÿè¿ç§»è½¬æ¢</p>
<p>é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ¯”å‰è€…èƒ½å¤Ÿæ›´å¿«çš„è¿›è¡Œé£æ ¼è½¬æ¢ï¼Œé€Ÿåº¦å› æœºå™¨è€Œå¼‚ï¼Œä¸è¿‡æ•ˆç‡æ¯”å‰è€…ç¡®ç¡®å®å®æé«˜äº†å¾ˆå¤šå€</p>
<p>æœ€åå®ç°éœ€å€ŸåŠ©</p>
<ul>
<li>ä¸€ä¸ªè®­ç»ƒå¥½çš„é£æ ¼æ¨¡å‹</li>
<li>å¾…è½¬æ¢çš„é£æ ¼å›¾ç‰‡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding</span></span><br><span class="line"> python eval.py --model_file &lt;path of ckpt-done&gt; --image_file &lt;path of image&gt;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é€Ÿåº¦ç›¸å¯¹æ¥è¯´å¾ˆå¿«</li>
<li>ç¯å¢ƒæ­å»ºç›¸å¯¹æ¥è¯´æ›´å®¹æ˜“ ç¼ºç‚¹ï¼š</li>
<li>å¯æ‹“å±•æ€§æ›´å¼±</li>
<li>åªèƒ½è½¬æ¢å›ºå®šå‡ ç§é£æ ¼</li>
<li>è®­ç»ƒæ–°é£æ ¼æ¨¡å‹æ—¶é—´é•¿ï¼ˆæ¯”å‰è€…ç”Ÿæˆæ—¶é—´æ›´é•¿ï¼‰</li>
</ul>
<h2 id="style-transferçš„å®ç°">style-transferçš„å®ç°</h2>
<p><strong>ç¯å¢ƒä»‹ç»</strong></p>
<p>Ubuntu16.04 + CPU + python2.7 + caffe</p>
<h3 id="æ­å»ºcaffeç¯å¢ƒ">æ­å»ºcaffeç¯å¢ƒ</h3>
<h4 id="ä»‹ç»">ä»‹ç»</h4>
<p>Caffeæ˜¯ä¸€ä¸ªæ¸…æ™°è€Œé«˜æ•ˆçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚Caffeæ˜¯çº¯ç²¹çš„C++/CUDAæ¶æ„ï¼Œæ”¯æŒå‘½ä»¤è¡Œã€Pythonå’ŒMATLABæ¥å£ï¼›å¯ä»¥åœ¨CPUå’ŒGPUç›´æ¥æ— ç¼åˆ‡æ¢ã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä¸Šæ‰‹å¿«ï¼šæ¨¡å‹ä¸ç›¸åº”ä¼˜åŒ–éƒ½æ˜¯ä»¥æ–‡æœ¬å½¢å¼è€Œéä»£ç å½¢å¼ç»™å‡ºã€‚
Caffeç»™å‡ºäº†æ¨¡å‹çš„å®šä¹‰ã€æœ€ä¼˜åŒ–è®¾ç½®ä»¥åŠé¢„è®­ç»ƒçš„æƒé‡ï¼Œæ–¹ä¾¿ç«‹å³ä¸Šæ‰‹ã€‚</li>
<li>é€Ÿåº¦å¿«ï¼šèƒ½å¤Ÿè¿è¡Œæœ€æ£’çš„æ¨¡å‹ä¸æµ·é‡çš„æ•°æ®ã€‚
Caffeä¸cuDNNç»“åˆä½¿ç”¨ï¼Œæµ‹è¯•AlexNetæ¨¡å‹ï¼Œåœ¨K40ä¸Šå¤„ç†æ¯å¼ å›¾ç‰‡åªéœ€è¦1.17ms.</li>
<li>æ¨¡å—åŒ–ï¼šæ–¹ä¾¿æ‰©å±•åˆ°æ–°çš„ä»»åŠ¡å’Œè®¾ç½®ä¸Šã€‚
å¯ä»¥ä½¿ç”¨Caffeæä¾›çš„å„å±‚ç±»å‹æ¥å®šä¹‰è‡ªå·±çš„æ¨¡å‹ã€‚</li>
<li>å¼€æ”¾æ€§ï¼šå…¬å¼€çš„ä»£ç å’Œå‚è€ƒæ¨¡å‹ç”¨äºå†ç°ã€‚</li>
<li>ç¤¾åŒºå¥½ï¼šå¯ä»¥é€šè¿‡BSD-2å‚ä¸å¼€å‘ä¸è®¨è®ºã€‚</li>
</ul>
<h4 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># caffe ä¾èµ–</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libhdf5-serial-dev protobuf-compiler</span><br><span class="line"><span class="built_in">sudo</span> apt-get install --no-install-recommends libboost-all-dev</span><br><span class="line"><span class="built_in">sudo</span> apt-get install libatlas-base-dev</span><br><span class="line"><span class="built_in">sudo</span> apt-get install libhdf5-serial-dev</span><br><span class="line"><span class="comment"># Python ä¾èµ–</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python-dev</span><br><span class="line"><span class="built_in">sudo</span> apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev</span><br></pre></td></tr></table></figure>
<h4
id="å®‰è£…caffeå¯åˆ©ç”¨virtualenvæ–°å»ºä¸€ä¸ªçº¯å‡€ç¯å¢ƒ">å®‰è£…caffeï¼ˆå¯åˆ©ç”¨virtualenvæ–°å»ºä¸€ä¸ªçº¯å‡€ç¯å¢ƒï¼‰</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ä»¬éœ€è¦å°†caffeçš„æºç ä¸‹è½½ä¸‹æ¥ï¼Œæ‰€ä»¥éœ€è¦git</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install git</span><br><span class="line"><span class="comment"># ä¸‹è½½ä»£ç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/BVLC/caffe.git</span><br><span class="line"><span class="comment"># ä¸‹è½½å®Œæˆåï¼Œè¿›å…¥caffeæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> caffe</span><br><span class="line"><span class="comment"># å®‰è£…caffeçš„pythonä¾èµ–</span></span><br><span class="line"><span class="keyword">for</span> req <span class="keyword">in</span> $(<span class="built_in">cat</span> requirements.txt); <span class="keyword">do</span> pip install <span class="variable">$req</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h4 id="é…ç½®caffe">é…ç½®caffe</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆç¡®ä¿åœ¨caffeæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># è¿›è¡Œå¤‡ä»½</span></span><br><span class="line"><span class="built_in">cp</span> Makefile.config.example Makefile.config</span><br><span class="line"><span class="comment"># è¿›è¡Œç¼–è¾‘</span></span><br><span class="line">vim Makefile.config</span><br></pre></td></tr></table></figure>
<ul>
<li>å› ä¸ºCPU MODE, æ‰€ä»¥åœ¨CPU_ONLY := 1å‰é¢çš„#è¦å»æ‰</li>
<li>ä¸¤ä¸ªè·¯å¾„è¦æ”¹æˆè¿™æ ·:(æ·»åŠ åé¢çš„ä¸¤ä¸ªhdf5çš„è·¯å¾„,
å¦åˆ™ç¼–è¯‘æ—¶æŠ¥hdf5é”™è¯¯)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Whatever else you find you need goes here.</span></span><br><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu/hdf5/serial</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œä¿å­˜é€€å‡ºå³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œç¼–è¯‘</span></span><br><span class="line">make pycaffe</span><br><span class="line">make all</span><br><span class="line">make <span class="built_in">test</span></span><br><span class="line">make runtest</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ç»“æŸåï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># é¦–å…ˆç¡®ä¿å·²ç»è¿›å…¥åˆ°caffeæ–‡ä»¶å¤¹ä¸­ï¼Œä¹‹åæŸ¥çœ‹å½“å‰è·¯å¾„</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="comment"># å‡è®¾è¾“å‡ºç»“æœæ˜¯xxxï¼Œé‚£ä¹ˆå°†xxxå¤åˆ¶ä¸‹æ¥ï¼Œé»è´´è‡³ä¸‹é¢xxxçš„ä½ç½®</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=xxx/python:<span class="variable">$PYTHONPATH</span></span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœè¿æ°”å¥½çš„è¯ï¼Œåˆ°è¿™é‡ŒåŸºæœ¬å°±ç®—å®‰è£…å®Œæˆï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯è¦æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥pythonç¯å¢ƒ</span></span><br><span class="line">python</span><br><span class="line"><span class="comment"># å¯¼å…¥caffeæ¨¡å—</span></span><br><span class="line">&gt;caffe</span><br><span class="line"><span class="comment"># å¦‚æœæ­¤å¤„æ²¡æœ‰æŠ¥ä»»ä½•é”™è¯¯ï¼Œæ­å–œä½ å®‰è£…æˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<h4 id="éƒ¨åˆ†æŠ¥é”™è§£å†³æ–¹æ¡ˆ">éƒ¨åˆ†æŠ¥é”™è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>æœ€å¥½çš„æ–¹æ¡ˆè«è¿‡äºï¼Œå¤åˆ¶æŠ¥é”™ä»£ç ï¼ŒGoogleä¸€ä¸‹ </strong>
ä¸‹é¢æä¾›å‡ ç§ï¼Œæˆ‘å®‰è£…æ—¶çš„å‡ å¤„å‘</p>
<ul>
<li>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ³¨æ„ä¸€å®šæ˜¯åœ¨caffeæ–‡ä»¶å¤¹ä¸‹ï¼Œè·¯å¾„æ˜¯caffe/pythonçš„ç»å¯¹è·¯å¾„</li>
<li>å®‰è£…ä¾èµ–æŠ¥é”™ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è®²ï¼Œç›´æ¥googleå§</li>
<li>makeçš„æ—¶å€™æŠ¥é”™ï¼Œæƒ³æƒ³çœ‹æ˜¯å¦ç¼–è¾‘äº†Makefile.configã€‚ä¹‹åmake
cleanä¸€ä¸‹ï¼Œå†é‡æ–°ç¼–è¯‘ä¸€ä¸‹</li>
<li>CPU_ONLYè¿™ä¸ªé€‰é¡¹ä¸º1æ—¶ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹<code>caffe/examples/mnist/lenet_solver.prototxt</code>ï¼Œå°†å…¶ä¸­çš„<code>solver_mode:GPU</code>æ”¹ä¸ºCPU</li>
</ul>
<p><a
href="http://blog.csdn.net/sinat_26917383/article/details/53502719">å‚è€ƒæ–‡ç« </a></p>
<h3 id="å®ç°å‰å‡†å¤‡">å®ç°å‰å‡†å¤‡</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤å·²å®‰è£…gitï¼Œæœªå®‰è£…è¯·sudo apt get install git</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/fzliu/style-transfer</span><br><span class="line"></span><br><span class="line"><span class="comment"># pycaffeç¯å¢ƒå¸ƒç½®</span></span><br><span class="line"><span class="built_in">sudo</span> pip install progressbar</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½è®­ç»ƒæ¨¡å‹ï¼Œè¿™é‡Œæ¨èvgg16</span></span><br><span class="line"><span class="comment"># æ–¹æ³•ä¸€ï¼Œä½¿ç”¨scripts/ ä¸‹çš„download_models.shè¿™ä¸ªæ–¹æ³•å¯èƒ½å¾ˆæ…¢ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">bash scripts/download_models.sh vgg16</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">wget http://www.robots.ox.ac.uk/~vgg/software/very_deep/caffe/VGG_ILSVRC_16_layers.caffemodel</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•äºŒä¸‹è½½çš„modeléœ€è¦æ”¾åœ¨./model/vgg16ä¸‹ï¼Œä½¿ç”¨æ–¹æ³•ä¸€ä¸‹è½½çš„å·²ç»é»˜è®¤æ”¾åœ¨é‚£</p>
<h3 id="å®ç°">å®ç°</h3>
<p>ç¡®ä¿åœ¨æºç æ–‡ä»¶å¤¹ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼</span></span><br><span class="line">python style.py -s &lt;style_image&gt; -c &lt;content_image&gt; -m &lt;model_name&gt; -g 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸¾ä¸ªæ —å­ï¼Œmodel_nameç›´æ¥å†™vgg16æˆ–å…¶ä»–ï¼Œä¸éœ€è¦åŠ å…·ä½“è·¯å¾„</span></span><br><span class="line">python style.py -s images/style/starry_night.jpg -c images/content/nanjing.jpg -m vgg16 -g -1</span><br></pre></td></tr></table></figure>
<p>æç¤ºï¼šCPUå¾ˆæ…¢ï¼ŒçœŸçš„å¾ˆæ…¢ï¼Œä¼°è®¡è¦ç­‰ä¸€ä¼šæ‰ä¼šæœ‰æ—¶é—´æ˜¾ç¤ºå‡ºæ¥</p>
<p>å‚æ•°è§£æï¼š</p>
<ul>
<li>-s, é£æ ¼å›¾ä½ç½®ï¼›</li>
<li>-c, å†…å®¹å›¾ä½ç½®ï¼›</li>
<li>-m, æ¨¡å‹ä½ç½®ï¼›</li>
<li>-g, ä»€ä¹ˆæ¨¡å¼ï¼Œ-1ä¸ºCPUï¼Œ0ä¸ºå•ä¸ªGPUï¼Œ1ä¸ºä¸¤ä¸ªGPUã€‚</li>
</ul>
<h3 id="è°ƒæ•´å‚æ•°">è°ƒæ•´å‚æ•°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¡®ä¿åœ¨æºç æ–‡ä»¶å¤¹ä¸‹,ä¿®æ”¹style.pyé…ç½®æ–‡ä»¶</span></span><br><span class="line">vim style.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶å¤§å°ï¼Œæ”¹ä¸º1024</span></span><br><span class="line">parser.add_argument(<span class="string">&quot;-l&quot;</span>, <span class="string">&quot;--length&quot;</span>, default=1024, <span class="built_in">type</span>=<span class="built_in">float</span>, required=False, <span class="built_in">help</span>=<span class="string">&quot;maximum image length&quot;</span>)</span><br><span class="line">def transfer_style(self, img_style, img_content, length=1024, ratio=1e5,</span><br><span class="line">n_iter=512, init=<span class="string">&quot;-1&quot;</span>, verbose=False, callback=None)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹è¿­ä»£æ¬¡æ•°ï¼Œä¸ªäººè®¤ä¸º400å°±å·®ä¸å¤šäº†ï¼Œå¯è‡ªè¡Œä¿®æ”¹ï¼›50æ¬¡è¿­ä»£ä¹‹åæ”¹å˜çš„å°±æ˜¯èƒŒæ™¯çº¹ç†ï¼ŒæŒ‰éœ€æ›´æ”¹</span></span><br><span class="line">parser.add_argument(<span class="string">&quot;-n&quot;</span>, <span class="string">&quot;--num-iters&quot;</span>, default=400, <span class="built_in">type</span>=int, required=False, <span class="built_in">help</span>=<span class="string">&quot;L-BFGS iterations&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜æœ‰å¾ˆå¤šå…¶ä»–å¯ä»¥ä¿®æ”¹çš„åœ°æ–¹ï¼Œåœ¨æ­¤å°±ä¸ä¸€ä¸€èµ˜è¿°äº†</span></span><br></pre></td></tr></table></figure>
<h2
id="fast-neural-style-tensorflowçš„å®ç°">fast-neural-style-tensorflowçš„å®ç°</h2>
<p><strong>ç¯å¢ƒä»‹ç» </strong></p>
<p>Ubuntu16.04 + CPU + python2.7 + tensorflow 1.0</p>
<h3 id="æ­å»ºtensorflowç¯å¢ƒ">æ­å»ºtensorflowç¯å¢ƒ</h3>
<p>ç¯å¢ƒè¯´æ˜ï¼šUbuntu16.04 æ³¨ï¼štensorflowåªæ”¯æŒ64ä½ç³»ç»Ÿ</p>
<h4 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¡®ä¿æœ‰pipå·¥å…·ï¼Œä¸€èˆ¬è‡ªå¸¦ï¼Œæ²¡æœ‰çš„è¯è¯·æŒ‰ä¸‹é¢è¿™æ¡å‘½ä»¤è¿›è¡Œå®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python-pip python-dev</span><br></pre></td></tr></table></figure>
<h4 id="cpuå®‰è£…">CPUå®‰è£…</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line"><span class="built_in">sudo</span> pip installl tensorflow</span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="built_in">sudo</span> pip3 install tensorflow</span><br></pre></td></tr></table></figure>
<h4 id="gpuå®‰è£…">GPUå®‰è£…</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…åœ°å€è¯·æ ¹æ®è‡ªå·±éœ€æ±‚è¿›è¡Œå£°æ˜ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># python2</span></span><br><span class="line"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-0.12.0rc0-cp27-none-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-0.12.0rc0-cp35-cp35m-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="built_in">sudo</span> pip install --upgrade <span class="variable">$TF_BINARY_URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">sudo</span> pip3 install --upgrade <span class="variable">$TF_BINARY_URL</span></span><br></pre></td></tr></table></figure>
<p><a
href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/1-2-install/">å‚è€ƒæ–‡ç« </a></p>
<h4 id="æºç å®‰è£…">æºç å®‰è£…</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½æœ€æ–°çš„tensorflowé¡¹ç›®</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/tensorflow/tensorflow</span><br><span class="line"><span class="comment"># è¿›å…¥tensorflow</span></span><br><span class="line"><span class="built_in">cd</span> tensorflow</span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°éœ€è¦å®‰è£…çš„ç‰ˆæœ¬åˆ†æ”¯ï¼Œä»¥1.0ä¸ºæ —å­</span></span><br><span class="line">git checkout r1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…bazel</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/bazel.list</span><br><span class="line"></span><br><span class="line">curl https://bazel.build/bazel-release.pub.gpg | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> apt-get update &amp;&amp; <span class="built_in">sudo</span> apt-get install bazel</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python-numpy python-dev python-pip python-wheel</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python3-numpy python3-dev python3-pip python3-wheel</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œç¼–è¯‘ï¼Œç¡®ä¿åœ¨tensorflowæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># æç¤ºä¿¡æ¯å¯ä»¥ä¸€è·¯å›è½¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘CPUç‰ˆæœ¬</span></span><br><span class="line">bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line"><span class="comment"># ç¼–è¯‘GPUç‰ˆæœ¬</span></span><br><span class="line">bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ç”Ÿæˆçš„whlåŒ…</span></span><br><span class="line">bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ç”Ÿæˆçš„åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> pip install /tmp/tensorflow_pkg/tensorflow*.whl</span><br></pre></td></tr></table></figure>
<p><a
href="https://tensorflow.feisky.xyz/install/src.html">å‚è€ƒæ–‡ç« </a></p>
<h4 id="æµ‹è¯•-1">æµ‹è¯•</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€å¯¹åº”ç‰ˆæœ¬çš„pythonç»ˆç«¯</span></span><br><span class="line">&gt;import tensorflow</span><br><span class="line"><span class="comment"># æœªæŠ¥é”™å³å®‰è£…æˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<h3 id="å®ç°å‰å‡†å¤‡-1">å®ç°å‰å‡†å¤‡</h3>
<p>ä¸‹è½½å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹</p>
<p><a
href="https://pan.baidu.com/s/1i4GTS4d#list/path=%2F">ç™¾åº¦äº‘ç›˜é“¾æ¥</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å®‰è£…pyyaml</span><br><span class="line">sudo pip install pyyaml</span><br></pre></td></tr></table></figure>
<h3 id="å®ç°-1">å®ç°</h3>
<p>ç¡®ä¿åœ¨æºç æ–‡ä»¶å¤¹ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼</span></span><br><span class="line">python eval.py --model_file &lt;path of ckpt-done&gt; --image_file &lt;path of image&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸¾ä¸ªæ —å­,å‡è®¾wave.ckpt-doneæ”¾åœ¨äº†æºç æ–‡ä»¶å¤¹ä¸­çš„modelsæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">python eval.py --model_file models/wave.ckpt-done --image_file img/test.jpg</span><br><span class="line"><span class="comment"># é»˜è®¤ç”Ÿæˆä½ç½®åœ¨generatedï¼Œé»˜è®¤ç”Ÿæˆæ–‡ä»¶åç§°ä¸ºres.jpgã€‚å¯è‡ªè¡Œåœ¨eval.pyä¸­æ›´æ”¹</span></span><br></pre></td></tr></table></figure>
<h3 id="è®­ç»ƒæ–°çš„é£æ ¼æ¨¡å‹">è®­ç»ƒæ–°çš„é£æ ¼æ¨¡å‹</h3>
<p><strong>ä¸‹è½½</strong></p>
<p><a
href="http://download.tensorflow.org/models/vgg_16_2016_08_28.tar.gz">vgg16è®­ç»ƒæ¨¡å‹</a>(500å¤šM)</p>
<p><a
href="http://msvocds.blob.core.windows.net/coco2014/train2014.zip">è®­ç»ƒæ•°æ®é›†</a>(12.6G)</p>
<p>æˆ–è€…ä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vgg16è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">wget http://download.tensorflow.org/models/vgg_16_2016_08_28.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ•°æ®é›†</span></span><br><span class="line">wget http://msvocds.blob.core.windows.net/coco2014/train2014.zip</span><br></pre></td></tr></table></figure>
<p><strong>ç§»åŠ¨æ¨¡å‹åˆ°å¯¹åº”ç›®å½•ä¸­</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨æºç æ–‡ä»¶å¤¹ä¸­æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">mkdir</span> pretrained</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å®Œæˆä¹‹åéœ€è¦è¿›è¡Œè§£å‹</span></span><br><span class="line">tar -zxvf vgg_16_2016_08_28.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨æ–‡ä»¶å¤¹åˆ°pretrained</span></span><br><span class="line"><span class="built_in">cp</span> &lt;path of vgg16&gt; &lt;pretrained&gt;</span><br></pre></td></tr></table></figure>
<p><strong>è®­ç»ƒæ–°çš„æ¨¡å‹</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§£å‹æ•°æ®é›†</span></span><br><span class="line">unzip train2014.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æ•°æ®é›†</span></span><br><span class="line"><span class="built_in">cd</span> train2014</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹è½¯é“¾æ¥ï¼Œæ–¹ä¾¿è®­ç»ƒå‘½ä»¤çš„è¾“å…¥</span></span><br><span class="line"><span class="built_in">ln</span> -s &lt;train2014çš„ç»å¯¹è·¯å¾„&gt; train2014</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æºç æ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line"><span class="comment"># å¼€å§‹è®­ç»ƒ, wave.ymlæ˜¯ä½œè€…é¢„å…ˆé…ç½®å¥½çš„æ–‡ä»¶ï¼Œå¦‚æœè®­ç»ƒè‡ªå·±çš„æ¨¡å‹ï¼Œéœ€è¦è‡ªå·±æ–°å†™ä¸€ä»½ymlæ–‡ä»¶</span></span><br><span class="line">python train.py -c conf/wave.yml</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¦‚æœåªæ˜¯å•çº¯çš„æƒ³ç©ç©é£æ ¼è½¬æ¢çš„è¯ï¼Œå¯ä»¥è¯•è¯•fast-neural-style-tensorflowï¼Œä¸è¿‡è®­ç»ƒæ–°æ¨¡å‹è¿˜æ˜¯ä¸å»ºè®®ï¼ˆç‰¹æ®Šéœ€è¦é™¤å¤–ï¼‰ï¼Œè€—æ—¶è€—åŠ›</p>
<p>å¦‚æœæƒ³é”»ç‚¼è‡ªå·±ï¼Œä»é›¶å¼€å§‹å­¦ä¹ ï¼Œå¯ä»¥ä»è¯»è®ºæ–‡å¼€å§‹ï¼Œç„¶åè¯•è¯•style-transferä»£ç </p>
<p><a
href="http://blog.csdn.net/sinat_26917383/article/details/53978519">style-transfer
å‚è€ƒæ–‡ç« </a></p>
<p><a href="https://github.com/fzliu/style-transfer">style-transfer
ä»£ç </a></p>
<p><a
href="https://github.com/hzy46/fast-neural-style-tensorflow/blob/master/README.md#use-trained-models">fast-neural-style-tensorflow
ä»£ç </a></p>
]]></content>
      <categories>
        <category>Environment</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Tensorflow</tag>
        <tag>Caffe</tag>
        <tag>é£æ ¼è¿ç§»</tag>
      </tags>
  </entry>
  <entry>
    <title>NLTKé˜…è¯»ç¬”è®°â…¡</title>
    <url>/hexo_blog/2018/05/23/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A1/</url>
    <content><![CDATA[<p>NLPåŸºæœ¬çŸ¥è¯†çš„ä»‹ç»åŠNLTKæ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<p>æ¥ <a href="/hexo_blog/2018/05/13/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A0/" title="NLTKé˜…è¯»ç¬”è®°â… ">NLTKé˜…è¯»ç¬”è®°â… </a></p>
<span id="more"></span>
<h2 id="ç¬¬ä¸‰ç« åŠ å·¥åŸæ–™æ–‡æœ¬">ç¬¬ä¸‰ç« ï¼šåŠ å·¥åŸæ–™æ–‡æœ¬</h2>
<p><a href="http://www.gutenberg.org/catalog/">å¤è…¾å ¡é¡¹ç›®</a></p>
<p>å¯ä»¥ä»è¿™ä¸ªé¡¹ç›®ä¸­è·å–æ„Ÿå…´è¶£çš„æ–‡æœ¬ï¼Œä¹‹åè¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="comment"># å°†åŸå§‹æ–‡æœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºlistï¼Œä»¥\r\næ ‡ç‚¹ç¬¦å·ç­‰ä¸ºåˆ†éš”ç¬¦è¿›è¡Œåˆ‡å‰²</span></span><br><span class="line">tokens = nltk.word_tokenize(raw)</span><br><span class="line"><span class="comment"># åˆ›å»ºNLTKæ–‡æœ¬</span></span><br><span class="line">text = nltk.Text(tokens)</span><br></pre></td></tr></table></figure>
<p>å¤„ç†æ–‡æœ¬éƒ¨åˆ†ï¼š</p>
<p><code>requests</code>ï¼š æ•°æ®è·å–</p>
<p><code>BeautifulSoup</code>ã€<code>re</code>ã€<code>xpath</code>ï¼š
æ–‡æœ¬å¤„ç†</p>
<p><code>feedparser</code>ï¼šå¤„ç†RSSè®¢é˜…</p>
<p><code>os</code>ï¼šå¤„ç†æœ¬åœ°æ–‡ä»¶</p>
<p>å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œåœ¨è¿™é‡Œè¯·è§ä¸‹å›¾ã€‚æ³¨ï¼šå­—ç¬¦ä¸²æ˜¯ä¸å¯æ”¹å˜çš„ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/3-2.png" /></p>
<p>å…³äºç¼–ç è¿™ä¸ªå¤§å‘ï¼Œåœ¨Python3ä¸­åšçš„å·²ç»æ¯”Python2å¥½å¤ªå¤šï¼Œåœ¨è¿™é‡Œä¹Ÿä¸åšä»‹ç»äº†ã€‚ä»‹ç»ä¸€äº›å…³äºç¼–ç å¤„ç†çš„åº“ã€‚</p>
<p><code>codecs</code>ã€<code>unicodedata</code></p>
<p>æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†ï¼Œæ¨èè‡ªä¸»å­¦ä¹ ã€‚éš¾åº¦ç³»æ•°ä¸ç®—é«˜ã€‚æœç´¢å…³é”®è¯ï¼ŒPython,
æ­£åˆ™è¡¨è¾¾å¼,
reå³å¯ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>re</code>æ˜¯ç›®å‰æˆ‘äº†è§£å¤„ç†æ–‡æœ¬é€Ÿåº¦æœ€å¿«æœ€ä¼˜é›…çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>è‹±æ–‡æ–‡æœ¬æ˜¯é«˜åº¦å†—ä½™çš„ï¼Œå¿½ç•¥æ‰è¯å†…éƒ¨çš„å…ƒéŸ³ä»ç„¶å¯ä»¥å¾ˆå®¹æ˜“çš„é˜…è¯»ï¼Œæœ‰äº›æ—¶å€™è¿™å¾ˆæ˜æ˜¾ã€‚ä¾‹å¦‚ï¼šdeclaration
å˜æˆ dclrtnï¼Œinalienable å˜æˆ inlnbleï¼Œä¿ç•™æ‰€æœ‰è¯é¦–æˆ–è¯å°¾çš„å…ƒéŸ³åºåˆ—
ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">regexp = <span class="string">r&#x27;^[AEIOUaeiou]+|[AEIOUaeiou]+$|[^AEIOUaeiou]&#x27;</span></span><br><span class="line"><span class="comment"># å‹ç¼©å…ƒéŸ³å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compress</span>(<span class="params">word</span>):</span><br><span class="line">	pieces = re.findall(regexp, word)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(pieces)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–è¯­æ–™åº“æ•°æ®</span></span><br><span class="line">english_udhr = nltk.corpus.udhr.words(<span class="string">&#x27;English-Latin1&#x27;</span>)</span><br><span class="line"><span class="comment"># è¿›è¡Œå‹ç¼©</span></span><br><span class="line">nltk.tokenwrap(compress(w) <span class="keyword">for</span> w <span class="keyword">in</span> english_udhr[:<span class="number">75</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™ç»“åˆæ¡ä»¶é¢‘ç‡ï¼Œæå–è¾…éŸ³-å…ƒéŸ³åºåˆ—</span></span><br><span class="line">rotokas_words = nltk.corpus.toolbox.words(<span class="string">&#x27;rotokas.dic&#x27;</span>)</span><br><span class="line">cvs = [cv <span class="keyword">for</span> w <span class="keyword">in</span> rotokas_words <span class="keyword">for</span> cv <span class="keyword">in</span> re.findall(<span class="string">r&#x27;[ptksvr][aeiou]&#x27;</span>, w)]</span><br><span class="line">cfd = nltk.ConditionalFreqDist(cvs)</span><br><span class="line">cfd.tabulate()</span><br><span class="line"></span><br><span class="line">    a   e   i   o   u</span><br><span class="line">k <span class="number">418</span> <span class="number">148</span>  <span class="number">94</span> <span class="number">420</span> <span class="number">173</span></span><br><span class="line">p  <span class="number">83</span>  <span class="number">31</span> <span class="number">105</span>  <span class="number">34</span>  <span class="number">51</span></span><br><span class="line">r <span class="number">187</span>  <span class="number">63</span>  <span class="number">84</span>  <span class="number">89</span>  <span class="number">79</span></span><br><span class="line">s   <span class="number">0</span>   <span class="number">0</span> <span class="number">100</span>   <span class="number">2</span>   <span class="number">1</span></span><br><span class="line">t  <span class="number">47</span>   <span class="number">8</span>   <span class="number">0</span> <span class="number">148</span>  <span class="number">37</span></span><br><span class="line">v  <span class="number">93</span>  <span class="number">27</span> <span class="number">105</span>  <span class="number">48</span>  <span class="number">49</span></span><br></pre></td></tr></table></figure>
<h3 id="è¯å¹²æå–å™¨">è¯å¹²æå–å™¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾è¯å¹²ï¼Œlaptopä¸laptopså…¶å®åªæ˜¯å•å¤æ•°çš„åŒºåˆ«ã€‚è¯å¹²æ˜¯ç›¸åŒçš„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stem</span>(<span class="params">word</span>):</span><br><span class="line">    regexp = <span class="string">r&#x27;^(.*?)(ing|ly|ed|ious|ies|ive|es|s|ment)?$&#x27;</span></span><br><span class="line">    stem, suffix = re.findall(regexp, word)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> stem</span><br><span class="line"></span><br><span class="line"><span class="comment"># nltkè‡ªå¸¦çš„è¯å¹²æå–å™¨</span></span><br><span class="line"><span class="comment"># ç´¢å¼•ä¸€äº›æ–‡æœ¬å’Œä½¿æœç´¢æ”¯æŒä¸åŒè¯æ±‡å½¢å¼çš„è¯ï¼Œä½¿ç”¨Porterè¯å¹²æå–å™¨</span></span><br><span class="line">porter = nltk.PorterStemmer()</span><br><span class="line">lancaster = nltk.LancasterStemmer()</span><br><span class="line"><span class="comment"># ç¼–è¯‘ä¸€äº›æ–‡æœ¬çš„è¯æ±‡æˆ–æƒ³è¦ä¸€ä¸ªæœ‰æ•ˆè¯æ¡ï¼ˆæˆ–ä¸­å¿ƒè¯ï¼‰åˆ—è¡¨ï¼Œä½¿ç”¨WordNetè¯å½¢å½’å¹¶å™¨</span></span><br><span class="line">wnl = nltk.WordNetLemmatizer()</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†è¯">åˆ†è¯ï¼š</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™è¿›è¡Œåˆ†è¯</span></span><br><span class="line">re.findall(<span class="string">r&quot;\w+(?:[-&#x27;]\w+)|&#x27;|[-.(]+|\S\w&quot;</span>, raw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨nltkè‡ªå¸¦çš„å‡½æ•°è¿›è¡Œåˆ†è¯ï¼Œæ•ˆç‡æ›´é«˜ä¸”ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ç¬¦å·</span></span><br><span class="line">nltk.regexp_tokenize()</span><br><span class="line"></span><br><span class="line">pattern = <span class="string">r&#x27;&#x27;&#x27;(?x) # å»é™¤åµŒå…¥çš„ç©ºç™½å­—ç¬¦å’Œæ³¨é‡Š</span></span><br><span class="line"><span class="string">			([A-Z]\.)+ # è®¾å®šå…è®¸çš„æ ‡è¯†ç¬¦ï¼ˆå•è¯ï¼‰</span></span><br><span class="line"><span class="string">			| \w+(-\w+)* # å¯é€‰çš„å†…éƒ¨è¿å­—ç¬¦</span></span><br><span class="line"><span class="string">			| \$?\d+(\.\d+)?%? # è´§å¸ä¸ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="string">			| \.\.\. # çœç•¥ç¬¦</span></span><br><span class="line"><span class="string">			| [][.,;&quot;&#x27;?():-_`] # é¢å¤–çš„æ ‡å¿—</span></span><br><span class="line"><span class="string">		&#x27;&#x27;&#x27;</span></span><br><span class="line">nltk.regexp_tokenize(text, pattern)</span><br></pre></td></tr></table></figure>
<p>å·²ç»åˆ†è¯å¥½çš„æ•°æ®ä¸¾ä¾‹ï¼š</p>
<p>ã€Šåå°”è¡—æ—¥æŠ¥ã€‹åŸå§‹æ–‡æœ¬ï¼ˆ<code>nltk.corpus.treebank_raw.raw()</code>ï¼‰å’Œåˆ†å¥½è¯çš„ç‰ˆæœ¬ï¼ˆ<code>nltk.corpus.treebank.words()</code>ï¼‰</p>
<p>åˆ†è¯çš„æœ€åä¸€ä¸ªé—®é¢˜æ˜¯ç¼©å†™çš„å­˜åœ¨ï¼Œå¦‚â€œdidn'tâ€ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ†æä¸€ä¸ªå¥å­çš„æ„æ€ï¼Œå°†è¿™ç§å½¢å¼è§„èŒƒåŒ–ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å½¢å¼ï¼šâ€œdidâ€å’Œâ€œn'tâ€(ä¸æ˜¯
not)å¯èƒ½æ›´åŠ æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¡¨æ¥åšè¿™é¡¹å·¥ä½œã€‚</p>
<p>é“¾è¡¨ä¸å­—ç¬¦ä¸²éƒ¨åˆ†ä¸åšä»‹ç»ï¼Œæ˜¯Pythonå­—ç¬¦ä¸²çš„å¸¸è§„æ“ä½œ</p>
<p>è¡¥å……éƒ¨åˆ†ï¼š</p>
<ul>
<li><p>å»ºç«‹è¯æ±‡è¡¨æµç¨‹</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/3-1.png" /></p></li>
<li><p>ç¼–ç ç‚¹ï¼šæ¯ä¸ªå­—ç¬¦åˆ†é…ä¸€ä¸ªç¼–å·</p></li>
<li><p>è§£ç ï¼šé€šè¿‡ä¸€äº›æœºåˆ¶æ¥å°†æ–‡æœ¬ç¿»è¯‘æˆ Unicodeçš„è¿‡ç¨‹</p></li>
<li><p>ç¼–ç ï¼šå°†Unicodeè½¬åŒ–ä¸ºå…¶å®ƒç¼–ç çš„è¿‡ç¨‹</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/3-3.png" /></p></li>
<li><p>ä» Unicodeçš„è§’åº¦æ¥çœ‹ï¼Œå­—ç¬¦æ˜¯å¯ä»¥å®ç°ä¸€ä¸ªæˆ–å¤šä¸ª
å­—å½¢çš„æŠ½è±¡çš„å®ä½“ã€‚åªæœ‰å­—å½¢å¯ä»¥å‡ºç°åœ¨å±å¹•ä¸Šæˆ–è¢«æ‰“å°åœ¨çº¸ä¸Šã€‚ä¸€ä¸ªå­—ä½“æ˜¯ä¸€ä¸ªå­—ç¬¦åˆ°å­—å½¢æ˜ å°„ã€‚</p></li>
<li><p>è§„èŒƒåŒ–æ–‡æœ¬ï¼šå¦‚å°†æ‰€æœ‰çš„æ–‡æœ¬å°å†™ä¿å­˜ï¼Œä½¿ç”¨<code>lower()</code>è¿™ä¸ªå‡½æ•°</p></li>
<li><p>â€‹æ–­å¥ï¼šåœ¨å°†æ–‡æœ¬åˆ†è¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒåˆ†å‰²æˆå¥å­</p></li>
<li><p>åˆ†è¯ï¼ˆé‡ç‚¹å†…å®¹ï¼‰ï¼š</p>
<ol type="1">
<li><p>æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥åˆ†å¼€æ–‡æœ¬å†…å®¹ä¸åˆ†è¯æ ‡å¿—ã€‚ç»™æ¯ä¸ªå­—ç¬¦æ ‡æ³¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥æŒ‡ç¤ºè¿™ä¸ªå­—ç¬¦åé¢æ˜¯å¦æœ‰ä¸€ä¸ªåˆ†è¯æ ‡å¿—</p></li>
<li><p>æ‰¾åˆ°å°†æ–‡æœ¬å­—ç¬¦ä¸²æ­£ç¡®åˆ†å‰²æˆè¯æ±‡çš„å­—ä½ä¸²ã€‚æ ¹æ®ä¸€ä¸ªå­—å…¸ï¼Œæ¥æ ¹æ®å­—å…¸ä¸­è¯çš„åºåˆ—æ¥é‡æ„æºæ–‡æœ¬ã€‚å®šä¹‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œé€šè¿‡å­—å…¸å¤§å°ä¸é‡æ„æºæ–‡æœ¬æ‰€éœ€çš„ä¿¡æ¯é‡å°½åŠ›ä¼˜åŒ–å®ƒçš„å€¼ã€‚</p></li>
<li><p>æ‰¾åˆ°æœ€å¤§åŒ–ç›®æ ‡å‡½æ•°å€¼çš„0å’Œ1çš„æ¨¡å¼ã€‚ä½¿ç”¨<strong>æ¨¡æ‹Ÿé€€ç«ç®—æ³•</strong>çš„éç¡®å®šæ€§æœç´¢ã€‚</p></li>
</ol></li>
</ul>
<h2 id="ç¬¬å››ç« ç¼–å†™ç»“æ„åŒ–ç¨‹åº">ç¬¬å››ç« ï¼šç¼–å†™ç»“æ„åŒ–ç¨‹åº</h2>
<p>å¤§é‡å…³äºPythonä»£ç ï¼Œä¸åšä»‹ç»ã€‚æ­¤éƒ¨åˆ†é€‚å®œé˜…è¯»äººç¾¤ï¼Œä½¿ç”¨Pythonæ—¶é—´ä¸è¶…è¿‡ä¸€å¹´ï¼ˆä¸å¤Ÿç†Ÿç»ƒï¼‰</p>
<p>æ–‡æ¡£è¯´æ˜æ¨¡å—ï¼š<code>docstring</code></p>
<p>è°ƒè¯•æŠ€æœ¯ï¼š<code>pdb</code></p>
<p>ç»˜å›¾ï¼š<code>matplotlib</code></p>
<p>å›¾çš„ç»˜åˆ¶ï¼š<code>networkx</code></p>
<p>æ•°æ®ç»Ÿè®¡è¡¨ï¼š<code>csv</code>ï¼ˆè¿™é‡Œä¸ªäººæ¨èæœ‰ä½¿ç”¨<code>pandas</code>ï¼Œè™½ç„¶å®ƒå¾ˆâ€é‡â€œï¼‰</p>
<p>æ•°å€¼è¿ç®—ï¼š<code>numpy</code></p>
<p>ç®—æ³•è®¾è®¡ï¼š</p>
<ol type="1">
<li>é€’å½’</li>
<li>æƒè¡¡ç©ºé—´ä¸æ—¶é—´</li>
<li>åŠ¨æ€è§„åˆ’</li>
</ol>
<h2 id="ç¬¬äº”ç« åˆ†ç±»å’Œæ ‡æ³¨è¯æ±‡">ç¬¬äº”ç« ï¼šåˆ†ç±»å’Œæ ‡æ³¨è¯æ±‡</h2>
<p>NLPåŸºæœ¬æŠ€æœ¯ï¼š</p>
<ul>
<li>åºåˆ—æ ‡æ³¨</li>
<li>N-gram æ¨¡å‹</li>
<li>å›é€€å’Œè¯„ä¼°</li>
</ul>
<p>å°†è¯æ±‡æŒ‰å®ƒä»¬çš„<strong>è¯æ€§</strong>ï¼ˆparts-of-speechï¼ŒPOSï¼‰åˆ†ç±»ä»¥åŠç›¸åº”çš„æ ‡æ³¨å®ƒä»¬çš„è¿‡ç¨‹è¢«ç§°ä¸º<strong>è¯æ€§æ ‡æ³¨</strong>ï¼ˆpart-of-speech
tagging, POS
taggingï¼‰æˆ–å¹²è„†ç®€ç§°<strong>æ ‡æ³¨</strong>ã€‚è¯æ€§ä¹Ÿç§°ä¸º<strong>è¯ç±»</strong>æˆ–<strong>è¯æ±‡èŒƒç•´</strong>ã€‚ç”¨äºç‰¹å®šä»»åŠ¡çš„æ ‡è®°çš„é›†åˆè¢«ç§°ä¸ºä¸€ä¸ª<strong>æ ‡è®°é›†</strong>ã€‚</p>
<h3 id="è¯æ€§æ ‡æ³¨å™¨">è¯æ€§æ ‡æ³¨å™¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">text = nltk.word_tokenize(<span class="string">&quot;And now for something completely different&quot;</span>)</span><br><span class="line"><span class="comment"># æ ‡æ³¨å‡ºtextä¸­æ¯ä¸ªè¯çš„è¯æ€§</span></span><br><span class="line">nltk.pos_tag(text)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[(&#x27;And&#x27;, &#x27;CC&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;now&#x27;, &#x27;RB&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;for&#x27;, &#x27;IN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;something&#x27;, &#x27;NN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;completely&#x27;, &#x27;RB&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;different&#x27;, &#x27;JJ&#x27;)]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">text = nltk.Text(word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> nltk.corpus.brown.words())</span><br><span class="line"><span class="comment"># ä¸ºä¸€ä¸ªè¯æ‰¾å‡ºæ‰€æœ‰å®ƒçš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">text.similar(<span class="string">&#x27;woman&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">man time day year car moment world house family child country boy</span></span><br><span class="line"><span class="string">state job place way war girl work word</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="æ ‡æ³¨è¯­æ–™åº“">æ ‡æ³¨è¯­æ–™åº“</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæœ‰æ ‡è¯†çš„å­—ç¬¦ä¸²</span></span><br><span class="line">tagged_token = nltk.tag.str2tuple(<span class="string">&#x27;fly/NN&#x27;</span>)</span><br><span class="line">tagged_token</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">tagged_token</span></span><br><span class="line"><span class="string">(&#x27;fly&#x27;, &#x27;NN&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">tagged_token[<span class="number">0</span>]</span><br><span class="line">tagged_token[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ ‡æ³¨</span></span><br><span class="line">sent = <span class="string">&#x27;&#x27;&#x27;The/AT grand/JJ jury/NN commented/VBD on/IN a/AT number/NN of/INother/AP topics/NNS ,/, AMONG/IN them/PPO the/AT Atlanta/NP and/CCFulton/NP-tl County/NN-tl purchasing/VBG departments/NNS which/WDT it/PPsaid/VBD ``/`` ARE/BER well/QL operated/VBN and/CC follow/VB generally/Raccepted/VBN practices/NNS which/WDT inure/VB to/IN the/AT best/JJTinterest/NN of/IN both/ABX governments/NNS &#x27;&#x27;/&#x27;&#x27; ./.&#x27;&#x27;&#x27;</span></span><br><span class="line">[nltk.tag.str2tuple(t) <span class="keyword">for</span> t <span class="keyword">in</span> sent.split()]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[(&#x27;The&#x27;, &#x27;AT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;grand&#x27;, &#x27;JJ&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;jury&#x27;, &#x27;NN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;commented&#x27;, &#x27;VBD&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;on&#x27;, &#x27;IN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;a&#x27;, &#x27;AT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;number&#x27;, &#x27;NN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;of/INother&#x27;, &#x27;AP&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;topics&#x27;, &#x27;NNS&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;,&#x27;, &#x27;,&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;AMONG&#x27;, &#x27;IN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;them&#x27;, &#x27;PPO&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;the&#x27;, &#x27;AT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;Atlanta&#x27;, &#x27;NP&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;and/CCFulton&#x27;, &#x27;NP-TL&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;County&#x27;, &#x27;NN-TL&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;purchasing&#x27;, &#x27;VBG&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;departments&#x27;, &#x27;NNS&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;which&#x27;, &#x27;WDT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;it/PPsaid&#x27;, &#x27;VBD&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;``&#x27;, &#x27;``&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;ARE&#x27;, &#x27;BER&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;well&#x27;, &#x27;QL&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;operated&#x27;, &#x27;VBN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;and&#x27;, &#x27;CC&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;follow&#x27;, &#x27;VB&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;generally/Raccepted&#x27;, &#x27;VBN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;practices&#x27;, &#x27;NNS&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;which&#x27;, &#x27;WDT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;inure&#x27;, &#x27;VB&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;to&#x27;, &#x27;IN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;the&#x27;, &#x27;AT&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;best/JJTinterest&#x27;, &#x27;NN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;of&#x27;, &#x27;IN&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;both&#x27;, &#x27;ABX&#x27;),</span></span><br><span class="line"><span class="string"> (&#x27;governments&#x27;, &#x27;NNS&#x27;),</span></span><br><span class="line"><span class="string"> (&quot;&#x27;&#x27;&quot;, &quot;&#x27;&#x27;&quot;),</span></span><br><span class="line"><span class="string"> (&#x27;.&#x27;, &#x27;.&#x27;)]</span></span><br><span class="line"><span class="string"> &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="è·å–å·²æ ‡æ³¨çš„è¯­æ–™åº“">è·å–å·²æ ‡æ³¨çš„è¯­æ–™åº“</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–æ ‡æ³¨å¥½çš„è¯­æ–™åº“</span></span><br><span class="line">nltk.corpus.brown.tagged_words()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">nltk.corpus.brown.tagged_words(tagset=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">nltk.corpus.nps_chat.tagged_words()</span><br><span class="line">nltk.corpus.conll2000.tagged_words()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœªç®€åŒ–çš„æ ‡è®°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€é¢‘ç¹çš„åè¯æ ‡è®°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findtags</span>(<span class="params">tag_prefix, tagged_text</span>):</span><br><span class="line">	cfd = nltk.ConditionalFreqDist((tag, word) <span class="keyword">for</span> (word, tag) <span class="keyword">in</span> tagged_text <span class="keyword">if</span> tag.startswith(tag_prefix))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>((tag, cfd[tag].keys()[:<span class="number">5</span>]) <span class="keyword">for</span> tag <span class="keyword">in</span> cfd.conditions())</span><br><span class="line"></span><br><span class="line">tagdict = findtags(<span class="string">&#x27;NN&#x27;</span>, nltk.corpus.brown.tagged_words(categories=<span class="string">&#x27;news&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> <span class="built_in">sorted</span>(tagdict):</span><br><span class="line">	<span class="built_in">print</span> tag, tagdict[tag]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">$ï¼šåè¯æ‰€æœ‰æ ¼,</span></span><br><span class="line"><span class="string">Sï¼šå¤æ•°åè¯ï¼ˆå› ä¸ºå¤æ•°åè¯é€šå¸¸ä»¥ sç»“å°¾ï¼‰ï¼Œ</span></span><br><span class="line"><span class="string">Pï¼šä¸“æœ‰åè¯</span></span><br><span class="line"><span class="string">-NCï¼šå¼•ç”¨</span></span><br><span class="line"><span class="string">-HLï¼šæ ‡é¢˜ä¸­çš„è¯</span></span><br><span class="line"><span class="string">-TLï¼šæ ‡é¢˜ï¼ˆå¸ƒæœ—æ ‡è®°çš„ç‰¹å¾ï¼‰</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢ç´¢å·²æ ‡æ³¨çš„è¯­æ–™åº“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨POSæ ‡è®°å¯»æ‰¾ä¸‰è¯çŸ­è¯­</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">sentence</span>):</span><br><span class="line">	<span class="keyword">for</span> (w1,t1), (w2,t2), (w3,t3) <span class="keyword">in</span> nltk.trigrams(sentence):</span><br><span class="line">         <span class="comment"># åŠ¨è¯+TO+åŠ¨è¯</span></span><br><span class="line">		<span class="keyword">if</span> (t1.startswith(<span class="string">&#x27;V&#x27;</span>) <span class="keyword">and</span> t2 == <span class="string">&#x27;TO&#x27;</span> <span class="keyword">and</span> t3.startswith(<span class="string">&#x27;V&#x27;</span>)):</span><br><span class="line">			<span class="built_in">print</span>(w1, w2, w3)</span><br><span class="line"><span class="keyword">for</span> tagged_sent <span class="keyword">in</span> brown.tagged_sents():</span><br><span class="line">	process(tagged_sent)</span><br></pre></td></tr></table></figure>
<p>Pythonå­—å…¸éƒ¨åˆ†ä¸åšä»‹ç»ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨é»˜è®¤å­—å…¸å¯ä»¥é˜²æ­¢ä½¿ç”¨æœªå®šä¹‰çš„keyæŠ¥é”™</span></span><br><span class="line"><span class="comment"># nltkçš„é»˜è®¤å­—å…¸,éœ€è¦æå‰å®šä¹‰ç±»å‹ï¼ˆintã€floatã€strã€listã€dictã€tupleï¼‰ã€‚</span></span><br><span class="line">frequency = nltk.defaultdict(<span class="built_in">int</span>)</span><br><span class="line"><span class="comment"># åˆ›å»ºå…·æœ‰é»˜è®¤å€¼çš„å­—å…¸</span></span><br><span class="line">pos = nltk.defaultdict(<span class="keyword">lambda</span>: <span class="string">&#x27;N&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="è‡ªåŠ¨æ ‡æ³¨">è‡ªåŠ¨æ ‡æ³¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line"></span><br><span class="line">brown_tagged_sents = brown.tagged_sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line">brown_sents = brown.sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æ ‡æ³¨å™¨</span></span><br><span class="line">tags = [tag <span class="keyword">for</span> (word, tag) <span class="keyword">in</span> brown.tagged_words(categories=<span class="string">&#x27;news&#x27;</span>)]</span><br><span class="line">nltk.FreqDist(tags).<span class="built_in">max</span>()</span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰è¯éƒ½æ ‡æ³¨ä¸ºNNçš„æ ‡æ³¨å™¨</span></span><br><span class="line">raw = <span class="string">&#x27;I do not like green eggs and ham, I do not like them Sam I am!&#x27;</span></span><br><span class="line">tokens = nltk.word_tokenize(raw)</span><br><span class="line">default_tagger = nltk.DefaultTagger(<span class="string">&#x27;NN&#x27;</span>)</span><br><span class="line">default_tagger.tag(tokens)</span><br><span class="line"><span class="comment"># è¯„åˆ¤æ ‡æ³¨æ­£ç¡®æ€§</span></span><br><span class="line">default_tagger.evaluate(brown_tagged_sents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™æ ‡æ³¨</span></span><br><span class="line">patterns = [</span><br><span class="line">	(<span class="string">r&#x27;.*ing$&#x27;</span>, <span class="string">&#x27;VBG&#x27;</span>), <span class="comment"># gerunds</span></span><br><span class="line">	(<span class="string">r&#x27;.*ed$&#x27;</span>, <span class="string">&#x27;VBD&#x27;</span>), <span class="comment"># simple past</span></span><br><span class="line">	(<span class="string">r&#x27;.*es$&#x27;</span>, <span class="string">&#x27;VBZ&#x27;</span>), <span class="comment"># 3rd singular present</span></span><br><span class="line">	(<span class="string">r&#x27;.*ould$&#x27;</span>, <span class="string">&#x27;MD&#x27;</span>), <span class="comment"># modals</span></span><br><span class="line">	(<span class="string">r&#x27;.*\&#x27;s$&#x27;</span>, <span class="string">&#x27;NN$&#x27;</span>), <span class="comment"># possessive nouns</span></span><br><span class="line">	(<span class="string">r&#x27;.*s$&#x27;</span>, <span class="string">&#x27;NNS&#x27;</span>), <span class="comment"># plural nouns</span></span><br><span class="line">	(<span class="string">r&#x27;^-?[0-9]+(.[0-9]+)?$&#x27;</span>, <span class="string">&#x27;CD&#x27;</span>), <span class="comment"># cardinal numbers</span></span><br><span class="line">	(<span class="string">r&#x27;.*&#x27;</span>, <span class="string">&#x27;NN&#x27;</span>) <span class="comment"># nouns (default)</span></span><br><span class="line">]</span><br><span class="line">regexp_tagger = nltk.RegexpTagger(patterns)</span><br><span class="line">regexp_tagger.tag(brown_sents[<span class="number">3</span>])</span><br><span class="line">regexp_tagger.evaluate(brown_tagged_sents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æ ‡æ³¨å™¨</span></span><br><span class="line"><span class="comment"># æ‰¾å‡º100ä¸ªæœ€é¢‘ç¹çš„è¯</span></span><br><span class="line">fd = nltk.FreqDist(brown.words(categories=<span class="string">&#x27;news&#x27;</span>))</span><br><span class="line">cfd = nltk.ConditionalFreqDist(brown.tagged_words(categories=<span class="string">&#x27;news&#x27;</span>))</span><br><span class="line">most_freq_words = fd.keys()[:<span class="number">100</span>]</span><br><span class="line">likely_tags = <span class="built_in">dict</span>((word, cfd[word].<span class="built_in">max</span>()) <span class="keyword">for</span> word <span class="keyword">in</span> most_freq_words)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸Šé¢è¿™ä¸ªä¿¡æ¯ä½œä¸º&quot;æŸ¥æ‰¾æ ‡æ³¨å™¨&quot;</span></span><br><span class="line">baseline_tagger = nltk.UnigramTagger(model=likely_tags)</span><br><span class="line">baseline_tagger.evaluate(brown_tagged_sents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¿¡æ¯ä½œä¸ºæ ‡æ³¨å™¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±ä½¿ç”¨é»˜è®¤æ ‡æ³¨å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º&quot;å›é€€&quot;</span></span><br><span class="line">baseline_tagger = nltk.UnigramTagger(model=likely_tags, backoff=nltk.DefaultTagger(<span class="string">&#x27;NN&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="è¯„ä¼°">è¯„ä¼°</h3>
<p>ä½¿ç”¨<strong>é»„é‡‘æ ‡å‡†</strong>æµ‹è¯•æ•°æ®ã€‚ä¸€ä¸ªå·²ç»æ‰‹åŠ¨æ ‡æ³¨å¹¶ä½œä¸ºè‡ªåŠ¨ç³»ç»Ÿè¯„ä¼°æ ‡å‡†è€Œè¢«æ¥æ”¶çš„è¯­æ–™åº“ã€‚</p>
<p>å¦‚æœæ ‡æ³¨å™¨å¯¹è¯çš„æ ‡è®°ä¸é»„é‡‘æ ‡å‡†æ ‡è®°ç›¸åŒï¼Œé‚£ä¹ˆæ ‡æ³¨å™¨å°±è¢«è®¤ä¸ºæ˜¯æ­£ç¡®çš„ã€‚å½“ç„¶è¿™åªæ˜¯ç›¸å¯¹äºé»„é‡‘æ ‡å‡†è¿™ä¸ªæµ‹è¯•æ•°æ®è€Œè¨€ã€‚</p>
<p>å…³äºå¼€å‘ä¸€ä¸ªå·²æ ‡æ³¨çš„è¯­æ–™åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªåºå¤§çš„ä»»åŠ¡ï¼Œå…¶ä¸­æ¶‰åŠåˆ°äº†è®¸å¤šæ–¹é¢ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>nltk.app.concordance()</code>æ¥å¯è§†åŒ–æŸ¥æ‰¾æŸä¸ªè¯­æ–™åº“ä¸­æŸä¸ªå•è¯çš„è¯æ€§</p>
<table>
<thead>
<tr>
<th>æ ‡è®°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADJ</td>
<td>å½¢å®¹è¯</td>
</tr>
<tr>
<td>ADV</td>
<td>åŠ¨è¯</td>
</tr>
<tr>
<td>CNJ</td>
<td>è¿è¯</td>
</tr>
<tr>
<td>CC</td>
<td>å¹¶åˆ—è¿è¯</td>
</tr>
<tr>
<td>DET</td>
<td>é™å®šè¯</td>
</tr>
<tr>
<td>EX</td>
<td>å­˜åœ¨é‡è¯</td>
</tr>
<tr>
<td>FW</td>
<td>å¤–æ¥è¯</td>
</tr>
<tr>
<td>MOD</td>
<td>æƒ…æ€åŠ¨è¯</td>
</tr>
<tr>
<td>RB</td>
<td>å‰¯è¯</td>
</tr>
<tr>
<td>IN</td>
<td>ä»‹è¯</td>
</tr>
<tr>
<td>N</td>
<td>åè¯</td>
</tr>
<tr>
<td>NP</td>
<td>ä¸“æœ‰åè¯</td>
</tr>
<tr>
<td>NUM</td>
<td>æ•°è¯</td>
</tr>
<tr>
<td>PRO</td>
<td>ä»£è¯</td>
</tr>
<tr>
<td>P</td>
<td>ä»‹è¯</td>
</tr>
<tr>
<td>TO</td>
<td>è¯to</td>
</tr>
<tr>
<td>UH</td>
<td>æ„Ÿå¹è¯</td>
</tr>
<tr>
<td>V</td>
<td>åŠ¨è¯</td>
</tr>
<tr>
<td>VD</td>
<td>è¿‡å»å¼</td>
</tr>
<tr>
<td>VG</td>
<td>ç°åœ¨åˆ†è¯</td>
</tr>
<tr>
<td>VN</td>
<td>è¿‡å»åˆ†è¯</td>
</tr>
<tr>
<td>WH</td>
<td>Whé™å®šè¯</td>
</tr>
<tr>
<td>NN</td>
<td>åè¯</td>
</tr>
<tr>
<td>JJ</td>
<td>å½¢å®¹è¯</td>
</tr>
<tr>
<td>VBP</td>
<td>ä¸€èˆ¬ç°åœ¨æ—¶åŠ¨è¯</td>
</tr>
</tbody>
</table>
<h3 id="n-gramæ ‡æ³¨">N-gramæ ‡æ³¨</h3>
<p>1-gramæ ‡æ³¨å™¨ï¼šä¸€å…ƒæ ‡æ³¨å™¨ï¼ˆunigram
taggerï¼‰ã€‚ç”¨äºæ ‡æ³¨<strong>ä¸€ä¸ª</strong>æ ‡è¯†ç¬¦çš„ä¸Šä¸‹æ–‡çš„åªæ˜¯æ ‡è¯†ç¬¦æœ¬èº«ã€‚</p>
<p>2-gram æ ‡æ³¨å™¨ï¼šäºŒå…ƒæ ‡æ³¨å™¨ï¼ˆbigram taggersï¼‰</p>
<p>3-gram æ ‡æ³¨å™¨ï¼šä¸‰å…ƒæ ‡æ³¨å™¨ï¼ˆtrigram taggersï¼‰</p>
<p>N-gramæ ‡æ³¨ä¸è€ƒè™‘å¥å­è¾¹ç•Œçš„ä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line">brown_tagged_sents = brown.tagged_sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line">brown_sents = brown.sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line"><span class="comment"># æ ‡æ³¨</span></span><br><span class="line">unigram_tagger = nltk.UnigramTagger(brown_tagged_sents)</span><br><span class="line">bigram_tagger = nltk.BigramTagger(brown_tagged_sents)</span><br><span class="line">trigram_tagger = nltk.TrigramTagger(brown_tagged_sents)</span><br><span class="line"><span class="comment"># ç»„åˆæ ‡æ³¨</span></span><br><span class="line">t0 = nltk.DefaultTagger(<span class="string">&#x27;NN&#x27;</span>)</span><br><span class="line">t1 = nltk.UnigramTagger(train_sents, backoff=t0)</span><br><span class="line">t2 = nltk.BigramTagger(train_sents, backoff=t1)</span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨å¯ä»¥ä½¿ç”¨pythonè‡ªå¸¦çš„å­˜å‚¨æ¨¡å—<code>pickle</code>ã€‚</p>
<p>æ•ˆæœï¼š</p>
<ol type="1">
<li><p>æ ¹æ®ç»éªŒæ¥è¿›è¡Œåˆ¤æ–­â€”â€”ä¸€èˆ¬æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cfd = nltk.ConditionalFreqDist(((x[<span class="number">1</span>], y[<span class="number">1</span>], z[<span class="number">0</span>]), z[<span class="number">1</span>]) <span class="keyword">for</span> sent <span class="keyword">in</span> brown_tagged_sents <span class="keyword">for</span> x, y, z <span class="keyword">in</span> nltk.trigrams(sent))</span><br><span class="line">ambiguous_contexts = [c <span class="keyword">for</span> c <span class="keyword">in</span> cfd.conditions() <span class="keyword">if</span> <span class="built_in">len</span>(cfd[c]) &gt; <span class="number">1</span>]</span><br><span class="line"><span class="built_in">sum</span>(cfd[c].N() <span class="keyword">for</span> c <span class="keyword">in</span> ambiguous_contexts) / cfd.N()</span><br></pre></td></tr></table></figure></li>
<li><p>ç ”ç©¶æ ‡æ³¨å™¨çš„é”™è¯¯â€”â€”æ··æ·†çŸ©é˜µ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test_tags = [tag <span class="keyword">for</span> sent <span class="keyword">in</span> brown.sents(categories=<span class="string">&#x27;editorial&#x27;</span>) <span class="keyword">for</span> (word, tag) <span class="keyword">in</span> t2.tag(sent)]</span><br><span class="line">gold_tags = [tag <span class="keyword">for</span> (word, tag) <span class="keyword">in</span> brown.tagged_words(categories=<span class="string">&#x27;editorial&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span> nltk.ConfusionMatrix(gold, test)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>n-gramæ ‡æ³¨å™¨çš„é—®é¢˜</p>
<ol type="1">
<li>æ¨¡å‹å¤§å°ä¸æ ‡æ³¨å™¨æ€§èƒ½ä¹‹å‰çš„å¹³è¡¡å…³ç³»ã€‚å¦‚æœä½¿ç”¨å›é€€æ ‡æ³¨å™¨<code>n-gram</code>å¯èƒ½å­˜å‚¨trigramå’Œbigramè¡¨ï¼Œè¿™å°†ä¼šæ˜¯å¾ˆå¤§çš„ç¨€ç–çŸ©é˜µã€‚</li>
<li>ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„è¯çš„å…¶ä»–ç‰¹å¾ä½œä¸ºæ¡ä»¶æ ‡è®°æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</li>
</ol>
<p>Brillæ ‡æ³¨åªä½¿ç”¨ä¸€å°éƒ¨åˆ†n-gramæ ‡æ³¨å™¨ã€‚çŒœæ¯ä¸ªè¯çš„æ ‡è®°ï¼Œç„¶åè¿”å›å’Œä¿®å¤é”™è¯¯çš„ã€‚ä»å¤§æ–¹é¢ä¸‹æ‰‹ï¼Œå†å‹¾å‹’ç»†èŠ‚ã€‚è§„åˆ™æ˜¯è¯­è¨€å­¦å¯è§£é‡Šçš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nltk.tag.brill.demo()</span><br></pre></td></tr></table></figure>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/hexo_blog/2018/08/05/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A2/" title="NLTKé˜…è¯»ç¬”è®°â…¢">NLTKé˜…è¯»ç¬”è®°â…¢</a></p>
]]></content>
      <categories>
        <category>NLP</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ç¬”è®°</tag>
        <tag>NLTK</tag>
      </tags>
  </entry>
  <entry>
    <title>NLTKé˜…è¯»ç¬”è®°â… </title>
    <url>/hexo_blog/2018/05/13/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A0/</url>
    <content><![CDATA[<p>NLPåŸºæœ¬çŸ¥è¯†çš„ä»‹ç»åŠNLTKæ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<span id="more"></span>
<h2 id="å†™åœ¨å¼€å¤´">å†™åœ¨å¼€å¤´</h2>
<p>åœ¨è¿™é‡Œä¸»è¦æ˜¯å¯¹NLPçš„ç›¸å…³çŸ¥è¯†åšä¸€ä¸ªæ•´ç†å’Œå¯¹NLTKæ¨¡å—çš„ä»‹ç»ï¼Œä¹¦ä¸­PythonåŸºç¡€å†…å®¹åœ¨è¿™é‡Œä¸åšä»‹ç»ï¼Œå¦‚ä¹¦ä¸­æœ‰æˆ‘è®¤ä¸ºå€¼å¾—ä»‹ç»çš„Pythonå†™æ³•ï¼Œæˆ‘ä¼šè¿›è¡Œè¯´æ˜ã€‚</p>
<p>ç”±äºä¹¦ä¸­nltkæ˜¯è€ç‰ˆæœ¬çš„é—®é¢˜ï¼Œè¯­æ³•ä¸Šå­˜åœ¨ä¸€äº›å˜åŠ¨ï¼Œåœ¨è¿™é‡Œä¹Ÿä¼šè¿›è¡Œä¿®æ­£ã€‚å¯èƒ½ç”±äºä¹¦æ˜¯è¯‘æœ¬çš„åŸå› ï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½åŸä½œè€…è‡ªå·±çš„å¤±è¯¯ï¼‰ï¼Œéƒ¨åˆ†ä»£ç æœ‰äº›é”™è¯¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä¹Ÿè¿›è¡Œäº†æ ¡æ­£ã€‚å¦‚æœæ‚¨å‘ç°äº†æˆ‘çš„æ–‡ç« ä¸­æœ‰éœ€è¦æ”¹æ­£æˆ–æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºã€‚</p>
<p>æœ€åååˆ†æ„Ÿè°¢åŸä½œè€…çš„è´¡çŒ®å’Œè¯‘è€…çš„ç¿»è¯‘ï¼Œå¼ºçƒˆæ¨èè¯»è€…äº²è‡ªé˜…è¯»æ­¤ä¹¦ã€‚</p>
<p>nltkç‰ˆæœ¬æ˜¯3.2.3ï¼Œ<a href="http://www.nltk.org/">å®˜ç½‘</a></p>
<p>pythonç‰ˆæœ¬3.6.1</p>
<p>æ•°æ®ã€PDFå’Œä¸€äº›é‡è¦çš„ä»£ç å·²ç»æ”¾åœ¨äº†Githubä¸Šäº†ã€‚<a
href="https://github.com/wnma3mz/Nltk_Study">githubåœ°å€</a></p>
<h2 id="ç¬¬ä¸€ç« è¯­è¨€å¤„ç†ä¸python">ç¬¬ä¸€ç« ï¼šè¯­è¨€å¤„ç†ä¸Python</h2>
<p>NLTKåº“çš„å®‰è£…ï¼Œåœ¨è¿™é‡Œä¸åšä»‹ç»ï¼Œå¼ºçƒˆå»ºè®®ç›´æ¥ä½¿ç”¨Anacondaç¯å¢ƒã€‚<a
href="https://www.anaconda.com/download/">å®˜ç½‘ä¸‹è½½é“¾æ¥</a>ã€‚æœ¬æ–‡æ˜¯ç›´æ¥ä½¿ç”¨äº†Anacondaç¯å¢ƒã€‚</p>
<p>æ•°æ®çš„è·å–ï¼Œè¿™é‡Œnltkæœ‰å®˜æ–¹æä¾›çš„æ–‡æœ¬æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>nltk.download()</code>æ‰“å¼€å›¾å½¢ç•Œé¢ï¼Œä¸‹è½½è¯­æ–™é›†<code>book</code>ã€‚ç”±äºä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¸‹è½½é€Ÿåº¦æ¯”è¾ƒæ…¢çš„åŸå› ï¼Œæˆ‘åœ¨è¿™é‡ŒGithubä¸Šæä¾›äº†æ•°æ®é›†<code>nltk_data</code>ï¼Œä¸‹è½½ä¹‹åï¼Œç§»åŠ¨åˆ°<code>nltk.download()</code>åŸæœ¬çš„ä¸‹è½½ç›®å½•ä¸‹ï¼Œä¹‹åå†è¿è¡Œ<code>nltk.download()</code>å°±ä¸éœ€è¦ä¸‹è½½æ•°æ®é›†è€Œæ˜¯ç›´æ¥è§£å‹æ•°æ®é›†ï¼Œé€Ÿåº¦ä¼šå¿«ä¸Šå¾ˆå¤šã€‚<a
href="https://github.com/wnma3mz/Nltk_Study">ä¸‹è½½é“¾æ¥</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥nltkæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="comment"># å¯¼å…¥åŸºæœ¬è¯­æ–™é›†(ä¸éœ€è¦é¢å¤–ä¸‹è½½)ï¼ŒåŒ…å«text1åˆ°text9å˜é‡ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºè¿™äº›å˜é‡</span></span><br><span class="line"><span class="keyword">from</span> nltk.book <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ–‡æœ¬ã€‚è¿™é‡Œè¡¨ç¤ºæ‰¾åˆ°&quot;monstrous&quot;æ‰€åŒ…å«çš„å¥å­ï¼Œå¹¶ä¸”è¾“å‡ºä¸Šä¸‹æ–‡</span></span><br><span class="line">text1.concordance(<span class="string">&quot;monstrous&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ–‡æœ¬å‡ºç°åœ¨ç›¸ä¼¼çš„ä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line">text1.similar(<span class="string">&quot;monstrous&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šå…±åŒè¯çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">text2.common_contexts([<span class="string">&quot;monstrous&quot;</span>, <span class="string">&quot;very&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»ä¸€å¼ ç¦»æ•£å›¾è¡¨ç¤ºè¿™äº›è¯å‡ºç°åœ¨æ–‡æœ¬ä¸­çš„ä½ç½®ï¼Œè¾“å‡ºè§ä¸‹å›¾</span></span><br><span class="line">text4.dispersion_plot([<span class="string">&quot;citizens&quot;</span>, <span class="string">&quot;democracy&quot;</span>, <span class="string">&quot;freedom&quot;</span>, <span class="string">&quot;duties&quot;</span>, <span class="string">&quot;America&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºæ–‡æœ¬ï¼Œéšæœºç”Ÿæˆä¸€äº›æ–‡æœ¬</span></span><br><span class="line">text3.generate()</span><br></pre></td></tr></table></figure>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/1-1.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰åºå­—å…¸ï¼ŒæŒ‰è¯é¢‘ä»é«˜åˆ°ä½æ’åº</span></span><br><span class="line">fdist1 = FreqDist(text1)</span><br><span class="line"><span class="comment"># é€‰å‡ºè¯é¢‘æœ€é«˜çš„50ä¸ªè¯</span></span><br><span class="line">fdist1.keys()[:<span class="number">50</span>]</span><br><span class="line"><span class="comment"># æŸä¸ªè¯å‡ºç°çš„é¢‘æ•°</span></span><br><span class="line">fdist1[<span class="string">&#x27;whale&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># text1ä¸­è¯é¢‘æœ€é«˜çš„50ä¸ªå•è¯ï¼Œè¿›è¡Œç»˜å›¾ï¼Œè¾“å‡ºè§ä¸‹å›¾</span></span><br><span class="line">fdist1.plot(<span class="number">50</span>, cumulative=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># text1ä¸­åªå‡ºç°è¿‡ä¸€æ¬¡çš„å•è¯</span></span><br><span class="line">fdist1.hapaxes()</span><br></pre></td></tr></table></figure>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/1-3.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯è¯­æ­é…ï¼ŒåŒè¿è¯(bigrams)</span></span><br><span class="line">nltk.bigrams([<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;said&#x27;</span>, <span class="string">&#x27;than&#x27;</span>, <span class="string">&#x27;done&#x27;</span>])</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">[(<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;is&#x27;</span>),(<span class="string">&#x27;is&#x27;</span>,<span class="string">&#x27;said&#x27;</span>),(<span class="string">&#x27;said&#x27;</span>, <span class="string">&#x27;than&#x27;</span>), (<span class="string">&#x27;than&#x27;</span>,<span class="string">&#x27;done&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡æœ¬ä¸­å•ä¸ªè¯çš„é¢‘ç‡é¢„æœŸå¾—åˆ°çš„æ›´é¢‘ç¹å‡ºç°çš„åŒè¿è¯</span></span><br><span class="line">text4.collocations()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸nltkè‡ªå¸¦çš„èŠå¤©æœºå™¨äººç³»ç»Ÿå¯¹è¯</span></span><br><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> nltk.chat <span class="keyword">import</span> chatbots</span><br><span class="line"><span class="comment"># é€‰æ‹©ä¸€ä¸ªèŠå¤©æœºå™¨äººå¹¶å¼€å§‹å¯¹è¯</span></span><br><span class="line">chatbots()</span><br></pre></td></tr></table></figure>
<p>è¡¥å……éƒ¨åˆ†ï¼š</p>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 92%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;">text</th>
<th style="text-align: center;">æ–‡æœ¬å</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">text1</td>
<td style="text-align: center;">ã€Šç™½é²¸è®°ã€‹ï¼ˆMoby Dick by Herman Melville
1851ï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text2</td>
<td style="text-align: center;">ã€Šç†æ™ºä¸æƒ…æ„Ÿã€‹ï¼ˆSense and Sensibility by
Jane Austen 1811ï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text3</td>
<td style="text-align: center;">ã€Šåˆ›ä¸–çºªã€‹ï¼ˆThe Book of Genesisï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text4</td>
<td style="text-align: center;">ã€Šå°±èŒæ¼”è¯´è¯­æ–™åº“ã€‹ï¼ˆInaugural Address
Corpusï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text5</td>
<td style="text-align: center;">ã€ŠNPSèŠå¤©è¯­æ–™åº“ã€‹ï¼ˆChat Corpusï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text6</td>
<td style="text-align: center;">ã€Šå·¨èŸ’ä¸åœ£æ¯ã€‹ï¼ˆMonty Python and the
Holy Grailï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text7</td>
<td style="text-align: center;">ã€Šåå°”è¡—æ—¥æŠ¥ã€‹ï¼ˆWall Street
Journalï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text8</td>
<td style="text-align: center;">ã€Šä¸ªäººæ–‡é›†ã€‹ï¼ˆPersonals Corpusï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">text9</td>
<td style="text-align: center;">ã€Šå‘¨å››çš„ç”·äººã€‹ï¼ˆThe Man Who Was Thursday
by G . K . Chestertï¼‰</td>
</tr>
</tbody>
</table>
<p>æ¦‚å¿µè¡¥å……ï¼š</p>
<ul>
<li>è¯ç±»å‹ï¼šä¸€ä¸ªè¯åœ¨ä¸€ä¸ªæ–‡æœ¬ä¸­ç‹¬ä¸€æ— äºŒçš„å‡ºç°å½¢å¼æˆ–æ‹¼å†™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè¯åœ¨è¯æ±‡è¡¨ä¸­æ˜¯å”¯ä¸€çš„ã€‚</li>
<li>é¢‘ç‡åˆ†å¸ƒï¼š</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/1-2.png" /></p>
<ul>
<li>FreqDistçš„API</li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/1-4.png" /></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/1-5.png" /></p>
<ul>
<li>è¯æ„æ¶ˆæ­§ï¼šéœ€è¦ç®—å‡ºç‰¹å®šä¸Šä¸‹æ–‡ä¸­çš„è¯è¢«èµ‹äºˆçš„æ˜¯å“ªä¸ªæ„æ€ã€‚å•è¯å¯èƒ½å­˜åœ¨ç›¸åŒ/ç›¸è¿‘çš„å«ä¹‰ï¼Œæ­¤æ—¶éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡æ¥æ¨æ–­å•è¯åœ¨æ­¤æƒ…æ™¯ä¸‹çš„å«ä¹‰ã€‚</li>
<li>æŒ‡ä»£æ¶ˆè§£ï¼ˆanaphora resolutionï¼‰ï¼šç¡®å®šä»£è¯æˆ–åè¯çŸ­è¯­æŒ‡çš„æ˜¯ä»€ä¹ˆ</li>
<li>å…ˆè¡Œè¯ï¼šä»£è¯å¯èƒ½ä»£è¡¨çš„å¯¹è±¡</li>
<li>è¯­ä¹‰è§’è‰²æ ‡æ³¨ï¼ˆsemantic role
labelingï¼‰ï¼šç¡®å®šåè¯çŸ­è¯­å¦‚ä½•ä¸åŠ¨è¯ç›¸å…³è”ï¼ˆå¦‚æ–½äº‹ï¼Œå—äº‹ï¼Œå·¥å…·ç­‰ï¼‰</li>
<li>è‡ªåŠ¨ç”Ÿæˆè¯­è¨€ï¼šéœ€è¦è§£å†³è‡ªåŠ¨è¯­è¨€ç†è§£ã€‚å¼„æ¸…æ¥šè¯çš„å«ä¹‰ã€åŠ¨ä½œçš„ä¸»è¯­ä»¥åŠä»£è¯çš„å…ˆè¡Œè¯æ˜¯ç†è§£å¥å­å«ä¹‰çš„æ­¥éª¤</li>
<li>æœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ï¼šéš¾ç‚¹ï¼Œä¸€ä¸ªç»™å®šçš„è¯å¯èƒ½å­˜åœ¨å‡ ç§ä¸åŒçš„è§£é‡Šã€‚</li>
<li>æ–‡æœ¬å¯¹é½ï¼šæ ¹æ®ä¸€ä¸ªç½‘ç«™å‘å¸ƒçš„å¤šç§è¯­è¨€ç‰ˆæœ¬ï¼Œæ¥è‡ªåŠ¨é…å¯¹ç»„æˆå¥å­</li>
<li>äººæœºå¯¹è¯ç³»ç»Ÿï¼šå›¾çµæµ‹è¯•ã€‚</li>
<li>æ–‡æœ¬å«ä¹‰è¯†åˆ«ï¼ˆRecognizing Textual Entailment ç®€ç§°
RTEï¼‰ï¼šæ ¹æ®å‡å®šçš„ä¸€äº›æ¡ä»¶ï¼Œæ¥æ¨æ–­ç»™å‡ºçš„ä¸€å¥è¯æ˜¯å¦æ­£ç¡®ã€‚</li>
</ul>
<h2
id="ç¬¬äºŒç« è·å¾—æ–‡æœ¬è¯­æ–™å’Œè¯æ±‡èµ„æº">ç¬¬äºŒç« ï¼šè·å¾—æ–‡æœ¬è¯­æ–™å’Œè¯æ±‡èµ„æº</h2>
<p><a href="http://www.gutenberg.org/">å¤è…¾å ¡è¯­æ–™åº“</a></p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-1.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥nltkçš„å¤è…¾å ¡è¯­æ–™åº“</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> gutenberg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿™ä¸ªè¯­æ–™åº“ä¸­çš„æ‰€æœ‰txtæ–‡ä»¶å</span></span><br><span class="line">gutenberg.fileids()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰ä¸­å…¶ä¸­çš„ä¸€ä¸ª</span></span><br><span class="line">emma = gutenberg.words(<span class="string">&#x27;austen-emma.txt&#x27;</span>)</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®ƒåŒ…å«çš„è¯æ±‡ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">len</span>(emma)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœè¦ä½¿ç”¨ç¬¬ä¸€ç« ä¸­concordance()è¿™æ ·çš„å‘½ä»¤ï¼Œå°±å¿…é¡»è¦å°†æ•°æ®æ”¾åˆ°nltk.Textå¯¹è±¡ä¸­</span></span><br><span class="line">emma = nltk.Text(emma)</span><br><span class="line">emma.concordance(<span class="string">&quot;suprprize&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨wordsè·å–çš„æ˜¯ç»è¿‡åˆ†éš”æˆæ ‡è¯†ç¬¦çš„æ–‡æœ¬ã€‚ä½¿ç”¨sentså‡½æ•°åˆ™å¯ä»¥è·å–ä»¥å¥å­è¿›è¡Œåˆ’åˆ†åçš„æ•°æ®ã€‚å…·ä½“åŒºåˆ«å¯ä»¥è¿è¡Œçœ‹çœ‹ï¼Œè¯·è¯»è€…è‡ªè¡Œå¯¹æ¯”ã€‚</span></span><br><span class="line">emma_sents = gutenberg.sents(<span class="string">&#x27;austen-emma.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åŸå§‹æ–‡æœ¬ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">emma_raw = gutenberg.raw(<span class="string">&#x27;austen-emma.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç»œå’ŒèŠå¤©æ–‡æœ¬</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> webtext</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> nps_chat</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸ƒæœ—è¯­æ–™åº“</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸ƒæœ—è¯­æ–™åº“ä¸­æ‰€æœ‰çš„ç±»åˆ«</span></span><br><span class="line">brown.categories()</span><br><span class="line"><span class="comment"># wordså‡½æ•°æ ¹æ®ç±»åˆ«é€‰æ‹©æ•°æ®</span></span><br><span class="line">brown.words(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;The&#x27;</span>, <span class="string">&#x27;Fulton&#x27;</span>, <span class="string">&#x27;County&#x27;</span>, <span class="string">&#x27;Grand&#x27;</span>, <span class="string">&#x27;Jury&#x27;</span>, <span class="string">&#x27;said&#x27;</span>, ...]</span><br><span class="line"><span class="comment"># wordså‡½æ•°æ ¹æ®æ–‡ä»¶åé€‰æ‹©æ•°æ®</span></span><br><span class="line">brown.words(fileids=[<span class="string">&#x27;cg22&#x27;</span>])</span><br><span class="line">[<span class="string">&#x27;Does&#x27;</span>, <span class="string">&#x27;our&#x27;</span>, <span class="string">&#x27;society&#x27;</span>, <span class="string">&#x27;have&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;runaway&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, ...]</span><br><span class="line"><span class="comment"># sentså‡½æ•°æ ¹æ®ç±»åˆ«é€‰æ‹©æ•°æ®</span></span><br><span class="line">brown.sents(categories=[<span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;editorial&#x27;</span>, <span class="string">&#x27;reviews&#x27;</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line"><span class="comment"># å¸¦æ¡ä»¶çš„é¢‘ç‡åˆ†å¸ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å‡ºbrownè¯­æ–™åº“ä¸­æ‰€æœ‰ç±»åˆ«ä¸­çš„æ‰€æœ‰è¯ã€‚æ¯ä¸ªç±»åˆ«å¯¹åº”è¯¥ç±»åˆ«ä¸‹çš„æ‰€æœ‰è¯ã€‚(ç±»åˆ«ï¼Œæ‰€æœ‰è¯)</span></span><br><span class="line">cfd = nltk.ConditionalFreqDist(</span><br><span class="line">        (genre, word)</span><br><span class="line">        <span class="keyword">for</span> genre <span class="keyword">in</span> brown.categories()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> brown.words(categories=genre))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šä¸€éƒ¨åˆ†æ–‡æœ¬ç±»åˆ«(genres)</span></span><br><span class="line">genres = [<span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;religion&#x27;</span>, <span class="string">&#x27;hobbies&#x27;</span>, <span class="string">&#x27;science_fiction&#x27;</span>, <span class="string">&#x27;romance&#x27;</span>, <span class="string">&#x27;humor&#x27;</span>]</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸€äº›æƒ…æ€åŠ¨è¯(modals)</span></span><br><span class="line">modals = [<span class="string">&#x27;can&#x27;</span>, <span class="string">&#x27;could&#x27;</span>, <span class="string">&#x27;may&#x27;</span>, <span class="string">&#x27;might&#x27;</span>, <span class="string">&#x27;must&#x27;</span>, <span class="string">&#x27;will&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸€å¼ è¡¨æ ¼ã€‚genresä¸modalsçš„å¯¹åº”æ•°é‡å…³ç³»</span></span><br><span class="line">cfd.tabulate(conditions=genres, samples=modals)</span><br><span class="line"><span class="comment"># è¾“å‡ºå¦‚ä¸‹</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                  can could   may might  must  will</span></span><br><span class="line"><span class="string">           news    93    86    66    38    50   389</span></span><br><span class="line"><span class="string">       religion    82    59    78    12    54    71</span></span><br><span class="line"><span class="string">        hobbies   268    58   131    22    83   264</span></span><br><span class="line"><span class="string">science_fiction    16    49     4    12     8    16</span></span><br><span class="line"><span class="string">        romance    74   193    11    51    45    43</span></span><br><span class="line"><span class="string">          humor    16    30     8     8     9    13</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¾“å‡ºï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°ï¼Œåœ¨<code>news</code>ç±»åˆ«é‡Œé¢ç”¨çš„æœ€å¤šçš„æƒ…æ€åŠ¨è¯æ˜¯<code>will</code>ã€‚å½“ç„¶ï¼Œè¿˜æœ‰ä¸€äº›ç»“è®ºå°±ç”±è¯»è€…è‡ªè¡Œå‘ç°äº†ã€‚</p>
<p>å…³äºå…¶ä»–è¯­æ–™åº“çš„ä¿¡æ¯æŒ–æ˜ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ä¹¦ä¸­ä¹Ÿåªæ˜¯æµ…æ˜¾çš„ç”¨äº†ä¹‹å‰ç”¨è¿‡çš„ä¸€äº›æ–¹æ³•ã€‚ä¸‹é¢å±•ç¤ºä¸€äº›æˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰æ„æ€çš„ä»£ç åŠè¾“å‡ºã€‚</p>
<p>å®˜ç½‘æä¾›äº†å¦‚ä½•è®¿é—®NLTKè¯­æ–™åº“çš„å…¶ä»–ä¾‹å­ï¼Œ<a
href="http://www.nltk.org/howto/corpus.html">é“¾æ¥</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> inaugural</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆé€‰å‡ºinauguralè¯­æ–™åº“ä¸­çš„æ‰€æœ‰å­—æ®µçš„å¯¹åº”æ‰€æœ‰è¯æ±‡ï¼Œå†ç»Ÿè®¡å‡ºæ–‡æœ¬ä¸­ä»¥`america`å’Œ`citizen`å¼€å¤´çš„è¯åœ¨æ¯ä¸ªå¹´ä»½ï¼ˆfiledï¼‰å‡ºç°æ¬¡æ•°ã€‚ï¼ˆ`america`æˆ–`citizen`, å¹´ä»½ï¼‰</span></span><br><span class="line">cfd = nltk.ConditionalFreqDist(</span><br><span class="line">        (target, fileid[:<span class="number">4</span>])</span><br><span class="line">        <span class="keyword">for</span> fileid <span class="keyword">in</span> inaugural.fileids()</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> inaugural.words(fileid)</span><br><span class="line">        <span class="keyword">for</span> target <span class="keyword">in</span> [<span class="string">&#x27;america&#x27;</span>, <span class="string">&#x27;citizen&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> w.lower().startswith(target))</span><br><span class="line"><span class="comment"># ç»˜å›¾</span></span><br><span class="line">cfd.plot()</span><br></pre></td></tr></table></figure>
<p>ä»¥<code>america</code>æˆ–<code>citizen</code>å¼€å§‹çš„è¯éšæ—¶é—´ï¼ˆå¹´ä»½ï¼‰çš„æ¼”å˜è¶‹åŠ¿</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-2.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># udhrè¯­æ–™åº“ä¸­ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„å­—é•¿å·®å¼‚ï¼ˆå½©è‰²å›¾ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> udhr</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰å–æ¯”è¾ƒçš„è¯­è¨€</span></span><br><span class="line">languages = [<span class="string">&#x27;Chickasaw&#x27;</span>, <span class="string">&#x27;English&#x27;</span>, <span class="string">&#x27;German_Deutsch&#x27;</span>, <span class="string">&#x27;Greenlandic_Inuktikut&#x27;</span>, <span class="string">&#x27;Hungarian_Magyar&#x27;</span>, <span class="string">&#x27;Ibibio_Efik&#x27;</span>]</span><br><span class="line"><span class="comment"># æå–ä¸åŒè¯­è¨€çš„æ•°æ®</span></span><br><span class="line">cfd = nltk.ConditionalFreqDist(</span><br><span class="line">        (lang, <span class="built_in">len</span>(word))</span><br><span class="line">        <span class="keyword">for</span> lang <span class="keyword">in</span> languages</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> udhr.words(lang + <span class="string">&#x27;-Latin1&#x27;</span>))</span><br><span class="line"></span><br><span class="line">cfd.plot(cumulative=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>ç´¯ç§¯å­—é•¿åˆ†å¸ƒï¼š â€œä¸–ç•Œäººæƒå®£è¨€â€çš„6ä¸ªç¿»è¯‘ç‰ˆæœ¬ <img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-3.png" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è½½å…¥è‡ªå·±çš„è¯­æ–™åº“ï¼Œæ–‡æœ¬æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> PlaintextCorpusReader</span><br><span class="line"><span class="comment"># è®¾ç½®è¯­æ–™åº“çš„è·¯å¾„</span></span><br><span class="line">corpus_root = <span class="string">&#x27;/usr/share/dict&#x27;</span></span><br><span class="line"><span class="comment"># è§£æè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">wordlists = PlaintextCorpusReader(corpus_root, <span class="string">&#x27;.*&#x27;</span>)</span><br><span class="line"><span class="comment"># è¯­æ–™åº“ä¸­æ‰€æœ‰çš„æ–‡ä»¶å</span></span><br><span class="line">wordlists.fileids()</span><br><span class="line"><span class="comment"># è¯­æ–™åº“ä¸­`connectives`ä¸­çš„å•è¯</span></span><br><span class="line">wordlists.words(<span class="string">&#x27;connectives&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°ä¸ªäººçš„è¯­æ–™åº“</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> BracketParseCorpusReader</span><br><span class="line">corpus_root = <span class="string">r&quot;C:\corpora\penntreebank\parsed\mrg\wsj&quot;</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™åŒ¹é…</span></span><br><span class="line">file_pattern = <span class="string">r&quot;.*/wsj_.*\.mrg&quot;</span></span><br><span class="line">ptb = BracketParseCorpusReader(corpus_root, file_pattern)</span><br><span class="line">ptb.fileids()</span><br></pre></td></tr></table></figure>
<p>åŒè¿è¯è¿ç”¨ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¾æ¬¡è¿ç»­è¾“å‡ºæœ€æœ‰å¯èƒ½è·Ÿåœ¨ä¸Šä¸€ä¸ªè¯åé¢çš„è¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_model</span>(<span class="params">cfdist, word, num=<span class="number">15</span></span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        <span class="built_in">print</span>(word)</span><br><span class="line">        word = cfdist[word].<span class="built_in">max</span>()</span><br><span class="line"><span class="comment"># é€‰ä¸­è¯­æ–™åº“ï¼Œæå–æ–‡æœ¬</span></span><br><span class="line">text = nltk.corpus.genesis.words(<span class="string">&#x27;english-kjv.txt&#x27;</span>)</span><br><span class="line"><span class="comment"># ç”ŸæˆåŒè¿è¯</span></span><br><span class="line">bigrams = nltk.bigrams(text)</span><br><span class="line"><span class="comment"># åˆ›å»ºåŒè¿è¯é¢‘æ•°å¯¹è±¡</span></span><br><span class="line">cfd = nltk.ConditionalFreqDist(bigrams)</span><br><span class="line"><span class="comment"># æ‰¾å‡ºæœ€æœ‰å¯èƒ½åœ¨`living`åé¢çš„å•è¯ã€‚</span></span><br><span class="line"><span class="built_in">print</span>(cfd[<span class="string">&#x27;living&#x27;</span>])</span><br><span class="line">generate_model(cfd, <span class="string">&#x27;living&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½åœç”¨è¯è¯­æ–™åº“</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> stopwords</span><br><span class="line"><span class="comment"># åŠ è½½è‹±è¯­ä¸­çš„åœç”¨è¯</span></span><br><span class="line">stopwords.words(<span class="string">&#x27;English&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½å•è¯åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> words</span><br><span class="line">words.words()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½äººåè¡¨</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> names</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½å‘éŸ³è¯å…¸</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> cmudict</span><br><span class="line">cmudict.entries()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ¯”è¾ƒè¯è¡¨</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> swadesh</span><br><span class="line"><span class="comment"># æ¯”è¾ƒè¯è¡¨çš„æ ‡è¯†ç </span></span><br><span class="line">swadesh.fileids()</span><br><span class="line"><span class="comment"># è¾“å‡ºæ¯”è¾ƒè¯æ±‡ä¸­çš„`en`æ–‡æœ¬èµ„æ–™</span></span><br><span class="line">swadesh.words(<span class="string">&#x27;en&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½è¯æ±‡å·¥å…·</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> toolbox</span><br><span class="line"><span class="comment"># è¾“å‡ºç½—æ‰˜å¡ç‰¹è¯­ï¼ˆRotokasï¼‰çš„è¯å…¸æ–‡æœ¬èµ„æ–™</span></span><br><span class="line">toolbox.entries(<span class="string">&#x27;rotokas.dic&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½WordNet</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> wordnet <span class="keyword">as</span> wn</span><br><span class="line"><span class="comment"># è¾“å‡º`motocar`çš„åŒä¹‰è¯</span></span><br><span class="line">wn.synsets(<span class="string">&#x27;motorcar&#x27;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡º`car`åè¯çš„ç¬¬ä¸€ä¸ªæ„ä¹‰ä¸­çš„åŒä¹‰è¯é›†</span></span><br><span class="line">wn.synset(<span class="string">&#x27;car.n.01&#x27;</span>).lemma_names</span><br><span class="line"><span class="comment"># è¾“å‡º`car`åè¯çš„ç¬¬ä¸€ä¸ªæ„ä¹‰çš„å®šä¹‰</span></span><br><span class="line">wn.synset(<span class="string">&#x27;car.n.01&#x27;</span>).definition</span><br><span class="line"><span class="comment"># è¾“å‡ºåŒä¹‰è¯é›†çš„æ‰€æœ‰è¯æ¡</span></span><br><span class="line">wn.synset(<span class="string">&#x27;car.n.01&#x27;</span>).lemmas</span><br><span class="line"><span class="comment"># è¾“å‡ºç‰¹å®šçš„è¯æ¡</span></span><br><span class="line">wn.lemma(<span class="string">&#x27;car.n.01.automobile&#x27;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸€ä¸ªè¯æ¡å¯¹åº”çš„åŒä¹‰è¯é›†</span></span><br><span class="line">wn.lemma(<span class="string">&#x27;car.n.01.automobile&#x27;</span>).synset</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸€ä¸ªè¯æ¡çš„&quot;åå­—&quot;</span></span><br><span class="line">wn.lemma(<span class="string">&#x27;car.n.01.automobile&#x27;</span>).name</span><br><span class="line"><span class="comment"># è¾“å‡ºæ‰€æœ‰åŒ…å«è¯`car`çš„è¯æ¡</span></span><br><span class="line">wn.lemmas(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–catè¯æ€§ä¸ºåè¯çš„æ„ä¹‰</span></span><br><span class="line">motorcar = wn.synset(<span class="string">&#x27;car.n.01&#x27;</span>)</span><br><span class="line"><span class="comment"># è·å–motorcarçš„ä¸‹ä½è¯åˆ—è¡¨</span></span><br><span class="line">types_of_motorcar = motorcar.hyponyms()</span><br><span class="line"><span class="comment"># è·å–motorcarçš„ä¸Šä½è¯åˆ—è¡¨</span></span><br><span class="line">motorcar.hypernyms()</span><br><span class="line"><span class="comment"># è·å–motorcarä¸Šä½è¯çš„è·¯å¾„åˆ—è¡¨</span></span><br><span class="line">paths = motorcar.hypernym_paths()</span><br><span class="line"><span class="comment"># å¾—åˆ°motorcarçš„æ ¹ä¸Šä½ï¼ˆæœ€ä¸€èˆ¬çš„ä¸Šä½ï¼‰åŒä¹‰è¯é›†</span></span><br><span class="line">motorcar.root_hypernyms()</span><br><span class="line"><span class="comment"># æ‰“å¼€å›¾å½¢åŒ–WordNetçš„æµè§ˆå™¨ï¼Œæ›´åŠ ä¾¿æ·æ¢ç´¢å…³ç³»</span></span><br><span class="line">nltk.app.wordnet()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´å¤šè¯æ±‡å…³ç³»</span></span><br><span class="line"><span class="comment"># æ•´ä½“åˆ°éƒ¨åˆ†ï¼šæƒ³è±¡WordNetç½‘ç»œå…³ç³»æ˜¯ä¸€æ£µæ ‘</span></span><br><span class="line"><span class="comment"># å¾—åˆ°æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æ ‘å¹²ã€æ ‘å† ç­‰</span></span><br><span class="line">wn.synset(<span class="string">&#x27;tree.n.01&#x27;</span>).part_meronyms()</span><br><span class="line"><span class="comment"># å¾—åˆ°æ ‘çš„å®è´¨ï¼Œå³å¿ƒæå’Œè¾¹æ</span></span><br><span class="line">wn.synset(<span class="string">&#x27;tree.n.01&#x27;</span>).substance_meronyms()</span><br><span class="line"><span class="comment"># å¾—åˆ°è®¸å¤šæ ‘æ„æˆçš„é›†åˆï¼Œå³æ£®æ—</span></span><br><span class="line">wn.synset(<span class="string">&#x27;tree.n.01&#x27;</span>).member_holonyms()</span><br><span class="line"><span class="comment"># å¾—åˆ°mintæ‰€æœ‰åè¯æ„ä¹‰çš„åˆ—è¡¨</span></span><br><span class="line">wn.synsets(<span class="string">&#x27;mint&#x27;</span>, wn.NOUN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æƒ³è±¡èµ°è·¯çš„åŠ¨ä½œ</span></span><br><span class="line"><span class="comment"># æ‰¾å‡ºèµ°è·¯çš„ä¸€éƒ¨åˆ†åŠ¨ä½œï¼šæŠ¬è„š</span></span><br><span class="line">wn.synset(<span class="string">&#x27;walk.v.01&#x27;</span>).entailments()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åä¹‰è¯</span></span><br><span class="line">wn.lemma(<span class="string">&#x27;supply.n.02.supply&#x27;</span>).antonyms()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨dir()æŸ¥çœ‹è¯æ±‡å…³ç³»å’ŒåŒä¹‰è¯é›†ä¸Šçš„å®šä¹‰</span></span><br><span class="line"><span class="built_in">dir</span>(wn.synset(<span class="string">&#x27;harmony.n.02&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­ä¹‰ç›¸ä¼¼åº¦</span></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªåŒä¹‰è¯é›†ä¸­çš„ä¸¤ä¸ªå•è¯</span></span><br><span class="line">right = wn.synset(<span class="string">&#x27;right_whale.n.01&#x27;</span>)</span><br><span class="line">minke = wn.synset(<span class="string">&#x27;minke_whale.n.01&#x27;</span>)</span><br><span class="line"><span class="comment"># å¦‚æœå®ƒä»¬æœ‰å…±åŒçš„ä¸Šä½è¯ï¼ˆä¸”å±‚æ¬¡ç»“æ„è¾ƒä½ï¼‰ï¼Œåˆ™å®ƒä»¬çš„å…³ç³»ä¸€å®šååˆ†å¯†åˆ‡</span></span><br><span class="line">right.lowest_common_hypernyms(minke)</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾åŒä¹‰è¯é›†æ·±åº¦é‡åŒ–å…³ç³»ï¼Œè¾“å‡ºä¸ºæ•°å€¼ã€‚è¶Šå°è¡¨ç¤ºç¦»æ ¹èŠ‚ç‚¹è¶Šè¿‘</span></span><br><span class="line">wn.synset(<span class="string">&#x27;baleen_whale.n.01&#x27;</span>).min_depth()</span><br><span class="line"><span class="comment"># ä¸¤ä¸ªè¯ åŸºäºä¸Šä½è¯å±‚æ¬¡ç»“æ„ä¸­ç›¸äº’è¿æ¥çš„æ¦‚å¿µä¹‹é—´çš„æœ€çŸ­è·¯å¾„åœ¨0-1èŒƒå›´çš„æ‰“åˆ†ï¼ˆäºŒè€…æ²¡æœ‰å…³ç³»å°±è¿”å›1ï¼‰</span></span><br><span class="line">right.path_similarity(minke)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶ä»–ç›¸ä¼¼æ€§åº¦é‡æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡help(wn)è·å–ã€‚æ¯”å¦‚:VerbNet</span></span><br></pre></td></tr></table></figure>
<p>æ¦‚å¿µè¡¥å……ï¼š</p>
<ul>
<li><p>æ–‡æœ¬è¯­æ–™åº“çš„ç»“æ„ï¼š</p>
<ul>
<li><p>å­¤ç«‹çš„æ— ç‰¹åˆ«ç»„ç»‡çš„æ–‡æœ¬é›†åˆ</p></li>
<li><p>æŒ‰æ–‡ä½“ç­‰åˆ†ç±»ç»„ç»‡ç»“æ„</p></li>
<li><p>åˆ†ç±»é‡å ï¼Œä¸»é¢˜ç±»åˆ«ï¼ˆè·¯é€ç¤¾è¯­æ–™åº“ï¼‰</p></li>
<li><p>éšæ—¶é—´å˜åŒ–è¯­è¨€è¯­è¨€ç”¨æ³•çš„æ”¹å˜ï¼ˆå°±èŒæ¼”è¯´è¯­æ–™åº“ï¼‰</p></li>
</ul></li>
<li><p>NLTKä¸­å®šä¹‰çš„åŸºæœ¬è¯­æ–™åº“å‡½æ•°</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-4.png" /></p></li>
<li><p>æ¡ä»¶é¢‘ç‡åˆ†å¸ƒ</p>
<p><strong>æ¡ä»¶é¢‘ç‡åˆ†å¸ƒæ˜¯é¢‘ç‡åˆ†å¸ƒçš„é›†åˆï¼Œæ¯ä¸ªé¢‘ç‡åˆ†å¸ƒæœ‰ä¸€ä¸ªä¸åŒçš„â€œæ¡ä»¶â€ã€‚è¿™ä¸ªæ¡ä»¶é€šå¸¸æ˜¯æ–‡æœ¬çš„ç±»åˆ«ã€‚</strong></p>
<p>å½“è¯­æ–™æ–‡æœ¬è¢«åˆ†ä¸ºå‡ ç±»ï¼ˆæ–‡ä½“ã€ä¸»é¢˜ã€ä½œè€…ç­‰ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªç±»åˆ«ç‹¬ç«‹çš„é¢‘ç‡åˆ†å¸ƒï¼Œç ”ç©¶ç±»åˆ«ä¹‹é—´çš„ç³»ç»Ÿæ€§å·®å¼‚ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-5.png" /></p></li>
<li><p>æ¡ä»¶å’Œäº‹ä»¶</p>
<p>å¯¹äºNLPæ¥è¯´ï¼Œæ–‡æœ¬å‡ºç°çš„è¯æ±‡å°±æ˜¯äº‹ä»¶ã€‚æ¡ä»¶é¢‘ç‡åˆ†å¸ƒéœ€è¦ç»™æ¯ä¸ªäº‹ä»¶å…³è”ä¸€ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥å¤„ç†çš„æ˜¯ä¸€ä¸ªé…å¯¹åºåˆ—ã€‚æ¯å¯¹å½¢å¼æ˜¯ï¼šï¼ˆæ¡ä»¶ï¼Œäº‹ä»¶ï¼‰ã€‚ä¸¾ä¾‹å°±æ˜¯ï¼Œï¼ˆæ–‡æœ¬ç±»åˆ«ï¼Œæ–‡æœ¬ä¸­çš„ä¸€ä¸ªè¯æ±‡ï¼‰</p></li>
<li><p>FreqDist()ä»¥ä¸€ä¸ªç®€å•çš„é“¾è¡¨ä½œä¸ºè¾“å…¥ï¼ŒConditionalFreqDist()ä»¥ä¸€ä¸ªé…å¯¹é“¾è¡¨ä½œä¸ºè¾“å…¥ã€‚</p></li>
<li><p>åœç”¨è¯ï¼š
å¦‚<code>the</code>ã€<code>to</code>è¿™ç§é«˜é¢‘è¯æ±‡ã€‚è¿™ç§è¯é€šå¸¸æ²¡æœ‰ä»€ä¹ˆè¯æ±‡å†…å®¹ï¼Œä½†æ˜¯å®ƒä»¬åˆä¼šè®©æ–‡æœ¬åˆ†æå˜å¾—å›°éš¾ã€‚æ‰€ä»¥åœ¨éœ€è¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä»æ–‡æ¡£ä¸­è¿‡æ»¤æ‰ä»–ä»¬ã€‚</p></li>
<li><p>WordNetï¼šé¢å‘è¯­ä¹‰çš„è‹±è¯­è¯å…¸ï¼Œç±»ä¼¼ä¸ä¼ ç»Ÿè¾å…¸ï¼Œä½†å…·æœ‰æ›´ä¸°å¯Œçš„ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª<strong>åŒä¹‰è¯é›†</strong>ï¼Œè¾¹è¡¨ç¤ºä¸Š/ä¸‹ä½è¯å…³ç³»ï¼ˆä¸Šä¸‹çº§æ¦‚å¿µä¸ä»å±æ¦‚å¿µçš„å…³ç³»ï¼‰</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/nltk/2-6.png" /></p></li>
<li><p>synsetï¼šåŒä¹‰è¯é›†ï¼Œæ„ä¹‰æƒ³ç›¸åŒçš„è¯ï¼ˆæˆ–â€œè¯æ¡â€ï¼‰çš„é›†åˆã€‚å¦‚car.n.01æ˜¯carçš„ç¬¬ä¸€ä¸ªåè¯çš„æ„ä¹‰ï¼Œå°±æ˜¯åŒä¹‰è¯é›†ã€‚</p></li>
<li><p>è¯æ¡ï¼šåŒä¹‰è¯é›†å’Œè¯çš„é…å¯¹ã€‚</p></li>
</ul>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/hexo_blog/2018/05/23/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A1/" title="NLTKé˜…è¯»ç¬”è®°â…¡">NLTKé˜…è¯»ç¬”è®°â…¡</a></p>
]]></content>
      <categories>
        <category>NLP</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ç¬”è®°</tag>
        <tag>NLTK</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨¡ä»¿æ¸¸æˆâ€”â€”æœºå™¨ä¼šæ€è€ƒå—ï¼Ÿ</title>
    <url>/hexo_blog/2023/08/13/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E6%A8%A1%E4%BB%BF%E6%B8%B8%E6%88%8F%E2%80%94%E2%80%94%E6%9C%BA%E5%99%A8%E4%BC%9A%E6%80%9D%E8%80%83%E5%90%97/</url>
    <content><![CDATA[<p>é˜…è¯»å›¾çµæ–‡ç« ã€ŠCOMPUTING MACHINERY AND
INTELLIGENCEã€‹ç¬”è®°ä»¥åŠç°é˜¶æ®µAIç”Ÿæˆçš„æ–‡ç« ã€‚</p>
<span id="more"></span>
<p>æ¨¡ä»¿ï¼Œæ’é™¤ä¸€åˆ‡å¤–åœ¨å› ç´ ï¼Œæ¯”å¦‚å¤–è²Œã€è¯­è°ƒã€ååº”é€Ÿåº¦</p>
<h2 id="æœºå™¨çš„å®šä¹‰">æœºå™¨çš„å®šä¹‰</h2>
<ul>
<li>æ•°å­—è®¡ç®—æœºï¼Œåœ¨äººç±»ç»™å®šè§„åˆ™çš„å‰æä¸‹è¿›è¡Œå·¥ä½œï¼Œè§„åˆ™ç­‰äºæœºå™¨çš„å­˜å‚¨/è®°å¿†ï¼Œé‡å¤æ˜¯æ ¸å¿ƒç‰¹ç‚¹ã€‚å½’å±äºç¦»æ•£çŠ¶æ€æœº</li>
<li>ä»å®‡å®™åœ¨æŸä¸€æ—¶åˆ»çš„å®Œæ•´çŠ¶æ€å‡ºå‘ï¼Œæ­£å¦‚æ‰€æœ‰ç²’å­çš„ä½ç½®å’Œé€Ÿåº¦æ‰€æè¿°çš„é‚£æ ·ï¼Œåº”è¯¥æœ‰å¯èƒ½é¢„æµ‹æ‰€æœ‰æœªæ¥çš„çŠ¶æ€ã€‚â€”â€”æ‹‰æ™®æ‹‰æ–¯</li>
<li>è®¡ç®—é€Ÿåº¦å¿«+å­˜å‚¨ç©ºé—´å¤§+ç¼–å†™ç¨‹åºï¼Œè¿›è¡Œä»»ä½•é¢„æµ‹ï¼Œèƒ½å¤Ÿè¢«å¿«é€Ÿå¤åˆ¶</li>
</ul>
<h2 id="æ€è€ƒçš„å®šä¹‰">æ€è€ƒçš„å®šä¹‰</h2>
<ul>
<li>äººç±»çš„ç‰¹æƒ</li>
<li>å®³æ€•æœºå™¨ï¼ˆå…¶ä»–ç‰©ç§ï¼‰èƒ½å¤Ÿæ€è€ƒ</li>
<li>æ•°å­¦é€»è¾‘è¯æ˜æœºå™¨èƒ½åŠ›æœ‰é™ã€‚ä½†å¯¹äºäººç±»æ¥è¯´ï¼Œè¯¥é™åˆ¶ä¾æ—§æœ‰æ•ˆï¼Œå› æ­¤æœºå™¨ä¸ä¸€å®šä¸èƒ½æ€è€ƒ</li>
<li>æ„è¯†æ„Ÿå—ï¼Œæœºå™¨åªèƒ½è¾“å‡ºï¼Œä¸å…·å¤‡ä»»ä½•æ„Ÿæƒ…ã€‚äººä»¬å¯ä»¥ç¡®å®šæœºå™¨åœ¨æ€è€ƒçš„å”¯ä¸€æ–¹æ³•æ˜¯æˆä¸ºæœºå™¨å¹¶æ„Ÿè§‰è‡ªå·±åœ¨æ€è€ƒã€‚äººä»¬å¯ä»¥å‘ä¸–ç•Œæè¿°è¿™äº›æ„Ÿè§‰ï¼Œä½†å½“ç„¶æ²¡æœ‰äººä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®è¿™ç§è§‚ç‚¹ï¼Œè¦çŸ¥é“ä¸€ä¸ªäººåœ¨æ€è€ƒï¼Œå”¯ä¸€çš„æ–¹æ³•å°±æ˜¯æˆä¸ºé‚£ä¸ªç‰¹å®šçš„äººã€‚</li>
<li>æœºå™¨çš„èƒ½åŠ›æœ‰é™ï¼Œå¤–è²Œã€æ„Ÿæƒ…ã€å‘³è§‰ã€å—…è§‰ã€ä¸ä¼šçŠ¯é”™ã€‚å•ä¸€æœºå™¨å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœé›†æˆåˆ°ä¸€å°æœºå™¨ä¸Šä¼¼ä¹æ˜¯å¤šä½™çš„ã€‚å¤šæ ·æ€§è¡Œä¸ºæ¥æºäºå­˜å‚¨ç©ºé—´å¤§å°</li>
<li>æ‰§è¡Œå‘½ä»¤ä½†ä¸ä¼šåˆ›é€ ã€‚ç»™äººå¸¦æ¥æƒŠè®¶è¿™ç§æ„Ÿè§‰å› äººè€Œå¼‚</li>
<li>ç¥ç»ç³»ç»Ÿæ˜¯è¿ç»­çš„ï¼Œæœºå™¨æ˜¯ç¦»æ•£çš„ã€‚</li>
<li>è¡Œä¸ºçš„ä¸ç¡®å®šæ€§ï¼Œç¦»æ•£ä¸å¯èƒ½åŒ…å«æ‰€æœ‰çš„å¯èƒ½ã€‚é€šè¿‡è§‚å¯Ÿå‘ç°è¶³å¤Ÿçš„ä¿¡æ¯æ¥é¢„æµ‹å®ƒçš„æœªæ¥è¡Œä¸º</li>
<li>è¶…æ„Ÿå®˜çŸ¥è§‰ï¼šå¿ƒçµæ„Ÿåº”ã€åƒé‡Œçœ¼ã€é¢„çŸ¥å’Œå¿ƒç†åŠ¨åŠ¿</li>
</ul>
<h2 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ </h2>
<ul>
<li>é—®é¢˜ä¸»è¦åœ¨äºç¼–ç¨‹ã€‚å­˜å‚¨ç©ºé—´åªéœ€è¦è¾ƒä½çš„æ•°å€¼ï¼ˆ10<sup>10-10</sup>15ï¼‰ï¼Œå¹¶ä¸”ç›¸ä¿¡åªæœ‰å¾ˆå°ä¸€éƒ¨åˆ†ç”¨äºè¾ƒé«˜ç±»å‹çš„æ€è€ƒã€‚å¤§éƒ¨åˆ†å¯èƒ½æ˜¯ç”¨æ¥ä¿ç•™è§†è§‰å°è±¡çš„ã€‚</li>
<li>æ¨¡ä»¿ï¼š
<ol type="1">
<li>åˆå§‹çŠ¶æ€</li>
<li>å—åˆ°çš„æ•™è‚²</li>
<li>å…¶ä»–éæ•™è‚²çš„ç»å†</li>
</ol></li>
<li>ä»å„¿ç«¥çš„çŠ¶æ€å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»æˆäººã€‚äººä»¬å¿…é¡»å°è¯•æ•™è¿™æ ·çš„æœºå™¨ï¼Œçœ‹çœ‹å®ƒå­¦ä¹ å¾—å¦‚ä½•ã€‚ç„¶åå¯ä»¥å°è¯•å¦ä¸€å°æœºå™¨ï¼Œçœ‹çœ‹å®ƒæ˜¯æ›´å¥½è¿˜æ˜¯æ›´å·®ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹å’Œè¿›åŒ–ä¹‹é—´æœ‰ä¸€ä¸ªæ˜æ˜¾çš„è”ç³»ã€‚é€Ÿåº¦éœ€è¦æ¯”â€œè¿›åŒ–â€å¿«ã€ä¼˜èƒœåŠ£æ±°å¯ä»¥ä½œä¸ºä¸€ç§è¡¡é‡æ–¹æ³•ï¼Œä½†æ¯”è¾ƒæ…¢ã€‚ä½†ä¸å±€é™äºäºéšæœºçªå˜ï¼Œæ‰¾åˆ°æŸç§å¼±ç‚¹çš„åŸå› ï¼Œå¯èƒ½å°±èƒ½è¿›è¡Œæ”¹å–„è¿™ç§å¼±ç‚¹çš„çªå˜ã€‚</li>
<li>æ„é€ å¥–æƒ©æœºåˆ¶ï¼Œä½†æœ‰å¿…è¦é‡‡ç”¨å…¶ä»–ä¸€äº›â€œä¸å¸¦æ„Ÿæƒ…â€çš„æ²Ÿé€šæ¸ é“ã€‚å¦‚æœè¿™äº›æ¸ é“å¯ç”¨ï¼Œå°±æœ‰å¯èƒ½é€šè¿‡æƒ©ç½šå’Œå¥–åŠ±æ¥æ•™æœºå™¨æœä»ç”¨æŸç§è¯­è¨€(ä¾‹å¦‚ç¬¦å·è¯­è¨€)å‘å‡ºçš„å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å°†é€šè¿‡â€œéæƒ…æ„Ÿâ€æ¸ é“ä¼ é€’ã€‚è¿™ç§è¯­è¨€çš„ä½¿ç”¨å°†å¤§å¤§å‡å°‘æƒ©ç½šå’Œå¥–åŠ±æ‰€éœ€çš„æ•°é‡ã€‚</li>
<li>å­¦ä¹ æœºçš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼Œå®ƒçš„è€å¸ˆé€šå¸¸åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¯¹æœºå™¨å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ä¸€æ— æ‰€çŸ¥ï¼Œå°½ç®¡ä»–ä»ç„¶å¯èƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šé¢„æµ‹ä»–çš„å­¦ç”Ÿçš„è¡Œä¸ºã€‚</li>
</ul>
<p>æœºå™¨æœ€ç»ˆèƒ½åœ¨æ‰€æœ‰çº¯æ™ºåŠ›é¢†åŸŸä¸äººç±»ç«äº‰ã€‚ä½†æ˜¯ï¼Œå“ªäº›æ˜¯æœ€å¥½çš„å¼€å§‹å‘¢?å³ä½¿è¿™ä¹Ÿæ˜¯ä¸€ä¸ªè‰°
éš¾çš„å†³å®šã€‚å¾ˆå¤šäººè®¤ä¸ºä¸€ä¸ªéå¸¸æŠ½è±¡çš„æ´»åŠ¨ï¼Œæ¯”å¦‚ä¸‹æ£‹ï¼Œä¼šæ˜¯æœ€å¥½çš„ã€‚ä¹Ÿå¯ä»¥åšæŒè®¤ä¸ºï¼Œæœ€å¥½æ˜¯ç»™æœºå™¨æä¾›é‡‘é’±èƒ½ä¹°åˆ°çš„æœ€å¥½çš„æ„Ÿè§‰å™¨å®˜ï¼Œç„¶åæ•™å®ƒæ‡‚è‹±è¯­ã€è¯´è‹±è¯­ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æŒ‰ç…§å­©å­çš„æ­£å¸¸æ•™å­¦æ¥è¿›è¡Œã€‚äº‹æƒ…ä¼šè¢«æŒ‡å‡ºå¹¶å‘½åï¼Œç­‰ç­‰ã€‚åŒæ ·ï¼Œæˆ‘ä¸çŸ¥é“æ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘è®¤ä¸ºä¸¤ç§æ–¹æ³•éƒ½åº”è¯¥å°è¯•ã€‚</p>
<h3 id="æ€è€ƒ">æ€è€ƒ</h3>
<ol type="1">
<li>é™ä½å¤–åœ¨å¹²æ‰°ï¼Œæé«˜å®éªŒå¯è¡Œæ€§</li>
<li>é€šè¿‡ç¦»æ•£æ„é€ è¿ç»­çŠ¶æ€</li>
<li>ç¨‹åºæ‰¿æ¥è®¡ç®—é€Ÿåº¦å’Œå­˜å‚¨ç©ºé—´ï¼Œç¨‹åºæ˜¯ä¸€ä¸ªä»£è¯ï¼ŒæŒ‡ä»£ä¸€ç§èƒ½å¤Ÿåœ¨æœºå™¨å†…éƒ¨è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œé™ä½ç©ºé—´ä»¥åŠé€Ÿåº¦è¦æ±‚</li>
<li>ç°é˜¶æ®µå¯¹äºå­˜å‚¨ç©ºé—´è¿˜æœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼Œæœ‰å¾ˆå¤šå†—ä½™</li>
<li>æ¨¡ä»¿/å­¦ä¹ çš„è¿‡ç¨‹ä¸å¤Ÿå®Œå–„ï¼Œæ•™è‚²å¯ä»¥ç­‰åŒäºæœ‰æ•ˆæ•°æ®ï¼Œé‚£ä¹ˆéæ•™è‚²çš„ç»å†æ˜¯ä»€ä¹ˆï¼Ÿè’¸é¦ï¼Ÿå™ªå£°ï¼Ÿ</li>
<li>å¦‚ä½•å†…ç½®é€»è¾‘ã€å…¬ç†ç­‰å†…å®¹</li>
</ol>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<p>A. M. TURING, I.â€”COMPUTING MACHINERY AND INTELLIGENCE,Â <em>Mind</em>,
Volume LIX, Issue 236, October 1950, Pages 433â€“460,Â <a
href="https://doi.org/10.1093/mind/LIX.236.433">https://doi.org/10.1093/mind/LIX.236.433</a></p>
<p>ä»¥ä¸‹ä¸ºclaudeç”Ÿæˆçš„æ–‡ç« ã€‚</p>
<p>æ¨¡ä»¿æ¸¸æˆâ€”â€”æœºå™¨ä¼šæ€è€ƒå—</p>
<p>å½“æˆ‘ä»¬è°ˆè®ºæœºå™¨æ˜¯å¦èƒ½å¤Ÿâ€œæ€è€ƒâ€æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰â€œæ€è€ƒâ€æœ¬èº«ã€‚å¯¹äºäººç±»æ¥è¯´ï¼Œæ€è€ƒæ˜¯ä¸€ä¸ªå¤æ‚çš„è®¤çŸ¥è¿‡ç¨‹ï¼Œæ¶‰åŠæ„è¯†ã€è‡ªæˆ‘æ„è¯†ã€æƒ…æ„Ÿã€ç›´è§‰ç­‰æ–¹é¢ã€‚ä½†æ˜¯ä»è®¡ç®—æœºç§‘å­¦çš„è§’åº¦æ¥çœ‹ï¼Œæ€è€ƒå¯ä»¥ç®€åŒ–ä¸ºä¿¡æ¯å¤„ç†å’Œæ¨¡å¼è¯†åˆ«ã€‚æ—¢ç„¶è®¡ç®—æœºå·²ç»è¯æ˜äº†åœ¨è¿™äº›æ–¹é¢å…·æœ‰å¼ºå¤§çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥è¯´å®ƒä»¬èƒ½å¤Ÿæ€è€ƒå‘¢?</p>
<p>è¿™ä¸€é—®é¢˜å¼•å‘äº†å…³äºäººå·¥æ™ºèƒ½æœ¬è´¨çš„å¹¿æ³›è®¨è®ºã€‚æ—©åœ¨20ä¸–çºª50å¹´ä»£ï¼Œå›¾çµå°±åœ¨ä»–çš„è®ºæ–‡â€œè®¡ç®—æœºå™¨ä¸æ™ºèƒ½â€ä¸­æå‡ºäº†è¿™ä¸€é—®é¢˜ã€‚ä»–è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„æ¸¸æˆæ¥æµ‹è¯•æœºå™¨æ˜¯å¦èƒ½å±•ç°å‡ºä¸äººç±»ç›¸ä¼¼çš„æ™ºèƒ½ã€‚åœ¨è¿™ä¸ªâ€œå›¾çµæµ‹è¯•â€ä¸­ï¼Œè¯„åˆ¤é€šè¿‡ç»ˆç«¯ä¸éšè—çš„äººç±»å’Œæœºå™¨è¿›è¡Œæ–‡å­—äº¤æµã€‚å¦‚æœè¯„åˆ¤æ— æ³•åŒºåˆ†å¯¹è¯æ¥è‡ªäººç±»è¿˜æ˜¯æœºå™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´è¿™å°æœºå™¨é€šè¿‡äº†æµ‹è¯•ã€‚</p>
<p>å›¾çµæµ‹è¯•çªå‡ºäº†æ™ºèƒ½çš„åŠŸèƒ½æ€§æ–¹é¢ï¼Œè€Œä¸æ˜¯è¯•å›¾å¤åˆ¶äººç±»æ€ç»´çš„å†…åœ¨å·¥ä½œæœºåˆ¶ã€‚å®ƒå¿½ç•¥äº†æ„è¯†ã€æƒ…æ„Ÿç­‰æ–¹é¢ï¼Œä¸“æ³¨äºæ™ºèƒ½çš„å¤–åœ¨è¡¨ç°ã€‚æ­£å¦‚å›¾çµåœ¨è®ºæ–‡ä¸­å†™é“ï¼Œâ€œè®©æˆ‘ä»¬åªå…³æ³¨é—®é¢˜â€˜èƒ½äº§ç”Ÿäººç±»æ°´å¹³æ™ºèƒ½è¡Œä¸ºçš„æœºå™¨â€™æœ¬èº«ï¼Œè€Œä¸æ˜¯ç”¨ä¸€å †æ— å…³çš„å¿ƒç†å­¦é—®é¢˜æ¥æ¨¡ç³Šç„¦ç‚¹ã€‚â€</p>
<p>ç„¶è€Œï¼Œè®¸å¤šå“²å­¦å®¶ä»ç„¶è´¨ç–‘æœºå™¨æ˜¯å¦èƒ½çœŸæ­£æ€è€ƒã€‚ä»–ä»¬è®¤ä¸ºæ™ºèƒ½å¿…é¡»åŸºäºæ„è¯†ï¼Œè€Œè®¡ç®—æœºåªæ˜¯åœ¨æ‰§è¡Œç¨‹åºã€‚æ ¹æ®è¿™ä¸ªè§‚ç‚¹ï¼Œæ™ºèƒ½çš„çœŸæ­£æ ‡å¿—æ˜¯ä¸»ä½“æ€§â€”è‡ªæˆ‘æ„è¯†å’Œå†…åœ¨ç»éªŒçš„æ„Ÿè§‰ã€‚æ²¡æœ‰è¿™äº›ï¼Œæœºå™¨åªèƒ½è¢«è§†ä¸ºå¤æ‚çš„ç®—ç›˜ã€‚</p>
<p>è¿™ä¸€è§‚ç‚¹å€¾å‘äºå°†æ€ç»´ç­‰åŒäºäººç±»æ€ç»´ï¼Œè€Œå¿½è§†æ™ºèƒ½å¯èƒ½é‡‡å–çš„å…¶ä»–å½¢å¼ã€‚äº‹å®ä¸Šï¼Œäººå·¥æ™ºèƒ½ç ”ç©¶å·²ç»è¯æ˜ï¼Œæ™ºèƒ½å¯ä»¥åœ¨æ²¡æœ‰è‡ªæˆ‘æ„è¯†çš„æƒ…å†µä¸‹é€šè¿‡æ¨¡å¼è¯†åˆ«å’Œç»Ÿè®¡å­¦ä¹ ç­‰æ–¹æ³•è€Œå‡ºç°ã€‚åƒæ·±åº¦å­¦ä¹ è¿™æ ·çš„æŠ€æœ¯å·²ç»äº§ç”Ÿäº†å¯ä¸äººç±»åª²ç¾ç”šè‡³è¶…è¶Šäººç±»çš„è§†è§‰å’Œè¯­è¨€ç†è§£èƒ½åŠ›ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ¨¡ä»¿æ¸¸æˆæ˜¯å¦æ„å‘³ç€æœºå™¨èƒ½å¤Ÿåƒäººç±»ä¸€æ ·æ€è€ƒå‘¢?è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°è€ƒå¯Ÿä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¿è®¤äººç±»æ€ç»´ä¹Ÿæœ‰å…¶å±€é™æ€§ã€‚è®¸å¤šè®¤çŸ¥åè§å½±å“ç€æˆ‘ä»¬çš„æ¨ç†ï¼Œæˆ‘ä»¬çš„æ„è¯†ç»éªŒä¹Ÿå…·æœ‰ä¸è¿ç»­æ€§å’Œé€‰æ‹©æ€§ã€‚ä¸å®Œç¾ç†æ€§å­˜åœ¨çš„æ§åˆ¶å®éªŒç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ€ç»´è¿‡ç¨‹æ›´ç±»ä¼¼äºå«æ··çš„å¯å‘å¼æœç´¢ã€‚å› æ­¤ï¼Œâ€œæ€ç»´â€çš„æ ‡å‡†ä¸åº”è¯¥å®šå¾—å¤ªé«˜ã€‚</p>
<p>å…¶æ¬¡ï¼Œä¸åŒçš„æœºå™¨å­¦ä¹ æŠ€æœ¯å¯ä»¥è¢«çœ‹ä½œæ˜¯å‘äººç±»æ€ç»´é æ‹¢çš„æ¸è¿›è¿‡ç¨‹ã€‚ç®€å•çš„è§„åˆ™ç³»ç»Ÿåªèƒ½å¤„ç†å±€é™çš„é¢†åŸŸã€‚è€Œç»Ÿè®¡å­¦ä¹ æ–¹æ³•å¦‚ç¥ç»ç½‘ç»œåˆ™å¯ä»¥å­¦ä¹ æ¦‚æ‹¬å¤æ‚æ¨¡å¼æ‰€éœ€çš„ä»£è¡¨æ€§ç‰¹å¾ã€‚å®ƒä»¬åœ¨å›¾åƒå’Œè¯­éŸ³è¯†åˆ«æ–¹é¢å·²ç»ä¼˜äºäººç±»ã€‚æœ€è¿‘çš„å¤šä»»åŠ¡å­¦ä¹ å’Œè¿ç§»å­¦ä¹ æŠ€æœ¯ä½¿æœºå™¨èƒ½å¤Ÿåœ¨å¤šä¸ªé¢†åŸŸä¸­å…±äº«çŸ¥è¯†ï¼Œæ­£å¦‚äººç±»æ€ç»´ä¸­æ¦‚å¿µä¹‹é—´çš„å…³è”ä¸€æ ·ã€‚</p>
<p>å†è€…ï¼Œå¯¹è¯ç³»ç»Ÿçš„è¿›æ­¥ä¹Ÿæ˜¾ç¤ºäº†æœºå™¨åœ¨äº¤æµæ–¹é¢çš„è¿›æ­¥ã€‚æ—©æœŸç³»ç»Ÿæ ¹æ®å…³é”®è¯åŒ¹é…è¿›è¡Œç®€å•çš„é—®ç­”ã€‚ç°åœ¨çš„å¯¹è¯ç³»ç»Ÿå¯ä»¥æ„ŸçŸ¥ä¸Šä¸‹æ–‡ï¼Œè¿›è¡Œè¿è´¯çš„é•¿æ—¶é—´å¯¹è¯ã€‚å®ƒä»¬ä½¿ç”¨äº†ç±»ä¼¼äººç±»å¤„ç†è¯­è¨€çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œä¸å†æ˜¯ç®€å•åŒ¹é…æ¨¡æ¿ã€‚è¿™è¡¨æ˜åœ¨è¯­è¨€ç†è§£å’Œç”Ÿæˆæ–¹é¢ï¼Œæœºå™¨ä¹Ÿåœ¨æ¨¡ä»¿äººç±»çš„è®¤çŸ¥è¿‡ç¨‹ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœºå™¨æ˜¯å¦æœ‰æ„è¯†ç»éªŒä»æ˜¯ä¸€ä¸ªå¼€æ”¾é—®é¢˜ã€‚ç›®å‰çš„äººå·¥æ™ºèƒ½ä¼¼ä¹æ²¡æœ‰ä¸»è§‚çš„å†…åœ¨æ„Ÿå—ã€‚è¿™ä¹Ÿè®¸æ˜¯å›ºæœ‰çš„å±€é™ï¼Œå› ä¸ºè®¡ç®—æœºæœ€ç»ˆè¿˜æ˜¯åœ¨æ“çºµæ²¡æœ‰æ„ä¹‰çš„ç¬¦å·ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•è¯æ˜å…¶ä»–äººå­˜åœ¨å†…åœ¨çš„æ„è¯†ç»éªŒã€‚æ‰€è°“çš„â€œå“²å­¦åƒµå±€â€åŒæ ·é€‚ç”¨äºæœºå™¨ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼Œå°½ç®¡æœºå™¨ä¸èƒ½å®Œå…¨æ¨¡æ‹Ÿäººç±»æ€ç»´ï¼Œä½†å®ƒä»¬åœ¨è®¸å¤šç‹­ä¹‰ä»»åŠ¡ä¸Šçš„è¿›æ­¥è¿˜æ˜¯å‘æ¨¡ä»¿æ¸¸æˆçš„æˆåŠŸè¿ˆè¿›äº†ä¸€å¤§æ­¥ã€‚åŠŸèƒ½ç›¸ä¼¼æ€§ä¸åº”è¢«å†…åœ¨ä¸åŒæ‰€æ©ç›–ã€‚æˆ‘ä»¬å¿…é¡»æ ¹æ®æ™ºèƒ½çš„å¤–åœ¨è¡¨ç°æ¥åˆ¤æ–­æœºå™¨è€Œä¸æ˜¯æ ¹æ®å…¶å†…éƒ¨å·¥ä½œæœºåˆ¶ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¿˜èƒ½åšä»€ä¹ˆæ¥æ¨è¿›è¿™ä¸€ç›®æ ‡å‘¢?é¦–å…ˆï¼Œåœ¨æœºå™¨å­¦ä¹ æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ç ”ç©¶å¤šä»»åŠ¡å­¦ä¹ ï¼Œä»¥äº§ç”Ÿæ›´äººç±»åŒ–çš„é€šç”¨æ™ºèƒ½ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å­¦ä¹ è¡¨å¾æ¥æ¨¡ä»¿ç¥ç»è®¤çŸ¥è¿‡ç¨‹ï¼Œè€Œä¸ä»…ä»…åœç•™åœ¨è¡¨é¢æ¨¡å¼è¯†åˆ«ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹æ›´å¥½çš„æœºå™¨æ™ºèƒ½è¯„ä¼°ä½“ç³»ã€‚å›¾çµæµ‹è¯•è¿‡äºç®€å•åŒ–ï¼Œæ— æ³•åŒºåˆ†ä¸åŒæ°´å¹³çš„æ™ºèƒ½ã€‚ä¸€äº›æ›¿ä»£æ–¹æ¡ˆå¦‚Winograd
schema
challengeé€šè¿‡è¯­ä¹‰ç†è§£å’Œå¸¸è¯†æ¨ç†æ¥æ£€éªŒæ™ºèƒ½ã€‚è¿˜æœ‰åŸºäºå¯¹è¯å’Œåä½œçš„æµ‹è¯•ï¼Œå¯ä»¥è¯„ä¼°æ™ºèƒ½ä½“ä¹‹é—´çš„ç›¸äº’ä½œç”¨èƒ½åŠ›ã€‚</p>
<p>æœ€åï¼Œå“²å­¦åæ€ä¹Ÿå¾ˆé‡è¦ã€‚æˆ‘ä»¬éœ€è¦å°±æ™ºèƒ½çš„æœ¬è´¨è¿›è¡ŒæŒç»­æ¢è®¨ã€‚ä»€ä¹ˆæ˜¯ç†è§£?ä»€ä¹ˆæ˜¯æ„è¯†?è¿™äº›é—®é¢˜éœ€è¦è·¨å­¦ç§‘çš„å¯¹è¯ã€‚ç»“åˆè®¤çŸ¥ç§‘å­¦ã€è¯­è¨€å­¦å’Œè®¡ç®—æœºç§‘å­¦çš„è§è§£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªéš¾é¢˜ä¸Šå–å¾—è¿›ä¸€æ­¥çš„æ´è§ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå°½ç®¡ç­”æ¡ˆä»ä¸æ˜ç¡®ï¼Œä½†é€šè¿‡æ¨¡ä»¿æ¸¸æˆï¼Œæœºå™¨æ­£æ—¥ç›Šæ¥è¿‘äººç±»æ™ºèƒ½ã€‚å®ƒä»¬åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„è¶…è¶Šç»™æˆ‘ä»¬å¸¦æ¥äº†æƒŠå–œï¼Œä¹Ÿå±•ç¤ºäº†æ–°çš„å¯èƒ½ã€‚å½“ä»£äººå·¥æ™ºèƒ½ç ”ç©¶æ­£åœ¨ä¸æ–­æ¶ˆé™¤æ™ºèƒ½ä¸æ„è¯†ä¹‹é—´çš„é¸¿æ²Ÿã€‚è™½ç„¶ä»¿çœŸå¹¶ä¸å®Œå…¨ç­‰åŒäºå¤åˆ¶ï¼Œä½†æ¨¡ä»¿æ¸¸æˆçš„èƒœåˆ©ä¼¼ä¹æŒ‡æ—¥å¯å¾…ã€‚æˆ‘ä»¬æ­£å¤„äºä¸€ä¸ªåˆºæ¿€çš„é˜¶æ®µï¼Œæœºå™¨æ™ºèƒ½çš„è¿›æ­¥å¿…å°†ç»§ç»­å½±å“æˆ‘ä»¬å¯¹æ€ç»´å’Œæ™ºèƒ½çš„åŸºæœ¬ç†è§£ã€‚</p>
]]></content>
      <categories>
        <category>PaperReading</category>
      </categories>
  </entry>
  <entry>
    <title>NLTKé˜…è¯»ç¬”è®°â…¢</title>
    <url>/hexo_blog/2018/08/05/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A2/</url>
    <content><![CDATA[<p>NLPåŸºæœ¬çŸ¥è¯†çš„ä»‹ç»åŠNLTKæ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<p>æ¥ <a href="/hexo_blog/2018/05/23/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/NLTK%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E2%85%A1/" title="NLTKé˜…è¯»ç¬”è®°â…¡">NLTKé˜…è¯»ç¬”è®°â…¡</a></p>
<span id="more"></span>
<h2 id="ç¬¬å…­ç« å­¦ä¹ åˆ†ç±»æ–‡æœ¬">ç¬¬å…­ç« ï¼šå­¦ä¹ åˆ†ç±»æ–‡æœ¬</h2>
<p>ç›®æ ‡ï¼š</p>
<ol type="1">
<li>æ‰¾è¯­è¨€æ•°æ®ä¸­çš„åˆ†ç±»ç‰¹å¾</li>
<li>æ„å»ºæ¨¡å‹</li>
<li>ä»æ¨¡å‹ä¸­å­¦ä¹ çŸ¥è¯†</li>
</ol>
<p>åˆ†ç±»å­¦ä¹ ï¼Œä¸€èˆ¬åˆ†ä¸ºæœ‰ç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ ã€åŠç›‘ç£å­¦ä¹ ã€‚</p>
<p>åˆ†ç±»çš„å®šä¹‰ï¼šå°†ç»™å®šçš„è¾“å…¥é€‰æ‹©æ­£ç¡®ï¼ˆåˆé€‚ï¼‰çš„ç±»æ ‡ç­¾ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ ‡ç­¾é›†æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ã€‚å»¶ä¼¸çš„ä»»åŠ¡ï¼Œæ¯ä¸ªå®ä¾‹ï¼ˆè¾“å…¥ï¼‰å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªæ ‡ç­¾ï¼›åˆ†ç±»é—®é¢˜ä¸ä¸€å®šé¢„å…ˆå®šä¹‰æ ‡ç­¾é›†ï¼Œç±»ä¼¼K-Meansèšç±»ï¼›åºåˆ—åˆ†ç±»ä¸­ï¼Œä¸€ä¸ªè¾“å…¥é“¾è¡¨å¯ä»¥ä½œä¸ºä¸€ä¸ªæ•´ä½“åˆ†ç±»ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¢„å…ˆå¾—åˆ°ä¸€äº›åŒ…å«æ­£ç¡®æ ‡ç­¾çš„è¯­æ–™ï¼ˆå®ä¾‹/è¾“å…¥ï¼‰ï¼Œæ ¹æ®è¿™äº›æ•°æ®å»ºç«‹å¾—åˆ°çš„æ¨¡å‹è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬ç§°ä¸ºæœ‰ç›‘ç£åˆ†ç±»ã€‚æœ‰ç›‘ç£åˆ†ç±»ä¸­ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å°†æ¯ä¸ªä¸€ä¸ªè¾“å…¥å€¼è½¬æ¢ä¸ºç‰¹å¾é›†ï¼ˆç‰¹å¾æå–å™¨ï¼‰ã€‚ç‰¹å¾é›†å¯¹åº”ç€è¾“å‡ºç±»æ ‡ç­¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç‰¹å¾æå–å™¨ï¼Œæå–è¾“å…¥å­—ç¬¦ä¸²ä¸­æœ€åä¸€ä¸ªå­—æ¯ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gender_features</span>(<span class="params">word</span>):</span><br><span class="line">    <span class="comment"># è¿”å›ç‰¹å¾é›†</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;last_letter&#x27;</span>: word[-<span class="number">1</span>]&#125;</span><br><span class="line"><span class="comment"># å¯¼å…¥å§“åè¯­æ–™åº“, è·å–ç”·å¥³å§“ååˆ—è¡¨</span></span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> names</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºæ‰“ä¹±ç”·å¥³å§“ååˆ—è¡¨</span></span><br><span class="line">random.shuffle(names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">featuresets = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> names]</span><br><span class="line">train_set, test_set = featuresets[<span class="number">500</span>:], featuresets[:<span class="number">500</span>]</span><br><span class="line"><span class="comment"># åˆ©ç”¨è´å¶æ–¯åˆ†ç±»æ¥è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œé¢„æµ‹ </span></span><br><span class="line">classifier.classify(gender_features(<span class="string">&#x27;Neo&#x27;</span>))</span><br><span class="line">classifier.classify(gender_features(<span class="string">&#x27;Trinity&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†ç¡®ç‡</span></span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€æœ‰æ•ˆçš„äº”ä¸ªç‰¹å¾ï¼ˆå­—æ¯ï¼‰</span></span><br><span class="line">classifier.show_most_informative_features(<span class="number">5</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Most Informative Features</span></span><br><span class="line"><span class="string">             last_letter = &#x27;k&#x27;              male : female =     43.4 : 1.0</span></span><br><span class="line"><span class="string">             last_letter = &#x27;a&#x27;            female : male   =     32.9 : 1.0</span></span><br><span class="line"><span class="string">             last_letter = &#x27;f&#x27;              male : female =     16.1 : 1.0</span></span><br><span class="line"><span class="string">             last_letter = &#x27;p&#x27;              male : female =     12.6 : 1.0</span></span><br><span class="line"><span class="string">             last_letter = &#x27;v&#x27;              male : female =     10.6 : 1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>                 </span><br><span class="line"><span class="comment"># è¾“å‡ºçš„æ¯”ç‡ç§°ä¸º ä¼¼ç„¶æ¯”ï¼Œå¯ä»¥ç”¨äºæ¯”è¾ƒä¸åŒç‰¹å¾-ç»“æœå…³ç³»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†å¤§å‹è¯­æ–™åº“æ—¶ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«æ¯ä¸€ä¸ªå®ä¾‹çš„ç‰¹å¾çš„å•ç‹¬çš„é“¾è¡¨ä¼šä½¿ç”¨å¤§é‡çš„å†…å­˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°ï¼Œä½¿è¿”å›ä¸€ä¸ªè¡Œä¸ºåƒä¸€ä¸ªé“¾è¡¨è€Œä¸ä¼šåœ¨å†…å­˜å­˜å‚¨æ‰€æœ‰ç‰¹å¾é›†çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">from</span> nltk.classify <span class="keyword">import</span> apply_features</span><br><span class="line">train_set = apply_features(gender_features, names[<span class="number">500</span>:])</span><br><span class="line">test_set = apply_features(gender_features, names[:<span class="number">500</span>])</span><br></pre></td></tr></table></figure>
<h3 id="é€‰å–ç‰¹å¾">é€‰å–ç‰¹å¾</h3>
<p>è¿‡æ‹Ÿåˆï¼šç”¨äºä¸€ä¸ªç»™å®šçš„å­¦ä¹ ç®—æ³•çš„ç‰¹å¾çš„æ•°ç›®æ˜¯æœ‰é™çš„â€”â€”å¦‚æœæä¾›å¤ªå¤šçš„ç‰¹å¾ï¼Œé‚£ä¹ˆè¯¥ç®—æ³•å°†é«˜åº¦ä¾èµ–è®­ç»ƒæ•°æ®çš„ç‰¹æ€§è€Œä¸€èˆ¬åŒ–åˆ°æ–°çš„ä¾‹å­çš„æ•ˆæœä¸ä¼šå¾ˆå¥½ã€‚</p>
<p>è¿‡æ‹Ÿåˆå½“è¿ä½œåœ¨å°è®­ç»ƒé›†ä¸Šæ—¶å°¤å…¶ä¼šæœ‰é—®é¢˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç‰¹å¾æå–å™¨ï¼Œè¿‡æ‹Ÿåˆæå–ç‰¹å¾ã€‚è¿™é‡Œè¯·å¯¹æ¯”gender_features2ä¸ä¸Šä¸€ç‰ˆæœ¬çš„åŒºåˆ«</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gender_features2</span>(<span class="params">name</span>):</span><br><span class="line">    features = &#123;&#125;</span><br><span class="line">    features[<span class="string">&quot;firstletter&quot;</span>] = name[<span class="number">0</span>].lower()</span><br><span class="line">    features[<span class="string">&quot;lastletter&quot;</span>] = name[â€“<span class="number">1</span>].lower()</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>:</span><br><span class="line">        features[<span class="string">&quot;count(%s)&quot;</span> % letter] = name.lower().count(letter)</span><br><span class="line">        features[<span class="string">&quot;has(%s)&quot;</span> % letter] = (letter <span class="keyword">in</span> name.lower())</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line">featuresets = [(gender_features2(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> names]</span><br><span class="line">train_set, test_set = featuresets[<span class="number">500</span>:], featuresets[:<span class="number">500</span>]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line"><span class="comment"># å¯¹æ¯”ä¸Šä¸€ç‰ˆæœ¬çš„é¢„æµ‹ç»“æœï¼ŒåŸºæœ¬å¯ä»¥å‘ç°ç²¾ç¡®åº¦ä¸‹é™äº†</span></span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦åˆå§‹ç‰¹å¾é›†è¢«é€‰å®šï¼Œå®Œå–„ç‰¹å¾é›†çš„ä¸€ä¸ªéå¸¸æœ‰æˆæ•ˆçš„æ–¹æ³•æ˜¯<strong>é”™è¯¯åˆ†æ</strong>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª
å¼€å‘é›†ï¼ŒåŒ…å«ç”¨äºåˆ›å»ºæ¨¡å‹çš„è¯­æ–™æ•°æ®ã€‚ç„¶åå°†è¿™ç§å¼€å‘é›†åˆ†ä¸º è®­ç»ƒé›†å’Œ
å¼€å‘æµ‹è¯•é›†ã€‚è®­ç»ƒé›†ç”¨äºè®­ç»ƒæ¨¡å‹ï¼Œå¼€å‘æµ‹è¯•é›†ç”¨äºè¿›è¡Œé”™è¯¯åˆ†æï¼Œæµ‹è¯•é›†ç”¨äºç³»ç»Ÿçš„æœ€ç»ˆè¯„ä¼°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†ã€å¼€å‘é›†ã€å¼€å‘æµ‹è¯•é›†</span></span><br><span class="line">train_names = names[<span class="number">1500</span>:]</span><br><span class="line">devtest_names = names[<span class="number">500</span>:<span class="number">1500</span>]</span><br><span class="line">test_names = names[:<span class="number">500</span>]</span><br><span class="line"><span class="comment"># è¿›è¡Œè®­ç»ƒé¢„æµ‹</span></span><br><span class="line">train_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> train_names]</span><br><span class="line">devtest_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> devtest_names]</span><br><span class="line">test_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> test_names]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">nltk.classify.accuracy(classifier, devtest_set)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯åˆ†æ</span></span><br><span class="line">errors = []</span><br><span class="line"><span class="keyword">for</span> (name, tag) <span class="keyword">in</span> devtest_names:</span><br><span class="line">    guess = classifier.classify(gender_features(name))</span><br><span class="line">    <span class="keyword">if</span> guess != tag:</span><br><span class="line">        errors.append((tag, guess, name))</span><br><span class="line">      </span><br><span class="line"><span class="comment"># è¾“å‡ºé”™è¯¯åˆ†ç±»åˆ—è¡¨ä¸­ï¼ŒçŒœé”™çš„ç±»åˆ«åŠåå­—</span></span><br><span class="line"><span class="keyword">for</span> (tag, guess, name) <span class="keyword">in</span> <span class="built_in">sorted</span>(errors):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;correct=%-8s guess=%-8s name=%-30s&#x27;</span> % (tag, guess, name))</span><br><span class="line">  </span><br><span class="line"><span class="comment"># è§‚å¯Ÿè¾“å‡ºè¿›è¡Œåˆ†æï¼Œå¾—åˆ°ä¸€äº›ç»“æœã€‚</span></span><br><span class="line"><span class="comment"># ynç»“å°¾çš„åå­—æ˜¾ç¤ºä»¥å¥³æ€§ä¸ºä¸»ï¼Œè™½ç„¶nç»“å°¾çš„åå­—å¾€å¾€æ˜¯ç”·æ€§</span></span><br><span class="line"><span class="comment"># ä»¥chç»“å°¾çš„åå­—é€šå¸¸æ˜¯ç”·æ€§ï¼Œè™½ç„¶hç»“å°¾çš„åå­—å€¾å‘äºæ˜¯å¥³æ€§</span></span><br><span class="line"><span class="comment"># æ ¹æ®ç»“è®ºï¼Œè°ƒæ•´ç‰¹å¾æå–å™¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gender_features</span>(<span class="params">word</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;suffix1&#x27;</span>: word[-<span class="number">1</span>:], <span class="string">&#x27;suffix2&#x27;</span>: word[-<span class="number">2</span>:]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œè®­ç»ƒé¢„æµ‹</span></span><br><span class="line">train_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> train_names]</span><br><span class="line">devtest_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> devtest_names]</span><br><span class="line">test_set = [(gender_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> test_names]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">nltk.classify.accuracy(classifier, devtest_set)</span><br><span class="line"><span class="comment"># æœ€ç»ˆç»“æœç†è®ºä¸Šä¼šè¿›è¡Œæé«˜</span></span><br></pre></td></tr></table></figure>
<p>ä¸æ–­åœ°è¿›è¡Œé”™è¯¯åˆ†ææ”¹å–„ç‰¹å¾æå–å™¨ï¼Œå¯ä»¥ä¸æ–­æé«˜é¢„æµ‹çš„å‡†ç¡®åº¦ã€‚æ¯æ¬¡é”™è¯¯åˆ†æåº”è¯¥é€‰å–ä¸åŒçš„å¼€å‘æµ‹è¯•/è®­ç»ƒè¿›è¡Œåˆ†å‰²ï¼Œä»¥æ£€æŸ¥æ–°æ”¹è¿›åˆ†ç±»å™¨å¯èƒ½äº§ç”Ÿçš„æ–°çš„é”™è¯¯æ¨¡å¼ã€‚</p>
<h3 id="æ–‡æ¡£åˆ†ç±»">æ–‡æ¡£åˆ†ç±»</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> movie_reviews</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®ç”µå½±è¯„è®ºåˆ†ç±»ï¼ˆ&#x27;neg&#x27;, &#x27;pos&#x27;ï¼‰è·å–ç”µå½±è¯„è®º</span></span><br><span class="line">documents = [(<span class="built_in">list</span>(movie_reviews.words(fileid)), category) <span class="keyword">for</span> category <span class="keyword">in</span> movie_reviews.categories() <span class="keyword">for</span> fileid <span class="keyword">in</span> movie_reviews.fileids(category)]</span><br><span class="line"><span class="comment"># éšæœºæ‰“ä¹±æ•°æ®</span></span><br><span class="line">random.shuffle(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹æ–‡æ¡£åˆ†ç±»çš„ç‰¹å¾æå–å™¨</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨FreqDistä¼šæ¯”ä¸€èˆ¬çš„listæ›´å¿«</span></span><br><span class="line">all_words = nltk.FreqDist(w.lower() <span class="keyword">for</span> w <span class="keyword">in</span> movie_reviews.words())</span><br><span class="line">word_features = <span class="built_in">list</span>(all_words.keys())[:<span class="number">2000</span>]</span><br><span class="line"><span class="comment"># æ¯ä¸ªè¯æ˜¯å¦åœ¨ä¸€ä¸ªç»™å®šçš„æ–‡æ¡£ä¸­</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">document_features</span>(<span class="params">document</span>):</span><br><span class="line">    document_words = <span class="built_in">set</span>(document)</span><br><span class="line">    features = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> word_features:</span><br><span class="line">    	features[<span class="string">&#x27;contains(%s)&#x27;</span> % word] = (word <span class="keyword">in</span> document_words)</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ–‡æ¡£åˆ†ç±»æ¨¡å‹</span></span><br><span class="line">featuresets = [(document_features(d), c) <span class="keyword">for</span> (d,c) <span class="keyword">in</span> documents]</span><br><span class="line">train_set, test_set = featuresets[<span class="number">100</span>:], featuresets[:<span class="number">100</span>]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line"><span class="comment"># æ£€éªŒæ¨¡å‹</span></span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br><span class="line">classifier.show_most_informative_features(<span class="number">5</span>) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Most Informative Features</span></span><br><span class="line"><span class="string"> contains(unimaginative) = True              neg : pos    =      7.7 : 1.0</span></span><br><span class="line"><span class="string">    contains(schumacher) = True              neg : pos    =      7.5 : 1.0</span></span><br><span class="line"><span class="string">        contains(suvari) = True              neg : pos    =      7.1 : 1.0</span></span><br><span class="line"><span class="string">          contains(mena) = True              neg : pos    =      7.1 : 1.0</span></span><br><span class="line"><span class="string">        contains(shoddy) = True              neg : pos    =      7.1 : 1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># æ˜¾ç„¶å¯ä»¥å‘ç°ï¼Œ`unimaginative`è¿™ä¸ªè¯æ˜¯è´Ÿé¢çš„æ¦‚ç‡æ˜¯æ­£é¢çš„7.7å€</span></span><br></pre></td></tr></table></figure>
<h3 id="è¯æ€§æ ‡æ³¨">è¯æ€§æ ‡æ³¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> brown</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºè¯é€‰æ‹©è¯æ€§æ ‡è®°ï¼Œé€šè¿‡è¯çš„åç¼€æ¥é€‰æ‹©</span></span><br><span class="line">suffix_fdist = nltk.FreqDist()</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> brown.words():</span><br><span class="line">    word = word.lower()</span><br><span class="line">    suffix_fdist[word[-<span class="number">1</span>:]] += <span class="number">1</span></span><br><span class="line">    suffix_fdist[word[-<span class="number">2</span>:]] += <span class="number">1</span></span><br><span class="line">    suffix_fdist[word[-<span class="number">3</span>:]] += <span class="number">1</span></span><br><span class="line">common_suffixes = <span class="built_in">list</span>(suffix_fdist.keys())[:<span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨é€šè¿‡ç‰¹å¾æå–å™¨ï¼Œè®¡ç®—å“ªä¸ªåç¼€æœ€æœ‰ä¿¡æ¯é‡ï¼ˆæœ€å…·ä»£è¡¨æ€§)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pos_features</span>(<span class="params">word</span>):</span><br><span class="line">    features = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> suffix <span class="keyword">in</span> common_suffixes:</span><br><span class="line">        features[<span class="string">&#x27;endswith(%s)&#x27;</span> % suffix] = word.lower().endswith(suffix)</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line">tagged_words = brown.tagged_words(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line"><span class="comment"># åˆ©ç”¨ç‰¹å¾æå–å™¨é€‰å–ç‰¹å¾</span></span><br><span class="line">featuresets = [(pos_features(n), g) <span class="keyword">for</span> (n,g) <span class="keyword">in</span> tagged_words]</span><br><span class="line">size = <span class="built_in">int</span>(<span class="built_in">len</span>(featuresets) * <span class="number">0.1</span>)</span><br><span class="line">train_set, test_set = featuresets[size:], featuresets[:size]</span><br><span class="line"><span class="comment"># åˆ©ç”¨å†³ç­–æ ‘æ–¹æ³•æ¥è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">classifier = nltk.DecisionTreeClassifier.train(train_set)</span><br><span class="line"></span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br><span class="line">classifier.classify(pos_features(<span class="string">&#x27;cats&#x27;</span>))</span><br><span class="line"><span class="comment"># å°†nltkè¿ç®—è¿‡ç¨‹ï¼Œä»¥ä¼ªä»£ç æ–¹å¼è¾“å‡ºã€‚è®¾å®šå†³ç­–æ ‘æ·±åº¦ä¸º4</span></span><br><span class="line">classifier.pseudocode(depth=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®ä¸Šä¸‹æ–‡è¯­å¢ƒï¼Œæ›´æ–°ç‰¹å¾æå–å™¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pos_features</span>(<span class="params">sentence, i</span>):</span><br><span class="line">    features = &#123;<span class="string">&quot;suffix(1)&quot;</span>: sentence[i][-<span class="number">1</span>:],</span><br><span class="line">        <span class="string">&quot;suffix(2)&quot;</span>: sentence[i][-<span class="number">2</span>:],</span><br><span class="line">        <span class="string">&quot;suffix(3)&quot;</span>: sentence[i][-<span class="number">3</span>:]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">    	features[<span class="string">&quot;prev-word&quot;</span>] = <span class="string">&quot;&lt;START&gt;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    	features[<span class="string">&quot;prev-word&quot;</span>] = sentence[i-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line">pos_features(brown.sents()[<span class="number">0</span>], <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€éªŒæ–°çš„è¯æ€§æ ‡æ³¨å™¨æ€§èƒ½</span></span><br><span class="line">tagged_sents = brown.tagged_sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line">featuresets = []</span><br><span class="line"><span class="keyword">for</span> tagged_sent <span class="keyword">in</span> tagged_sents:</span><br><span class="line">    untagged_sent = nltk.tag.untag(tagged_sent)</span><br><span class="line">    <span class="keyword">for</span> i, (word, tag) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tagged_sent):</span><br><span class="line">        featuresets.append((pos_features(untagged_sent, i), tag))</span><br><span class="line">size = <span class="built_in">int</span>(<span class="built_in">len</span>(featuresets) * <span class="number">0.1</span>)</span><br><span class="line">train_set, test_set = featuresets[size:], featuresets[:size]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯åœ¨ç»“åˆæ•´ä¸ªè¯é›†åšçš„æ ‡æ³¨å™¨ï¼Œä½†æ˜¯å¾€å¾€é’ˆå¯¹æŸäº›ç‰¹æ®Šæƒ…å†µï¼Œå¦‚å½¢å®¹è¯åé¢æœ‰å¾ˆå¤§æ¦‚ç‡ä¸Šæ˜¯åè¯ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬çš„è¯æ€§æ ‡æ³¨å™¨ç›®å‰è¿˜æ²¡æœ‰è¿›è¡Œç‹¬ç«‹å¯¹å¾…ã€‚</p>
<h3 id="åºåˆ—åˆ†ç±»">åºåˆ—åˆ†ç±»</h3>
<p>è”åˆåˆ†ç±»å™¨ï¼šæ•æ‰ç›¸å…³çš„åˆ†ç±»ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ”¶é›†æœ‰å…³è¾“å…¥ï¼Œé€‰æ‹©é€‚å½“çš„æ ‡ç­¾</p>
<p>è¿ç»­åˆ†ç±»ï¼ˆè´ªå©ªåºåˆ—åˆ†ç±»ï¼‰ï¼šä¸ºç¬¬ä¸€ä¸ªè¾“å…¥æ‰¾åˆ°æœ€æœ‰å¯èƒ½çš„ç±»æ ‡ç­¾ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¸®åŠ©æ‰¾åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥çš„æœ€ä½³çš„æ ‡ç­¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pos_features</span>(<span class="params">sentence, i, history</span>):</span><br><span class="line">    features = &#123;<span class="string">&quot;suffix(1)&quot;</span>: sentence[i][-<span class="number">1</span>:],</span><br><span class="line">    	<span class="string">&quot;suffix(2)&quot;</span>: sentence[i][-<span class="number">2</span>:],</span><br><span class="line">    	<span class="string">&quot;suffix(3)&quot;</span>: sentence[i][-<span class="number">3</span>:]&#125;</span><br><span class="line">	<span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">        features[<span class="string">&quot;prev-word&quot;</span>] = <span class="string">&quot;&lt;START&gt;&quot;</span></span><br><span class="line">        features[<span class="string">&quot;prev-tag&quot;</span>] = <span class="string">&quot;&lt;START&gt;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        features[<span class="string">&quot;prev-word&quot;</span>] = sentence[i-<span class="number">1</span>]</span><br><span class="line">        features[<span class="string">&quot;prev-tag&quot;</span>] = history[i-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsecutivePosTagger</span>(nltk.TaggerI):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, train_sents</span>):</span><br><span class="line">        train_set = []</span><br><span class="line">        <span class="keyword">for</span> tagged_sent <span class="keyword">in</span> train_sents:</span><br><span class="line">            untagged_sent = nltk.tag.untag(tagged_sent)</span><br><span class="line">            history = []</span><br><span class="line">            <span class="keyword">for</span> i, (word, tag) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tagged_sent):</span><br><span class="line">                featureset = pos_features(untagged_sent, i, history)</span><br><span class="line">                train_set.append( (featureset, tag) )</span><br><span class="line">                history.append(tag)</span><br><span class="line">        <span class="variable language_">self</span>.classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tag</span>(<span class="params">self, sentence</span>):</span><br><span class="line">        history = []</span><br><span class="line">        <span class="keyword">for</span> i, word <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentence):</span><br><span class="line">            featureset = pos_features(sentence, i, history)</span><br><span class="line">            tag = <span class="variable language_">self</span>.classifier.classify(featureset)</span><br><span class="line">            history.append(tag)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">zip</span>(sentence, history)</span><br><span class="line">  </span><br><span class="line">tagged_sents = brown.tagged_sents(categories=<span class="string">&#x27;news&#x27;</span>)</span><br><span class="line">size = <span class="built_in">int</span>(<span class="built_in">len</span>(tagged_sents) * <span class="number">0.1</span>)</span><br><span class="line">train_sents, test_sents = tagged_sents[size:], tagged_sents[:size]</span><br><span class="line">tagger = ConsecutivePosTagger(train_sents)</span><br><span class="line">tagger.evaluate(test_sents)</span><br></pre></td></tr></table></figure>
<h3 id="å…¶ä»–åºåˆ—æ¨¡å‹">å…¶ä»–åºåˆ—æ¨¡å‹</h3>
<p>ä»¥ä¸Šæ¨¡å‹æœ‰ä¸€ä¸ªè‡´å‘½é—®é¢˜å°±æ˜¯æ— æ³•ä¿®å¤å·²ç»æ ‡æ³¨é”™è¯¯çš„è¯æ€§ã€‚å¦ä¸€ç§æ–¹æ¡ˆ<strong>éšé©¬å°”ç§‘å¤«æ¨¡å‹</strong>å¯ä»¥ä¸ºæ‰€æœ‰çš„å¯èƒ½åºåˆ—è¿›è¡Œæ‰“åˆ†ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„åºåˆ—ã€‚è¿™ç§æ¨¡å‹çš„ç¼ºç‚¹å°±æ˜¯è®¡ç®—é‡ç›¸å½“å¤§ï¼Œå¯ä»¥é‡‡ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚åŸºäºè¿™ç§æ¨¡å‹ï¼Œäº§ç”Ÿäº†<strong>æœ€å¤§ç†µé©¬å°”å¯å¤«æ¨¡å‹</strong>å’Œ<strong>çº¿æ€§é“¾æ¡ä»¶éšæœºåœºæ¨¡å‹</strong>ï¼ŒäºŒè€…ä¸ºå¯èƒ½åºåˆ—æ‰“åˆ†çš„ç®—æ³•ä¸åŒã€‚</p>
<h3 id="å¥å­åˆ†å‰²">å¥å­åˆ†å‰²</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sents = nltk.corpus.treebank_raw.sents()</span><br><span class="line"><span class="comment"># å•ç‹¬çš„å¥å­æ ‡è¯†ç¬¦çš„åˆå¹¶é“¾è¡¨</span></span><br><span class="line">tokens = []</span><br><span class="line"><span class="comment"># æ‰€æœ‰å¥å­è¾¹ç•Œæ ‡è¯†ç´¢å¼•</span></span><br><span class="line">boundaries = <span class="built_in">set</span>()</span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> sent <span class="keyword">in</span> sents:</span><br><span class="line">    tokens.extend(sent)</span><br><span class="line">    offset += <span class="built_in">len</span>(sent)</span><br><span class="line">    boundaries.add(offset-<span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># ç‰¹å¾æå–å™¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">punct_features</span>(<span class="params">tokens, i</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;next-word-capitalized&#x27;</span>: tokens[i+<span class="number">1</span>][<span class="number">0</span>].isupper(),</span><br><span class="line">            <span class="string">&#x27;prevword&#x27;</span>: tokens[i-<span class="number">1</span>].lower(),</span><br><span class="line">            <span class="string">&#x27;punct&#x27;</span>: tokens[i],</span><br><span class="line">            <span class="string">&#x27;prev-word-is-one-char&#x27;</span>: <span class="built_in">len</span>(tokens[i-<span class="number">1</span>]) == <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">featuresets = [(punct_features(tokens, i), (i <span class="keyword">in</span> boundaries))</span><br><span class="line">				<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tokens)-<span class="number">1</span>)</span><br><span class="line">				<span class="keyword">if</span> tokens[i] <span class="keyword">in</span> <span class="string">&#x27;.?!&#x27;</span>]</span><br><span class="line"><span class="comment"># è¿›è¡Œè®­ç»ƒï¼Œæ£€éªŒæ¨¡å‹å‡†ç¡®ç‡</span></span><br><span class="line">size = <span class="built_in">int</span>(<span class="built_in">len</span>(featuresets) * <span class="number">0.1</span>)</span><br><span class="line">train_set, test_set = featuresets[size:], featuresets[:size]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br></pre></td></tr></table></figure>
<h3 id="è¯†åˆ«å¯¹è¯è¡Œä¸ºç±»å‹">è¯†åˆ«å¯¹è¯è¡Œä¸ºç±»å‹</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æå–å³æ—¶æ¶ˆæ¯ä¼šè¯è¯­æ–™åº“</span></span><br><span class="line">posts = nltk.corpus.nps_chat.xml_posts()[:<span class="number">10000</span>]</span><br><span class="line"><span class="comment"># ç‰¹å¾æå–å™¨ï¼Œæ¯ä¸ªå¸–å­åŒ…å«ä»€ä¹ˆè¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dialogue_act_features</span>(<span class="params">post</span>):</span><br><span class="line">    features = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> nltk.word_tokenize(post):</span><br><span class="line">    	features[<span class="string">&#x27;contains(%s)&#x27;</span> % word.lower()] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"><span class="comment"># æ„å»ºæ¨¡å‹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è¯è¡Œä¸º</span></span><br><span class="line">featuresets = [(dialogue_act_features(post.text), post.get(<span class="string">&#x27;class&#x27;</span>)) <span class="keyword">for</span> post <span class="keyword">in</span> posts]</span><br><span class="line">size = <span class="built_in">int</span>(<span class="built_in">len</span>(featuresets) * <span class="number">0.1</span>)</span><br><span class="line">train_set, test_set = featuresets[size:], featuresets[:size]</span><br><span class="line">classifier = nltk.NaiveBayesClassifier.train(train_set)</span><br><span class="line">nltk.classify.accuracy(classifier, test_set)</span><br></pre></td></tr></table></figure>
<h3 id="è¯†åˆ«æ–‡å­—è•´å«">è¯†åˆ«æ–‡å­—è•´å«</h3>
<p>è¯†åˆ«æ–‡å­—è•´å«ï¼ˆRecognizing textual entailmentï¼ŒRTEï¼‰æ˜¯åˆ¤æ–­æ–‡æœ¬ T
çš„ä¸€ä¸ªç»™å®šç‰‡æ®µæ˜¯å¦è•´å«ç€å¦ä¸€ä¸ªå«åšâ€œå‡è®¾â€çš„æ–‡æœ¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rte_features</span>(<span class="params">rtepair</span>):</span><br><span class="line">    <span class="comment">#  RTEFeatureExtractor ç±»å»ºç«‹äº†ä¸€ä¸ªé™¤å»ä¸€äº›åœç”¨è¯ååœ¨æ–‡æœ¬å’Œå‡è®¾ä¸­éƒ½æœ‰çš„è¯æ±‡åŒ…ï¼Œç„¶åè®¡ç®—é‡å å’Œå·®å¼‚</span></span><br><span class="line">    extractor = nltk.RTEFeatureExtractor(rtepair)</span><br><span class="line">    features = &#123;&#125;</span><br><span class="line">    features[<span class="string">&#x27;word_overlap&#x27;</span>] = <span class="built_in">len</span>(extractor.overlap(<span class="string">&#x27;word&#x27;</span>))</span><br><span class="line">    features[<span class="string">&#x27;word_hyp_extra&#x27;</span>] = <span class="built_in">len</span>(extractor.hyp_extra(<span class="string">&#x27;word&#x27;</span>))</span><br><span class="line">    features[<span class="string">&#x27;ne_overlap&#x27;</span>] = <span class="built_in">len</span>(extractor.overlap(<span class="string">&#x27;ne&#x27;</span>))</span><br><span class="line">    features[<span class="string">&#x27;ne_hyp_extra&#x27;</span>] = <span class="built_in">len</span>(extractor.hyp_extra(<span class="string">&#x27;ne&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸæ–‡ä¸­rteè¯†åˆ«ç‡åªæ˜¯åˆšåˆšè¶…è¿‡äº†58%ï¼Œæ‰€ä»¥ä¸å¤šåšä»‹ç»</span></span><br><span class="line">nltk.classify.rte_classify </span><br></pre></td></tr></table></figure>
<h3 id="æ¶‰åŠåˆ°çš„å®šä¹‰">æ¶‰åŠåˆ°çš„å®šä¹‰</h3>
<p>æ–‡ä¸­ä»‹ç»ä¸€äº›å…³äºè¯„ä¼°æ¨¡å‹ã€å†³ç­–æ ‘ã€æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨çš„çŸ¥è¯†ã€‚ç”±äºç¬”è€…å·²æŒæ¡è¿™äº›åŸºç¡€æ¨¡å‹çŸ¥è¯†æ‰€ä»¥åœ¨è¿™é‡Œç•¥å»ï¼Œä»¥ä¸‹ä»‹ç»ä¸€äº›åŸºæœ¬çš„å®šä¹‰ã€‚</p>
<p>æµ‹è¯•é›†ï¼šé€‰æ‹©é€‚å½“çš„æ¯”ä¾‹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</p>
<p>å‡†ç¡®åº¦ï¼šæµ‹é‡æµ‹è¯•é›†ä¸Šåˆ†ç±»å™¨æ­£ç¡®æ ‡æ³¨çš„è¾“å…¥çš„æ¯”ä¾‹ã€‚</p>
<p>ç²¾ç¡®åº¦ï¼ˆPrecisionï¼‰ï¼Œè¡¨ç¤ºæˆ‘ä»¬å‘ç°çš„é¡¹ç›®ä¸­æœ‰å¤šå°‘æ˜¯ç›¸å…³çš„ï¼ŒTP/(TP+
FP)ã€‚</p>
<p>å¬å›ç‡ï¼ˆRecallï¼‰ï¼Œè¡¨ç¤ºç›¸å…³çš„é¡¹ç›®ä¸­æˆ‘ä»¬å‘ç°äº†å¤šå°‘ï¼ŒTP/(TP+ FN)ã€‚</p>
<p>F- åº¦é‡å€¼ï¼ˆF-Measureï¼‰ï¼ˆæˆ–
F-å¾—åˆ†ï¼ŒF-Scoreï¼‰ï¼Œç»„åˆç²¾ç¡®åº¦å’Œå¬å›ç‡ä¸ºä¸€ä¸ªå•ç‹¬çš„å¾—åˆ†ï¼Œè¢«å®šä¹‰ä¸ºç²¾ç¡®åº¦å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°(2
Ã— Precision Ã— Recall)/(Precision+Recall)ã€‚</p>
<p>æ··æ·†çŸ©é˜µï¼šå…¶ä¸­æ¯ä¸ª cells[i,j]è¡¨ç¤ºæ­£ç¡®çš„æ ‡ç­¾ i è¢«é¢„æµ‹ä¸ºæ ‡ç­¾ j çš„æ¬¡æ•°
ã€‚å› æ­¤ï¼Œå¯¹è§’çº¿é¡¹ç›®ï¼ˆå³
cells[i,i]ï¼‰è¡¨ç¤ºæ­£ç¡®é¢„æµ‹çš„æ ‡ç­¾ï¼Œéå¯¹è§’çº¿é¡¹ç›®è¡¨ç¤ºé”™è¯¯ã€‚nltkä¸­å¯ä»¥ä½¿ç”¨
<code>nltk.ConfusionMatrix</code>å‡½æ•°</p>
<p>äº¤å‰éªŒè¯ï¼šåœ¨ä¸åŒçš„æµ‹è¯•é›†ä¸Šæ‰§è¡Œå¤šä¸ªè¯„ä¼°ï¼Œç„¶åç»„åˆè¿™äº›è¯„ä¼°çš„å¾—åˆ†</p>
<p>ä¿¡æ¯å¢ç›Šï¼šç”¨ç»™å®šçš„ç‰¹å¾åˆ†å‰²è¾“å…¥å€¼ï¼Œè¡¡é‡æ•°æ®å˜å¾—æ›´æœ‰åºçš„ç¨‹åº¦</p>
<p>æœ´ç´ è´å¶æ–¯å‡è®¾ï¼ˆç‹¬ç«‹æ€§å‡è®¾ï¼‰ï¼šæ¯ä¸ªè¾“å…¥å€¼æ˜¯é€šè¿‡é¦–å…ˆä¸ºé‚£ä¸ªè¾“å…¥å€¼é€‰æ‹©ä¸€ä¸ªç±»æ ‡ç­¾ï¼Œç„¶åäº§ç”Ÿæ¯ä¸ªç‰¹å¾çš„æ–¹å¼äº§ç”Ÿçš„
ï¼Œæ¯ä¸ªç‰¹å¾ä¸å…¶ä»–ç‰¹å¾å®Œå…¨ç‹¬ç«‹ã€‚</p>
<p>é›¶è®¡æ•°ï¼šå¦‚æœè®­ç»ƒé›†ä¸­æœ‰ç‰¹å¾ä»æ¥æ²¡æœ‰å’Œç»™å®šæ ‡ç­¾ä¸€èµ·å‡ºç°ï¼Œå¯¼è‡´ç»™å®šæ ‡ç­¾çš„æ ‡ç­¾å¯èƒ½æ€§ä¸º
0ã€‚</p>
<p>å¹³æ»‘ï¼šç»™å®šä¸€ä¸ªåˆå€¼ï¼Œè§£å†³é›¶è®¡æ•°é—®é¢˜ã€‚<code>nltk.probability</code>æä¾›äº†å¤šç§å¹³æ»‘æŠ€æœ¯</p>
<p>Heldoutä¼°è®¡ä½¿ç”¨ä¸€ä¸ªheldout
è¯­æ–™åº“è®¡ç®—ç‰¹å¾é¢‘ç‡ä¸ç‰¹å¾æ¦‚ç‡ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>éäºŒå…ƒç‰¹å¾ï¼šå¦‚æœæ ‡ç­¾æ˜¯1,2,4,5è¿™ç§å¤šå…ƒæ ‡ç­¾ï¼Œå¯ä»¥è½¬æ¢0&lt;x&lt;3,
3&lt;x&lt;6è¿™ç§äºŒå…ƒæ ‡ç­¾</p>
<p>åŒé‡è®¡æ•°ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç‰¹å¾çš„è´¡çŒ®è¢«åˆ†å¼€è®¡ç®—ï¼Œä½†å½“ä½¿ç”¨åˆ†ç±»å™¨ä¸ºæ–°è¾“å…¥é€‰æ‹©æ ‡ç­¾æ—¶ï¼Œè¿™äº›ç‰¹å¾çš„è´¡çŒ®è¢«ç»„åˆã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ºæ¯ä¸€ä¸ªç‰¹å¾è´¡çŒ®è®¾å®šä¸€ä¸ªæƒé‡ã€‚</p>
<p>æœ€å¤§ç†µåˆ†ç±»å™¨ï¼šä¸æœ´ç´ è´å¶æ–¯ç±»ä¼¼ï¼Œä½¿ç”¨æœç´¢æŠ€æœ¯æ‰¾å‡ºä¸€ç»„å°†æœ€å¤§é™åº¦åœ°æé«˜åˆ†ç±»å™¨æ€§èƒ½çš„å‚æ•°ã€‚é¿å…ä½¿ç”¨å¹¿ä¹‰
è¿­ä»£ç¼©æ”¾ï¼ˆGeneralized Iterative Scalingï¼ŒGISï¼‰æˆ–æ”¹è¿›çš„è¿­ä»£ç¼©æ”¾ï¼ˆImproved
Iterative Scalingï¼ŒIISï¼‰ï¼Œè¿™ä¸¤è€…éƒ½æ¯”å…±è½­æ¢¯åº¦ï¼ˆConjugate Gradientï¼ŒCG
ï¼‰å’Œ BFGS ä¼˜åŒ–æ–¹æ³•æ…¢å¾ˆå¤š</p>
<p>è”åˆç‰¹å¾ï¼šæ¯ä¸ªæ¥æ”¶å®ƒè‡ªå·±çš„å‚æ•°çš„æ ‡ç­¾å’Œç‰¹å¾çš„ç»„åˆã€‚è”åˆç‰¹å¾æ˜¯æœ‰æ ‡ç­¾çš„çš„å€¼çš„å±æ€§ï¼Œè€Œï¼ˆç®€å•ï¼‰ç‰¹å¾æ˜¯æœªåŠ æ ‡ç­¾çš„å€¼çš„å±æ€§ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ
æœ€å¤§ç†µåŸç†æ˜¯è¯´åœ¨ä¸æˆ‘ä»¬æ‰€çŸ¥é“çš„ä¸€è‡´çš„çš„åˆ†å¸ƒä¸­ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ç†µæœ€é«˜ï¼ˆåˆ†å¸ƒæœ€å‡åŒ€ï¼‰çš„ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè”åˆç‰¹å¾ï¼Œæœ€å¤§ç†µæ¨¡å‹è®¡ç®—è¯¥ç‰¹å¾çš„â€œç»éªŒé¢‘ç‡â€â€”â€”å³å®ƒå‡ºç°åœ¨è®­ç»ƒé›†ä¸­çš„é¢‘ç‡ã€‚ç„¶åï¼Œå®ƒæœç´¢ç†µæœ€å¤§çš„åˆ†å¸ƒï¼ŒåŒæ—¶ä¹Ÿé¢„æµ‹æ¯ä¸ªè”åˆç‰¹å¾æ­£ç¡®çš„é¢‘ç‡ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”Ÿæˆå¼æ¨¡å‹ç¡®å®æ¯”æ¡ä»¶å¼æ¨¡å‹å¼ºå¤§ã€‚ä½†æ˜¯å‰è€…æ‰€éœ€çš„å‚æ•°ä¼šå¤§äºåè€…ã€‚</p>
]]></content>
      <categories>
        <category>NLP</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ç¬”è®°</tag>
        <tag>NLTK</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€ä¼˜åŒ–ç®—æ³•å­¦ä¹ è®°å½•</title>
    <url>/hexo_blog/2021/02/03/%E6%95%B0%E5%AD%A6/%E6%9C%80%E4%BC%98%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>æœ¬æ–‡æä¾›äº†ä¼˜åŒ–é—®é¢˜çš„æ¦‚è¿°ï¼ŒåŒ…æ‹¬èƒŒæ™¯ï¼Œåˆ†ç±»ï¼Œä»¥åŠçº¿æ€§ï¼Œéçº¿æ€§å’ŒäºŒæ¬¡è§„åˆ’é—®é¢˜çš„æ±‚è§£æ–¹æ³•ã€‚æœ¬æ–‡è¿˜è®¨è®ºäº†å…¨å±€ä¼˜åŒ–ï¼Œå¹¶æä¾›äº†éå‡¸å‡½æ•°å’Œå‡¸å‡½æ•°çš„ä¾‹å­ï¼Œä»¥åŠçº¿æ€§è§„åˆ’å’ŒäºŒæ¬¡è§„åˆ’çš„ä¾‹å­ã€‚</p>
<span id="more"></span>
<p>ä¼˜åŒ–é—®é¢˜çš„æœ€ç»ˆç›®çš„å°±æ˜¯æ±‚æœ€å°å€¼ï¼ˆæœ€å¤§å€¼è½¬ä¸ºæ±‚æœ€å°å€¼ï¼‰</p>
<h3 id="ç®€å•åˆ’åˆ†">ç®€å•åˆ’åˆ†</h3>
<ol type="1">
<li>è§£ææ³•</li>
<li><strong>è¿­ä»£æ³•</strong>
<ol type="1">
<li>å¸¸è§„æ–¹æ³•</li>
<li>æŠ€å·§
<ol type="1">
<li>åˆ‡å¹³é¢</li>
<li>æ¤­åœ†æ³•</li>
<li>å†…ç‚¹æ³•</li>
</ol></li>
</ol></li>
</ol>
<h3 id="background">Background</h3>
<ol type="1">
<li>ç›®æ ‡å‡½æ•°ã€çº¦æŸã€çº¿æ€§ï¼ˆéçº¿æ€§ï¼‰</li>
<li>å‡¸ä¼˜åŒ–é—®é¢˜ï¼ˆæ˜¯å¦ä¸ºå‡¸é—®é¢˜ï¼‰</li>
<li>å±€éƒ¨æœ€ä¼˜ã€å…¨å±€æœ€ä¼˜</li>
<li>çŸ©é˜µæ±‚å¯¼ï¼ˆæ¢¯åº¦ï¼‰ï¼ŒçŸ©é˜µçš„ä¸€é˜¶å¯¼æ•°ã€äºŒé˜¶å¯¼æ•°ï¼ˆHessianï¼‰</li>
<li>è§£æä¸è¿­ä»£</li>
</ol>
<h3 id="how">How</h3>
<ol type="1">
<li>ç›®æ ‡å‡½æ•°ã€çº¦æŸå‡ä¸ºçº¿æ€§ï¼šå•çº¯å½¢æ³•ã€‚å¤§é—®é¢˜ï¼šå†…ç‚¹æ³•</li>
<li>ç›®æ ‡å‡½æ•°äºŒæ¬¡ï¼Œçº¦æŸçº¿æ€§ï¼šæ”¹è¿›å•çº¯å½¢æ³•ã€‚å¤§é—®é¢˜ï¼šå†…ç‚¹æ³•</li>
<li>å‡¸é—®é¢˜ï¼šåˆ‡å‰²å¹³é¢ã€æ¤­çƒç®—æ³•ã€<strong>å†…ç‚¹æ³•</strong></li>
<li>ç›®æ ‡å‡½æ•°å­˜åœ¨å¤šä¸ªå±€éƒ¨æœ€å°å€¼ï¼Œå…¨å±€ä¼˜åŒ–ç®—æ³•ï¼ˆå¯å‘å¼ç®—æ³•/æ™ºèƒ½ä¼˜åŒ–ç®—æ³•ï¼‰</li>
<li>éçº¿æ€§éå‡¸é—®é¢˜ï¼ˆæœ€éš¾ï¼‰ï¼Œæ¢¯åº¦å’Œæµ·æ£®ä¿¡æ¯ï¼ˆäºŒé˜¶å¯¼ï¼‰-&gt;æ„é€ è§£æè¡¨è¾¾å¼</li>
<li>æ— çº¦æŸé—®é¢˜
<ol type="1">
<li>Levenberg-Marquardt</li>
<li>ç‰›é¡¿ç®—æ³•</li>
<li>æ‹Ÿç‰›é¡¿</li>
<li>æœ€é€Ÿä¸‹é™</li>
<li>Powell</li>
</ol></li>
<li>çº¿æ€§çº¦æŸï¼šSQPã€æ¢¯åº¦æŠ•å½±æ³•</li>
<li>éçº¿æ€§çº¦æŸï¼šSQPã€è½¬ä¸ºä¸ºæ— çº¦æŸ</li>
</ol>
<h3 id="ä¼˜åŒ–é—®é¢˜åˆ†ç±»">ä¼˜åŒ–é—®é¢˜åˆ†ç±»</h3>
<ol type="1">
<li><p>æ— çº¦æŸé—®é¢˜ï¼ˆéçº¿æ€§æœ€å°äºŒä¹˜é—®é¢˜ï¼‰</p>
<ol type="1">
<li>ç‰›é¡¿æ³•</li>
<li>é€†ç‰›é¡¿æ³•</li>
<li>Levenberg-Marquardtç®—æ³•</li>
<li>Nelder-Mead æ–¹æ³•</li>
<li>å…¶ä»–
<ol type="1">
<li>æœç´¢æ–¹å‘å’Œä¸€ç»´æœç´¢æ³•</li>
</ol></li>
</ol></li>
<li><p>çº¦æŸé—®é¢˜</p>
<ol type="1">
<li>è§„åˆ’é—®é¢˜
<ol type="1">
<li>çº¿æ€§è§„åˆ’ï¼ˆæ•´æ•°è§„åˆ’ï¼‰
<ol type="1">
<li>å•çº¯å½¢è§£æ³•</li>
</ol></li>
<li>äºŒæ¬¡è§„åˆ’
<ol type="1">
<li>æ”¹è¿›å•çº¯å½¢æ³•</li>
</ol></li>
</ol></li>
<li>éçº¿æ€§ä¼˜åŒ–çš„çº¦æŸ
<ol type="1">
<li>ç­‰å¼çº¦æŸ
<ol type="1">
<li>çº¿æ€§ç­‰å¼çº¦æŸ</li>
<li>éçº¿æ€§ç­‰å¼çº¦æŸ</li>
</ol></li>
<li>ä¸ç­‰å¼çº¦æŸ
<ol type="1">
<li>çº¿æ€§ç­‰å¼çº¦æŸ</li>
<li>éçº¿æ€§ç­‰å¼çº¦æŸ</li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<h3 id="å…¨å±€ä¼˜åŒ–">å…¨å±€ä¼˜åŒ–</h3>
<ol type="1">
<li>å¯å‘å¼ç®—æ³•
<ol type="1">
<li>æ¨¡æ‹Ÿé€€ç«</li>
<li>é—ä¼ ç®—æ³•</li>
</ol></li>
<li>åŸºæœ¬ç®—æ³•
<ol type="1">
<li>éšæœºæœç´¢</li>
<li>å¤šèµ·ç‚¹ä¼˜åŒ–</li>
</ol></li>
</ol>
<h3 id="ä¼˜åŒ–é—®é¢˜fx">ä¼˜åŒ–é—®é¢˜<span
class="math inline">\(F(x)\)</span></h3>
<ul>
<li>çº¿æ€§é—®é¢˜
<ul>
<li>ä¸è®ºæœ‰æ— çº¦æŸï¼Œéƒ½å¯ä»¥ä½¿ç”¨<strong>å•çº¯å½¢æ³•</strong>å’Œ<strong>å†…ç‚¹æ³•</strong>æ±‚è§£</li>
</ul></li>
<li>éçº¿æ€§é—®é¢˜
<ul>
<li>å‡¸ä¼˜åŒ–é—®é¢˜
<ul>
<li>æœ‰çº¦æŸï¼šåˆ‡å¹³é¢æ³•ã€æ¤­çƒæ³•ã€å†…ç‚¹æ³•</li>
<li>æ— çº¦æŸæƒ…å†µä¸‹ç­‰åŒäºéå‡¸é—®é¢˜</li>
</ul></li>
<li>éå‡¸é—®é¢˜
<ul>
<li>çº¦æŸ<span
class="math inline">\(h(x)\)</span>ä¸æ˜¯çº¿æ€§ï¼Œæ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•</li>
<li>çº¦æŸ<span class="math inline">\(g(x)\)</span>ä¸ºçº¿æ€§ï¼Œgradient
projectionã€SQP</li>
<li>çº¦æŸ<span
class="math inline">\(g(x)\)</span>ä¸æ˜¯çº¿æ€§ï¼Œæƒ©ç½šå‡½æ•°ã€Barrierå‡½æ•°ã€SQPé—®é¢˜</li>
<li>æ— çº¦æŸï¼ˆå¯æ¶ˆçº¦æŸï¼‰
<ul>
<li>å¤šèµ·ç‚¹ä¼˜åŒ–
<ul>
<li>HessionçŸ©é˜µï¼Œä¸€é˜¶çŸ©é˜µï¼šLevenberg-Marquardtã€ç‰›é¡¿æ³•ã€ç‰›é¡¿çº¿æ€§æœç´¢</li>
<li>ä¸€é˜¶çŸ©é˜µï¼šQuasi-Newtonã€Quasi-Newtonçº¿æ€§æœç´¢ã€æœ€é€Ÿä¸‹é™æ³•</li>
<li>æ— ï¼šPowell Perpendicularçº¿æ€§æœç´¢ã€Nelder-Mead</li>
</ul></li>
<li>ä¸æ˜¯å¤šèµ·ç‚¹ä¼˜åŒ–ï¼šéšæœºæœç´¢ã€æ¨¡æ‹Ÿé€€ç«ã€é—ä¼ ç®—æ³•</li>
</ul></li>
</ul></li>
</ul></li>
<li>äºŒæ¬¡é—®é¢˜
<ul>
<li>çº¦æŸï¼Œçº¿æ€§ï¼Œä¿®æ­£çš„å•çº¯å½¢æ³•ã€å†…ç‚¹æ³•</li>
</ul></li>
</ul>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/optimization/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95%E7%9A%84%E9%80%89%E6%8B%A9.png" />
<img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/optimization/%E6%9C%80%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95%E5%81%9C%E6%AD%A2%E5%87%86%E5%88%99.png" /></p>
<h3 id="ä¾‹å­">ä¾‹å­</h3>
<p>éå‡¸å‡½æ•°</p>
<p><span class="math inline">\(\int _ { 0 } ^ { x 2 } ( \frac { e ^ { x
_ { 3 } ^ { 2 } z } \cos ( z ) } { x _ { 3 } ^ { 4 } z + 1 } + z ^ { x 1
} ) d z\)</span></p>
<p><span class="math inline">\(e ^ { x _ { 1 } ^ { 2 } + x _ { 2 } ^ { 2
} } + x _ { 1 } ^ { 2 } x _ { 2 } ^ { 2 }\)</span></p>
<p><span class="math inline">\(( x _ { 1 } + x _ { 2 } ) ^ { 3 } - \log
( 2 - x _ { 1 } ^ { 2 } - x _ { 2 } ^ { 2 } )\)</span></p>
<p>$x _ { 1 } ^ { 4 } + x _ { 2 } ^ { 2 } + 3 x _ { 1 } x _ { 3 } + 2 x
_ { 4 } x _ { 5 } $</p>
<p>$9 x _ { 1 } ^ { 2 } + 4 x _ { 2 } ^ { 2 } + 2 x _ { 1 } x _ { 2 } +
8 x _ { 3 } ^ { 2 } - 2 x _ { 1 } x _ { 3 } $</p>
<p>$ { ( x _ { 1 } + 3 x _ { 2 } + 4 x _ { 3 } ) ^ { 2 } } + ( ( x _ { 1
} + 4 x _ { 2 } + 5 x _ { 3 } - 100 ) ^ { 4 } )$</p>
<p>$ { 1 + } $</p>
<p>å‡¸å‡½æ•°</p>
<p>$( x _ { 1 } ^ { 2 } + x _ { 2 } ^ { 2 } ) + 14 x _ { 2 } ^ { 4 }
$</p>
<p>$ ( ( x _ { 1 } - 1 ) ^ { 2 } + ( x _ { 2 } - 2 ) ^ { 2 } ) ^ { 2 } -
( 2 - x _ { 1 } ^ { 2 } - x _ { 2 } ^ { 2 } )$</p>
<p>$| 2 x _ { 1 } + 4 x _ { 2 } + 3 x _ { 3 } + 2 x _ { 4 } + 7 | + ( (
x _ { 1 } + x _ { 2 } - 4 x _ { 3 } - x _ { 4 } ) ^ { 4 } ) $</p>
<p>$( F _ { 1 } ( x ) , 2 F _ { 2 } ( x ) , F _ { 3 } ( x ) + 8 F _ { 4
} ( x ) ) $</p>
<p>$ x _ { 1 } + | x _ { 2 } | + 3 x _ { 3 } + 4 | x _ { 4 } |$</p>
<p><span class="math inline">\(( 4 x _ { 1 } + 7 x _ { 2 } - 4 x _ { 3 }
+ 12 x _ { 4 } ) ^ { 3 }\)</span></p>
<p><span class="math inline">\(( x _ { 1 } - 5 ) ^ { 2 } + ( x _ { 2 } -
8 ) ^ { 4 }\)</span></p>
<p>çº¿æ€§è§„åˆ’é—®é¢˜</p>
<p><span class="math inline">\(| x _ { 1 } - 4 x _ { 2 } + x _ { 3 } - 4
|\)</span></p>
<p>$( 4 x _ { 1 } - 3 x _ { 2 } + 8 x _ { 3 } - 5 , - 2 x _ { 1 } + 7 x
_ { 2 } - x _ { 3 } + 1 ) $</p>
<p>äºŒæ¬¡è§„åˆ’ï¼ˆå‡¸äºŒæ¬¡å‡½æ•°ï¼‰</p>
<p><span class="math inline">\(2 ^ { 5 x _ { 1 } ^ { 2 } + 2 x _ { 2 } ^
{ 2 } + 6 x _ { 1 } x _ { 2 } + 3 x _ { 1 } - x _ { 2 } }\)</span></p>
<p><span class="math inline">\(1 - 4 x _ { 1 } ^ { 2 } - 9 x _ { 2 } ^ {
2 } - 8 x _ { 3 } ^ { 2 } + 4 x _ { 1 } x _ { 2 } - 2 x _ { 1 } x _ { 3
} + 4 x _ { 2 } x _ { 3 }\)</span></p>
<h3 id="ç›¸å…³ä¹¦ç±">ç›¸å…³ä¹¦ç±</h3>
<p>[1] ç¨‹ç†æ°‘, å´æ±Ÿ, å¼ ç‰æ—. è¿ç­¹å­¦æ¨¡å‹ä¸æ–¹æ³•æ•™ç¨‹[M]. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾,
2000.</p>
<p>[2] é™ˆå®æ—. æœ€ä¼˜åŒ–ç†è®ºä¸ç®—æ³•[M]. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾æœ‰é™å…¬å¸, 2005.</p>
<p>[3] è¢äºšæ¹˜, å­™æ–‡ç‘œ. æœ€ä¼˜åŒ–ç†è®ºä¸æ–¹æ³•[M]. ç§‘å­¦å‡ºç‰ˆç¤¾, 1997.</p>
<p>ä¸ªäººæ„Ÿè§‰ï¼Œéš¾åº¦[3]&gt;[2]&gt;[1]ï¼Œè¢é™¢å£«é‚£æœ¬ç†è®ºè¯æ˜åå¤šï¼Œå¯æ­é…[2]ä¸è¯¾åç»ƒä¹ ä¸€èµ·é˜…è¯»ã€‚</p>
]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>Optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¥ç»ç½‘ç»œç¬”è®°â…¡</title>
    <url>/hexo_blog/2018/08/20/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0%E2%85%A1/</url>
    <content><![CDATA[<p>æ¥ <a href="/hexo_blog/2018/04/14/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0%E2%85%A0/" title="ç¥ç»ç½‘ç»œç¬”è®°â… ">ç¥ç»ç½‘ç»œç¬”è®°â… </a></p>
<p>ä»CNNåˆ°RNNå†åˆ°LSTMï¼Œæ·±å…¥äº†è§£ä¸‰ç§ç¥ç»ç½‘ç»œã€‚å…¶ä¸­ï¼ŒCNNä¸»è¦ç”¨äºå›¾åƒè¯†åˆ«ä¸å¤„ç†ï¼ŒRNNå¤„ç†å…·æœ‰åŠ¨æ€æ—¶åºè¡Œä¸ºçš„ä»»åŠ¡ï¼Œè€ŒLSTMåˆ™åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†è®°å¿†å•å…ƒï¼Œæ›´é€‚åˆå¤„ç†æ—¶é—´åºåˆ—ä¸­é—´éš”å’Œå»¶è¿Ÿéå¸¸é•¿çš„äº‹ä»¶ã€‚ä»…é å‰å‘ä¼ æ’­å·²ä¸æ»¡è¶³è¦æ±‚ï¼Œåå‘ä¼ æ’­ä¹Ÿå˜å¾—é‡è¦ã€‚</p>
<span id="more"></span>
<h2 id="cnnå·ç§¯ç¥ç»ç½‘ç»œ">CNNï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼‰</h2>
<p><a
href="https://www.zybuluo.com/hanbingtao/note/485480">é›¶åŸºç¡€å…¥é—¨æ·±åº¦å­¦ä¹ (4)
- å·ç§¯ç¥ç»ç½‘ç»œ</a></p>
<p>CNNï¼ˆConvolutional Neural
Networdï¼Œå·ç§¯ç¥ç»ç½‘ç»œï¼‰æ˜¯ä¸€ç§å‰é¦ˆç¥ç»ç½‘ç»œï¼Œäººå·¥ç¥ç»å…ƒå¯ä»¥å“åº”å‘¨å›´å•å…ƒï¼Œå¯ä»¥å¤§å‹å›¾åƒå¤„ç†ã€‚å·ç§¯ç¥ç»ç½‘ç»œåŒ…æ‹¬å·ç§¯å±‚å’Œæ± åŒ–å±‚ã€‚</p>
<p>åŸºç¡€ç»“æ„</p>
<ul>
<li>ç‰¹å¾æå–å±‚ï¼Œæ¯ä¸ªç¥ç»å…ƒçš„è¾“å…¥ä¸å‰ä¸€å±‚çš„å±€éƒ¨æ¥å—åŸŸç›¸è¿ï¼Œå¹¶æå–è¯¥å±€éƒ¨çš„ç‰¹å¾ã€‚ä¸€æ—¦è¯¥å±€éƒ¨ç‰¹å¾è¢«æå–åï¼Œå®ƒä¸å…¶ä»–ç‰¹å¾é—´çš„ä½ç½®å…³ç³»ä¹Ÿéšä¹‹ç¡®å®šä¸‹æ¥</li>
<li>ç‰¹å¾æ˜ å°„å±‚ï¼Œç½‘ç»œçš„æ¯ä¸ªè®¡ç®—å±‚ç”±å¤šä¸ªç‰¹å¾æ˜ å°„ç»„æˆï¼Œæ¯ä¸ªç‰¹å¾æ˜ å°„æ˜¯ä¸€ä¸ªå¹³é¢ï¼Œå¹³é¢ä¸Šæ‰€æœ‰çš„ç¥ç»å…ƒçš„æƒå€¼ç›¸ç­‰ã€‚é‡‡ç”¨å½±å“å‡½æ•°è¾ƒå°çš„<span
class="math inline">\(sigmoid\)</span>å‡½æ•°ä½œä¸ºå·ç§¯ç½‘ç»œçš„æ¿€æ´»å‡½æ•°ï¼Œä½¿å¾—ç‰¹å¾æ˜ å°„å…·æœ‰ä½ç§»ä¸å˜æ€§</li>
</ul>
<p>CNNä¸»è¦ç”¨æ¥è¯†åˆ«ä½ç§»ã€ç¼©æ”¾ä»¥åŠå…¶ä»–å½¢å¼æ‰­æ›²ä¸å˜æ€§çš„äºŒç»´å›¾å½¢ã€‚ç”±äºCNNçš„ç‰¹å¾æ£€æµ‹å±‚é€šè¿‡è®­ç»ƒæ•°æ®è¿›è¡Œå­¦ä¹ ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨CNNæ—¶ï¼Œé¿å…äº†æ˜¾ç¤ºçš„ç‰¹å¾æŠ½å–ï¼Œä»è€Œéšå¼åœ°ä»è®­ç»ƒæ•°æ®ä¸­è¿›è¡Œå­¦ä¹ ã€‚ç”±äºåŒä¸€ç‰¹å¾æ˜ å°„é¢ä¸Šçš„ç¥ç»å…ƒæƒå€¼ç›¸åŒï¼Œæ‰€ä»¥ç½‘ç»œå¯ä»¥å¹¶è¡Œå­¦ä¹ ã€‚</p>
<p>å¯¹äºå›¾åƒè¯†åˆ«ä»»åŠ¡</p>
<p>å…¨è¿æ¥ç½‘ç»œ</p>
<ol type="1">
<li>å‚æ•°æ•°é‡è¿‡å¤š</li>
<li>åƒç´ é—´çš„ä½ç½®ä¿¡æ¯</li>
<li>ç½‘ç»œå±‚æ•°é™åˆ¶</li>
</ol>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ol type="1">
<li>å±€éƒ¨è¿æ¥â€”â€”ä¸æ˜¯å…¨è¿æ¥ï¼Œå‡å°‘å‚æ•°æ•°é‡</li>
<li>æƒå€¼å…±äº«â€”â€”ä¸€ç»„è¿æ¥å¯ä»¥å…±äº«å…±ä¸€ä¸ªæƒé‡ï¼Œå†ä¸€æ¬¡å‡å°‘å‚æ•°æ•°é‡</li>
<li>ä¸‹é‡‡æ ·â€”â€”ä½¿ç”¨æ± åŒ–ï¼ˆPoolingï¼‰æ¥å‡å°‘æ¯å±‚çš„æ ·æœ¬æ•°ï¼Œè¿›ä¸€æ­¥å‡å°‘å‚æ•°æ•°é‡ï¼Œæä¾›<strong>é²æ£’æ€§
</strong></li>
</ol>
<p><strong>P.S.</strong></p>
<p>é²æ£’æ˜¯Robustçš„éŸ³è¯‘ï¼Œä¹Ÿå°±æ˜¯å¥å£®å’Œå¼ºå£®çš„æ„æ€ã€‚å®ƒæ˜¯åœ¨å¼‚å¸¸å’Œå±é™©æƒ…å†µä¸‹ç³»ç»Ÿç”Ÿå­˜çš„å…³é”®ã€‚æ¯”å¦‚è¯´ï¼Œè®¡ç®—æœºè½¯ä»¶åœ¨è¾“å…¥é”™è¯¯ã€ç£ç›˜æ•…éšœã€ç½‘ç»œè¿‡è½½æˆ–æœ‰æ„æ”»å‡»æƒ…å†µä¸‹ï¼Œèƒ½å¦ä¸æ­»æœºã€ä¸å´©æºƒï¼Œå°±æ˜¯è¯¥è½¯ä»¶çš„é²æ£’æ€§ã€‚æ‰€è°“â€œé²æ£’æ€§â€ï¼Œæ˜¯æŒ‡æ§åˆ¶ç³»ç»Ÿåœ¨ä¸€å®šï¼ˆç»“æ„ï¼Œå¤§å°ï¼‰çš„å‚æ•°æ‘„åŠ¨ä¸‹ï¼Œç»´æŒå…¶å®ƒæŸäº›æ€§èƒ½çš„ç‰¹æ€§ã€‚æ ¹æ®å¯¹æ€§èƒ½çš„ä¸åŒå®šä¹‰ï¼Œå¯åˆ†ä¸ºç¨³å®šé²æ£’æ€§å’Œæ€§èƒ½é²æ£’æ€§ã€‚ä»¥é—­ç¯ç³»ç»Ÿçš„é²æ£’æ€§ä½œä¸ºç›®æ ‡è®¾è®¡å¾—åˆ°çš„å›ºå®šæ§åˆ¶å™¨ç§°ä¸ºé²æ£’æ§åˆ¶å™¨ã€‚</p>
<p>å·ç§¯ç¥ç»ç½‘ç»œï¼š<strong>å·ç§¯å±‚ã€Poolingå±‚ï¼ˆæ± åŒ–å±‚ï¼‰ã€å…¨è¿æ¥å±‚</strong></p>
<p><code>INPUT -&gt; [[CONV]*N -&gt; POOL]*M -&gt; [FC]*K</code></p>
<p>Nä¸ªå·ç§¯å±‚å åŠ å†åŠ ä¸Šä¸€ä¸ªæ± åŒ–å±‚ï¼Œé‡å¤Mæ¬¡ï¼ŒåŠ ä¸ŠKä¸ªå…¨è¿æ¥å±‚ã€‚</p>
<p>æ¦‚å¿µä»‹ç»å’Œè®¡ç®—æ–¹å¼è¯·çœ‹ä¸‹é¢è¿™ç¯‡åšå®¢</p>
<p><a
href="http://www.cnblogs.com/charlotte77/p/7759802.html">ã€æ·±åº¦å­¦ä¹ ç³»åˆ—ã€‘å·ç§¯ç¥ç»ç½‘ç»œCNNåŸç†è¯¦è§£(ä¸€)â€”â€”åŸºæœ¬åŸç†</a></p>
<p>æ€»ç»“ï¼š</p>
<ol type="1">
<li>æ± åŒ–æ–¹å¼ï¼š
<ol type="1">
<li>MaxPoolingï¼šå–æ»‘åŠ¨çª—å£é‡Œæœ€å¤§çš„å€¼</li>
<li>AveragePoolingï¼šå–æ»‘åŠ¨çª—å£å†…æ‰€æœ‰å€¼çš„å¹³å‡å€¼</li>
<li>StochasticPoolingï¼Œä»‹äºä¸¤è€…ä¹‹é—´ï¼Œé€šè¿‡å¯¹åƒç´ ç‚¹æŒ‰ç…§æ•°å€¼å¤§å°èµ‹äºˆæ¦‚ç‡ï¼Œå†æŒ‰ç…§æ¦‚ç‡è¿›è¡Œäºšé‡‡æ ·ï¼›</li>
</ol></li>
<li>Zero Padding(è¡¥é›¶)ï¼šä¿ç•™åŸå§‹å›¾ç‰‡çš„å°ºå¯¸</li>
</ol>
<h4 id="å·ç§¯">å·ç§¯</h4>
<p>å¯¹äºä¸€ä¸ª<span class="math inline">\(l_1*l_2\)</span>çš„å›¾åƒï¼Œä½¿ç”¨<span
class="math inline">\(f_1*f_2\)</span>çš„filterè¿›è¡Œå·ç§¯ï¼ˆåè€…å°äºå‰è€…ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ª<span
class="math inline">\(f_3*f_4\)</span>çš„feature mapã€‚</p>
<p><span class="math display">\[
a_{ij}=f(\sum\limits_{m=0}^{f_1-1}\sum\limits_{n=0}^{f_2-1}w_{mn}x_{(m+i)(n+j)}+w_b)
\]</span></p>
<p><span class="math inline">\(a_{ij}\)</span>è¡¨ç¤ºçš„æ˜¯feature
mapçš„å…ƒç´ ï¼Œ<span
class="math inline">\(w_{mn}\)</span>è¡¨ç¤ºå¯¹åº”å…ƒç´ ï¼Œ<span
class="math inline">\(f\)</span>å‡½æ•°è¡¨ç¤ºæ¿€æ´»å‡½æ•°ï¼Œ<span
class="math inline">\(x_{(m+i)(n+j)}\)</span>è¡¨ç¤ºå›¾åƒçš„å…ƒç´ ï¼Œ<span
class="math inline">\(w_b\)</span>è¡¨ç¤ºåç½®é¡¹ï¼Œè¿™é‡Œä»0å¼€å§‹è®¡æ•°ï¼Œæ‰€ä»¥éœ€è¦-1ã€‚</p>
<p>è¿™é‡Œç®€å•èµ·è§ï¼Œæ­¥å¹…è®¾ç½®ä¸º1ã€‚</p>
<p>å›¾åƒå¤§å°ã€æ­¥å¹…å’Œå·ç§¯åçš„Feature Mapå¤§å°æ˜¯æœ‰å…³ç³»çš„ã€‚</p>
<p><span class="math inline">\(W_2=(W_1-F+2P)/S+1\)</span></p>
<p><span class="math inline">\(H_2=(H_1-F+2P)/S+1\)</span></p>
<p><span class="math inline">\(W_2\)</span>æ˜¯å·ç§¯åFeature
Mapçš„å®½åº¦ï¼›<span
class="math inline">\(W_1\)</span>æ˜¯å·ç§¯å‰å›¾åƒçš„å®½åº¦ï¼›<span
class="math inline">\(F\)</span>æ˜¯filterçš„å®½åº¦ï¼›<span
class="math inline">\(P\)</span>æ˜¯<strong>Zero
Padding</strong>æ•°é‡ï¼Œ<strong>Zero
Padding</strong>æ˜¯æŒ‡åœ¨åŸå§‹å›¾åƒå‘¨å›´è¡¥å‡ åœˆ0ï¼Œå¦‚æœçš„å€¼æ˜¯1ï¼Œé‚£ä¹ˆå°±è¡¥1åœˆ0ï¼›<span
class="math inline">\(S\)</span>æ˜¯<strong>æ­¥å¹…</strong>ï¼›<span
class="math inline">\(H_2\)</span>æ˜¯å·ç§¯åFeature Mapçš„é«˜åº¦ï¼›<span
class="math inline">\(H_1\)</span>æ˜¯å·ç§¯å‰å›¾åƒçš„å®½åº¦ã€‚</p>
<p>äºŒç»´å·ç§¯å…¬å¼ï¼Œå·²çŸ¥çŸ©é˜µ<span class="math inline">\(A\)</span>ã€<span
class="math inline">\(B\)</span>ï¼Œè¡Œåˆ—æ•°åˆ†åˆ«ç”¨<span
class="math inline">\(m\)</span>å’Œ<span
class="math inline">\(n\)</span>è¡¨ç¤ºã€‚å·ç§¯å…¬å¼å¦‚ä¸‹</p>
<p><span
class="math inline">\(C_{st}=\sum\limits_0^{m_A-1}\sum\limits_0^{n_A-1}A_{mn}B_{(s-m)(t-n)}\)</span></p>
<p><span class="math inline">\(0\le s&lt;m_A+m_B-1\)</span></p>
<p><span class="math inline">\(0\le t&lt;n_A+n_B-1\)</span></p>
<p>ä¹Ÿå¯ä»¥å†™æˆ<span class="math inline">\(C=A*B\)</span></p>
<p>æ•°å­¦ä¸­çš„å·ç§¯ä¸å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„å·ç§¯æ˜¯ä¸€å®šåŒºåˆ«çš„ã€‚å¯ä»¥æŠŠç¥ç»ç½‘ç»œä¸­çš„å·ç§¯ç§°ä¸º<strong>äº’ç›¸å…³(cross-correlation)</strong>ã€‚è¿™ä¸¤ç§æ“ä½œè½¬æ¢æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡æŠŠçŸ©é˜µ<span
class="math inline">\(A\)</span>ç¿»è½¬180åº¦ï¼Œå†äº¤æ¢<span
class="math inline">\(A\)</span>ã€<span
class="math inline">\(B\)</span>è¿ç®—ä½ç½®ï¼Œå³å¯ä»¥å°†å·ç§¯å˜ä¸ºäº’ç›¸å…³ã€‚</p>
<h2 id="rnnå¾ªç¯ç¥ç»ç½‘ç»œ">RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰</h2>
<p>RNNï¼ˆRecurrent neural
Networkï¼Œå¾ªç¯ç¥ç»ç½‘ç»œ/å¤šå±‚åé¦ˆç½‘ç»œï¼‰æ˜¯ä¸€ç§èŠ‚ç‚¹å®šå‘è¿æ¥æˆç¯çš„äººå·¥ç¥ç»ç½‘ç»œã€‚è¿™ç§ç½‘ç»œçš„å†…éƒ¨çŠ¶æ€å¯ä»¥å±•ç¤ºåŠ¨æ€æ—¶åºè¡Œä¸ºã€‚ä¸åŒäºå‰é¦ˆç¥ç»ç½‘ç»œçš„æ˜¯ï¼ŒRNNå¯ä»¥åˆ©ç”¨å®ƒå†…éƒ¨çš„è®°å¿†æ¥å¤„ç†ä»»æ„æ—¶åºçš„è¾“å…¥åºåˆ—ï¼Œè¿™è®©å®ƒå¯ä»¥æ›´å®¹æ˜“å¤„ç†ï¼Œå¦‚ä¸åˆ†æ®µçš„æ‰‹å†™è¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ç­‰ã€‚</p>
<p>RNNç½‘ç»œçš„æœ¬è´¨ç‰¹å¾æ˜¯å¤„ç†å•å…ƒä¹‹é—´æ—¢æœ‰å†…éƒ¨çš„åé¦ˆè¿æ¥åˆæœ‰å‰é¦ˆè¿æ¥ã€‚ä»ç³»ç»Ÿçš„è§‚ç‚¹çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåé¦ˆåŠ¨åŠ›ç³»ç»Ÿï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä½“ç°è¿‡ç¨‹åŠ¨æ€ç‰¹æ€§ï¼Œæ¯”å‰é¦ˆç¥ç»ç½‘ç»œå…·æœ‰æ›´å¼ºçš„åŠ¨æ€è¡Œä¸ºå’Œè®¡ç®—èƒ½åŠ›ã€‚</p>
<p><a
href="https://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/">å‚è€ƒæ–‡ç« </a></p>
<p><strong><em>Talk</em> <em>is</em> cheap. <em>Show</em> <em>me</em>
<em>the</em> <em>code</em>.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="comment"># sigmoidæ¿€æ´»å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (deriv == <span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨10è¿›åˆ¶è½¬2è¿›åˆ¶çš„å­—å…¸</span></span><br><span class="line">int2binary = &#123;&#125;</span><br><span class="line"><span class="comment"># äºŒè¿›åˆ¶æ•°æœ€å¤§é•¿åº¦</span></span><br><span class="line">binary_dim = <span class="number">8</span></span><br><span class="line"><span class="comment"># æœ€å¤§10è¿›åˆ¶æ•°</span></span><br><span class="line">larget_number = <span class="number">2</span> ** binary_dim</span><br><span class="line">binary = np.unpackbits(</span><br><span class="line">    np.array([<span class="built_in">range</span>(larget_number)], dtype=np.uint8).T, axis=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(larget_number):</span><br><span class="line">    int2binary[i] = binary[i]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢¯åº¦</span></span><br><span class="line">alpha = <span class="number">0.1</span></span><br><span class="line"><span class="comment"># è¾“å…¥ç»´åº¦ï¼Œä¸¤ä¸ªæ•°</span></span><br><span class="line">input_dim = <span class="number">2</span></span><br><span class="line"><span class="comment"># éšå•å…ƒç»´åº¦</span></span><br><span class="line">hidden_dim = <span class="number">16</span></span><br><span class="line"><span class="comment"># è¾“å‡ºç»´åº¦ï¼Œä¸€ä¸ªæ•°</span></span><br><span class="line">output_dim = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸¤å±‚ç¥ç»ç½‘ç»œã€‚æ¯å±‚æƒé‡ï¼Œ[-1, 1]</span></span><br><span class="line">syn_0 = <span class="number">2</span> * np.random.random((input_dim, hidden_dim)) - <span class="number">1</span></span><br><span class="line">syn_1 = <span class="number">2</span> * np.random.random((hidden_dim, output_dim)) - <span class="number">1</span></span><br><span class="line"><span class="comment"># ç¥ç»ç½‘ç»œè¿æ¥å‰ä¸€ä¸ªéšè—å±‚çš„æƒé‡</span></span><br><span class="line">syn_h = <span class="number">2</span> * np.random.random((hidden_dim, hidden_dim)) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨æƒé‡çš„æ›´æ–°</span></span><br><span class="line">syn_0_update = np.zeros_like(syn_0)</span><br><span class="line">syn_1_update = np.zeros_like(syn_1)</span><br><span class="line">syn_h_update = np.zeros_like(syn_h)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    <span class="comment"># ä¸€ä¸ªç®€å•çš„åŠ æ³•é—®é¢˜ï¼Œc=a+b</span></span><br><span class="line">    <span class="comment"># åœ¨0ï¼Œ128ï¼ˆé¿å…ç›¸åŠ è¶…è¿‡256ï¼‰ä¹‹é—´ä¸€ä¸ªéšæœºæ•°aï¼Œåè¿›åˆ¶è¡¨ç¤º</span></span><br><span class="line">    a_int = np.random.randint(larget_number / <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># äºŒè¿›åˆ¶è¡¨ç¤ºa</span></span><br><span class="line">    a = int2binary[a_int]</span><br><span class="line"></span><br><span class="line">    b_int = np.random.randint(larget_number / <span class="number">2</span>)</span><br><span class="line">    b = int2binary[b_int]</span><br><span class="line">    <span class="comment"># æ­£ç¡®ç­”æ¡ˆc</span></span><br><span class="line">    c_int = a_int + b_int</span><br><span class="line">    c = int2binary[c_int]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¥ç»ç½‘ç»œè®¡ç®—çš„ç­”æ¡ˆ</span></span><br><span class="line">    d = np.zeros_like(c)</span><br><span class="line">    <span class="comment"># è®¡ç®—çš„è¯¯å·®</span></span><br><span class="line">    overallError = <span class="number">0</span></span><br><span class="line">    <span class="comment"># è®°å½•l2_deltaã€l1</span></span><br><span class="line">    layer_2_deltas = []</span><br><span class="line">    layer_1_values = []</span><br><span class="line">    <span class="comment"># l1åˆå§‹å€¼å…¨ä¸º0</span></span><br><span class="line">    layer_1_values.append(np.zeros(hidden_dim))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‰å‘ä¼ æ’­ã€‚ç‰¹å¾æ˜¯äºŒè¿›åˆ¶æ•°ç»´åº¦ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> position <span class="keyword">in</span> <span class="built_in">range</span>(binary_dim):</span><br><span class="line">        <span class="comment"># Xæ˜¯1*2çš„çŸ©é˜µï¼Œ[[m, n]]ï¼Œmã€næ˜¯äºŒè¿›åˆ¶æ•°aã€båœ¨æ¯ä¸ªä½ç½®çš„01å€¼ã€‚ä»æœ€åä¸€ç»´å¼€å§‹éå†</span></span><br><span class="line">        X = np.array(</span><br><span class="line">            [[a[binary_dim - position - <span class="number">1</span>], b[binary_dim - position - <span class="number">1</span>]]])</span><br><span class="line">        <span class="comment"># yæ˜¯1*1çš„çŸ©é˜µã€‚[[t]]ï¼Œtæ˜¯äºŒè¿›åˆ¶æ•°cåœ¨æ¯ä¸ªä½ç½®çš„01å€¼</span></span><br><span class="line">        y = np.array([[c[binary_dim - position - <span class="number">1</span>]]]).T</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—è¾“å‡ºå±‚ï¼Œnp.dot(X,syn_0)æ˜¯æ­£å¸¸æ“ä½œ:ä»è¾“å…¥å±‚åˆ°éšè—å±‚;np.dot(layer_1_values[-1],syn_h):ä»å‰ä¸€å±‚éšè—å±‚åˆ°è¿™ä¸€å±‚éšè—å±‚</span></span><br><span class="line">        layer_1 = sigmoid(np.dot(X, syn_0) + np.dot(layer_1_values[-<span class="number">1</span>], syn_h))</span><br><span class="line">        layer_2 = sigmoid(np.dot(layer_1, syn_1))</span><br><span class="line">        <span class="comment"># è®¡ç®—l2åå·®</span></span><br><span class="line">        layer_2_error = y - layer_2</span><br><span class="line">        <span class="comment"># ä¿å­˜åå·®åŠ æƒå¯¼æ•°l2_delta</span></span><br><span class="line">        layer_2_deltas.append(layer_2_error * sigmoid(layer_2, deriv=<span class="literal">True</span>))</span><br><span class="line">        <span class="comment"># è¯¯å·®æ€»å’Œ</span></span><br><span class="line">        overallError += np.<span class="built_in">abs</span>(layer_2_error[<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># ç¥ç»ç½‘ç»œæ¯ä¸ªç»´åº¦çš„è®¡ç®—çš„01å€¼</span></span><br><span class="line">        d[binary_dim - position - <span class="number">1</span>] = np.<span class="built_in">round</span>(layer_2[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># ä¿å­˜l1å±‚ï¼Œåœ¨ä¸‹æ¬¡è¿­ä»£æ—¶è®¡ç®—ä¸‹æ¬¡ä¼ æ’­çš„éšè—å±‚</span></span><br><span class="line">        <span class="comment"># layer_1_values.append(copy.deepcopy(layer_1))</span></span><br><span class="line">        layer_1_values.append(layer_1.copy())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å­˜å‚¨åå‘ä¼ æ’­çš„l1_delta</span></span><br><span class="line">    futuer_layer_1_delta = np.zeros(hidden_dim)</span><br><span class="line">    <span class="comment"># åå‘ä¼ æ’­.(input + prev_input) -&gt; hidden -&gt; output</span></span><br><span class="line">    <span class="keyword">for</span> position <span class="keyword">in</span> <span class="built_in">range</span>(binary_dim):</span><br><span class="line">        <span class="comment"># ä»ç¬¬ä¸€ç»´å¼€å§‹éå†</span></span><br><span class="line">        X = np.array([[a[position], b[position]]])</span><br><span class="line">        <span class="comment"># é€‰å‡ºå‰é¢è®¡ç®—å¾—åˆ°çš„l1ä½œä¸ºå½“å‰å±‚ï¼Œåå‘è®¡ç®—</span></span><br><span class="line">        layer_1 = layer_1_values[-position - <span class="number">1</span>]</span><br><span class="line">        <span class="comment"># é€‰æ‹©l1å‰ä¸€å±‚çš„éšè—å±‚</span></span><br><span class="line">        prev_layer_1 = layer_1_values[-position - <span class="number">2</span>]</span><br><span class="line">        <span class="comment"># é€‰æ‹©å‡ºl2ï¼Œå½“å‰å±‚è¾“å‡ºçš„è¯¯å·®</span></span><br><span class="line">        layer_2_delta = layer_2_deltas[-position - <span class="number">1</span>]</span><br><span class="line">        <span class="comment"># è®¡ç®—å½“å‰éšè—å±‚è¯¯å·®ï¼Œè®¡ç®—å‰ä¸€å±‚çš„l1_deltaåˆ°å½“å‰å±‚ï¼ŒåŠ ä¸Šæ­£å¸¸æ“ä½œã€‚</span></span><br><span class="line">        layer_1_delta = (np.dot(futuer_layer_1_delta, syn_h.T) +</span><br><span class="line">                         layer_2_delta.dot(syn_1.T)) * sigmoid(layer_1, deriv=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ›´æ–°æƒé‡æ›´æ–°çš„å‚æ•°ã€‚å°†l1è½¬æ¢ä¸ºäºŒç»´çŸ©é˜µ</span></span><br><span class="line">        syn_1_update += np.atleast_2d(layer_1).T.dot(layer_2_delta)</span><br><span class="line">        syn_h_update += np.atleast_2d(prev_layer_1).T.dot(layer_1_delta)</span><br><span class="line">        <span class="comment"># Xå·²ç»æ˜¯äºŒç»´çŸ©é˜µï¼Œä¸éœ€è¦è½¬æ¢</span></span><br><span class="line">        syn_0_update += X.T.dot(layer_1_delta)</span><br><span class="line">        <span class="comment"># æ›¿æ¢futuer_l1</span></span><br><span class="line">        futuer_layer_1_delta = layer_1_delta</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è°ƒæ•´æ¯å±‚æƒé‡</span></span><br><span class="line">    syn_0 += syn_0_update * alpha</span><br><span class="line">    syn_1 += syn_1_update * alpha</span><br><span class="line">    syn_h += syn_h_update * alpha</span><br><span class="line">    <span class="comment"># å½’é›¶æ›´æ–°æƒé‡å‚æ•°</span></span><br><span class="line">    syn_0_update *= <span class="number">0</span></span><br><span class="line">    syn_1_update *= <span class="number">0</span></span><br><span class="line">    syn_h_update *= <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_ % <span class="number">1000</span> == <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: &quot;</span> + <span class="built_in">str</span>(overallError))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Pred: &quot;</span> + <span class="built_in">str</span>(d))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;True: &quot;</span> + <span class="built_in">str</span>(c))</span><br><span class="line">        <span class="comment"># äºŒè¿›åˆ¶è½¬åè¿›åˆ¶</span></span><br><span class="line">        out = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">reversed</span>(d)):</span><br><span class="line">            out += x * (<span class="number">2</span>**index)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(a_int) + <span class="string">&quot; + &quot;</span> + <span class="built_in">str</span>(b_int) + <span class="string">&quot;=&quot;</span> + <span class="built_in">str</span>(out))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------------&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å°†å‰å‘ä¼ æ’­æ¯”å–»ä¸ºå­—æ¯è¡¨é¡ºåºè¯»å‡ºï¼Œåå‘ä¼ æ’­å°±æ˜¯å­—æ¯è¡¨ååºè¯»å‡ºã€‚</p>
<h2 id="lstmæ—¶é—´é€’å½’ç¥ç»ç½‘ç»œ">LSTMï¼ˆæ—¶é—´é€’å½’ç¥ç»ç½‘ç»œï¼‰</h2>
<p>é•¿çŸ­æœŸè®°å¿†ï¼ˆè‹±è¯­ï¼šLong Short-Term
Memoryï¼ŒLSTMï¼‰æ˜¯ä¸€ç§æ—¶é—´é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼Œè®ºæ–‡é¦–æ¬¡å‘è¡¨äº1997å¹´ã€‚ç”±äºç‹¬ç‰¹çš„è®¾è®¡ç»“æ„ï¼ŒLSTMé€‚åˆäºå¤„ç†å’Œé¢„æµ‹æ—¶é—´åºåˆ—ä¸­é—´éš”å’Œå»¶è¿Ÿéå¸¸é•¿çš„é‡è¦äº‹ä»¶ã€‚</p>
<p>LSTMçš„è¡¨ç°é€šå¸¸æ¯”æ—¶é—´é€’å½’ç¥ç»ç½‘ç»œåŠéšé©¬å°”ç§‘å¤«æ¨¡å‹ï¼ˆHMMï¼‰æ›´å¥½ï¼Œæ¯”å¦‚ç”¨åœ¨ä¸åˆ†æ®µè¿ç»­æ‰‹å†™è¯†åˆ«ä¸Šã€‚ä½œä¸ºéçº¿æ€§æ¨¡å‹ï¼ŒLSTMå¯ä½œä¸ºå¤æ‚çš„éçº¿æ€§å•å…ƒç”¨äºæ„é€ æ›´å¤§å‹æ·±åº¦ç¥ç»ç½‘ç»œã€‚</p>
]]></content>
      <categories>
        <category>DeepLearning</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ç¥ç»ç½‘ç»œ</tag>
        <tag>NumPy</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼šä»å‡½æ•°çš„æ±‚å¯¼åˆ°ä¸ç­‰å¼çº¦æŸçš„æ±‚è§£</title>
    <url>/hexo_blog/2018/04/30/%E6%95%B0%E5%AD%A6/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E4%B9%98%E5%AD%90%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>æœ¬ç¯‡æ–‡ç« ç®€å•æ¢³ç†äº†å…³äºæ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•çš„ç›¸å…³é—®é¢˜åŠä¸€äº›ç›¸å…³æ¦‚å¿µçš„ä»‹ç»ã€‚</p>
<span id="more"></span>
<h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3>
<p>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼ˆLagrange
Multiplierï¼‰åœ¨æŸäº›åœ°æ–¹åˆå«åšæ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•ã€‚åœ¨æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€ã€‚æœ€ä¼˜åŒ–é—®é¢˜å¾€å¾€æŠ½è±¡ä¸ºæŸä¸ªå‡½æ•°ï¼Œå³æ±‚å‡½æ•°çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ã€‚æ±‚è§£æœ€å¤§å€¼å’Œæœ€å°å€¼çš„æ±‚è§£å¯ä»¥ç›¸äº’è½¬æ¢ï¼ˆå¯¹å¶ï¼‰ã€‚å¯¹äºæ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼ˆéš¾åº¦ä¾æ­¤é€’å¢ï¼‰ï¼š</p>
<h3 id="æ— çº¦æŸæ¡ä»¶">æ— çº¦æŸæ¡ä»¶</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªéœ€è¦å¯¹ç»™å‡ºçš„å‡½æ•°è¿›è¡Œæ±‚å¯¼ï¼Œä»¤å…¶å¯¼å‡½æ•°ä¸º0çš„ç‚¹å¯èƒ½å°±æ˜¯æå€¼ç‚¹ï¼Œå°†å¯èƒ½çš„ç»“æœåˆ†åˆ«ä»£å›åŸå‡½æ•°è¿›è¡ŒéªŒè¯å³å¯ã€‚</p>
<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°<span class="math inline">\(f(x)\)</span>ï¼Œä»¤<span
class="math inline">\(g(x)=f^{&#39;}(x)\)</span>ï¼Œ<span
class="math inline">\(g(x)=0\)</span>çš„è§£æœ‰<span
class="math inline">\(x_1,x_2,x_3,\cdots\)</span>ã€‚æ±‚å‡½æ•°<span
class="math inline">\(f(x)\)</span>çš„æœ€ä¼˜è§£å°±åªéœ€è¦åˆ†åˆ«å°†<span
class="math inline">\(x_1,x_2,x_3,\cdots\)</span>ä»£å…¥<span
class="math inline">\(f(x)\)</span>ï¼Œæ¯”è¾ƒå¤§å°ï¼Œå¾—åˆ°æœ€ä¼˜è§£<span
class="math inline">\(x_i\)</span>ã€‚</p>
<p>ä»è¿™é‡Œå¼€å§‹å¼•å‡º<strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•</strong></p>
<h3 id="ç­‰å¼çº¦æŸæ¡ä»¶">ç­‰å¼çº¦æŸæ¡ä»¶</h3>
<p>è®¾ç›®æ ‡å‡½æ•°ä¸º<span class="math inline">\(f(x)\)</span>,
çº¦æŸæ¡ä»¶ä¸º$h_k(x) $, <span
class="math inline">\(k=1,2,\cdots,l\)</span>ï¼Œå³è¦æ±‚<span
class="math inline">\(f(x)\)</span>çš„æœ€ä¼˜è§£ï¼Œä½†æ˜¯æœ‰<span
class="math inline">\(l\)</span>ä¸ª<span
class="math inline">\(h(x)\)</span>ç­‰å¼çº¦æŸï¼ˆé™åˆ¶ï¼‰æ±‚è§£ã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰æ‹‰æ ¼æœ—æ—¥å‡½æ•°ä¸º</p>
<p><span class="math display">\[
F(x, \lambda)=f(x)+\sum\limits_{k=1}^{l}\lambda_kh_k(x)
\]</span></p>
<p><span
class="math inline">\(\lambda_k\)</span>è¡¨ç¤ºçº¦æŸæ¡ä»¶çš„å¾…å®šç³»æ•°ã€‚ä¹‹åè§£å˜é‡çš„åå¯¼æ–¹ç¨‹ï¼Œå¦‚ä¸‹:</p>
<p><span class="math display">\[
\frac{\partial F}{\partial x_k}=0, \frac{\partial F}{\partial
\lambda_k}=0, k=1,2,\cdots, l
\]</span></p>
<p>æ±‚è§£å¾—åˆ°äº†<span
class="math inline">\(l+1\)</span>ä¸ªæ–¹ç¨‹ï¼Œå°†ç»“æœä»£å›åŸæ–¹ç¨‹éªŒè¯å³å¯å¾—åˆ°è§£ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<p>ç»™å®šä¸€ä¸ªæ¤­åœ†<span
class="math inline">\(\frac{x^2}{a^2}+\frac{y^2}{b^2}+\frac{z^2}{c^2}=1\)</span>ï¼Œæ±‚è§£<span
class="math inline">\(f(x,y,z)=8xyz\)</span>çš„æœ€å¤§å€¼ã€‚</p>
<p>æ±‚è§£è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>é€šè¿‡æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•çš„å®šä¹‰ï¼Œå¾—åˆ°å¦‚ä¸‹æ–¹ç¨‹</p>
<p><span class="math display">\[
\begin{array}{l}F(x,y,z,\lambda)&amp;=f(x,y,z)+\lambda\cdot h(x,y,z) \\
&amp;=8xyz+\lambda\cdot(\frac{x^2}{a^2}+\frac{y^2}{b^2}+\frac{z^2}{c^2}-1)
\end{array}
\]</span></p></li>
<li><p>æ¥ä¸‹æ¥å¯¹<span
class="math inline">\(F(x,y,z,\lambda)\)</span>æ±‚åå¯¼ï¼Œåˆ†åˆ«å¾—åˆ°</p>
<p><span class="math display">\[
\frac{\partial F(x,y,z,\lambda)}{\partial x}=8yz+\frac{2\lambda
x}{a^2}=0
\]</span></p>
<p><span class="math display">\[
\frac{\partial F(x,y,z,\lambda)}{\partial y}=8xz+\frac{2\lambda
y}{b^2}=0
\]</span></p>
<p><span class="math display">\[
\frac{\partial F(x,y,z,\lambda)}{\partial z}=8xy+\frac{2\lambda
z}{c^2}=0
\]</span></p>
<p><span class="math display">\[
\frac{\partial F(x,y,z,\lambda)}{\partial
\lambda}=\frac{x^2}{a^2}+\frac{y^2}{b^2}+\frac{z^2}{c^2}-1=0
\]</span></p></li>
<li><p>è”ç«‹å‰ä¸‰ä¸ªæ–¹ç¨‹å¯ä»¥å¾—åˆ°<span
class="math inline">\(bx=ay\)</span>å’Œ<span
class="math inline">\(az=cx\)</span>ï¼Œä»£å…¥æœ€åä¸€ä¸ªæ–¹ç¨‹ï¼Œè§£å¾—ï¼š</p>
<p><span class="math display">\[
x=\frac{\sqrt{3}}{3}a
\]</span></p>
<p><span class="math display">\[
y=\frac{\sqrt{3}}{3}b
\]</span></p>
<p><span class="math display">\[
z=\frac{\sqrt{3}}{3}c
\]</span></p></li>
<li><p>æœ€åä»£å…¥åŸæ–¹ç¨‹ï¼Œè§£å¾—æœ€å¤§ä½“ç§¯</p>
<p><span class="math display">\[
V_{max}=f(\frac{\sqrt{3}}{3}a,\frac{\sqrt{3}}{3}b,\frac{\sqrt{3}}{3}c)=\frac{8\sqrt{3}}{9}abc
\]</span></p></li>
</ul>
<h3 id="ä¸ç­‰å¼çº¦æŸæ¡ä»¶">ä¸ç­‰å¼çº¦æŸæ¡ä»¶</h3>
<p>è®¾ç›®æ ‡å‡½æ•°ä¸º<span class="math inline">\(f(x)\)</span>,
ä¸ç­‰å¼çº¦æŸæ¡ä»¶ä¸º<span class="math inline">\(c_i(x)\)</span>,<span
class="math inline">\(i=1,2,\cdots,k\)</span>ï¼Œç­‰å¼çº¦æŸæ¡ä»¶ä¸º$h_j(x) $,
<span class="math inline">\(j=1,2,\cdots,l\)</span>ï¼Œå³è¦æ±‚<span
class="math inline">\(f(x)\)</span>çš„æœ€ä¼˜è§£ï¼Œä½†æ˜¯æœ‰<span
class="math inline">\(k\)</span>ä¸ª<span
class="math inline">\(g(x)\)</span>ä¸ç­‰å¼å’Œ<span
class="math inline">\(l\)</span>ä¸ª<span
class="math inline">\(h(x)\)</span>ç­‰å¼çº¦æŸï¼ˆé™åˆ¶ï¼‰æ±‚è§£ã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰æ‹‰æ ¼æœ—æ—¥å‡½æ•°ä¸º</p>
<p><span class="math display">\[
L(x,a,b)=f(x)+\sum\limits^{k}_{i=1}a_ic_i(x)+\sum\limits^{l}_{j=1}b_jh_j(x)
\]</span></p>
<p>è¿™é‡Œç”¨ä¸€ä¸ªå«åšKKTæ¡ä»¶çš„æ–¹æ³•ï¼ŒæŠŠæ‰€æœ‰çš„ä¸ç­‰å¼çº¦æŸã€ç­‰å¼çº¦æŸå’Œç›®æ ‡å‡½æ•°å…¨éƒ¨å†™ä¸ºä¸€ä¸ªå¼å­<span
class="math inline">\(L(a,b,x)=f(x)+a*c(x)+b*h(x)\)</span>ã€‚</p>
<p>KKTæ¡ä»¶æ˜¯æŒ‡æœ€ä¼˜è§£å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><span class="math inline">\(L(a,b,x)\)</span>æ±‚<span
class="math inline">\(x\)</span>æ±‚å¯¼ä¸º0</li>
<li><span class="math inline">\(h(x)=0\)</span></li>
<li><span class="math inline">\(a*c(x)=0\)</span></li>
</ul>
<p>è¿™æ ·å°±å¯ä»¥å°†ä¸ç­‰å¼çº¦æŸè½¬æ¢ä¸ºäº†ç­‰å¼çº¦æŸï¼Œæ±‚<span
class="math inline">\(L(a,b,x)\)</span>çš„åå¯¼ç­‰äºé›¶å³å¯æ±‚å¾—æœ€ä¼˜å‚æ•°ã€‚</p>
<p><span class="math display">\[
\min f(x)\Leftrightarrow \min\limits_x \max\limits_{a,b} L(x,a,b)
\]</span></p>
<p>ç»è¿‡å¯¹å¶å˜æ¢å¾—ï¼š</p>
<p><span class="math display">\[
\max\limits_{a,b} \min L(x,a,b)
\]</span></p>
<p>å› ä¸º<span class="math inline">\(c(x)&lt;0\)</span>ï¼Œæ‰€ä»¥åªæœ‰å½“<span
class="math inline">\(a*c(x)=0\)</span>æ—¶ï¼Œ<span
class="math inline">\(L(x,a,b)\)</span>æ‰èƒ½å–å¾—æœ€å¤§å€¼ã€‚ä»¥ä¸Šå°±å¯ä»¥ä½¿ç”¨åŒç­‰å¼çº¦æŸçš„æ±‚è§£æ–¹æ³•è¿›è¡Œæ±‚è§£ã€‚</p>
<h3 id="è¡¥å……éƒ¨åˆ†">è¡¥å……éƒ¨åˆ†</h3>
<h4 id="å®šä¹‰ä¸ç­‰å¼çº¦æŸé—®é¢˜çš„æ ‡å‡†å†™æ³•">å®šä¹‰ä¸ç­‰å¼çº¦æŸé—®é¢˜çš„æ ‡å‡†å†™æ³•</h4>
<p><span class="math inline">\(f(x), c_i(x),h_j(x)\)</span>æ˜¯å®šä¹‰åœ¨<span
class="math inline">\(R^n\)</span>ä¸Šçš„è¿ç»­å¯å¾®å‡½æ•°ï¼Œè€ƒè™‘çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š</p>
<p><span class="math inline">\(\min f(x)  \quad  x\in R^n\)</span></p>
<p><span class="math inline">\(s.t. c_i(x) \leq 0 \quad i =
1...k\)</span></p>
<pre><code>$h_j(x)=0 \quad j = 1...l$</code></pre>
<p>å³æœ‰<span class="math inline">\(k\)</span>ä¸ªä¸ç­‰å¼çº¦æŸ<span
class="math inline">\(c_i(x)\)</span>å’Œ<span
class="math inline">\(l\)</span>ä¸ªç­‰å¼çº¦æŸ<span
class="math inline">\(h_j(x)\)</span></p>
<h4 id="æ‹‰æ ¼æœ—æ—¥å‡½æ•°">æ‹‰æ ¼æœ—æ—¥å‡½æ•°</h4>
<p><span class="math inline">\(L(x,\alpha,
\beta)=f(x)+\sum^{k}_{i=1}\alpha_ic_i(x)+\sum^{l}_{j=1}\beta_jh_j(x)\)</span></p>
<p>å…¶ä¸­çš„<span class="math inline">\(\alpha_i\)</span>å’Œ<span
class="math inline">\(\beta_j\)</span>ï¼Œç§°ä¸º<strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­</strong>ï¼Œ<span
class="math inline">\(\alpha_i \geq 0\)</span></p>
<h4 id="å‡ ä½•æ„ä¹‰">å‡ ä½•æ„ä¹‰</h4>
<p>å¯¹äºä¸€ä¸ªäºŒç»´ç©ºé—´æ¥è¯´ï¼Œæ±‚è§£æœ€çŸ­è·¯å¾„çš„é—®é¢˜ã€‚å°†ç»´åº¦å‡é«˜ï¼Œå˜ä¸ºå¯¹äºå¤šç»´ç©ºé—´æ¥è¯´ï¼Œæ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜ã€‚</p>
<p>æ¯”è¾ƒç›´è§‚çš„è§£é‡Šï¼Œçˆ¬å±±çš„ç›®æ ‡æ˜¯åˆ°å±±é¡¶ï¼Œæ ¹æ®æ¢¯åº¦ä¸Šå‡ï¼ˆä¸‹é™ï¼‰çš„æ–¹æ³•æ¥å¯»æ±‚ä¼˜è§£ï¼Œå³çˆ¬åˆ°å±±é¡¶ã€‚</p>
<h4 id="å¯¹å¶æ¦‚å¿µçš„ç®€å•ä»‹ç»">å¯¹å¶æ¦‚å¿µçš„ç®€å•ä»‹ç»</h4>
<p>ä¸€å¯¹ä¸€çš„ä¸€ç§æ–¹å¼ï¼ŒæŠŠä¸€ç§æ¦‚å¿µã€å…¬ç†æˆ–æ•°å­¦ç»“æ„è½¬æ¢ä¸ºå¦ä¸€ç§æ¦‚å¿µã€å…¬ç†æˆ–æ•°å­¦ç»“æ„ã€‚å¦‚æœAçš„å¯¹å¶æ˜¯Bï¼Œé‚£ä¹ˆBçš„å¯¹å¶æ˜¯Aã€‚Açš„å¯¹å¶æœ‰æ—¶å€™æ˜¯Açš„æœ¬èº«ã€‚</p>
<p>æœ‰ç•Œçº¿æ€§æ³›å‡½æ•°ï¼šå¤æ‚å¯¹è±¡æ˜ å°„åˆ°<strong>ç®€å•å¯¹è±¡</strong>ä¸Š</p>
<p>ç¾¤è¡¨ç¤ºï¼šç®€å•å¯¹è±¡å…·æœ‰ç±»ä¼¼çº¿æ€§ç»“æ„çš„<strong>ç®€å•ç»“æ„</strong></p>
<p>èŒƒç•´è®ºï¼šæ˜ å°„ç®­å¤´æ‰€æ„æˆçš„é›†åˆ</p>
<p>ï¼ˆåƒé›†ï¼Œæ˜ å°„ï¼‰â€”â€”&gt;åŸåƒé›†</p>
<p>å¯¹è”å¯ä»¥ç§°ä¸ºä¸€ç§å¯¹å¶ï¼Œä¸Šè”ä¸ä¸‹è”æœ‰å¯¹åº”çš„å…³ç³»ï¼ˆç›¸ä¼¼å’Œå–é€†ï¼‰ã€‚å¯¹å¶æ˜¯æœ‰ä¸€å®šè¦æœ‰è‡ªç„¶åˆç†çš„å¯¹åº”å…³ç³»ï¼ˆæˆ–è€…è¯´èƒ½å¤Ÿå¹å‡ºæ¥çš„è‡ªç„¶åˆç†å…³ç³»ï¼‰ã€‚</p>
<p>å¸¸è§çš„è‡ªç„¶ã€åˆç†æ³•åˆ™é¦–æ¨ï¼šç›¸ä¼¼ï¼ˆåŒ…æ‹¬åŒæ„ï¼‰å’Œå–é€†ï¼ˆåŒ…æ‹¬äº’åï¼‰</p>
<p>å¸¸è§å¯¹å¶çš„ä¾‹å­ï¼š</p>
<ol type="1">
<li>å¥‡æ•°å’Œå¶æ•°</li>
<li>æ´›å¿…è¾¾æ³•åˆ™å’ŒStolz å®šç†ï¼ˆç›¸å½“äºç¦»æ•£æ´›å¿…è¾¾æ³•åˆ™ï¼‰</li>
<li>Fourier ç³»æ•°ä¸ Fourier å˜æ¢ï¼ˆå‚…é‡Œå¶ï¼‰</li>
</ol>
<p>å¯¹å¶å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªé—®é¢˜ä¸å¥½ç†è§£è½¬æ¢ä¸ºå¦ä¸€ä¸ªç®€å•æ–¹å¼çš„é—®é¢˜æ¥ç†è§£ï¼ŒäºŒè€…åœ¨æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ã€‚</p>
<p>æ¯”å¦‚ï¼šæŸä¸ªå‡½æ•°çš„æœ€å¤§åŒ–ä¸æ–¹ä¾¿æ±‚è§£ï¼Œé‚£ä¹ˆå°±æ±‚è¿™ä¸ªå‡½æ•°çš„æœ€å°åŒ–ã€‚</p>
<p>æœªå®Œå¾…ç»­â€¦â€¦</p>
<ol type="1">
<li>ç½šå‡½æ•°</li>
<li>å¹¿ä¹‰ä¹˜å­æ³•</li>
<li>KKTçš„æ±‚å¯¼è¯æ˜</li>
</ol>
]]></content>
      <categories>
        <category>MachineLearning</category>
      </categories>
      <tags>
        <tag>æ•°å­¦</tag>
        <tag>Optimization</tag>
        <tag>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>çŸ©é˜µåˆ†è§£ä»‹ç»åŠPythonå®ç°ï¼ˆQRã€SVDã€LUï¼‰</title>
    <url>/hexo_blog/2018/04/13/%E6%95%B0%E5%AD%A6/%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3%E4%BB%8B%E7%BB%8D%E5%8F%8APython%E5%AE%9E%E7%8E%B0%EF%BC%88QR%E3%80%81SVD%E3%80%81LU%EF%BC%89/</url>
    <content><![CDATA[<p>æœ¬ç¯‡æ–‡ç« ç®€å•ä»‹ç»äº†ä¸‰ç§çŸ©é˜µåˆ†è§£æ–¹å¼å¹¶ä¸”é™„ä¸Šéƒ¨åˆ†åˆ†è§£æ–¹å¼çš„å®ç°ä»£ç ã€‚</p>
<span id="more"></span>
<h1 id="çŸ©é˜µåˆ†è§£">çŸ©é˜µåˆ†è§£</h1>
<p>Pythonå®ç°äº†QRä¸LUåˆ†è§£ï¼ŒQRç”¨äº†ä¸¤ç§å˜æ¢æ–¹å¼å®ç°ã€‚<a
href="https://github.com/wnma3mz/Matrix-factorization">Githubåœ°å€</a></p>
<h2 id="what">Whatï¼Ÿ</h2>
<p><a
href="https://zh.wikipedia.org/wiki/%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3">wikié“¾æ¥</a></p>
<p>å°†çŸ©é˜µæ‹†åˆ†æˆæ•°ä¸ªä¸‰è§’å½¢çŸ©é˜µã€‚</p>
<h2 id="why">Whyï¼Ÿ</h2>
<ol type="1">
<li>æ•°å€¼åˆ†æä¸­ï¼Œç”¨äºå®ç°ä¸€äº›çŸ©é˜µè¿ç®—çš„å¿«é€Ÿç®—æ³•</li>
<li>æ¨èç®—æ³•ï¼ˆSVDï¼‰ï¼Œä¿¡å·å¤„ç†ï¼ˆSVDï¼‰</li>
<li>ååº”çŸ©é˜µä¸­çš„ä¸€äº›æ•°å€¼ç‰¹æ€§ï¼šå¦‚çŸ©é˜µçš„ç§©ã€ç‰¹å¾å€¼(å¥‡å¼‚å€¼)</li>
</ol>
<p>æ¯ä¸€ç§çŸ©é˜µåˆ†è§£æ–¹å¼å¯¹åº”ä¸åŒçš„æ„ä¹‰</p>
<h2 id="how">Howï¼Ÿ</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µä»‹ç»">åŸºæœ¬æ¦‚å¿µä»‹ç»</h3>
<p>å…³äºè½¬ç½®ã€é€†çŸ©é˜µå°±ä¸å¤šä»‹ç»äº†ã€‚</p>
<ul>
<li>æ»¡ç§©çŸ©é˜µ
<ul>
<li>çŸ©é˜µçš„ç§©ç­‰äºè¡Œæ•°â€”&gt;è¡Œæ»¡ç§©</li>
<li>çŸ©é˜µçš„ç§©ç­‰äºåˆ—æ•°â€”&gt;åˆ—æ»¡ç§©</li>
<li>ä»¥ä¸Šä¸¤ä¸ªéƒ½æ»¡è¶³ç§°ä¸ºné˜¶æ–¹é˜µ</li>
</ul></li>
<li>é…‰çŸ©é˜µï¼ˆæ­£äº¤çŸ©é˜µï¼‰
<ul>
<li>æ–¹å—çŸ©é˜µï¼Œå…ƒç´ çš†ä¸ºå®æ•°ï¼Œè¡Œä¸åˆ—çš†æ­£äº¤çš„å•ä½å‘é‡</li>
<li>ç‰¹æ€§ï¼šçŸ©é˜µçš„è½¬ç½®çŸ©é˜µä¸ºé€†çŸ©é˜µ</li>
<li>å®šç†ï¼ˆdetè¡¨ç¤ºè¡Œåˆ—å¼ï¼‰ï¼š</li>
</ul></li>
</ul>
<p><span class="math display">\[Q^T=Q^{-1}\Leftrightarrow Q^TQ=QQ^T =
I\]</span></p>
<p><span
class="math display">\[1=\det(I)=\det(Q^TQ)=\det(Q^T)\det(Q)=(\det(Q))^2\Rightarrow|Q|
\pm 1\]</span></p>
<ul>
<li><p>å•ä½çŸ©é˜µ</p>
<ul>
<li>çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¸º1</li>
<li>å¦‚ä¸‹</li>
</ul>
<p><span class="math display">\[\left| \begin{array}{ccc} 1 &amp; 1
&amp; 1 \\ 1 &amp; 1 &amp; 1 \\ 1&amp; 1 &amp; 1 \end{array}
\right|\]</span></p></li>
<li><p>ä¸Šä¸‰è§’çŸ©é˜µ</p>
<ul>
<li>éé›¶å…ƒç´ åœ¨å³ä¸Šæ–¹çš„çŸ©é˜µ</li>
<li>å¦‚ä¸‹</li>
</ul>
<p><span class="math display">\[\left| \begin{array}{ccc} 1 &amp; 2
&amp; 3 \\ 0 &amp; 1 &amp; 2\\ 0&amp; 0 &amp; 1 \end{array}
\right|\]</span></p></li>
<li><p>äºŒèŒƒæ•°</p>
<ul>
<li>å‡è®¾æœ‰ä¸€ä¸ªxçš„å‘é‡</li>
</ul>
<p><span class="math display">\[x= (1, 2, 3)^T\]</span></p>
<ul>
<li>é‚£ä¹ˆå®ƒçš„äºŒèŒƒæ•°è¡¨ç¤ºå¦‚ä¸‹</li>
</ul>
<p><span class="math display">\[||x||_2 =\sqrt{1^2 + 2^2 +
3^2}=\sqrt{14}\]</span></p></li>
<li><p>å…±è½­è½¬ç½®</p>
<p><span class="math display">\[A^*=(\bar{A})^T=\bar{A^T}\]</span></p>
<ul>
<li>ç°æœ‰çŸ©é˜µA</li>
</ul>
<p><span class="math display">\[A=\left[ \begin{array}{ccc} 3+i &amp; 5
\\ 2-2i &amp; i\end{array} \right]\]</span></p>
<ul>
<li>åˆ™å®ƒçš„å…±è½­çŸ©é˜µå¦‚ä¸‹</li>
</ul>
<p><span class="math display">\[A^*=\left[ \begin{array}{ccc} 3-i &amp;
2+2i \\ 5 &amp; -i\end{array} \right]\]</span></p></li>
<li><p>ç‰¹å¾å€¼ä¸å¥‡å¼‚å€¼</p>
<p>æˆ‘çš„ç†è§£æ˜¯ï¼šç‰¹å¾å€¼æ˜¯å¥‡å¼‚å€¼çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œç‰¹å¾å€¼æ˜¯åœ¨çŸ©é˜µæ˜¯æ–¹é˜µæ—¶å€™çš„å¥‡å¼‚å€¼ã€‚</p>
<p>å…³äºä»€ä¹ˆæ˜¯ç‰¹å¾å€¼ã€‚</p>
<p>ä¸€ä¸ªçŸ©é˜µå¯ä»¥ç†è§£ä¸ºç”±nä¸ªå‘é‡ç»„æˆçš„ï¼Œè€Œç‰¹å¾å€¼å°±æ˜¯ååº”å‘é‡é•¿åº¦ï¼ˆé‡è¦æ€§ï¼‰çš„æ ‡å‡†ï¼Œç‰¹å¾å€¼è¶Šå¤§ï¼Œåˆ™å¯¹åº”å‘é‡å°±è¶Šé‡è¦ã€‚</p>
<p>å‡è®¾åˆ¤æ–­ç”µå½±ä¸ºåŠ¨ä½œç‰‡è¿˜æ˜¯æç¬‘ç‰‡ï¼Œå¯ä»¥ç”±ä»¥ä¸‹å‡ ä¸ªç‰¹å¾æ¥è¡¡é‡ï¼Œæ‰“æ–—åœºæ™¯ã€è§‚ä¼—ç¬‘å£°æ¬¡æ•°ã€å¯¼æ¼”ã€æ¼”å‘˜â€¦â€¦ã€‚å°†æ•°æ®ç¦»æ•£åŒ–æˆçŸ©é˜µï¼Œç„¶åæå–ç‰¹å¾å€¼ï¼Œç‰¹å¾å€¼è¶Šå¤§çš„ç‰¹å¾åˆ™å¯¹äºè¡¡é‡ç”µå½±æ˜¯åŠ¨ä½œç‰‡è¿˜æ˜¯æç¬‘ç‰‡çš„æ¯”é‡è¶Šå¤§ã€‚</p></li>
<li><p>HouseholderçŸ©é˜µ</p>
<ul>
<li><p><a
href="https://zh.wikipedia.org/wiki/è±ªæ–¯éœå°”å¾·å˜æ¢">wikié“¾æ¥</a></p></li>
<li><p>å…¬å¼å¦‚ä¸‹ï¼ŒHè¡¨ç¤ºHouseholderçŸ©é˜µï¼ŒIè¡¨ç¤ºå•ä½çŸ©é˜µï¼Œvè¡¨ç¤ºå•ä½å‘é‡ï¼Œv*è¡¨ç¤ºvçš„å…±è½­è½¬ç½®ã€‚</p>
<p><span class="math display">\[H=I-2vv^*\]</span></p></li>
<li><p>æ€§è´¨ï¼š</p>
<ol type="1">
<li>HçŸ©é˜µçš„è½¬ç½®ç­‰äºå®ƒæœ¬èº«çš„é€†</li>
<li>HçŸ©é˜µçš„å¹³æ–¹ç­‰äºå•ä½çŸ©é˜µ</li>
</ol>
<p><span class="math display">\[H^{-1}=H^*\]</span></p>
<p><span class="math display">\[H^2=I\]</span></p></li>
</ul></li>
</ul>
<h3 id="svdåˆ†è§£">1. SVDåˆ†è§£</h3>
<p><a
href="https://blog.csdn.net/u010099080/article/details/68060274">æ•°å­¦è§£é‡Šå‚è€ƒé“¾æ¥</a></p>
<p>å¥‡å¼‚å€¼åˆ†è§£ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[M=U\Sigma V^*\]</span></p>
<p>ä¸¾ä¾‹ï¼š</p>
<p><span class="math display">\[\begin{array}{clll} M &amp;= U\Sigma V^*
\\ &amp;= \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 &amp; 2\\ 0 &amp; 0
&amp; 3 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 4
&amp; 0 &amp; 0 &amp; 0\end{bmatrix} \\  &amp;= \begin{bmatrix} 0 &amp;
0 &amp; 1 &amp; 0\\ 0 &amp; 1 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp;
1\\ 1 &amp; 0 &amp; 0 &amp; 0\end{bmatrix} \cdot \begin{bmatrix} 4 &amp;
0 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 3 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp;
0 &amp; \sqrt{5} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp;
0\end{bmatrix} \cdot \begin{bmatrix} 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\ \sqrt{0.2} &amp; 0 &amp; 0 &amp; 0
&amp; \sqrt{0.8}\\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\ \sqrt{0.8} &amp;
0 &amp; 0 &amp; 0 &amp; -\sqrt{0.2}\end{bmatrix}
\end{array}\]</span></p>
<p>æ€§è´¨:</p>
<ol type="1">
<li>çŸ©é˜µ<span
class="math inline">\(\Sigma\)</span>çš„æ‰€æœ‰éå¯¹è§’å…ƒä¸º0ã€‚çŸ©é˜µ<strong>U</strong>å’Œ<span
class="math inline">\(V^*\)</span>éƒ½æ˜¯é…‰çŸ©é˜µï¼Œå®ƒä»¬ä¹˜ä¸Šå„è‡ªçš„å…±è½­è½¬ç½®éƒ½å¾—åˆ°å•ä½çŸ©é˜µ</li>
<li>å¥‡å¼‚å€¼çš„åˆ†è§£å¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ˜¯å› ä¸º<span
class="math inline">\(\Sigma\)</span>çŸ©é˜µä¸­çš„å¯¹è§’å…ƒæœ‰å…ƒç´ ä¸º0</li>
</ol>
<p>æ­¥éª¤ï¼š</p>
<ol type="1">
<li>è®¡ç®—<span class="math inline">\(M.T\cdot
M\)</span>å¾—åˆ°ç‰¹å¾å‘é‡ï¼ˆå·¦å¥‡å¼‚å‘é‡ï¼‰ï¼Œæ˜¯Uçš„åˆ—å‘é‡</li>
<li>è®¡ç®—<span class="math inline">\(M\cdot
M.T\)</span>å¾—åˆ°ç‰¹å¾å‘é‡ï¼ˆå³å¥‡å¼‚å‘é‡ï¼‰ï¼Œæ˜¯Vçš„åˆ—å‘é‡</li>
<li>è®¡ç®—<span class="math inline">\(M\cdot M.T\)</span>æˆ–è€…<span
class="math inline">\(M.T\cdot
M\)</span>å¾—åˆ°ç‰¹å¾å€¼ï¼Œæ‰€æœ‰éé›¶ç‰¹å¾å€¼çš„å¹³æ–¹æ ¹ï¼ˆäºŒèŒƒæ•°ï¼‰</li>
</ol>
<p>å¾—åˆ°ç‰¹å¾å‘é‡ä¹‹åï¼Œéœ€è¦ä¾ç…§ç‰¹å¾å€¼ä»å¤§åˆ°å°è¿›è¡Œæ’åºã€‚</p>
<p>å…³äºæ±‚ç‰¹å¾å€¼çš„æ–¹æ³•ï¼Œçº¿ä»£ä¹¦ä¸Šå·²åšä»‹ç»ï¼Œå°±ä¸èµ˜è¿°ã€‚å¦‚æœè¿ç”¨ç¼–ç¨‹æ–¹æ³•æ±‚çŸ©é˜µçš„ç‰¹å¾å€¼ï¼Œæœ€å¸¸è§çš„æ–¹æ³•æœ‰<strong>é›…å¯æ¯”ç®—æ³•ã€å¹‚æ³•ã€‚</strong>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å…ˆè¿›è¡ŒQRåˆ†è§£æ±‚å¾—ç‰¹å¾å€¼ä¹‹åï¼Œå†ç»§ç»­è¿›è¡ŒSVDã€‚</p>
<h3 id="luåˆ†è§£">2. LUåˆ†è§£</h3>
<p><a
href="https://jiayi797.github.io/2017/03/29/%E6%95%B0%E5%AD%A6-%E7%9F%A9%E9%98%B5LU%E5%88%86%E8%A7%A3/">å‚è€ƒé“¾æ¥</a></p>
<p>å°†ä¸€ä¸ªçŸ©é˜µåˆ†è§£ä¸ºä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µå’Œä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µçš„ä¹˜ç§¯ã€‚å½¢å¼å¦‚ï¼š</p>
<p><span class="math display">\[A=LU\]</span></p>
<p>æ ¼å¼å¦‚ä¸‹</p>
<p><span class="math display">\[\left[ \begin{array} { l l l } { a _ {
11 } } &amp; { a _ { 12 } } &amp; { a _ { 13 } } \\ { a _ { 21 } } &amp;
{ a _ { 22 } } &amp; { a _ { 23 } } \\ { a _ { 31 } } &amp; { a _ { 32 }
} &amp; { a _ { 33 } } \end{array} \right] = \left[ \begin{array} { c c
c } { l _ { 11 } } &amp; { 0 } &amp; { 0 } \\ { l _ { 21 } } &amp; { l _
{ 22 } } &amp; { 0 } \\ { l _ { 31 } } &amp; { l _ { 32 } } &amp; { l _
{ 33 } } \end{array} \right] \left[ \begin{array} { c c c } { u _ { 11 }
} &amp; { u _ { 12 } } &amp; { u _ { 13 } } \\ { 0 } &amp; { u _ { 22 }
} &amp; { u _ { 23 } } \\ { 0 } &amp; { 0 } &amp; { u _ { 33 } }
\end{array} \right]\]</span></p>
<p>åˆ†è§£è¿‡ç¨‹ï¼š</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/matrix/2017-03-29-20-13-15.png" /></p>
<p>å£°æ˜ï¼šl11è¡¨ç¤ºLçŸ©é˜µçš„ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„å…ƒç´ ï¼ŒU1iè¡¨ç¤ºLçŸ©é˜µç¬¬ä¸€è¡Œæ¯ä¸€åˆ—ï¼ˆéœ€è¦éå†çš„åˆ—ï¼‰çš„å…ƒç´ </p>
<ol type="1">
<li>åˆå§‹åŒ–Lã€UçŸ©é˜µã€‚LçŸ©é˜µä¸‹ä¸‰è§’çŸ©é˜µï¼Œå¯¹è§’å…ƒç´ å…¨ä¸º1ï¼›UçŸ©é˜µä¸ºä¸Šä¸‰è§’çŸ©é˜µã€‚</li>
<li>è®¡ç®—UçŸ©é˜µçš„ç¬¬ä¸€è¡Œï¼Œå¯¹åº”AçŸ©é˜µçš„ç¬¬ä¸€è¡Œå…ƒç´ ï¼Œä¸éœ€è¦åšä»»ä½•æ“ä½œ</li>
<li>è®¡ç®—LçŸ©é˜µçš„ç¬¬ä¸€åˆ—ï¼ˆé™¤å»ç¬¬ä¸€è¡Œå…ƒç´ ï¼‰ï¼Œå¯¹åº”AçŸ©é˜µçš„ç¬¬ä¸€åˆ—å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ é™¤ä»¥u11</li>
<li>è®¡ç®—UçŸ©é˜µçš„ç¬¬äºŒè¡Œï¼ˆé™¤å»ç¬¬ä¸€åˆ—å…ƒç´ ï¼‰ï¼Œå¯¹åº”AçŸ©é˜µçš„ç¬¬äºŒè¡Œå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å‡å»l21*u1i</li>
<li>è®¡ç®—LçŸ©é˜µçš„ç¬¬äºŒåˆ—ï¼ˆé™¤å»å‰ä¸¤è¡Œå…ƒç´ ï¼‰ï¼Œå¯¹åº”AçŸ©é˜µçš„ç¬¬äºŒåˆ—å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å…ˆå‡å»l31*u12ï¼Œå†é™¤ä»¥u22</li>
<li>â€¦â€¦</li>
</ol>
<p>æ€»ç»“å…¬å¼å¦‚ä¸‹ï¼š</p>
<p>LçŸ©é˜µå¯¹è§’å…ƒç´ ä¸º1ã€‚</p>
<p>ç¬¬ä¸€æ­¥çš„å…¬å¼ï¼š</p>
<p><span class="math display">\[\begin{array}{lll}
a_{1j}=(1,0,0,\cdots,0)\cdot(u_{1j},u_{2j},\cdots,u_{ij}).T=u_{1j} \\
a_{i1}=(l_{i1},
l_{i1},\cdots,l_{i1})\cdot(u_{11},0,\cdots,0).T=l_{i1}\cdot u_{11}
\\u_{1j}=a_{1j}  \\ l_{i1}=\frac{a_{i1}}{u_{11}} \\j=1,2,\cdots,n
\\i=2,3,\cdots,n\end{array}\]</span></p>
<p>ç¬¬ræ­¥çš„å…¬å¼ï¼š</p>
<p><span
class="math display">\[\begin{array}{rl}  a_{rj}&amp;=(l_{r1},l_{r2},...,l_{rr-1})\cdot(u_{1j},u_{2j},...,u_{jj}).T
\\&amp;=\sum\limits_{k=1}^{r-1}l_{rk}u_{kj}+u_{rj}  \end{array}\]</span></p>
<p><span class="math display">\[\begin{array}{lll}
u_{rj}=a_{rj}-\sum\limits_{k=1}^{r-1}l_{rk}u_{kj} \\
l_{ir}=\frac{a_{ir}-\sum\limits_{k=1}^{r-1}l_{ik}u_{kr}}{u_{rr}}
\end{array}\]</span></p>
<p><span class="math display">\[\begin{array}{lll} j=r,r+1,\cdots,n \\
r=2,3,\cdots,n-1 \\ i=r+1,\cdots,n\end{array}\]</span></p>
<h3 id="qråˆ†è§£">3. QRåˆ†è§£</h3>
<p><a
href="https://wenku.baidu.com/view/c2e34678168884868762d6f9.html">å‚è€ƒé“¾æ¥</a></p>
<p>æŠŠçŸ©é˜µåˆ†è§£æˆä¸€ä¸ªåŠæ­£äº¤çŸ©é˜µä¸ä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µçš„ç§¯ã€‚</p>
<p>å½¢å¼å¦‚:</p>
<p><span class="math display">\[A=QR\]</span></p>
<p>åˆ†è§£å®šç†ï¼šä»»æ„ä¸€ä¸ªæ»¡ç§©å®ï¼ˆå¤ï¼‰çŸ©é˜µAï¼Œéƒ½å¯å”¯ä¸€åœ°åˆ†è§£A=QR,å…¶ä¸­Qä¸ºæ­£äº¤ï¼ˆé…‰ï¼‰çŸ©é˜µï¼ŒRæ˜¯å…·æœ‰å¯¹è§’å…ƒçš„ä¸Šä¸‰è§’çŸ©é˜µã€‚</p>
<h4 id="ä¸‰ç§å®ç°æ–¹å¼">ä¸‰ç§å®ç°æ–¹å¼</h4>
<ol type="1">
<li><p>Gram-Schmidtæ­£äº¤åŒ–</p>
<p>è¿‡ç¨‹:</p>
<ol type="1">
<li><p>å–å‡ºçŸ©é˜µAä¸­çš„æ¯ä¸€åˆ—å‘½åä¸ºx_colï¼Œå®ƒä»¬ä¹‹é—´çº¿æ€§æ— å…³</p></li>
<li><p>å°†æ¯ä¸€ä¸ªx_colæ­£äº¤åŒ–å¾—åˆ°y_col</p></li>
<li><p>å†å°†y_colè¿›è¡Œå•ä½åŒ–ï¼Œå³è½¬æ¢ä¸ºe_colã€‚è¿™é‡Œæ¯ä¸ªe_colä¸ºçŸ©é˜µQä¸­çš„æ¯ä¸€åˆ—ã€‚</p></li>
<li><p>å°†ç¬¬äºŒæ­¥ä¸­ï¼Œå…ˆè½¬æ¢ä¸ºy_colçš„æ­£äº¤åŒ–å¾—åˆ°x_colï¼Œå†è½¬æ¢ä¸ºe_colæ­£äº¤åŒ–å¾—åˆ°x_colã€‚è¿™é‡Œæ¯ä¸ªe_colçš„ç³»æ•°ï¼Œå¯¹åº”çš„å°±æ˜¯çŸ©é˜µRä¸­çš„æ¯ä¸€åˆ—</p></li>
</ol></li>
<li><p>Householderå˜æ¢</p>
<p><a href="https://www.bbsmax.com/A/gVdnKqK1zW/">å‚è€ƒé“¾æ¥</a></p>
<p>outerå‡½æ•°</p>
<ul>
<li><p>é€šå¸¸æœ‰ä¸¤ä¸ªè¾“å…¥å‘é‡ï¼Œå‡è®¾ä¸ºå‘é‡aã€b</p>
<p><span class="math display">\[a = (1, 2, 3) , b = (-1, -2,
-3)\]</span></p></li>
<li><p>é‚£ä¹ˆï¼Œouterå‡½æ•°è¿ç®—è¿‡ç¨‹å¦‚</p></li>
</ul>
<p><span class="math display">\[outer(a, b) = \left[ \begin{array}{ccc}
1*-1 &amp; 1*-2 &amp; 1*-3 \\ 2*1 &amp; 2*-2 &amp; 2*-3 \\ 3*-1 &amp;
3*-2 &amp; 3*-3 \end{array} \right]\]</span></p>
<p>è¿‡ç¨‹:</p>
<ol type="1">
<li>åˆå§‹åŒ–çŸ©é˜µQä¸ºå•ä½çŸ©é˜µ(rxr)ï¼Œrä¸ºçŸ©é˜µAçš„è¡Œæ•°ã€‚åˆå§‹åŒ–çŸ©é˜µRä¸ºçŸ©é˜µA</li>
<li>å–Rä¸­çš„ä¸‹ä¸‰è§’çŸ©é˜µï¼Œæ¯æ¬¡å–ä¸€åˆ—å‘½åä¸ºxï¼ˆä¸åŒ…æ‹¬æœ€åä¸€åˆ—ï¼‰ã€‚eåˆå§‹åŒ–ä¸ºå½¢å¦‚xçš„é›¶å‘é‡</li>
<li>eä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‘é‡xçš„äºŒèŒƒæ•°</li>
<li>è¿™é‡Œå¾—åˆ°vï¼ŒèŒƒæ•°å–2</li>
</ol>
<p><span class="math display">\[v = \frac{x - e}{||x-e||}\]</span></p>
<ol start="5" type="1">
<li>åˆå§‹åŒ–ä¸€ä¸ªå•ä½çŸ©é˜µå‘½åä¸ºQ_cntï¼Œå–Q_cntçš„ä¸‹ä¸‰è§’çŸ©é˜µï¼Œæ¯æ¬¡å–ä¸€åˆ—åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå‡å»2*outer(v,
v)ã€‚ï¼ˆä¸åŒ…æ‹¬æœ€åä¸€åˆ—ï¼‰</li>
<li>æ›´æ–°R,Q</li>
</ol>
<p><span class="math display">\[R = Q\_cnt * R \]</span></p>
<p><span class="math display">\[Q = Q * Q\_cnt\]</span></p></li>
<li><p>Givenså˜æ¢</p>
<p><a
href="http://www.voidcn.com/article/p-vmnqitql-xa.html">å‚è€ƒé“¾æ¥</a></p>
<p>æœ‰å¾…è¡¥å……</p></li>
</ol>
]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>æ•°å­¦</tag>
        <tag>çŸ©é˜µåˆ†è§£</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¥ç»ç½‘ç»œç¬”è®°â… </title>
    <url>/hexo_blog/2018/04/14/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0%E2%85%A0/</url>
    <content><![CDATA[<p>æœ¬ç¯‡æ–‡ç« åªåšä¸€ä¸ªç¥ç»ç½‘ç»œå…¥é—¨çŸ¥è¯†çš„æ¢³ç†å’Œä¸ªäººçš„ç†è§£ã€‚</p>
<span id="more"></span>
<p>å…³äºç¥ç»ç½‘ç»œçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µåœ¨è¿™é‡Œå°±ä¸åšä»‹ç»ï¼Œé¦–å…ˆæˆ‘ä»¬è¿›è¡Œä¸€äº›æ¦‚å¿µå’Œç¬¦å·ä¸Šçš„çº¦å®šã€‚</p>
<p>å‡è®¾ä¸€ä¸ªçŸ©é˜µå¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
\mathbf{X} = \left[ \begin{array}{ccc} 1 &amp; 2 &amp; 3 \\ 2 &amp; 3
&amp; 1 \\ 3 &amp; 2 &amp; 1  \end{array}\right]
\]</span></p>
<p><strong>ç‚¹ä¹˜</strong>ï¼š <span
class="math inline">\(\cdot\)</span></p>
<p><span class="math display">\[
\mathbf{X} \cdot \mathbf{X} = \left [ \begin{array}{ccc} 1*1 &amp; 2* 2
&amp; 3* 3 \\ 2*2 &amp; 3*3 &amp; 1*1 \\ 3*3&amp; 2*2 &amp; 1*1
\end{array} \right]= \left [ \begin{array}{ccc} 1 &amp; 4 &amp; 9 \\
4&amp; 9&amp; 1 \\ 9&amp; 4&amp; 1 \end{array} \right]
\]</span></p>
<p><strong>å‰ä¹˜</strong>ï¼š *</p>
<p><span class="math display">\[
\mathbf{X} * \mathbf{X} = \left [ \begin{array}{ccc} 1* 1 + 2*2+
3*3&amp; 1*2+2*3+3*2 &amp; 1*3+2*1+3*1 \\ 2*1+3*2+1*3 &amp; 2*2+3*3+1*2
&amp; 2*3+3*1+1*1 \\ 3*1+2*2+1*3&amp; 3*2+2*3+1*2&amp;
3*3+2*1+1*1\end{array} \right]= \left [ \begin{array}{ccc}14 &amp; 14
&amp; 8 \\11&amp; 15&amp; 10 \\ 10&amp; 14&amp; 12 \end{array} \right]
\]</span></p>
<p><strong>å·²çŸ¥æ•°æ®</strong>ï¼š
çŸ©é˜µ<strong>X</strong>ä¸ºè®­ç»ƒæ•°æ®é›†ï¼ŒçŸ©é˜µ<strong>y</strong>ä¸ºè®­ç»ƒæ•°æ®é›†çš„æ ‡ç­¾</p>
<h2 id="æœ€ç®€å•çš„ç¥ç»ç½‘ç»œ">æœ€ç®€å•çš„ç¥ç»ç½‘ç»œ</h2>
<p><a
href="https://juejin.im/entry/5ab495f151882521d657806f">åŸºäºNumpyå®ç°ç¥ç»ç½‘ç»œï¼šåå‘ä¼ æ’­</a></p>
<p>æœ€ç®€å•çš„ç¥ç»ç½‘ç»œå°±æ˜¯åªæœ‰è¾“å…¥å±‚å’Œè¾“å‡ºå±‚çš„ç½‘ç»œç»“æ„ï¼ˆåŒå±‚ç¥ç»ç½‘ç»œï¼‰ã€‚</p>
<p>å…³äºæ¿€æ´»å‡½æ•°ç®€å•ä»‹ç»ï¼š</p>
<p>å¦‚æœä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¸å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ç›¸å½“ã€‚å¼•å…¥ä¹‹åï¼Œä¸‹ä¸€å±‚çš„è¾“å…¥å°±ä¸å†æ˜¯çº¿æ€§ç»„åˆï¼Œè¾“å‡ºå°±æœ‰æ„ä¹‰ã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼Œé‚£ä¹ˆè¾“å…¥ä¸è¾“å‡ºéƒ½æ˜¯çº¿æ€§å˜æ¢ï¼Œæ— æ³•åšåˆ°éçº¿æ€§åˆ†ç±»ã€‚</p>
<h3 id="æ¿€æ´»å‡½æ•°">æ¿€æ´»å‡½æ•°</h3>
<p>è¿™æ˜¯å…¬å¼ï¼Œå€¼åŸŸä¸º[0,1]ï¼Œå®ƒçš„å¯¼æ•°è‡ªè¯ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ol type="1">
<li>å¼•å…¥éçº¿æ€§å› ç´ </li>
<li>çº¿æ€§å˜æ¢</li>
<li>æ¿€æ´»å‡½æ•°ï¼Œå¹¶ä¸æ˜¯å»æ¿€æ´»ä»€ä¹ˆï¼Œè€Œæ˜¯æŒ‡å¦‚ä½•æŠŠâ€œæ¿€æ´»çš„ç¥ç»å…ƒçš„ç‰¹å¾â€é€šè¿‡å‡½æ•°æŠŠç‰¹å¾ä¿ç•™å¹¶æ˜ å°„å‡ºæ¥ï¼ˆä¿ç•™ç‰¹å¾ï¼Œå»é™¤ä¸€äº›æ•°æ®ä¸­æ˜¯çš„å†—ä½™ã€‚æ¿€åŠ±å°±æ˜¯æ ·æœ¬çš„ç‰¹å¾å€¼ï¼‰ï¼Œè¿™æ˜¯ç¥ç»ç½‘ç»œèƒ½è§£å†³éçº¿æ€§é—®é¢˜å…³é”®ã€‚</li>
</ol>
<p><code>sigmoid</code>çš„å¯¼æ•°ï¼Œå³ä½¿ç”¨äº† <code>deriv=True</code>ã€‚</p>
<p>ä½œç”¨ï¼šç”¨å®ƒçš„è¾“å‡ºåˆ›å»ºå®ƒçš„å¯¼æ•°ï¼Œé™ä½é«˜ä¿¡åº¦é¢„æµ‹çš„é”™è¯¯</p>
<p>æ³¨æ„ï¼šå¦‚æœç¥ç»ç½‘ç»œæå‰è¾¾åˆ°é¢„æœŸçš„ç»“æœï¼ˆæŸå¤±å‡½æ•°å°äºä¸€å®šçš„èŒƒå›´ï¼‰ï¼Œå¯ä»¥æå‰ç»ˆæ­¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># çŸ©é˜µè®¡ç®—</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ¿€æ´»å‡½æ•°, è¿™é‡Œç”¨sigmoidå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="comment"># å¦‚æœæ»¡è¶³æ¡ä»¶å°±è¿”å›sigmoidçš„å¯¼æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (deriv == <span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="comment"># ä¸æ»¡è¶³ç›´æ¥è¿”å›sigmoidå‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè®­ç»ƒæ•°æ®, Xè§„æ¨¡ä¸º4x3, yè§„æ¨¡ä¸º4x1</span></span><br><span class="line">X = np.array([[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">y = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æƒé‡æ•°æ®, ç”¨éšæœºæ•°è¿›è¡Œåˆå§‹åŒ–ï¼ŒçŸ©é˜µè§„æ¨¡3x1</span></span><br><span class="line">syn_0 = <span class="number">2</span> * np.random.random((<span class="number">3</span>, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œè¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    <span class="comment"># è¾“å…¥å±‚ä¸ºè®­ç»ƒæ•°æ®</span></span><br><span class="line">    l0 = X</span><br><span class="line">    <span class="comment"># np.dotè¡¨ç¤ºå‰ä¹˜, è¿›è¡Œæ¿€æ´»æ“ä½œï¼Œ è¾“å‡ºå±‚</span></span><br><span class="line">    l1 = sigmoid(np.dot(l0, syn_0))</span><br><span class="line">    <span class="comment"># è®¡ç®—åå·®</span></span><br><span class="line">    l1_error = y - l1</span><br><span class="line">    <span class="comment"># è¯¯ï¼ˆåï¼‰å·®åŠ æƒå¯¼æ•°ã€‚åå·®ä¹˜ä»¥sigmoidåœ¨l1å¤„çš„æ–œç‡ï¼Œç”¨ä»¥æ›´æ–°æƒé‡</span></span><br><span class="line">    l1_delta = l1_error * sigmoid(l1, deriv=<span class="literal">True</span>)</span><br><span class="line">    syn_0 += np.dot(l0.T, l1_delta)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒå®Œæˆï¼Œè¾“å‡ºl1çœ‹çœ‹</span></span><br><span class="line"><span class="built_in">print</span>(l1)</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰å±‚ç¥ç»ç½‘ç»œ">ä¸‰å±‚ç¥ç»ç½‘ç»œ</h2>
<p>å¢åŠ äº†ä¸€å±‚ç½‘ç»œï¼Œåœ¨è¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¸­é—´ã€‚è¿™é‡Œåšä¸€ä¸ªè§„å®šï¼Œåœ¨è¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„ç½‘ç»œç»“æ„æˆ‘ä»¬ç§°ä¸ºéšè—å±‚ã€‚</p>
<p><strong>ä¸€å±‚éšå±‚ç½‘ç»œå°±æ˜¯ä¸€å±‚ç‰¹å¾å±‚æ¬¡ï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒå¯ä»¥ç±»ä¼¼çœ‹ä½œä¸€ä¸ªç‰¹å¾å±æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> (deriv == <span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line">X = np.array([[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">y = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æƒé‡æ•°æ®, ç”¨éšæœºæ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œ è¿™é‡Œçš„è§„æ¨¡åŒXã€yçŸ©é˜µçš„è§„æ¨¡</span></span><br><span class="line">syn_0 = <span class="number">2</span> * np.random.random((<span class="number">3</span>, <span class="number">4</span>)) - <span class="number">1</span></span><br><span class="line">syn_1 = <span class="number">2</span> * np.random.random((<span class="number">4</span>, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    l0 = X</span><br><span class="line">    l1 = sigmoid(np.dot(l0, syn_0))</span><br><span class="line">    <span class="comment"># åŠ äº†ä¸€å±‚ç¥ç»ç½‘ç»œï¼Œç§°ä¸ºéšè—å±‚</span></span><br><span class="line">    l2 = sigmoid(np.dot(l1, syn_1))</span><br><span class="line">    l2_error = y - l2</span><br><span class="line">    l2_delta = l2_error * sigmoid(l2, deriv=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># è®¡ç®—å®Œl2çš„è¯¯å·®ä¹‹åï¼Œå†ç”¨ç»“æœå»è®¡ç®—l1çš„è¯¯å·®</span></span><br><span class="line">    l1_error = np.dot(l2_delta, syn_1.T)</span><br><span class="line">    l1_delta = l1_error * sigmoid(l1, deriv=<span class="literal">True</span>)</span><br><span class="line">    syn_1 += np.dot(l1.T, l2_delta)</span><br><span class="line">    syn_0 += np.dot(l0.T, l1_delta)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(l1)</span><br></pre></td></tr></table></figure>
<h2 id="æ”¹è¿›ç¥ç»ç½‘ç»œv1.0å¢åŠ æ¢¯åº¦">æ”¹è¿›ç¥ç»ç½‘ç»œv1.0â€”â€”å¢åŠ æ¢¯åº¦</h2>
<p><a
href="http://iamtrask.github.io/2015/07/27/python-network-part2/">A
Neural Network in 13 lines of Python (Part 2 - Gradient Descent)</a></p>
<p>å…³äºæ¢¯åº¦çš„å®šä¹‰è¯·è‡ªè¡Œäº†è§£ã€‚</p>
<p>å¢åŠ äº†æ¢¯åº¦å¯ä»¥æ›´å¿«çš„æ‰¾åˆ°è¾ƒä¸ºç†æƒ³çš„ç»“æœã€‚</p>
<p>å…³äºæ¢¯åº¦ä¸Šå‡æœ‰ä¸‹é¢å‡ ç§æ–¹æ³•ï¼ˆæ¢¯åº¦ä¸‹é™åŒç†ï¼‰ï¼š</p>
<ol type="1">
<li><p>åŸå§‹çš„æ¢¯åº¦ä¸Šå‡</p>
<p>ç›®æ ‡ï¼šæ‰¾åˆ°æŸä¸ªå‡½æ•°çš„æœ€å¤§å€¼ã€‚æ¯æ¬¡æ²¿å‡½æ•°çš„æ¢¯åº¦æ–¹å‘æ¢å¯»ã€‚ä¸€ç›´è¿›è¡Œè¿­ä»£ï¼Œç›´åˆ°åˆ°è¾¾æŸä¸ªåœæ­¢æ¡ä»¶ï¼ˆè¿­ä»£æ¬¡æ•°é™åˆ¶æˆ–æŸä¸ªè¯¯å·®èŒƒå›´ï¼‰</p></li>
<li><p>éšæœºæ¢¯åº¦ä¸Šå‡(SGD)</p>
<p>ä¸åŒç‚¹åœ¨äºï¼Œç¬¬ä¸€ç§æ–¹æ³•æ¯æ¬¡æ˜¯éå†æ‰€æœ‰çš„æ•°æ®é›†ï¼ˆä¸€ç™¾ä»¥å†…çš„æ•°æ®é›†å¯ä»¥æ¥å—ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼‰ã€‚è€Œéšæœºæ¢¯åº¦åˆ™æ˜¯åªä½¿ç”¨ä¸€ä¸ªæ ·æœ¬ç‚¹æ¥æ›´æ–°å›å½’ç³»æ•°ã€‚</p></li>
<li><p>æ”¹è¿›ç‰ˆéšæœºæ¢¯åº¦ä¸Šå‡</p>
<p>ç”¨éšæœºçš„ä¸€ä¸ªæ ·æœ¬æ¥æ›´æ–°å›å½’ç³»æ•°ã€‚</p></li>
<li><p>æ‰¹æ¢¯åº¦ä¸Šå‡</p>
<p>åˆ‡åˆ†æ ·æœ¬é›†ï¼Œéšæœºå–å‡ºåˆ‡åˆ†åçš„æŸäº›æ ·æœ¬ï¼Œè¿›è¡Œéå†</p></li>
</ol>
<p>æŸå¤±å‡½æ•°ï¼ˆä»£ä»·å‡½æ•°ï¼‰</p>
<ol type="1">
<li><p>äºŒæ¬¡ä»£ä»·å‡½æ•°</p>
<p><span class="math display">\[
C= \frac{1}{2n}\sum_\limits{n}[y(x)-a^L(x)]^2
\]</span></p></li>
<li><p>äº¤å‰ç†µä»£ä»·å‡½æ•°</p>
<p><span class="math display">\[
C=\frac{1}{2n}\sum_\limits{x}[y\ln a-(1-y)\ln(1-a)]
\]</span></p></li>
<li><p>å¯¹æ•°ä¼¼ç„¶å‡½æ•°</p>
<p><span class="math display">\[
C=\frac{1}{n}\sum_\limits{x}\sum_\limits{k}y_k\log a_k
\]</span></p>
<p>å‰å‘ä¼ æ’­æ˜¯å‡½æ•°æ±‚åå¯¼ï¼Œåå‘ä¼ æ’­å‡å°‘äº†è¿™ä¸ªè®¡ç®—é‡</p></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> (deriv == <span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line">X = np.array([[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">y = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br><span class="line"></span><br><span class="line">syn_0 = <span class="number">2</span> * np.random.random((<span class="number">3</span>, <span class="number">4</span>)) - <span class="number">1</span></span><br><span class="line">syn_1 = <span class="number">2</span> * np.random.random((<span class="number">4</span>, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥æ­¥é•¿</span></span><br><span class="line">alphas = [<span class="number">0.001</span>,<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> alpha <span class="keyword">in</span> alphas:</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        l0 = X</span><br><span class="line">        l1 = sigmoid(np.dot(l0, syn_0))</span><br><span class="line">        <span class="comment"># åŠ äº†ä¸€å±‚ç¥ç»ç½‘ç»œï¼Œç§°ä¸ºéšè—å±‚</span></span><br><span class="line">        l2 = sigmoid(np.dot(l1, syn_1))</span><br><span class="line">        l2_error = y - l2</span><br><span class="line">        l2_delta = l2_error * sigmoid(l2, deriv=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># è®¡ç®—å®Œl2çš„è¯¯å·®ä¹‹åï¼Œå†ç”¨ç»“æœå»è®¡ç®—l1çš„è¯¯å·®</span></span><br><span class="line">        l1_error = np.dot(l2_delta, syn_1.T)</span><br><span class="line">        l1_delta = l1_error * sigmoid(l1, deriv=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># æ›´æ–°æƒé‡çš„æ—¶å€™åŠ å…¥æ­¥é•¿</span></span><br><span class="line">        syn_1 += alpha * np.dot(l1.T, l2_delta)</span><br><span class="line">        syn_0 += alpha * np.dot(l0.T, l1_delta)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;alpha:&quot;</span>, alpha, <span class="string">&quot;l1:&quot;</span>, l1)</span><br></pre></td></tr></table></figure>
<h2
id="æ”¹è¿›ç¥ç»ç½‘ç»œv2.0æ›´æ”¹éšå•å…ƒä¸ªæ•°">æ”¹è¿›ç¥ç»ç½‘ç»œv2.0â€”â€”æ›´æ”¹éšå•å…ƒä¸ªæ•°</h2>
<p>æ›´æ”¹ç½‘ç»œçš„ç¥ç»å…ƒä¸ªæ•°ï¼Œè¿™ä¸ªå¯èƒ½å°±æ˜¯æ‰€è°“çš„ç„å­¦è°ƒå‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> (deriv == <span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line">X = np.array([[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">y = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç¥ç»å…ƒä¸ªæ•°ï¼Œéšæœº</span></span><br><span class="line">hidden_dim = np.random.randint(<span class="number">2</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">syn_0 = <span class="number">2</span> * np.random.random((<span class="number">3</span>, hidden_dim)) - <span class="number">1</span></span><br><span class="line">syn_1 = <span class="number">2</span> * np.random.random((hidden_dim, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    l0 = X</span><br><span class="line">    l1 = sigmoid(np.dot(l0, syn_0))</span><br><span class="line">    l2 = sigmoid(np.dot(l1, syn_1))</span><br><span class="line">    l2_error = y - l2</span><br><span class="line">    l2_delta = l2_error * sigmoid(l2, deriv=<span class="literal">True</span>)</span><br><span class="line">    l1_error = np.dot(l2_delta, syn_1.T)</span><br><span class="line">    l1_delta = l1_error * sigmoid(l1, deriv=<span class="literal">True</span>)</span><br><span class="line">    syn_1 += np.dot(l1.T, l2_delta)</span><br><span class="line">    syn_0 += np.dot(l0.T, l1_delta)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(l1)</span><br></pre></td></tr></table></figure>
<h2 id="æ”¹è¿›ç¥ç»ç½‘ç»œv3.0dropout">æ”¹è¿›ç¥ç»ç½‘ç»œv3.0â€”â€”dropout</h2>
<p><a href="http://iamtrask.github.io/2015/07/28/dropout/">Hinton's
Dropout in 3 Lines of Python</a></p>
<p>å¢åŠ <strong>dropout_percent</strong>ã€‚ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä¸€ç§æ­£åˆ™åŒ–çš„æ‰‹æ®µã€‚åœ¨è¿­ä»£çš„æ—¶å€™ï¼Œå¯¹æŸä¸€ï¼ˆå‡ ï¼‰å±‚ç¥ç»ç½‘ç»œè¿›è¡Œ<strong>drop_out</strong>ã€‚è¿™é‡Œä¸¾ä¾‹ç”¨äºŒé¡¹åˆ†å¸ƒé‡‡æ ·çš„æ–¹æ³•è¿›è¡Œã€‚<code>np.random.binomial(n, p, size=None)</code>ã€‚</p>
<p>Dropoutæ˜¯æŒ‡åœ¨æ¨¡å‹è®­ç»ƒæ—¶<strong>éšæœº</strong>è®©ç½‘ç»œ<strong>æŸäº›éšå«å±‚èŠ‚ç‚¹</strong>çš„æƒé‡ä¸å·¥ä½œï¼Œä¸å·¥ä½œçš„é‚£äº›èŠ‚ç‚¹å¯ä»¥æš‚æ—¶è®¤ä¸ºä¸æ˜¯ç½‘ç»œç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒçš„æƒé‡å¾—ä¿ç•™ä¸‹æ¥ï¼ˆåªæ˜¯æš‚æ—¶ä¸æ›´æ–°è€Œå·²ï¼‰ã€‚</p>
<p>ä¸€äº›ç†ç”±è§£é‡Šï¼š</p>
<ol type="1">
<li>æƒå€¼çš„æ›´æ–°ä¸ä¾èµ–äºä¸€äº›å›ºå®šå…³ç³»éšå«èŠ‚ç‚¹çš„å…±åŒä½œç”¨ã€‚é˜»æ­¢äº†æŸäº›ç‰¹å¾ä»…ä»…åœ¨å…¶å®ƒç‰¹å®šç‰¹å¾ä¸‹æ‰æœ‰æ•ˆæœçš„æƒ…å†µã€‚å³éšæœºé€‰å–å½“å‰éšå«å±‚çš„éƒ¨åˆ†èŠ‚ç‚¹</li>
<li>æ¨¡å‹å¹³å‡æ¦‚å¿µï¼ˆé€‰å–æ¯æ¬¡è®¡ç®—è¿‡ç¨‹çš„ç›¸å¯¹æœ€ä¼˜è§£ï¼‰ï¼Œä½¿ç”¨äº†
<code>dropout</code>ä¹‹åæ¯æ¬¡çš„ç½‘ç»œç»“æ„ä¸åŒï¼Œæ ·æœ¬ä¸åŒå¯¹åº”çš„è¾“å‡ºæ¨¡å‹ä¹Ÿä¸åŒã€‚ï¼ˆä¸ªäººæ„Ÿè§‰æœ‰ç‚¹åƒåŠ å…¥éšæœºï¼‰</li>
<li>ç”Ÿç‰©è¿›åŒ–è§£é‡Šï¼Œä¸æ–­é€‚åº”å˜åŒ–æƒ…å†µï¼Œæœ‰æ•ˆé˜»æ­¢è¿‡æ‹Ÿåˆï¼ˆé¿å…ç¯å¢ƒæ”¹å˜ç‰©ç§é¢ä¸´æ­»äº¡ï¼‰</li>
<li>æœ´ç´ è´å¶æ–¯ï¼ˆnative
bayesï¼‰å±äºdropoutçš„ä¸€ç§ç‰¹ä¾‹ï¼šå„ä¸ªç‰¹å¾ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚åœ¨è®­ç»ƒæ ·æœ¬å°‘çš„æƒ…å†µä¸‹ï¼Œå•ç‹¬å¯¹æ¯ä¸ªç‰¹å¾è¿›è¡Œå­¦ä¹ ï¼ˆdropoutæ˜¯è®­ç»ƒä¸€éƒ¨åˆ†ç‰¹å¾ï¼‰ã€‚</li>
</ol>
<p>è¿™é‡Œå‡è®¾å¯¹<span class="math inline">\(l_1\)</span>è¿›è¡Œdrop_outã€‚</p>
<p>å®šä¹‰ <code>len(x)=3, hidden_dim=4, dropout_percent=0.2</code></p>
<p>ä»£å…¥æ•°å€¼è®¡ç®—,</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">np.random.binomial([array([[ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>],</span><br><span class="line">                           [ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>],</span><br><span class="line">                           [ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>]])], <span class="number">0.8</span>)[<span class="number">0</span>] * (<span class="number">1</span>/<span class="number">0.8</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤çš„dropout_percentæ˜¯0.5, å³å¦‚æœä¸åŠ å¦‚dropout_percentçš„è¯</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯å¯¹å›¾åƒè¿›è¡Œæ“ä½œçš„è¯ï¼Œå»ºè®®ä¸è¶…è¿‡0.25</span></span><br><span class="line">dropout_percent = <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">l1 *= np.random.binomial([np.ones((<span class="built_in">len</span>(X), hidden_dim))],<span class="number">1</span> - dropout_percent)[<span class="number">0</span>] *(<span class="number">1.0</span>/(<span class="number">1</span> - dropout_percent))</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>P.S:</p>
<p>å¯¹äºŒé¡¹åˆ†å¸ƒè¿›è¡Œé‡‡æ ·ã€‚è¿™é‡Œçš„nä¸º
<code>[np.ones((len(X), hidden_dim))]</code>ï¼Œpä¸º
<code>1-dropout_percent</code></p>
<p><code>np.random.binomial(n, p, size=None)</code></p>
<p>å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><span class="math display">\[
P(N)=C^0_n*p^0*(1-p)^n=(1-p)^n
\]</span></p>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/hexo_blog/2018/08/20/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0%E2%85%A1/" title="ç¥ç»ç½‘ç»œç¬”è®°â…¡">ç¥ç»ç½‘ç»œç¬”è®°â…¡</a></p>
<p>æ¨èé˜…è¯»</p>
<p><a
href="https://www.zybuluo.com/hanbingtao/note/433855">é›¶åŸºç¡€å…¥é—¨æ·±åº¦å­¦ä¹ </a></p>
]]></content>
      <categories>
        <category>DeepLearning</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ç¥ç»ç½‘ç»œ</tag>
        <tag>NumPy</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿æ€§ä»£æ•°ä¸­å„ç§çŸ©é˜µçš„ç®€ä»‹</title>
    <url>/hexo_blog/2019/05/13/%E6%95%B0%E5%AD%A6/%E7%BA%BF%E4%BB%A3%E7%9F%A9%E9%98%B5/</url>
    <content><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†çº¿æ€§ä»£æ•°çš„çŸ©é˜µï¼Œä»…ä½œç¬”è®°ã€‚</p>
<span id="more"></span>
<p>æ–¹é˜µï¼šè¡Œæ•°åˆ—æ•°ç›¸åŒçš„çŸ©é˜µ</p>
<p>å¯¹ç§°çŸ©é˜µï¼š<span
class="math inline">\(A=A^T\)</span>çš„çŸ©é˜µï¼ŒçŸ©é˜µç­‰äºå®ƒè‡ªå·±çš„è½¬ç½®çŸ©é˜µ</p>
<p>åå¯¹ç§°çŸ©é˜µï¼š<span class="math inline">\(A=-A^T\)</span></p>
<p>åŸƒå°”ç±³ç‰¹çŸ©é˜µï¼ˆHermitian matrixï¼‰ï¼š<span
class="math inline">\(A=A^*\)</span>ï¼ŒçŸ©é˜µç­‰äºå®ƒè‡ªå·±çš„å…±è½­è½¬ç½®çŸ©é˜µ</p>
<p>æ–œåŸƒå°”ç±³ç‰¹çŸ©é˜µï¼šååŸƒå°”ç±³ç‰¹çŸ©é˜µï¼Œ<span class="math inline">\(A =
âˆ’A^*\)</span></p>
<p>æ­£å®šçŸ©é˜µï¼š<span class="math inline">\(Q(x)=x^T A
x\)</span>ï¼Œä»»æ„éé›¶å‘é‡<span
class="math inline">\(x\)</span>ï¼Œè‹¥æ»¡è¶³<span
class="math inline">\(Q(x)&gt;0\)</span>ï¼Œåˆ™<span
class="math inline">\(A\)</span>ä¸ºæ­£å®šçŸ©é˜µ</p>
<p>åŠæ­£å®šçŸ©é˜µï¼šåŒä¸Šï¼Œ<span class="math inline">\(Q(x) \geq
0\)</span>ï¼Œåˆ™Aä¸ºåŠæ­£å®šçŸ©é˜µ</p>
<p>åŠè´Ÿå®šçŸ©é˜µï¼šåŒä¸Šï¼Œ<span class="math inline">\(Q(x) \leq
0\)</span>ï¼Œåˆ™Aä¸ºåŠè´Ÿå®šçŸ©é˜µ</p>
<p>ä¸å®šçŸ©é˜µï¼šè‹¥Aæ—¢ä¸æ˜¯åŠæ­£å®šçŸ©é˜µï¼Œä¹Ÿä¸æ˜¯åŠè´Ÿå®šçŸ©é˜µï¼Œåˆ™Aä¸ºä¸å®šçŸ©é˜µ</p>
<p>ä¸Šä¸‰è§’çŸ©é˜µï¼šçŸ©é˜µå¯¹è§’çº¿å·¦ä¸‹æ–¹ç³»æ•°å…¨ä¸º0</p>
<p>ä¸‹ä¸‰è§’çŸ©é˜µï¼šçŸ©é˜µå¯¹è§’çº¿å³ä¸Šæ–¹ç³»æ•°å…¨ä¸º0</p>
<p>ä¸‰å¯¹è§’çŸ©é˜µï¼šéé›¶ç³»æ•°åœ¨ä¸»å¯¹è§’çº¿ä¸Šï¼Œä¹Ÿåœ¨æ¯”ä¸»å¯¹è§’çº¿ä½å’Œé«˜ä¸€è¡Œçš„å¯¹è§’çº¿ä¸Šã€‚</p>
<p>å•ä½çŸ©é˜µï¼š<span class="math inline">\(I\)</span>,
çŸ©é˜µå¯¹è§’çº¿å…ƒç´ ä¸º1ï¼Œå…¶ä½™ä¸º0</p>
<p>é«˜æ–¯çŸ©é˜µï¼šé¦–å…ˆæ»¡è¶³å•ä½çŸ©é˜µï¼Œå…¶æ¬¡æŸåˆ—ç³»æ•°é0</p>
<p>é€†çŸ©é˜µï¼šåçŸ©é˜µï¼Œ<span
class="math inline">\(AB=I\)</span>ï¼ŒAæ˜¯å¯é€†çš„ï¼ŒBæ˜¯Açš„é€†çŸ©é˜µ</p>
<p>ä¼´éšçŸ©é˜µï¼š<strong>A</strong>å…³äºç¬¬<em>i</em>è¡Œç¬¬<em>j</em>åˆ—çš„<strong>ä½™å­å¼</strong>ï¼Œæ˜¯å»æ‰<strong>A</strong>çš„ç¬¬<em>i</em>è¡Œç¬¬<em>j</em>åˆ—ä¹‹åå¾—åˆ°çš„(<em>n</em>
âˆ’ 1)Ã—(<em>n</em> âˆ’ 1)çŸ©é˜µçš„è¡Œåˆ—å¼ã€‚</p>
<p>é˜¶æ¢¯å‹çŸ©é˜µï¼šä»ä¸Šè‡³ä¸‹ï¼Œ<span
class="math inline">\(A_{ii}\)</span>ä¹‹å‰çš„å…ƒç´ ä¸º0</p>
<p>é…‰çŸ©é˜µï¼š<span class="math inline">\(UU^*=U^*U=I\)</span>ï¼Œ<span
class="math inline">\(U^*\)</span>ä¸ºUçŸ©é˜µçš„å…±è½­è½¬ç½®ï¼Œåˆ™Uä¸ºé…‰çŸ©é˜µ</p>
<p>å¯¹è§’çŸ©é˜µï¼šåªæœ‰çŸ©é˜µä¸­çš„å¯¹è§’çº¿å­˜åœ¨å€¼ï¼Œå…¶ä»–åœ°æ–¹ä¸º0</p>
<p>ç©ºçŸ©é˜µï¼šè¡Œæ•°æˆ–åˆ—æ•°ä¸ºé›¶çš„çŸ©é˜µ</p>
<p>åˆ†å—çŸ©é˜µï¼šæ˜¯æŒ‡ä¸€ä¸ªå¤§çŸ©é˜µåˆ†å‰²æˆâ€œçŸ©é˜µçš„çŸ©é˜µâ€œ</p>
<p>æ­£äº¤çŸ©é˜µï¼šæ»¡è¶³æ–¹é˜µï¼Œ<span
class="math inline">\(Q^T=Q^{-1}\)</span>ï¼Œ<span
class="math inline">\(Q^TQ=QQ^T=I\)</span>ï¼Œæ­£äº¤çŸ©é˜µçš„è¡Œåˆ—å¼ä¸º1</p>
<p>æ—‹è½¬çŸ©é˜µï¼šåœ¨ä¹˜ä»¥ä¸€ä¸ªå‘é‡çš„æ—¶å€™æ”¹å˜å‘é‡çš„æ–¹å‘ä½†ä¸æ”¹å˜å¤§å°çš„æ•ˆæœå¹¶ä¿æŒäº†æ‰‹æ€§çš„çŸ©é˜µ</p>
<p>æ­£è§„çŸ©é˜µï¼š<span class="math inline">\(A^{*}A=AA^*\)</span>ï¼Œ<span
class="math inline">\(A^*\)</span>ä¸º<span
class="math inline">\(A\)</span>çš„å…±è½­çŸ©é˜µ</p>
<p>å…±è½­çŸ©é˜µï¼š<span class="math inline">\(A^*=(\bar{A})^T\)</span>ï¼Œ<span
class="math inline">\(\bar{A}\)</span>è¡¨ç¤ºçŸ©é˜µçš„å¤å…±è½­</p>
<p>å¥‡å¼‚çŸ©é˜µï¼šæ»¡è¶³æ–¹é˜µï¼ŒçŸ©é˜µçš„è¡Œåˆ—å¼æ˜¯å¦ç­‰äº0ï¼Œè‹¥ç­‰äº0ï¼Œç§°çŸ©é˜µAä¸ºå¥‡å¼‚çŸ©é˜µ</p>
<p>éå¥‡å¼‚çŸ©é˜µï¼šåŒä¸Šï¼Œè‹¥ä¸ç­‰äº0ï¼Œç§°çŸ©é˜µAä¸ºéå¥‡å¼‚çŸ©é˜µã€‚</p>
<p>ç¨€ç–çŸ©é˜µï¼šè‹¥æ•°å€¼ä¸º0çš„å…ƒç´ æ•°ç›®è¿œè¿œå¤šäºé0å…ƒç´ çš„æ•°ç›®ï¼Œå¹¶ä¸”é0å…ƒç´ åˆ†å¸ƒæ²¡æœ‰è§„å¾‹æ—¶</p>
<p>ç¨ å¯†çŸ©é˜µï¼šä¸ä¸Šç›¸åï¼Œè‹¥é0å…ƒç´ æ•°ç›®å å¤§å¤šæ•°æ—¶</p>
<p>å¢å¹¿çŸ©é˜µï¼šæ‰©å¢çŸ©é˜µï¼Œåœ¨ç³»æ•°çŸ©é˜µçš„å³è¾¹æ·»ä¸Šä¸€åˆ—ï¼Œè¿™ä¸€åˆ—æ˜¯çº¿æ€§æ–¹ç¨‹ç»„çš„ç­‰å·å³è¾¹çš„å€¼</p>
<p>ç³»æ•°çŸ©é˜µï¼šå°†æ–¹ç¨‹ç»„çš„ç³»æ•°ç»„æˆçŸ©é˜µæ¥è®¡ç®—æ–¹ç¨‹çš„è§£</p>
<p>ç›¸ä¼¼çŸ©é˜µï¼šåˆ¤æ–­ç‰¹å¾å€¼ã€è¡Œåˆ—å¼ã€è¿¹ã€ç§©æ˜¯å¦ç›¸ç­‰ï¼Œåªä½œä¸ºåˆ¤æ–­çŸ©é˜µæ˜¯å¦ç›¸ä¼¼çš„å¿…è¦æ¡ä»¶ï¼Œè€Œéå……åˆ†æ¡ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ‘è“æ´¾æ§åˆ¶æ‰‹æœºè‡ªåŠ¨æ‹ç…§</title>
    <url>/hexo_blog/2023/11/26/IOT/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%8E%A7%E5%88%B6%E6%89%8B%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%8B%8D%E7%85%A7/</url>
    <content><![CDATA[<p>æ ‘è“æ´¾ä½¿ç”¨ Python æ§åˆ¶æ‰‹æœºä¸Šçš„ DroidCam è‡ªåŠ¨æ‹ç…§</p>
<span id="more"></span>
<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<p>æ–°ä¹°äº†ä¸ªç›†æ ½ï¼Œæƒ³è¦å…³æ³¨ç›†æ ½çš„ç”Ÿé•¿æƒ…å†µã€‚å¦‚æœæ˜¯æ‘„åƒï¼Œâ€œä»£ä»·â€åˆæœ‰ç‚¹å¤§ã€‚æƒ³åˆ°äº†
DroidCam
è¿™ä¸ªè½¯ä»¶ï¼Œèƒ½å¤Ÿè®©æ‰‹æœºå˜æˆç›‘æ§æ‘„åƒå¤´ã€‚äºæ˜¯ï¼Œå¯ä»¥åˆ©ç”¨å®ƒåšä¸€ä¸ªè‡ªåŠ¨æ‹ç…§çš„å»¶æ—¶æ‘„å½±ã€‚</p>
<h2 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h2>
<ul>
<li>æ‰‹æœºï¼ˆIOSã€Android å‡å¯ï¼‰ + DroidCam è½¯ä»¶</li>
<li>æ ‘è“æ´¾ï¼ˆå¸¸å¹´å¼€æœºçš„å°ä¸»æœºï¼Œèƒ½ç”¨ Pythonå°±è¡Œï¼‰</li>
<li>å…¶ä»–é‡è¦çš„å†…å®¹ï¼š
<ul>
<li>æ‰‹æœºæ”¯æ¶</li>
<li>æ‰‹æœºå……ç”µçš„ç”µæº</li>
</ul></li>
</ul>
<p>å¤§è‡´æ•ˆæœå¦‚å›¾</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/raspberry_droidcam/IMG_20201126_201708.jpg" /></p>
<h2 id="v1.0">v1.0</h2>
<p>åœ¨æ­å»ºå®ŒåŸºæœ¬çš„è®¾æ–½ä¹‹åï¼Œé¦–å…ˆæµ‹è¯•æ‹ç…§åŠŸèƒ½ï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼Œå°† $IP_ADDR
æ¢æˆæ‰‹æœº IP åœ°å€å³å¯ï¼ŒDroidCam ä¸»ç•Œé¢ä¹Ÿä¼šæ˜¾ç¤ºã€‚é»˜è®¤ç«¯å£æ˜¯ 4747</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget <span class="string">&quot;http://<span class="variable">$IP_ADDR</span>:4747/cam/1/frame.jpg&quot;</span> -O $(<span class="built_in">date</span> +<span class="string">&quot;%s&quot;</span>).jpg</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œï¼Œåœ¨æŠŠè¿™è¡Œå‘½ä»¤æ”¾åˆ°æ ‘è“æ´¾ä¸Šçš„å®šæ—¶ä»»åŠ¡ä¸­æ—¶ï¼Œé‡åˆ°äº†å‡ ä¸ªé—®é¢˜</p>
<h3 id="æ™šä¸Šå…‰çº¿æš—">æ™šä¸Šå…‰çº¿æš—</h3>
<p>æ‰“å¼€æ‰‹æœºæ‘„åƒå¤´çš„é—ªå…‰ç¯ï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl <span class="string">&quot;http://<span class="variable">$IP_ADDR</span>:4747/cam/1/led_toggle&quot;</span> \</span><br><span class="line">  --compressed \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
<h3 id="æ²¡æœ‰å¯¹ç„¦">æ²¡æœ‰å¯¹ç„¦</h3>
<p>è‡ªåŠ¨å¯¹ç„¦å‘½ä»¤å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">af_cmd = f<span class="string">&quot;&quot;</span><span class="string">&quot;curl &quot;</span>http://<span class="variable">$IP_ADDR</span>:4747/cam/1/af<span class="string">&quot; \</span></span><br><span class="line"><span class="string">  --compressed \</span></span><br><span class="line"><span class="string">  --insecure</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªé—®é¢˜ç®—æ˜¯å¯ä»¥é€šè¿‡è½¯ä»¶æœ¬èº«è¿›è¡Œè§£å†³ã€‚ä½†å¼•å‘äº†ä¸€ä¸ªæ–°é—®é¢˜å°±æ˜¯ï¼Œä¸èƒ½çŸ¥é“æ‰‹æœºæ˜¯å¦å·²ç»å¼€å¯é—ªå…‰ç¯ã€æ˜¯å¦å·²ç»å¯¹ç„¦ã€‚å‰è€…å¯ä»¥é€šè¿‡æ—¶é—´åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ç™½å¤©åˆ™ä¸å¼€ï¼Œä½†åè€…æ²¡åŠæ³•æ§åˆ¶ã€‚DroidCam
çš„é€»è¾‘æ˜¯ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æ‰“å¼€ç½‘å€ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯æ‰“å¼€ï¼Œåè€…ä¼šæŠŠå‰è€…è¸¢ä¸‹çº¿ï¼Œä¸”çŠ¶æ€ä¸ºæ­¢ã€‚å› æ­¤ï¼Œæœ€åå†³å®šæ¯æ¬¡æ‹ä¸¤å¼ ç…§ç‰‡ï¼Œç”¨ç…§ç‰‡å¤§å°æ¥åˆ¤æ–­å›¾ç‰‡è´¨é‡ã€‚</p>
<h3 id="droidcam-è¦æ±‚å¯åŠ¨æ‘„åƒå¤´åæ‰èƒ½æ‹ç…§">DroidCam
è¦æ±‚å¯åŠ¨æ‘„åƒå¤´åï¼Œæ‰èƒ½æ‹ç…§</h3>
<p>ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜æ˜¯ï¼ŒDroidCam
è¦æ±‚å¯åŠ¨æ‘„åƒå¤´åï¼Œæ‰èƒ½æ‹ç…§ã€‚è€Œå¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯æ‰“å¼€ç½‘å€ï¼Œåˆ™æ‘„åƒå¤´ä¸ä¼šå¯åŠ¨ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨è¯·æ±‚å‰ï¼Œå»å¼€å¯ç½‘å€ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">start_func</span>():</span><br><span class="line">    video_url = <span class="string">&quot;http://&#123;&#125;/video?640x480&quot;</span>.<span class="built_in">format</span>(ip_addr)</span><br><span class="line">    response = requests.get(video_url, stream=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;start_func&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¯åŠ¨
DroidCamï¼Œæ‰‹æœºåˆ™ä¼šè‡ªåŠ¨æ¯å±ï¼Œå¯¼è‡´ä¹‹åçš„æ‹ç…§å…¨éƒ¨å¤±è´¥ã€‚</p>
<h2 id="å®ç°">å®ç°</h2>
<p>è§ä¸‹é¢ä»£ç çš„ <code>take_picture.py</code>
éƒ¨åˆ†ï¼Œåªéœ€å°†å…¶è®¾ç½®ä¸ºå®šæ—¶ä»»åŠ¡å³å¯
<code>*/10 * * * * cd /root/pics &amp;&amp; /usr/bin/python3 take_picture.py</code>ã€‚æ¯
10 åˆ†é’Ÿä¼šå»æ‹ä¸€æ¬¡ç…§ï¼Œä¸”ä¼šæ‹ä¸¤å¼ ï¼Œä»¥æ—¶é—´æˆ³ä¿å­˜åœ¨ <code>/root/pics</code>
ç›®å½•ä¸‹ã€‚</p>
<script src="https://gist.github.com/wnma3mz/a583832cbca9965a733834fbcae42352.js"></script>
<h2 id="v2.0">v2.0</h2>
<p>ç…§ç‰‡æ•°æ®é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±è¦å¤„ç†ç…§ç‰‡çš„åˆ é™¤ã€å¤„ç†ã€åˆæˆé€»è¾‘äº†ã€‚</p>
<p>è§ä¸Šé¢ä»£ç çš„ <code>process.py</code> éƒ¨åˆ†</p>
<p>ç®€å•æ¥è¯´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol type="1">
<li>è·å–å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„å›¾ç‰‡ï¼Œä»¥æ—¶é—´æˆ³è¿›è¡Œæ’åºï¼Œæ—¶é—´æˆ³é—´éš”å°äº 60
ç§’çš„ç…§ç‰‡ï¼Œåªä¿ç•™ä¸€å¼ ï¼ˆä»¥å›¾ç‰‡å¤§å°å®šï¼‰ã€‚</li>
<li>æŒ‰ç…§æ—¥æœŸè¿›è¡Œç§»åŠ¨ï¼Œå¹¶æ‰“åŒ…æˆ zip æ–‡ä»¶ã€‚</li>
<li>åœ¨ PC ç«¯è¿è¡Œ
<code>python3 process.py --convert</code>ï¼Œä¼šæ‹‰å–æ ‘è“æ´¾çš„å‹ç¼©åŒ…ï¼Œå¹¶è§£å‹
zip æ–‡ä»¶ï¼Œæœ€ååˆæˆè§†é¢‘ã€‚ï¼ˆä¸ºä»€ä¹ˆä¸åœ¨æ ‘è“æ´¾ä¸Šï¼Œæ€§èƒ½å¤ªå¼±ï¼Œå¾ˆæ…¢ï¼‰</li>
</ol>
<p>ffmpeg åˆå¹¶å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼Œä¼šé¢„å…ˆæŒ‰ç…§æ—¶é—´æˆ³æ’åºï¼Œå†™å…¥åˆ°
<code>input.txt</code> æ–‡ä»¶ä¸­ï¼Œç„¶ååˆå¹¶æˆè§†é¢‘ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffmpeg -f concat -i input.txt -vf <span class="string">&quot;fps=25&quot;</span> <span class="variable">$OUTPUT</span></span><br></pre></td></tr></table></figure>
<h2 id="æˆå“">æˆå“</h2>
<video id="video" controls="" preload="none">
<source id="mp4" src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/raspberry_droidcam/301_1697855508.mp4" type="video/mp4">
<p></videos></p>
]]></content>
      <categories>
        <category>Raspberry</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>DroidCam</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ‘è“æ´¾æŠ˜è…¾è®°å½•</title>
    <url>/hexo_blog/2023/11/26/IOT/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>ä½¿ç”¨æ ‘è“æ´¾çš„ä¸€äº›è®°å½•</p>
<span id="more"></span>
<h2 id="ç½‘ç»œ-wifi-é—®é¢˜">ç½‘ç»œ WiFi é—®é¢˜</h2>
<p>ä½¿ç”¨çš„ Zero
Wï¼Œæ²¡æœ‰ç½‘å£ã€‚æ‰€ä»¥åœ¨ä¸ä½¿ç”¨å›¾å½¢ç•Œé¢çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œé…ç½®ç½‘ç»œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
<p>ssid æ˜¯ WiFi åç§°ï¼Œpsk æ˜¯å¯†ç ï¼Œpriority
æ˜¯ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚æœ‰äº›ä½ç‰ˆæœ¬çš„æ ‘è“æ´¾ï¼Œåªèƒ½è¿æ¥ 2.4G çš„
Wifiã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">country=US</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">    ssid=<span class="string">&quot;ABC&quot;</span></span><br><span class="line">    psk=<span class="string">&quot;password&quot;</span></span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    priority=9</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WiFi é‡å¯å‘½ä»¤ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> wlan0 down &amp;&amp; ip <span class="built_in">link</span> <span class="built_in">set</span> wlan up</span><br></pre></td></tr></table></figure></p>
<h2 id="fbterm-å­—ä½“é—®é¢˜">fbterm å­—ä½“é—®é¢˜</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.fbtermrc</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">font-names=mono</span><br><span class="line">font-size=12</span><br></pre></td></tr></table></figure>
<p><a
href="https://bbs.deepin.org/post/230435">https://bbs.deepin.org/post/230435</a></p>
<h2 id="è·å–å°ç±³æ¸©æ¹¿åº¦è®¡çš„æ•°æ®">è·å–å°ç±³æ¸©æ¹¿åº¦è®¡çš„æ•°æ®</h2>
<h3 id="éœ€æ±‚">éœ€æ±‚</h3>
<p>å°ç±³æ¸©æ¹¿åº¦è®¡ç”¨ç±³å®¶è¿æ¥é€Ÿåº¦æ…¢ï¼Œä¸”è·å–é—´éš”ä¸º 1
å°æ—¶ä¸€æ¬¡ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ…¢ï¼Œæƒ³è¦æ‰‹åŠ¨ä¿å­˜è¿™äº›æ•°æ®ã€‚</p>
<p>æœ¬æ¥æ˜¯æƒ³ä½¿ç”¨ HomeAssistant æ¥å®Œæˆçš„ï¼Œä½†å‘ç° Python ç‰ˆæœ¬è¦æ±‚ 3.8
ä»¥ä¸Šï¼Œè€Œæ ‘è“æ´¾ä¸Šçš„ Python ç‰ˆæœ¬æ˜¯
3.7ã€‚ä¸”å°±è¿™ä¸€ä¸ªè®¾å¤‡ï¼Œæ„Ÿè§‰æ²¡å¿…è¦é‚£ä¹ˆå¤æ‚ã€‚</p>
<p>å¥½åœ¨å·²ç»æœ‰æˆç†Ÿçš„å¼€æºé¡¹ç›®å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œ<a
href="https://github.com/JsBergbau/MiTemperature2">https://github.com/JsBergbau/MiTemperature2</a>ã€‚ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•</p>
<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<p>å®‰è£…è“ç‰™é©±åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥å…ˆè¾“å…¥ bluetoothctl çœ‹çœ‹æ˜¯å¦å¯ä»¥è¿›å…¥è“ç‰™äº¤äº’ç•Œé¢ï¼Œå¦‚æœå¯ä»¥åˆ™æ— éœ€å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> apt update -y &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y </span><br><span class="line"><span class="built_in">sudo</span> apt install bluetooth pi-bluetooth bluez blueman mplayer -y</span><br></pre></td></tr></table></figure>
<p>python å®‰è£…ä¾èµ– <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip3 install bluepy</span><br></pre></td></tr></table></figure></p>
<h3 id="è·å–è®¾å¤‡ä¿¡æ¯">è·å–è®¾å¤‡ä¿¡æ¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥è“ç‰™äº¤äº’ç•Œé¢</span></span><br><span class="line">bluetoothctl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰«æé™„ä»¶çš„è“ç‰™è®¾å¤‡</span></span><br><span class="line">scan on</span><br></pre></td></tr></table></figure>
<p>ä¼šæŒç»­æ‰«æé™„è¿‘è“ç‰™è®¾å¤‡ï¼Œéœ€è¦å…³æ³¨ä¸€ä¸ªå«åš LYWSD03MMC
çš„è®¾å¤‡ï¼ˆåœ¨è®¾å¤‡åé¢æœ‰å‹å·ï¼‰ï¼Œè¿™ä¸ªå°±æ˜¯å°ç±³æ¸©æ¹¿åº¦è®¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">[NEW] Device AA:BB:CC:DD:EE:FF LYWSD03MMC</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è®°å½•è¿™ä¸ªè®¾å¤‡çš„ MAC åœ°å€ï¼Œé€€å‡ºè“ç‰™äº¤äº’ç•Œé¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="å®ç°">å®ç°</h3>
<p>åŸæ¥çš„ä»£ç è¿‡äºå¤æ‚ï¼Œè¿˜æ¶‰åŠä¸€äº›å…¶ä»–çš„åŠŸèƒ½ã€‚æ ¸å¿ƒåŠŸèƒ½æ˜¯ï¼Œè·å–æ¸©æ¹¿åº¦ä¿¡æ¯å³å¯ã€‚å› æ­¤ï¼Œæˆ‘å¯¹ä»£ç è¿›è¡Œäº†ç®€åŒ–ã€‚åœ¨å¤–é¢å¥—ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å³å¯ã€‚</p>
<p>æŠŠ MAC
åœ°å€å†™åˆ°ä¸‹é¢çš„è„šæœ¬ä¸­ï¼Œç„¶åè¿è¡Œè„šæœ¬ï¼Œå°±å¯ä»¥è·å–åˆ°æ¸©æ¹¿åº¦ä¿¡æ¯äº†ã€‚</p>
<script src="https://gist.github.com/wnma3mz/197a5665734e2449e591892da10cd08f.js"></script>
<p>æ¯ 10 åˆ†é’Ÿè·å–ä¸€æ¬¡æ¸©æ¹¿åº¦ä¿¡æ¯ï¼Œä¿å­˜åˆ° <code>temp.log</code>
æ–‡ä»¶ä¸­ã€‚å¦‚æœæ¯æ¬¡è·å–å¤±è´¥æ¬¡æ•°è¶…è¿‡ 5 æ¬¡ï¼Œåˆ™é€€å‡ºç¨‹åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*/10 * * * * <span class="built_in">cd</span> /root/MiTemperature2 &amp;&amp; /usr/bin/python3 mi_temp.py &gt;&gt; /root/MiTemperature2/temp.log</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„è„šæœ¬å¯ä»¥è·å–æ ‘è“æ´¾æœ¬èº«çš„æ¸©åº¦ä¿¡æ¯ï¼Œä¿å­˜åˆ° <code>temp.log</code>
æ–‡ä»¶ä¸­ã€‚å¯ä»¥è¿›è¡Œå¯¹æ¯” <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">date</span> +<span class="string">&quot;%Y-%m-%d %H:%M&quot;</span>` `vcgencmd measure_temp` &gt;&gt; /home/pi/temp_save/temp.log</span><br></pre></td></tr></table></figure></p>
<p>å‚è€ƒ</p>
<p>[1] <a
href="https://www.cnblogs.com/blueberry-mint/p/16575252.html">https://www.cnblogs.com/blueberry-mint/p/16575252.html</a></p>
<p>[2] <a
href="https://github.com/JsBergbau/MiTemperature2">https://github.com/JsBergbau/MiTemperature2</a></p>
<h2 id="notion-æ—¥å†å’Œè‹¹æœæ—¥å†è”åŠ¨">Notion æ—¥å†å’Œè‹¹æœæ—¥å†è”åŠ¨</h2>
<h3 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h3>
<p>Notion
ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„ç¬”è®°è½¯ä»¶ï¼Œå¸å¼•ç¬”è€…ä½¿ç”¨çš„ç‚¹åœ¨äºè·¨å¹³å°ï¼ŒåŠŸèƒ½é½å…¨ã€‚å› æ­¤ï¼Œåœ¨å°†
Notion ä½œä¸ºç¬”è®°è½¯ä»¶ä½¿ç”¨çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸º TODO
äº‹é¡¹ç®¡ç†è½¯ä»¶ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œç§»åŠ¨ç«¯çš„ Notion
å¹¶æ²¡æœ‰å®ç”¨çš„å°ç»„ä»¶è§†å›¾ã€‚å› æ­¤ï¼Œç»“åˆä¹‹å‰çš„æ–‡ç« æƒ³åˆ°ç”¨ ics æ–‡ä»¶æ¥ç®¡ç† Notion
çš„ TODO äº‹é¡¹ã€‚</p>
<h3 id="æ•°æ®è·å–">æ•°æ®è·å–</h3>
<p>Notion æ”¯æŒä»¥ API çš„æ–¹å¼è·å– Page çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯å½“ Page
ä¸­ä¸»è¦ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ—¶ï¼Œç”šè‡³å¯ä»¥ç”¨ä¸€ç³»åˆ—è¿‡æ»¤æ¡ä»¶ã€‚é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå·¥å…·ï¼Œä»¥èƒ½å¤Ÿç”¨
API çš„æ–¹å¼è·å– Notion ä¸­çš„ Page
ä¿¡æ¯ã€‚https://www.notion.so/my-integrationsï¼Œåˆ›å»ºè¿‡ç¨‹å¾ˆç®€å•ï¼Œä¸»è¦ä¿å­˜ä¸‹
Secrets å³å¯ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/notion_cal_apple/1701535383410.png" /></p>
<p>åˆ›å»ºå®Œæˆåï¼Œå°±å¯ä»¥åœ¨ Notion çš„ Page ä¸­ Add
connectionsï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥æŠŠåˆšåˆšåˆ›å»ºçš„å·¥å…·ï¼Œæ·»åŠ è¿›æ¥ã€‚æ¯”å¦‚è¿™é‡Œæ˜¯
123ã€‚</p>
<p><img
src="https://raw.githubusercontent.com/wnma3mz/blog_posts/master/imgs/notion_cal_apple/1701535461302.png" /></p>
<p>åŒæ—¶ï¼Œä¿å­˜ Page é¡µé¢çš„ urlï¼Œæ¯”å¦‚
https://www.notion.so/AAAï¼Œè®¿é—®é¡µé¢æ—¶çš„ urlï¼ŒAAA å°±æ˜¯
dataset_idã€‚è‡³æ­¤ï¼Œæœ‰ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯ Secretsï¼Œä¸€ä¸ªæ˜¯
dataset_idã€‚å°†å…¶ç²˜è´´è‡³ä¸‹é¢çš„ Python ä»£ç ä¸­ã€‚</p>
<p>Python çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"></span><br><span class="line">key = ...</span><br><span class="line">dataset_id = ...</span><br><span class="line">url = <span class="string">f&quot;https://api.notion.com/v1/databases/<span class="subst">&#123;dataset_id&#125;</span>/query&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">today = datetime(datetime.now().year, datetime.now().month, datetime.now().day)</span><br><span class="line">yesterday = today - timedelta(days=<span class="number">1</span>)  <span class="comment"># è®¡ç®—å‰ä¸€å¤©çš„æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;page_size&quot;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">&quot;filter&quot;</span>: &#123;&#125;, <span class="comment"># å¢åŠ ä¸€ç³»åˆ—è¿‡æ»¤æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥äº‹åç”¨ Python å†è¿‡æ»¤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;accept&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Notion-Version&quot;</span>: <span class="string">&quot;2022-06-28&quot;</span>,</span><br><span class="line">    <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;key&#125;</span>&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    response = requests.post(url, headers=headers, json=payload)</span><br><span class="line">    data_lst = response.json()[<span class="string">&quot;results&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼ŒPage ä¸Šçš„ä¿¡æ¯å·²ç»å­˜åˆ°äº† data_lst ä¸­ã€‚</p>
<h3 id="ics-æ–‡ä»¶ç”Ÿæˆ">ics æ–‡ä»¶ç”Ÿæˆ</h3>
<p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯ç”Ÿæˆ ics æ–‡ä»¶çš„ç”Ÿæˆã€‚ics æ–‡ä»¶çš„æ ¼å¼éœ€è¦æ—¥ç¨‹æ ‡é¢˜
<code>summary</code>ã€æ—¥ç¨‹æè¿°
<code>description</code>ï¼ˆå¯ä¸ºç©ºï¼‰ã€å¼€å§‹æ—¶é—´
<code>dtstart</code>ã€ç»“æŸæ—¶é—´ <code>dtend</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"><span class="keyword">from</span> icalendar <span class="keyword">import</span> Calendar, Event</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cal = Calendar()</span><br><span class="line">    cal[<span class="string">&quot;version&quot;</span>] = <span class="string">&quot;2.0&quot;</span></span><br><span class="line">    cal[<span class="string">&quot;prodid&quot;</span>] = <span class="string">&quot;-//ABC ICS//ZH&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> data_lst:</span><br><span class="line">        <span class="comment"># å¤„ç†æ¯æ¡ä¿¡æ¯ï¼Œå°†å…¶è½¬æ¢ä¸ºå¦‚ä¸‹ä¿¡æ¯</span></span><br><span class="line">        summary = ...</span><br><span class="line">        description = ...</span><br><span class="line">        dtstart = ...</span><br><span class="line">        dtend = ...</span><br><span class="line"></span><br><span class="line">        event = Event()</span><br><span class="line">        event.add(<span class="string">&quot;summary&quot;</span>, summary)</span><br><span class="line">        event.add(<span class="string">&quot;description&quot;</span>, description)</span><br><span class="line">        event.add(<span class="string">&quot;dtstart&quot;</span>, dtstart)</span><br><span class="line">        event.add(<span class="string">&quot;dtend&quot;</span>, dtend)</span><br><span class="line">        cal.add_component(event)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;my.ics&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(cal.to_ical())</span><br></pre></td></tr></table></figure>
<h3 id="ics-éƒ¨ç½²">ics éƒ¨ç½²</h3>
<p>å°†ç”Ÿæˆçš„ ics
æ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿äºæœåŠ¡å™¨å®šæœŸæ›´æ–°æ—¥ç¨‹ä¿¡æ¯ã€‚åŒæ—¶ï¼Œè‹¹æœå¯ä»¥è®¢é˜…è¯¥
icsï¼Œä»¥æ›´æ–°æ—¥ç¨‹ä¿¡æ¯ã€‚</p>
<p>å¯¹äº tailscale
è¿™ä¸€ç‚¹è€Œè¨€ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ã€‚å¦åˆ™ï¼Œéœ€è¦ä½¿ç”¨åŸŸå
+ nginx + httpsï¼Œè¿™æ ·æ‰èƒ½å°† ics æ–‡ä»¶æš´éœ²å‡ºå»ï¼Œä¸”è‹¹æœåªæ¥å— https çš„ ics
æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tailscale funnel --<span class="built_in">bg</span> https+insecure://localhost --set-path /ics /data/my.ics</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶è¿è¡Œä¸Šé¢çš„ python
è„šæœ¬ï¼Œä»¥æ›´æ–° notion ä¸Šçš„æ—¥ç¨‹ä¿¡æ¯è‡³ icsï¼Œæœ€åè‹¹æœæ‰‹æœºå†æ¥æ”¶åˆ° ics
æ–‡ä»¶å¯¹æ—¥å†è¿›è¡Œæ›´æ–°ã€‚</p>
<p>è‹¹æœæ‰‹æœºçš„è®¢é˜…æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>è®¾ç½® -&gt; æ—¥å† -&gt; è´¦æˆ· -&gt; æ·»åŠ è´¦æˆ· -&gt; å…¶ä»– -&gt;
æ·»åŠ å·²è®¢é˜…çš„æ—¥å† -&gt; è¾“å…¥ ics æ–‡ä»¶çš„ url å³å¯ï¼ˆæ¯”å¦‚è¿™é‡Œåº”è¯¥æ˜¯
https://A/icsï¼‰ã€‚è¿™æ ·å°±å®Œæˆäº†æ‰€æœ‰çš„è®¾ç½®</p>
]]></content>
      <categories>
        <category>Raspberry</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
